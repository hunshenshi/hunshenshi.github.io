<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Java设计模式之Builder模式 | big data decode club</title><meta name="keywords" content="java,Builder,设计模式"><meta name="author" content="混绅士"><meta name="copyright" content="混绅士"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="在这里我暂时这样理解，就是把复杂对象的构建过程和结果进行分离        也就是解耦 Builder模式概念The builder pattern is an object creation software design pattern. Unlike the abstract factory pattern and the factory method pattern whose inten">
<meta property="og:type" content="article">
<meta property="og:title" content="Java设计模式之Builder模式">
<meta property="og:url" content="http://bigdatadecode.top/Builder%20%E6%A8%A1%E5%BC%8F.html">
<meta property="og:site_name" content="big data decode club">
<meta property="og:description" content="在这里我暂时这样理解，就是把复杂对象的构建过程和结果进行分离        也就是解耦 Builder模式概念The builder pattern is an object creation software design pattern. Unlike the abstract factory pattern and the factory method pattern whose inten">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
<meta property="article:published_time" content="2015-12-02T07:30:16.000Z">
<meta property="article:modified_time" content="2022-01-17T08:58:24.252Z">
<meta property="article:author" content="混绅士">
<meta property="article:tag" content="java">
<meta property="article:tag" content="Builder">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://bigdatadecode.top/Builder%20%E6%A8%A1%E5%BC%8F"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="27E5EbutCm"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Java设计模式之Builder模式',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-01-17 16:58:24'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="big data decode club" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/uploads/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">119</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">197</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">big data decode club</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Java设计模式之Builder模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2015-12-02T07:30:16.000Z" title="发表于 2015-12-02 15:30:16">2015-12-02</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-01-17T08:58:24.252Z" title="更新于 2022-01-17 16:58:24">2022-01-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>19分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Java设计模式之Builder模式"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>在这里我暂时这样理解，就是把复杂对象的构建过程和结果进行分离        也就是解耦</p>
<h2 id="Builder模式概念"><a href="#Builder模式概念" class="headerlink" title="Builder模式概念"></a>Builder模式概念</h2><p>The builder pattern is an object creation software design pattern. Unlike the abstract factory pattern and the factory method pattern whose intention is to enable polymorphism, the intention of the builder pattern is to find a solution to the telescoping constructor anti-pattern[citation needed]. The telescoping constructor anti-pattern occurs when the increase of object constructor parameter combination leads to an exponential list of constructors. Instead of using numerous constructors, the builder pattern uses another object, a builder, that receives each initialization parameter step by step and then returns the resulting constructed object at once. （代替构造函数）</p>
<p>The builder pattern has another benefit. It can be used for objects that contain flat data (html code, SQL query, X.509 certificate…), that is to say, data that can’t be easily edited. This type of data cannot be edited step by step and must be edited at once. The best way to construct such an object is to use a builder class.（创建不可变对象）</p>
<p>定义<br>原文 – The intent of the Builder design pattern is to separate the construction of a complex object from its representation. By doing so the same construction process can create different representations.   （from wikipedia）<br>译文 – 将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
<p>定义有点抽象，先来看个Builder的一个比较直观的使用场景 —— 使用Builder代替具有多个参数（4个以上）的构造函数</p>
<span id="more"></span>

<h3 id="场景简介"><a href="#场景简介" class="headerlink" title="场景简介"></a>场景简介</h3><blockquote>
<p>如一个类表示包装食品外面显示的营养成分标签，标签中有些域是必须的，不过有些也是可选域。大多数产品在某几个可选域中都有非0值。对于这样的类，一般都使用重叠构造器（telescoping sconstructor）模式。这种模式将会出现过个构造函数，创建实例的时候选择合适的构造函数。例如如下代码：</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Telescoping constructor pattern - does not scale well!</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;  <span class="comment">//(ml) required</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;     <span class="comment">//(per container) required</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> calories;     <span class="comment">//  optional</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> fat;              <span class="comment">//  optional</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> sodium;           <span class="comment">//  optional</span></span><br><span class="line">    privatefinalintcarbohydrate;        <span class="comment">//  optional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(servingSize, servings, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">int</span> calories)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(servingSize, servings, calories, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">int</span> calories, <span class="keyword">int</span> fat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(servingSize, servings, calories, fat, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings,</span></span></span><br><span class="line"><span class="params"><span class="function">        <span class="keyword">int</span> calories, <span class="keyword">int</span> fat, <span class="keyword">int</span> sodium)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(servingSize, servings, calories, fat, sodium, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings, <span class="keyword">int</span> calories, <span class="keyword">int</span> fat, <span class="keyword">int</span> sodium, <span class="keyword">int</span> carbohydrate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.servingSize  = servingSize;</span><br><span class="line">        <span class="keyword">this</span>.servings = servings;</span><br><span class="line">        <span class="keyword">this</span>.calories = calories;</span><br><span class="line">        <span class="keyword">this</span>.fat = fat;</span><br><span class="line">        <span class="keyword">this</span>.sodium = sodium;</span><br><span class="line">        <span class="keyword">this</span>.carbohydrate = carbohydrate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用的时候使用NutritionFacts nut = new NutritionFacts(xx, xx, xx, xx, 0, xx); 这样的话可能就存在你不想给sodium赋值，但是你又得给carbohydrate赋值，就导致你必须给sodium传入0。如果参数数目更多的话，这种情况更糟糕，难以控制，而且当你传参的顺序弄错时，并不会提示错误，但运行可能会报错，对别人的可读性也不高。</p>
<h2 id="JavaBeans模式"><a href="#JavaBeans模式" class="headerlink" title="JavaBeans模式"></a>JavaBeans模式</h2><p>先来看第一种解决方案 —— JavaBeans模式</p>
<p>JavaBeans模式是调用一个无参构造函数创建对象，然后调用属性的setter方法对每个属性赋值。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaBeans Pattern - allows inconsistency, mandates mutability</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts</span> </span>&#123;</span><br><span class="line">   <span class="comment">// Parameters initialized to default values (if any)</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> servingSize = -<span class="number">1</span>; <span class="comment">// Required; no default value</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> servings=-<span class="number">1</span>;<span class="comment">//&quot;&quot;&quot;&quot;</span></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> calories=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> fat=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> sodium=<span class="number">0</span>;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">int</span> carbohydrate = <span class="number">0</span>;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="title">NutritionFacts</span><span class="params">()</span> </span>&#123; &#125;</span><br><span class="line">   <span class="comment">// Setters  汉子</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServingSize</span><span class="params">(<span class="keyword">int</span> val)</span>  </span>&#123; servingSize = val; &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setServings</span><span class="params">(<span class="keyword">int</span> val)</span>    </span>&#123; servings = val; &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCalories</span><span class="params">(<span class="keyword">int</span> val)</span>    </span>&#123; calories = val; &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFat</span><span class="params">(<span class="keyword">int</span> val)</span>         </span>&#123; fat = val; &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSodium</span><span class="params">(<span class="keyword">int</span> val)</span>      </span>&#123; sodium = val; &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCarbohydrate</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123; carbohydrate = val; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个代码比使用重叠构造函数的代码简单了点，阅读也较为容易，但是调用方法为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">NutritionFacts cocaCola = <span class="keyword">new</span> NutritionFacts();</span><br><span class="line">cocaCola.setServingSize(<span class="number">240</span>);</span><br><span class="line">cocaCola.setServings(<span class="number">8</span>);</span><br><span class="line">cocaCola.setCalories(<span class="number">100</span>);</span><br><span class="line">cocaCola.setSodium(<span class="number">35</span>);</span><br><span class="line">cocaCola.setCarbohydrate(<span class="number">27</span>);</span><br></pre></td></tr></table></figure>

<p>这种模式弥补了重叠构造函数的不足，使代码简单，可阅读；但是在调用时要先new一个对象，而无法保证我们在使用这个对象之前已经对相应的属性进行赋值。</p>
<p>JavaBeans模式的缺点是：使对象的构建过程分到几个调用中，在构造过程中可能处于不一致的状态。类无法仅仅通过检验构造器参数的有效性来保证一致性。试图使用处于不一致状态的对象，将会导致失败。这种失败与包含错误的代码大相劲庭，因为其调试起来十分困难。JavaBeans不能创建不可变的实例，因为需要你付出额外的代价来保证这个类是线程安全的。</p>
<h2 id="Builder模式"><a href="#Builder模式" class="headerlink" title="Builder模式"></a>Builder模式</h2><p>第二种解决方案 —— Builder模式</p>
<p>既能保证向重叠构造器模式那样的安全性，也能保证向JavaBeans模式那么好的可读性。这就是Builde模式的一种形式。不直接生成想要的对象，而是让客户端利用所有必要的参数调用构造器或者静态工厂，得到一个builder对象。然后客户端在builder上调用类似setter的方法来设置每个相关的可选参数。最后客户端调用无参的build方法来生成不可变的对象。这个builder是它构造的类的静态的成员类。代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Builder Pattern</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">NutritionFacts</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> calories;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> fat;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> sodium;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> carbohydrate;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</span><br><span class="line">	    <span class="comment">// Required parameters</span></span><br><span class="line">	    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servingSize;</span><br><span class="line">	    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> servings;</span><br><span class="line">	    <span class="comment">// Optional parameters - initialized to default values</span></span><br><span class="line">	    <span class="keyword">private</span> <span class="keyword">int</span> calories = <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">private</span> <span class="keyword">int</span> fat = <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">private</span> <span class="keyword">int</span> carbohydrate = <span class="number">0</span>;</span><br><span class="line">	    <span class="keyword">private</span> <span class="keyword">int</span> sodium = <span class="number">0</span>;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(<span class="keyword">int</span> servingSize, <span class="keyword">int</span> servings)</span> </span>&#123;</span><br><span class="line">	        <span class="keyword">this</span>.servingSize = servingSize;</span><br><span class="line">	        <span class="keyword">this</span>.servings = servings;</span><br><span class="line">	    &#125;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> Builder <span class="title">calories</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function">	        </span>&#123; calories = val; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> Builder <span class="title">fat</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function">	        </span>&#123; fat = val; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> Builder <span class="title">carbohydrate</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function">	        </span>&#123; carbohydrate = val; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> Builder <span class="title">sodium</span><span class="params">(<span class="keyword">int</span> val)</span></span></span><br><span class="line"><span class="function">	        </span>&#123; sodium = val; <span class="keyword">return</span> <span class="keyword">this</span>; &#125;</span><br><span class="line">	    <span class="function"><span class="keyword">public</span> NutritionFacts <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	        <span class="keyword">return</span> <span class="keyword">new</span> NutritionFacts(<span class="keyword">this</span>);</span><br><span class="line">	    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">NutritionFacts</span><span class="params">(Builder builder)</span> </span>&#123;</span><br><span class="line">        servingSize = builder.servingSize;</span><br><span class="line">        servings = builder.servings;</span><br><span class="line">        calories = builder.calories;</span><br><span class="line">        fat = builder.fat;</span><br><span class="line">        sodium = builder.sodium;</span><br><span class="line">        carbohydrate = builder.carbohydrate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>调用时是这样的：<br><code>NutritionFacts cocaCola = new NutritionFacts.Builder(240, 8).calories(100).sodium(35).carbohydrate(27).build();</code></p>
<p>就像构造器那样，builder 可以强加给它的参数变量（这个强加的参数变量可以作为创建对象的必须参数），build 方法实例化实体类，实例化前，可以对参数进行检查，如果不满足条件的，应该抛出 IllegalStateException，或者其他自定义异常。<br>另外一个小优点是 builder 可以有多个可变参数。构造器，像方法一样，可能只有一个可变参数。因为 builder 用不同的方法设置参数，只要你喜欢，他们可以有很多可变参数。</p>
<p>代码中NutritionFacts类中属性都是final类型的，这是必须的呢还是只是为了让对象实例一旦创建，其状态就不能在改变。而JavaBeans却无法创建这种不可变对象。</p>
<p>与JavaBeans的区别其实是在于真正构造对象的时间点上。其实Builder并没有提前把对象构造出来然后再一个个地对参数进行设置，而是先设定值，再在最后的build()方法中构建出对象。这样在一些参数存在依赖关系的时候，可以很好地解决依赖的问题。当然，对于参数的传递也不一定要按照上面写的方式，Setter其实也是可以的，其思想不在于模拟按名字传递参数，在于后面的build()。</p>
<p>从上面的例子中可以看出，Builder模式多数是用于对象比较复杂，可以逐步去构建的时候，其核心在于将类的构建逻辑转移到类的实例化外部。其经典应用是从一段文本中构建对象，因为文本的读入是以流的形式，那么一开始的时候可能没有办法创建完整的目标对象，这时候可以使用构建者模式来进行构建。但是在注重性能的环境下，每次创建实例都必须先创建Builder构造器也会是一笔开销，而且代码也有点冗长。总的来说如果类有多个属性需要多个构造函数，Builder模式还是一个不错的选择。</p>
<h2 id="Builder部件解析"><a href="#Builder部件解析" class="headerlink" title="Builder部件解析"></a>Builder部件解析</h2><p>再回到Builder的定义，将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。在这里我暂时这样理解，就是把复杂对象的构建过程和结果进行分离。Builder的uml图为：<br><img src="/blogimgs/Builder%E6%A8%A1%E5%BC%8F/builderuml.png" alt="Builder uml图" title="Builder uml图"><br>有点类似工厂模式，其中</p>
<ul>
<li>Builder：生成器接口，定义创建一个Product对象所需要的各个部件的操作。</li>
<li>ConcreteBuilder：具体的生成器实现，实现各个部件的创建，并负责组装Product对象的各个部件，同时还提供一个让用户获取组装完成后的产品对象的方法。</li>
<li>Director：指导者，也被称导向者，主要用来使用Builder接口，以一个统一的过程来构建所需要的Product对象。</li>
<li>Product：产品，表示被生成器构建的复杂对象，包含多个部件。</li>
</ul>
<p>看了上面的uml图和各个部件的解释，可能就会产生疑问了，上面的使用Builder代替构造函数的场景中使用的角色和UML中的角色不对称了，不要着急，下面进行解释：</p>
<p>上面的使用场景比较明确，就是创建某个复制对象，可以进行适当的简化。其中Builder模式只是用来创建某个对象，则就没有必要定义Builder的接口，直接提供一个具体的ConcreteBuilder就行；如果只创建一个复杂的对象，不可能会有很多种不同的选择和步骤，导演类Director就可以干掉了，将其功能与Client的功能合并，使Client具备Director的功能，来指导构建器来构建需要的复杂对象。</p>
<h2 id="Builder模式的功能"><a href="#Builder模式的功能" class="headerlink" title="Builder模式的功能"></a>Builder模式的功能</h2><p>生成器模式的主要功能是构建复杂的产品，而且是细化的，分步骤的构建产品，也就是生成器模式重在一步一步解决构造复杂对象的问题。如果仅仅这么认知生成器模式的功能是不够的。<br>更为重要的是，这个构建的过程是统一的、固定不变的，变化的部分放到生成器部分了，只要配置不同的生成器，那么同样的构建过程，就能构建出不同的产品来。 这是对定义（将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示 ）更进一步的解释。</p>
<p>正常的Builder模式的代码示例如下：<br>1、生成器接口定义的示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 生成器接口，定义创建一个产品对象所需的各个部件的操作 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 示意方法，构建某个部件 </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPart</span><span class="params">()</span></span>;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>2、具体生成器实现的示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 具体的生成器实现对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConcreteBuilder</span> <span class="keyword">implements</span> <span class="title">Builder</span> </span>&#123;  </span><br><span class="line">      </span><br><span class="line">    <span class="keyword">private</span> Product resultProduct;  </span><br><span class="line">      </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 获取生成器最终构建的产品对象 </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> Product <span class="title">getResultProduct</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> resultProduct;  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildPart</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="comment">//构建某个部件的功能处理  </span></span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>3、相应的产品对象接口的示例代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 被构建的产品对象的接口 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Product</span> </span>&#123;  </span><br><span class="line">    <span class="comment">//定义产品的操作  </span></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p>4、最后是指导者的实现示意，示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 指导者，指导使用生成器的接口来构建产品对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 持有当前需要使用的生成器对象 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> Builder builder;  </span><br><span class="line">   </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 构造方法，传人生成器对象 </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> builder </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.builder = builder;  </span><br><span class="line">     &#125;  </span><br><span class="line">       </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 示意方法，指导生成器构建最终的产品对象 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">construct</span><span class="params">()</span></span>&#123;  </span><br><span class="line">         <span class="comment">//通过使用生成器接口来构建最终的产品对象  </span></span><br><span class="line">         builder.buildPart();  </span><br><span class="line">     &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<h2 id="应用场景–-导出数据的应用框架"><a href="#应用场景–-导出数据的应用框架" class="headerlink" title="应用场景– 导出数据的应用框架"></a>应用场景– 导出数据的应用框架</h2><p>在讨论工厂方法模式的时候，提供了一个导出数据的应用框架。<br>对于导出数据的应用框架，通常在导出数据上，会有一些约束的方式，比如导出成文本格式、数据库备份形式、Excel格式、Xml格式等。<br>在工厂方法模式章节里面，讨论并使用工厂方法模式来解决了如何选择具体导出方式的问题，并没有涉及到每种方式具体如何实现。<br>换句话说，在讨论工厂方法模式的时候，并没有讨论如何实现导出成文本、Xml等具体格式，本章就来讨论这个问题。<br>对于导出数据的应用框架，通常对于具体的导出内容和格式是有要求的，加入现在有如下要求，简单描述一下：</p>
<ul>
<li>导出的文件，不管是什么格式，都分成3个部分，分别是文件头、文件体、文件尾。</li>
<li>在文件头部分，需要描述如下信息：分公司或者门市编号、导出数据的日期。</li>
<li>在文件体部分，需要描述如下信息：表名称，然后分条描述数据。</li>
<li>在文件尾部分，需要描述如下信息：输出人。</li>
</ul>
<p>1、下面将描述文件各个部分的数据对象定义出来<br>描述输出到文件头的内容的对象，示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 描述输出到文件头的内容的对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportHeaderModel</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 分公司或者门市编号 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> String depId;  </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 导出数据的日期 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> String exportDate;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">public</span> String <span class="title">getDepId</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> depId;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDepId</span><span class="params">(String depId)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.depId = depId;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> String <span class="title">getExportDate</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> exportDate;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExportDate</span><span class="params">(String exportDate)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.exportDate = exportDate;  </span><br><span class="line">     &#125;  </span><br><span class="line">       </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>描述输出数据的对象，示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 描述输出数据的对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportDataModel</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 产品编号 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> String productId;  </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 销售价格 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">double</span> price;  </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 销售数量 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">double</span> amount;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">public</span> String <span class="title">getProductId</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> productId;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProductId</span><span class="params">(String productId)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.productId = productId;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> price;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrice</span><span class="params">(<span class="keyword">double</span> price)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.price = price;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getAmount</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> amount;  </span><br><span class="line">     &#125;  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAmount</span><span class="params">(<span class="keyword">double</span> amount)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.amount = amount;  </span><br><span class="line">     &#125;  </span><br><span class="line">       </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>描述输出到文件尾的内容的对象，示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 描述输出到文件尾的内容的对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportFooterModel</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 输出人 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> String exportUser;  </span><br><span class="line">   </span><br><span class="line">     <span class="function"><span class="keyword">public</span> String <span class="title">getExportUser</span><span class="params">()</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> exportUser;  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExportUser</span><span class="params">(String exportUser)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.exportUser = exportUser;  </span><br><span class="line">     &#125;  </span><br><span class="line">       </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>2、定义Builder接口，主要是把导出各种格式文件的处理过程的步骤定义出来，每个步骤负责构建最终导出文件的一部分。示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 生成器接口，定义创建一个输出文件对象所需的各个部件的操作 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Builder</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 构建输出文件的Header部分 </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> ehm </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildHeader</span><span class="params">(ExportHeaderModel ehm)</span></span>;  </span><br><span class="line">       </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 构建输出文件的Body部分 </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> mapData </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBody</span><span class="params">(Map&lt;String,List&lt;ExportDataModel&gt;&gt; mapData)</span></span>;  </span><br><span class="line">       </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 构建输出文件的Footer部分 </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> efm </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFooter</span><span class="params">(ExportFooterModel efm)</span></span>;  </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>3、具体的生成器实现。<br>导出到文本文件的的生成器实现。示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 实现导出文件到文本文件的生成器对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxtBuilder</span> <span class="keyword">implements</span> <span class="title">Builder</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 用来记录构建的文件的内容，相当于产品 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> StringBuffer buffer = <span class="keyword">new</span> StringBuffer();  </span><br><span class="line">       </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildHeader</span><span class="params">(ExportHeaderModel ehm)</span> </span>&#123;  </span><br><span class="line">         buffer.append(ehm.getDepId()+<span class="string">&quot;,&quot;</span>+ehm.getExportDate()+<span class="string">&quot;\n&quot;</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBody</span><span class="params">(Map&lt;String, List&lt;ExportDataModel&gt;&gt; mapData)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">for</span>(String tablName : mapData.keySet())&#123;  </span><br><span class="line">               </span><br><span class="line">             <span class="comment">//先拼接表名  </span></span><br><span class="line">             buffer.append(tablName+<span class="string">&quot;\n&quot;</span>);  </span><br><span class="line">             <span class="comment">//然后循环拼接具体数据  </span></span><br><span class="line">             <span class="keyword">for</span>(ExportDataModel edm : mapData.get(tablName))&#123;  </span><br><span class="line">                 buffer.append(edm.getProductId()+<span class="string">&quot;,&quot;</span>+edm.getPrice()+<span class="string">&quot;,&quot;</span>+edm.getAmount()+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">             &#125;  </span><br><span class="line">         &#125;  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFooter</span><span class="params">(ExportFooterModel efm)</span> </span>&#123;  </span><br><span class="line">         buffer.append(efm.getExportUser());  </span><br><span class="line">     &#125;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">public</span> StringBuffer <span class="title">getResult</span><span class="params">()</span></span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> buffer;  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>导出到Xml文件的的生成器实现。示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 实现导出文件到Xml文件的生成器对象 </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XmlBuilder</span> <span class="keyword">implements</span> <span class="title">Builder</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * 用来记录构建的文件的内容，相当于产品 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> StringBuffer buffer = <span class="keyword">new</span> StringBuffer();  </span><br><span class="line">       </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildHeader</span><span class="params">(ExportHeaderModel ehm)</span> </span>&#123;  </span><br><span class="line">         buffer.append(<span class="string">&quot;&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;&lt;Report&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t&lt;Header&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t\t&lt;DepId&gt;&quot;</span>+ehm.getDepId()+<span class="string">&quot;&lt;/DepId&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t\t&lt;ExportDate&gt;&quot;</span>+ehm.getExportDate()+<span class="string">&quot;&lt;/ExportDate&gt;\n&quot;</span>);  </span><br><span class="line">           </span><br><span class="line">         buffer.append(<span class="string">&quot;\t&lt;/Header&gt;\n&quot;</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildBody</span><span class="params">(Map&lt;String, List&lt;ExportDataModel&gt;&gt; mapData)</span> </span>&#123;  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t&lt;Body&gt;\n&quot;</span>);  </span><br><span class="line">         <span class="keyword">for</span>(String tablName : mapData.keySet())&#123;  </span><br><span class="line">             <span class="comment">//先拼接表名  </span></span><br><span class="line">             buffer.append(<span class="string">&quot;\t\t&lt;Datas TableName=\&quot;&quot;</span>+tablName+<span class="string">&quot;\&quot;&gt;\n&quot;</span>);  </span><br><span class="line">             <span class="comment">//然后循环拼接具体数据  </span></span><br><span class="line">             <span class="keyword">for</span>(ExportDataModel edm : mapData.get(tablName))&#123;  </span><br><span class="line">                   </span><br><span class="line">                 buffer.append(<span class="string">&quot;\t\t\t&lt;Data&gt;\n&quot;</span>);  </span><br><span class="line">                   </span><br><span class="line">                 buffer.append(<span class="string">&quot;\t\t\t\t&lt;ProductId&gt;&quot;</span>+edm.getProductId()+<span class="string">&quot;&lt;/ProductId&gt;\n&quot;</span>);  </span><br><span class="line">                 buffer.append(<span class="string">&quot;\t\t\t\t&lt;Price&gt;&quot;</span>+edm.getPrice()+<span class="string">&quot;&lt;/Price&gt;\n&quot;</span>);  </span><br><span class="line">                 buffer.append(<span class="string">&quot;\t\t\t\t&lt;Amount&gt;&quot;</span>+edm.getAmount()+<span class="string">&quot;&lt;/Amount&gt;\n&quot;</span>);  </span><br><span class="line">                   </span><br><span class="line">                 buffer.append(<span class="string">&quot;\t\t\t&lt;/Data&gt;\n&quot;</span>);  </span><br><span class="line">             &#125;  </span><br><span class="line">               </span><br><span class="line">             buffer.append(<span class="string">&quot;\t\t&lt;/Datas&gt;\n&quot;</span>);  </span><br><span class="line">         &#125;  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t&lt;/Body&gt;\n&quot;</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="meta">@Override</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">buildFooter</span><span class="params">(ExportFooterModel efm)</span> </span>&#123;  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t&lt;Footer&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t\t&lt;ExportUser&gt;&quot;</span>+efm.getExportUser()+<span class="string">&quot;&lt;/ExportUser&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;\t&lt;/Footer&gt;\n&quot;</span>);  </span><br><span class="line">         buffer.append(<span class="string">&quot;&lt;/Report&gt;\n&quot;</span>);  </span><br><span class="line">     &#125;  </span><br><span class="line">       </span><br><span class="line">     <span class="function"><span class="keyword">public</span> StringBuffer <span class="title">getResult</span><span class="params">()</span></span>&#123;  </span><br><span class="line">         <span class="keyword">return</span> buffer;  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>4、指导者。有了具体的生成器实现后，需要由指导者来指导它进行具体的产品构建。示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment"> * 指导者，指导使用生成器的接口来构建输出的文件对象 </span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> *  </span></span><br><span class="line"><span class="comment"> */</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Director</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 持有当前需要的使用的生成器对象 </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="keyword">private</span> Builder builder;  </span><br><span class="line">   </span><br><span class="line">     <span class="comment">/** </span></span><br><span class="line"><span class="comment">      * 构造方法，传入生成器对象 </span></span><br><span class="line"><span class="comment">      *  </span></span><br><span class="line"><span class="comment">      * <span class="doctag">@param</span> builder </span></span><br><span class="line"><span class="comment">      */</span>  </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="title">Director</span><span class="params">(Builder builder)</span> </span>&#123;  </span><br><span class="line">         <span class="keyword">this</span>.builder = builder;  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">construct</span><span class="params">(ExportHeaderModel ehm,  </span></span></span><br><span class="line"><span class="params"><span class="function">             Map&lt;String, List&lt;ExportDataModel&gt;&gt; mapData, ExportFooterModel efm)</span> </span>&#123;  </span><br><span class="line">   </span><br><span class="line">         <span class="comment">//1.先构建Header  </span></span><br><span class="line">         builder.buildHeader(ehm);  </span><br><span class="line">           </span><br><span class="line">         <span class="comment">//2.然后构建Body  </span></span><br><span class="line">         builder.buildBody(mapData);  </span><br><span class="line">           </span><br><span class="line">         <span class="comment">//3.再构建Footer  </span></span><br><span class="line">         builder.buildFooter(efm);  </span><br><span class="line">     &#125;  </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>

<p>5、客户端测试代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Client</span> </span>&#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="comment">/** </span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args </span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">//准备测试数据  </span></span><br><span class="line">        ExportHeaderModel ehm = <span class="keyword">new</span> ExportHeaderModel();  </span><br><span class="line">         ehm.setDepId(<span class="string">&quot;一分公司&quot;</span>);  </span><br><span class="line">         ehm.setExportDate(<span class="string">&quot;2010-05-18&quot;</span>);  </span><br><span class="line">           </span><br><span class="line">         Map&lt;String, List&lt;ExportDataModel&gt;&gt; mapData = <span class="keyword">new</span> HashMap&lt;String, List&lt;ExportDataModel&gt;&gt;  </span><br><span class="line">         List&lt;ExportDataModel&gt; col = <span class="keyword">new</span> ArrayList&lt;ExportDataModel&gt;();  </span><br><span class="line">           </span><br><span class="line">         ExportDataModel edm1 = <span class="keyword">new</span> ExportDataModel();  </span><br><span class="line">         edm1.setProductId(<span class="string">&quot;产品001号&quot;</span>);  </span><br><span class="line">         edm1.setPrice(<span class="number">100</span>);  </span><br><span class="line">         edm1.setAmount(<span class="number">80</span>);  </span><br><span class="line">           </span><br><span class="line">         ExportDataModel edm2 = <span class="keyword">new</span> ExportDataModel();  </span><br><span class="line">         edm2.setProductId(<span class="string">&quot;产品002号&quot;</span>);  </span><br><span class="line">         edm2.setPrice(<span class="number">120</span>);  </span><br><span class="line">         edm2.setAmount(<span class="number">280</span>);  </span><br><span class="line">           </span><br><span class="line">         ExportDataModel edm3 = <span class="keyword">new</span> ExportDataModel();  </span><br><span class="line">         edm3.setProductId(<span class="string">&quot;产品003号&quot;</span>);  </span><br><span class="line">         edm3.setPrice(<span class="number">320</span>);  </span><br><span class="line">         edm3.setAmount(<span class="number">380</span>);  </span><br><span class="line">           </span><br><span class="line">         col.add(edm1);  </span><br><span class="line">         col.add(edm2);  </span><br><span class="line">         col.add(edm3);  </span><br><span class="line">           </span><br><span class="line">         mapData.put(<span class="string">&quot;销售记录表&quot;</span>, col);  </span><br><span class="line">           </span><br><span class="line">         ExportFooterModel efm = <span class="keyword">new</span> ExportFooterModel();  </span><br><span class="line">         efm.setExportUser(<span class="string">&quot;张三&quot;</span>);  </span><br><span class="line">           </span><br><span class="line">         <span class="comment">//测试输出到文本文件  </span></span><br><span class="line">         TxtBuilder txtBuilder = <span class="keyword">new</span> TxtBuilder();  </span><br><span class="line">         <span class="comment">//创建指导者对象  </span></span><br><span class="line">         Director director = <span class="keyword">new</span> Director(txtBuilder);  </span><br><span class="line">         director.construct(ehm, mapData, efm);  </span><br><span class="line">           </span><br><span class="line">         <span class="comment">//把要输出的内容输出到控制台看看  </span></span><br><span class="line">         System.out.println(<span class="string">&quot;输出到文本文件的内容:&quot;</span>+txtBuilder.getResult().toString());  </span><br><span class="line">           </span><br><span class="line">         XmlBuilder xmlBuilder = <span class="keyword">new</span> XmlBuilder();  </span><br><span class="line">         Director director2 = <span class="keyword">new</span> Director(xmlBuilder);  </span><br><span class="line">         director2.construct(ehm, mapData, efm);  </span><br><span class="line">           </span><br><span class="line">         <span class="comment">//把要输出的内容输出到控制台看看  </span></span><br><span class="line">         System.out.println(<span class="string">&quot;输出到Xml文件的内容:&quot;</span>+xmlBuilder.getResult().toString());  </span><br><span class="line">     &#125;  </span><br><span class="line">   </span><br><span class="line"> &#125;  </span><br></pre></td></tr></table></figure>
<h2 id="生成器模式的功能"><a href="#生成器模式的功能" class="headerlink" title="生成器模式的功能"></a>生成器模式的功能</h2><p>生成器模式的主要功能是构建复杂的产品，而且是细化的，分步骤的构建产品，也就是生成器模式重在一步一步解决构造复杂对象的问题。如果仅仅这么认知生成器模式的功能是不够的。<br>更为重要的是，这个构建的过程是统一的、固定不变的，变化的部分放到生成器部分了，只要配置不同的生成器，那么同样的构建过程，就能构建出不同的产品来。</p>
<p>##参考<br><a target="_blank" rel="noopener" href="http://blog.csdn.net/top_code/article/details/8469297">http://blog.csdn.net/top_code/article/details/8469297</a><br><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Builder_pattern">https://en.wikipedia.org/wiki/Builder_pattern</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">混绅士</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://bigdatadecode.top/Builder%20%E6%A8%A1%E5%BC%8F.html">http://bigdatadecode.top/Builder%20%E6%A8%A1%E5%BC%8F.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://bigdatadecode.top" target="_blank">big data decode club</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/Builder/">Builder</a><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/path/to/wechat-reward-image/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/path/to/wechat-reward-image/wechatpay.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E5%B8%B8%E7%94%A8Hadoop%E5%91%BD%E4%BB%A4.html"><img class="prev-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">常用Hadoop命令</div></div></a></div><div class="next-post pull-right"><a href="/test.html"><img class="next-cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Builder 模式</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/test.html" title="Builder 模式"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2013-12-02</div><div class="title">Builder 模式</div></div></a></div><div><a href="/%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E5%BC%95%E5%8F%91%E7%9A%84%E6%80%9D%E8%80%83.html" title="单例模式引发的思考"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-03-12</div><div class="title">单例模式引发的思考</div></div></a></div><div><a href="/Intellij%20idea%E4%B8%AD%E4%BE%9D%E8%B5%96%E6%A8%A1%E5%9D%97%E9%97%B4%E7%9A%84test%E4%BB%A3%E7%A0%81.html" title="Intellij idea中依赖模块间的test代码"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-06-02</div><div class="title">Intellij idea中依赖模块间的test代码</div></div></a></div><div><a href="/Java%20NIO.html" title="Java NIO"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-11-23</div><div class="title">Java NIO</div></div></a></div><div><a href="/JavaSynchronizedTheory.html" title="Java Synchronized实现原理"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2017-10-20</div><div class="title">Java Synchronized实现原理</div></div></a></div><div><a href="/Java%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97%E8%A7%A3%E6%9E%90.html" title="Java优先级队列解析"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2016-12-04</div><div class="title">Java优先级队列解析</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/uploads/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">混绅士</div><div class="author-info__description">Any answers you can find in source code.</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">119</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">197</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">22</div></a></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Builder%E6%A8%A1%E5%BC%8F%E6%A6%82%E5%BF%B5"><span class="toc-number">1.</span> <span class="toc-text">Builder模式概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%BA%E6%99%AF%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">场景简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JavaBeans%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.</span> <span class="toc-text">JavaBeans模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Builder%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">Builder模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Builder%E9%83%A8%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="toc-number">4.</span> <span class="toc-text">Builder部件解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Builder%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">5.</span> <span class="toc-text">Builder模式的功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E2%80%93-%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE%E7%9A%84%E5%BA%94%E7%94%A8%E6%A1%86%E6%9E%B6"><span class="toc-number">6.</span> <span class="toc-text">应用场景– 导出数据的应用框架</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%8A%9F%E8%83%BD"><span class="toc-number">7.</span> <span class="toc-text">生成器模式的功能</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95%E4%B9%8B%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html" title="无题"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="无题"/></a><div class="content"><a class="title" href="/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%AE%97%E6%B3%95%E4%B9%8B%E5%8A%A8%E6%80%81%E8%A7%84%E5%88%92.html" title="无题">无题</a><time datetime="2022-11-25T15:21:53.339Z" title="发表于 2022-11-25 23:21:53">2022-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/golang-wasm.html" title="Golang开发wasm程序"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Golang开发wasm程序"/></a><div class="content"><a class="title" href="/golang-wasm.html" title="Golang开发wasm程序">Golang开发wasm程序</a><time datetime="2022-11-25T13:32:12.000Z" title="发表于 2022-11-25 21:32:12">2022-11-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/wasm-realtime.html" title="基于Wasm的轻量实时计算"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="基于Wasm的轻量实时计算"/></a><div class="content"><a class="title" href="/wasm-realtime.html" title="基于Wasm的轻量实时计算">基于Wasm的轻量实时计算</a><time datetime="2022-11-05T05:35:12.000Z" title="发表于 2022-11-05 13:35:12">2022-11-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/scratch-extensions-demo.html" title="scratch自定义扩展"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="scratch自定义扩展"/></a><div class="content"><a class="title" href="/scratch-extensions-demo.html" title="scratch自定义扩展">scratch自定义扩展</a><time datetime="2021-12-14T14:30:20.000Z" title="发表于 2021-12-14 22:30:20">2021-12-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/metabase-import-ide.html" title="metabase导入IDE调试"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="metabase导入IDE调试"/></a><div class="content"><a class="title" href="/metabase-import-ide.html" title="metabase导入IDE调试">metabase导入IDE调试</a><time datetime="2021-12-13T15:31:22.000Z" title="发表于 2021-12-13 23:31:22">2021-12-13</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2016 - 2022 By 混绅士</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>