<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>big data decode club</title>
  
  <subtitle>hunhun -- Any answers you can find in source code.</subtitle>
  <link href="http://yuanba.tech/atom.xml" rel="self"/>
  
  <link href="http://yuanba.tech/"/>
  <updated>2022-11-25T15:12:10.000Z</updated>
  <id>http://yuanba.tech/</id>
  
  <author>
    <name>æ··ç»…å£«</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Golangå¼€å‘wasmç¨‹åº</title>
    <link href="http://yuanba.tech/golang-wasm.html"/>
    <id>http://yuanba.tech/golang-wasm.html</id>
    <published>2022-11-25T13:32:12.000Z</published>
    <updated>2022-11-25T15:12:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>wasmä»¥å°å·§å®‰å…¨çš„ç‰¹æ€§å—åˆ°å¹¿æ³›çš„å…³æ³¨ï¼Œä½†æ˜¯ä»–ä¹Ÿæœ‰å¾ˆå¤šçš„å±€é™æ€§ã€‚<br>è¿™äº›å±€é™æ€§å¯ä»¥é€šè¿‡<code>Host Function</code>è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾—<em>wasm</em>ä¸<em>host</em>èƒ½å¤Ÿè¿›è¡Œäº¤äº’ï¼Œå®Œæˆæ›´å¤šçš„åŠŸèƒ½ã€‚</p><p><code>Host Function</code>éœ€è¦<code>import</code>åˆ°wasmä¸­ï¼ŒåŒæ ·wasmä¸­çš„functionéœ€è¦<code>export</code>åˆ°hostä¸­æ‰èƒ½è°ƒç”¨ã€‚</p><p>æœ¬ç¯‡ä¸»è¦è®°å½•ä¸‹åœ¨Golangä¸‹ï¼Œ<code>wasm function</code>å¦‚ä½•ä¸<code>host function</code>è¿›è¡Œäº¤äº’ã€‚</p><span id="more"></span><h2 id="ç¯å¢ƒä¾èµ–"><a href="#ç¯å¢ƒä¾èµ–" class="headerlink" title="ç¯å¢ƒä¾èµ–"></a>ç¯å¢ƒä¾èµ–</h2><ol><li>ä½¿ç”¨wazeroæˆ–è€…wasmtime-goä½œä¸ºwasmçš„runtime</li><li>Tinygoç¼–è¯‘Golangä¸ºwasmæ–‡ä»¶</li></ol><h2 id="ä¸ºä»€ä¹ˆéœ€è¦Host-Function"><a href="#ä¸ºä»€ä¹ˆéœ€è¦Host-Function" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦Host Function"></a>ä¸ºä»€ä¹ˆéœ€è¦<code>Host Function</code></h2><p><code>Host Function</code>æŒ‡åœ¨<code>Host</code>ç¨‹åºé‡Œå®šä¹‰çš„æ–¹æ³•ã€‚æŸäº›æ–¹é¢wasmè¿˜ä¸å¤ªå®Œå–„ï¼Œæ¯”å¦‚é»˜è®¤æƒ…å†µä¸‹ä¸èƒ½åœ¨ç»ˆç«¯ä¸Šæ‰“å°ä¿¡æ¯ï¼Œæ¯”å¦‚<code>fmt.Println(&quot;Hello&quot;)</code>ï¼Œæ­¤æ—¶å°±å¯ä»¥åœ¨<code>host</code>ç¨‹åºä¸­åˆ›å»ºä¸€ä¸ª<code>Print(string)</code>æ–¹æ³•ï¼Œè®©wasmè°ƒç”¨è¿™ä¸ª<code>Print(string)</code>æ–¹æ³•ã€‚</p><p>åœ¨Golangä¸­éœ€è¦wasm runtimeå°†<code>Host Function</code>(æ¯”å¦‚<code>Print(string)</code>)åŠ è½½åˆ°wasmä¸­å³å¯è¿è¡Œï¼Œè¿™ä¸ªæ“ä½œä»wasmè§’åº¦çœ‹ï¼Œä¸º<code>import</code>ã€‚</p><p><img src="/blogimgs/golang-wasm/print-import.png"></p><h2 id="show-me-code"><a href="#show-me-code" class="headerlink" title="show me code"></a>show me code</h2><p><em>wasm</em>ä¸<em>host</em>è¿›è¡Œäº¤äº’æ¶‰åŠåˆ°<code>import</code>å’Œ<code>export</code>æ“ä½œï¼Œé€šè¿‡ä»£ç å…·ä½“å±•ç¤ºä½•æ—¶ä½¿ç”¨<code>import</code>å’Œ<code>export</code>ï¼Œä»¥åŠåœ¨tinygoä¸­åˆè¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p><h3 id="1-Golangåˆ›å»ºwasmæ¨¡å—"><a href="#1-Golangåˆ›å»ºwasmæ¨¡å—" class="headerlink" title="1. Golangåˆ›å»ºwasmæ¨¡å—"></a>1. Golangåˆ›å»ºwasmæ¨¡å—</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//export add </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">uint32</span>, y <span class="keyword">uint32</span>)</span> <span class="title">uint32</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>1æ ‡è®°çš„ç©º<code>main</code>å‡½æ•°æ˜¯tinygoç¼–è¯‘wasmæ—¶éœ€è¦çš„</li><li>2æ ‡è®°çš„æ˜¯å°†<code>add</code>æ–¹æ³•å¯¼å‡ºåˆ°<code>host</code>ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨hostç¨‹åºä¸­è°ƒç”¨wasmæ¨¡å—</li></ul><p>ä½¿ç”¨tinygoå°†golangç¼–è¯‘ä¸ºwasmæ¨¡å—<br><code>tinygo build -o hello.wasm -scheduler=none --no-debug -target wasi ./hello.go</code></p><h3 id="2-ç¼–å†™hostç¨‹åºè°ƒç”¨wasmæ¨¡å—"><a href="#2-ç¼–å†™hostç¨‹åºè°ƒç”¨wasmæ¨¡å—" class="headerlink" title="2. ç¼–å†™hostç¨‹åºè°ƒç”¨wasmæ¨¡å—"></a>2. ç¼–å†™<code>host</code>ç¨‹åºè°ƒç”¨wasmæ¨¡å—</h3><p><code>host</code>æ¨¡å—æ˜¯ç”¨<code>Wazero</code>runtimeç¼–å†™ï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ªWebAssembly Runtimeï¼Œç„¶åå®ä¾‹åŒ–ä¸€ä¸ªWebAssembly moduleï¼Œè¿™æ ·<code>host</code>ç¨‹åºå°±èƒ½è°ƒç”¨<code>wasm function</code>äº†ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;context&quot;</span></span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line">  <span class="string">&quot;log&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/tetratelabs/wazero&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/tetratelabs/wazero/wasi_snapshot_preview1&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  ctx := context.Background()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line">  r := wazero.NewRuntimeWithConfig(</span><br><span class="line">    ctx, wazero.NewRuntimeConfig().</span><br><span class="line">    WithWasmCore2())</span><br><span class="line"></span><br><span class="line">  <span class="keyword">defer</span> r.Close(ctx) </span><br><span class="line"></span><br><span class="line">  _, err := wasi_snapshot_preview1.Instantiate(ctx, r)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Panicln(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line">  helloWasm, err := os.ReadFile(<span class="string">&quot;./hello.wasm&quot;</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Panicln(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3</span></span><br><span class="line">  mod, err := r.InstantiateModuleFromBinary(ctx, helloWasm)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Panicln(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4</span></span><br><span class="line">  addWasmModuleFunction := mod.ExportedFunction(<span class="string">&quot;add&quot;</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment">// 5</span></span><br><span class="line">  result, err := addWasmModuleFunction.Call(ctx, <span class="number">20</span>, <span class="number">22</span>)</span><br><span class="line">  <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Panicln(err)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  fmt.Println(<span class="string">&quot;result:&quot;</span>, result[<span class="number">0</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>1æ ‡è®°çš„æ˜¯åˆ›å»ºä¸€ä¸ªWebAssembly Runtime</li><li>2æ ‡è®°çš„æ˜¯åŠ è½½ä¸€ä¸ªwasmæ¨¡å—</li><li>3æ ‡è®°çš„æ˜¯å®ä¾‹åŒ–ä¸€ä¸ªWebAssembly module</li><li>4æ ‡è®°çš„æ˜¯è·å–ä¸€ä¸ª<code>wasm function</code> <strong>add</strong>çš„å¼•ç”¨</li><li>5æ ‡è®°çš„æ˜¯åœ¨hostç¨‹åºä¸­è°ƒç”¨wasm</li></ul><p>ç„¶åå¯ä»¥åƒè¿è¡Œæ­£å¸¸Goç¨‹åºé‚£æ ·æ‰§è¡Œ<code>go run main.go</code>ï¼Œè¾“å‡ºæ˜¯<code>result: 42</code></p><p>è¿™ä¸ªåŸºç¡€ä¾‹å­å±•ç¤ºäº†wasmæ¨¡å—çš„å¸¸è§„ç”¨æ³•ï¼Œä¸»è¦å±•ç¤ºäº†hostç¨‹åºå¦‚ä½•è°ƒç”¨wasmæ¨¡å—ã€‚</p><ol><li>ä½†æ˜¯wasmæ¨¡å—å¦‚ä½•è°ƒç”¨<code>host function</code>å‘¢ï¼Ÿ</li><li>åœ¨Goç¼–å†™çš„wasmæ¨¡å—ä¸­ï¼Œä½¿ç”¨<code>export</code>å…³é”®å­—æ ‡è®°hostç¨‹åºå¯è°ƒç”¨çš„<code>wasm function</code>ï¼Œé‚£<code>host function</code>åˆæ˜¯å¦‚ä½•æ ‡è®°è¢«wasmæ¨¡å—è°ƒç”¨çš„å‘¢ï¼Ÿ</li></ol><p>å¸¦ç€è¿™ä¸¤ä¸ªç–‘é—®çœ‹ä¸‹é¢è¿™ä¸€èŠ‚å†…å®¹ã€‚</p><h2 id="export-import-å‚»å‚»åˆ†ä¸æ¸…æ¥š"><a href="#export-import-å‚»å‚»åˆ†ä¸æ¸…æ¥š" class="headerlink" title="export import å‚»å‚»åˆ†ä¸æ¸…æ¥š"></a>export import å‚»å‚»åˆ†ä¸æ¸…æ¥š</h2><p>ä¸Šé¢è¯´wasmå±€é™æ€§æ—¶æåˆ°æ— æ³•åœ¨ç»ˆç«¯æ‰“å°ä¿¡æ¯ï¼Œéœ€è¦åœ¨<code>host function</code>ä¸­å®šä¹‰ä¸€ä¸ª<code>Print(string)</code>æ–¹æ³•ï¼Œç„¶ååœ¨wasmæ¨¡å—ä¸­è°ƒç”¨ï¼Œç°åœ¨å°±åœ¨<code>host</code>ç¨‹åºä¸­å®šä¹‰ä¸€ä¸ªåœ¨ç»ˆç«¯æ‰“å°æ•°å­—çš„æ–¹æ³•<code>hostLogUint32</code>ã€‚</p><blockquote><p>hostLogUint32</p></blockquote><p>wasmæ¨¡å—è°ƒç”¨<code>host function</code>éœ€è¦åœ¨hostç¨‹åºä¸­å’Œwasmä¸­éƒ½è¿›è¡Œæ”¹åŠ¨</p><ul><li>hostç¨‹åºä¸­çš„æ”¹åŠ¨</li></ul><ol><li>å®šä¹‰ä¸€ä¸ª<code>logUint32</code>æ–¹æ³•</li><li>export <code>logUint32</code>æ–¹æ³•åˆ°Wasm runtimeç§ï¼Œä¸ºäº†æ–¹ä¾¿æ ‡è®°<code>logUint32</code> exportçš„åå­—ä¸º<code>hostLogUint32</code></li></ol><ul><li>wasmç¨‹åºä¸­çš„æ”¹åŠ¨</li></ul><ol><li>import <code>hostLogUint32</code>æ–¹æ³•</li><li>åœ¨wasmæ¨¡å—ä¸­è°ƒç”¨<code>hostLogUint32</code>æ–¹æ³•åœ¨ç»ˆç«¯æ‰“å°ä¸€ä¸ªæ•°å­—</li></ol><p><img src="/blogimgs/golang-wasm/hostLogUint32.png"></p><p>çœ‹ä¸‹å…·ä½“çš„ä»£ç æ”¹åŠ¨ï¼Œåœ¨<code>main.go</code>ä¸­æ·»åŠ <code>logUint32</code>æ–¹æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">logUint32</span><span class="params">(value <span class="keyword">uint32</span>)</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;ğŸ¤–:&quot;</span>, value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨runtimeä¸­export <code>logUint32</code>æ–¹æ³•ä¸º<code>hostLogUint32</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">_, errEnv := wasmRuntime.NewModuleBuilder(<span class="string">&quot;env&quot;</span>).</span><br><span class="line">  ExportFunction(<span class="string">&quot;hostLogUint32&quot;</span>, logUint32).</span><br><span class="line">  Instantiate(ctx, wasmRuntime)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> errEnv != <span class="literal">nil</span> &#123;</span><br><span class="line">  log.Panicln(<span class="string">&quot;env/host function(s) error:&quot;</span>, errEnv)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥åœ¨wasmæ¨¡å—ä¸­import <code>hostLogUint32</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//export hostLogUint32</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hostLogUint32</span><span class="params">(value <span class="keyword">uint32</span>)</span></span></span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œæ˜¯ä¸æ˜¯æœ‰äººå¼€å§‹ç–‘æƒ‘äº†ï¼Œä¸æ˜¯è¯´å¥½importå˜›ï¼Œæ€ä¹ˆè¿˜æ˜¯exportå‘€ï¼Ÿï¼Ÿï¼Ÿæˆ‘å½“æ—¶å¯æ˜¯å›°æ‰°äº†å¥½ä¹…å¥½ä¹…ã€‚ã€‚ã€‚</strong><br><strong>è¿™é‡Œ<code>//export hostLogUint32</code>å…¶å®æ˜¯wasmæ¨¡å—import <code>host function</code>ï¼Œå¯ä»¥æ³¨æ„åˆ°è¿™é‡Œçš„<code>hostLogUint32</code>å¹¶æ²¡æœ‰æ–¹æ³•ä½“ï¼Œè¿™ä¸ªå¯ä»¥ç”¨æ¥åŒºåˆ†æ˜¯exportè¿˜æ˜¯import</strong></p><p>æœ€åå°±æ˜¯åœ¨wasmæ¨¡å—ä¸­è°ƒç”¨<code>host function</code>äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//export hostLogUint32</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hostLogUint32</span><span class="params">(value <span class="keyword">uint32</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//export add</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add</span><span class="params">(x <span class="keyword">uint32</span>, y <span class="keyword">uint32</span>)</span> <span class="title">uint32</span></span> &#123;</span><br><span class="line">  res := x + y</span><br><span class="line">  hostLogUint32(res)</span><br><span class="line">  <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºå‡†å¤‡å¥½ä¹‹åå°±å¯ä»¥è¿è¡Œï¼Œç”±äºwasmæ¨¡å—ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°ç¼–è¯‘wasmæ–‡ä»¶ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tinygo build -o hello.wasm -scheduler=none --no-debug -target wasi ./hello.go</span><br><span class="line"></span><br><span class="line">go run main.go</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡ºå¦‚ä¸‹</span></span><br><span class="line">ğŸ¤–: 42         # from the Wasm module</span><br><span class="line">result: 42     # from the host program</span><br></pre></td></tr></table></figure><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>å†™è¿™ç¯‡æ–‡ç« çš„ä¸»è¦ç›®çš„å…¶å®æƒ³ç†è§£tinygoä¸­exportçš„ç”¨æ³•ï¼Œå› ä¸ºåœ¨å‚è€ƒwasmç›¸å…³æ•™ç¨‹ä¸­<code>host function</code>éœ€è¦importåˆ°wasmä¸­æ‰èƒ½ä½¿ç”¨ï¼Œä½†æ˜¯tinygoä¸­å¹¶æ²¡æœ‰æä¾›<code>import</code>å…³é”®å­—ï¼Œè¿™ä½¿æˆ‘ä¸€åº¦æ€€ç–‘ä»£ç æœ‰é—®é¢˜ï¼Œä¸ºäº†æ¶ˆé™¤ç–‘è™‘æ‰€ä»¥æ‰æŸ¥æ‰¾äº†å¾ˆå¤šèµ„æ–™ã€‚</p><p>æˆ‘çš„ç†è§£æ˜¯tinygoä¸­çš„<code>export</code>å…³é”®å­—æœ‰æ—¶é—´å……å½“å°†wasmæ¨¡å—ä¸­çš„æ–¹æ³•exportåˆ°hostçš„åŠŸèƒ½ï¼Œæœ‰æ—¶ä¹Ÿå……å½“å°†<code>host function</code>ä¸­çš„æ–¹æ³•importåˆ°wasmæ¨¡å—çš„åŠŸèƒ½ï¼Œé‚£è¿™ä¸¤ç§åœºæ™¯å¦‚ä½•åŒºåˆ†å‘¢ï¼Ÿæ˜¯çœ‹å¸¦æœ‰<code>export</code>å…³é”®å­—çš„æ–¹æ³•æ˜¯å¦æœ‰<code>æ–¹æ³•ä½“</code>ï¼Œå¦‚ä½•æœ‰å°±æ˜¯<code>export</code>ï¼Œæ²¡æœ‰åˆ™æ˜¯<code>import</code>ã€‚è¿™ä¸ªç»“æœä»<code>hostLogUint32</code>çš„è§£æå›¾ä¸­å¯ä»¥çŒœæƒ³åˆ°ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†ç¼–è¯‘ä¹‹åçš„wasmæ–‡ä»¶è¿›è¡Œåç¼–è¯‘è¿›è¡ŒéªŒè¯ã€‚</p><p>wasmæ–‡ä»¶åç¼–è¯‘ä½¿ç”¨çš„æ˜¯<code>wasm-decompile</code>å‘½ä»¤ï¼Œå…·ä½“å‘½ä»¤ä¸º<code>wasm-decompile log.wasm -o log.dcmp</code>ï¼ŒæŸ¥çœ‹<code>log.dcmp</code>æ–‡ä»¶å¯çœ‹åˆ°importå’Œexportæ ‡æ³¨çš„æ–¹æ³•ã€‚</p><p><a href="https://www.wasm.builders/k33g_org/extend-wasm-with-host-functions-thanks-to-wazero-3n0n">å‚è€ƒ</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;wasmä»¥å°å·§å®‰å…¨çš„ç‰¹æ€§å—åˆ°å¹¿æ³›çš„å…³æ³¨ï¼Œä½†æ˜¯ä»–ä¹Ÿæœ‰å¾ˆå¤šçš„å±€é™æ€§ã€‚&lt;br&gt;è¿™äº›å±€é™æ€§å¯ä»¥é€šè¿‡&lt;code&gt;Host Function&lt;/code&gt;è¿›è¡Œæ‰©å±•ï¼Œä½¿å¾—&lt;em&gt;wasm&lt;/em&gt;ä¸&lt;em&gt;host&lt;/em&gt;èƒ½å¤Ÿè¿›è¡Œäº¤äº’ï¼Œå®Œæˆæ›´å¤šçš„åŠŸèƒ½ã€‚&lt;/p&gt;
&lt;p&gt;&lt;code&gt;Host Function&lt;/code&gt;éœ€è¦&lt;code&gt;import&lt;/code&gt;åˆ°wasmä¸­ï¼ŒåŒæ ·wasmä¸­çš„functionéœ€è¦&lt;code&gt;export&lt;/code&gt;åˆ°hostä¸­æ‰èƒ½è°ƒç”¨ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡ä¸»è¦è®°å½•ä¸‹åœ¨Golangä¸‹ï¼Œ&lt;code&gt;wasm function&lt;/code&gt;å¦‚ä½•ä¸&lt;code&gt;host function&lt;/code&gt;è¿›è¡Œäº¤äº’ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Golang" scheme="http://yuanba.tech/categories/Golang/"/>
    
    
    <category term="Wasm" scheme="http://yuanba.tech/tags/Wasm/"/>
    
    <category term="Golang" scheme="http://yuanba.tech/tags/Golang/"/>
    
    <category term="Tinygo" scheme="http://yuanba.tech/tags/Tinygo/"/>
    
  </entry>
  
  <entry>
    <title>åŸºäºWasmçš„è½»é‡å®æ—¶è®¡ç®—</title>
    <link href="http://yuanba.tech/wasm-realtime.html"/>
    <id>http://yuanba.tech/wasm-realtime.html</id>
    <published>2022-11-05T05:35:12.000Z</published>
    <updated>2022-11-05T05:35:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>éšç€å„è¡Œå„ä¸šå¯¹å®æ—¶è®¡ç®—çš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºçƒˆï¼Œå®æ—¶è®¡ç®—é¢†åŸŸçš„ç«äº‰ä¹Ÿè¶Šæ¥è¶Šæ¿€çƒˆï¼Œå‘ˆç°ç™¾èŠ±é½æ”¾çš„çŠ¶æ€ã€‚</p><p>è™½è¯´Flinkåœ¨å®æ—¶è®¡ç®—é¢†åŸŸå·²åç¨³è€å¤§å“¥ï¼Œä½†æ˜¯å´ä¹Ÿé˜»æŒ¡ä¸äº†å…¶å®ƒå®æ—¶è®¡ç®—æ¡†æ¶åœ¨æŸäº›ç»†åˆ†é¢†åŸŸå‘å…‰ã€‚</p><p>æœ¬ç¯‡ä¸»è¦ä»‹ç»å‡ æ¬¾åŸºäºwasmçš„è½»é‡å®æ—¶è®¡ç®—æ¡†æ¶ï¼Œæ¯”å¦‚Redpandaã€InfinyOnã€‚</p><span id="more"></span><h2 id="wasmæ˜¯ä»€ä¹ˆ"><a href="#wasmæ˜¯ä»€ä¹ˆ" class="headerlink" title="wasmæ˜¯ä»€ä¹ˆ"></a>wasmæ˜¯ä»€ä¹ˆ</h2><p>wasmæ˜¯WebAssemblyçš„ç®€ç§°ï¼Œå°±æ˜¯ä¸€ä¸ªå¯ç§»æ¤ã€ä½“ç§¯å°ã€åŠ è½½å¿«å¹¶ä¸”å…¼å®¹Webçš„å…¨æ–°æ ¼å¼ã€‚ç½‘ä¸Šä¹Ÿæœ‰å¾ˆå¤šç›¸å…³çš„ä»‹ç»ï¼Œå¯ä»¥å‚è€ƒä¸‹ã€‚</p><h2 id="Redpanda"><a href="#Redpanda" class="headerlink" title="Redpanda"></a>Redpanda</h2><p>æ¥è‡ªå®˜æ–¹çš„æè¿°ï¼š<em>Redpanda is a KafkaÂ®-compatible streaming data platform that is up to 10x faster and 6x more hardware-efficient. It is also JVM-free, ZooKeeperÂ®-free, Jepsen-tested and source available.</em><br>Redpandaæ˜¯ä¸€ä¸ªå®æ—¶æ•°æ®å¹³å°ï¼Œå®Œå…¨å…¼å®¹kafkaï¼Œå¹¶ä¸”æ²¡æœ‰å¤–éƒ¨ä¾èµ–ï¼Œæ¯”å¦‚zookeeperã€‚å®ƒæ˜¯ç”¨<code>C++</code>ç¼–å†™ï¼Œæ‰€ä»¥ä¹Ÿæ²¡æœ‰<code>JVM</code>ã€‚</p><p>ç”±å®˜æ–¹çš„æè¿°å¯çŸ¥å®ƒä¸»è¦æ˜¯å¯¹æ ‡kafkaï¼Œå…¶æ ¸å¿ƒåŠŸèƒ½ä¹Ÿå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—ã€‚ä¸è¿‡å®ƒè¿˜å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå®æ—¶å¤„ç†ï¼Œä¸ªäººæ„Ÿè§‰å…¶æ•´ä½“åŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼Plusarã€‚</p><p>ç”±äºå®ƒå®Œå…¨å…¼å®¹kafkaï¼Œæ‰€ä»¥å®ƒä¹Ÿæœ‰topicã€partitionã€replicationè¿™äº›æ¦‚å¿µï¼Œè€Œä¸”ä½¿ç”¨æ–¹å¼ä¹Ÿä¸kafkaä¸€æ ·ï¼Œå°±ä¸å†èµ˜è¿°äº†ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸‹å®æ—¶å¤„ç†ä¹Ÿå°±æ˜¯<code>Data Transforms</code>åŠŸèƒ½</p><h3 id="Data-Transforms"><a href="#Data-Transforms" class="headerlink" title="Data Transforms"></a>Data Transforms</h3><p><code>Data Transforms</code>æ˜¯Redpandaç”¨äºå®æ—¶æ•°æ®å¤„ç†çš„æ¨¡å—ï¼Œå…¶åŸºäº<code>wasm</code>å®ç°ã€‚åŸºäº<code>wasm</code>å®ç°çš„å¥½å¤„æ˜¯ç”¨æˆ·å¯ä»¥ä½¿ç”¨è‡ªå·±ç†Ÿæ‚‰çš„è¯­è¨€(å¯ç¼–è¯‘ä¸ºwasm)å¼€å‘æ•°æ®å¤„ç†é€»è¾‘ï¼Œç„¶åå°†å…¶ç¼–è¯‘ä¸º<code>wasm</code>æ–‡ä»¶å¹¶æ³¨å†Œéƒ¨ç½²åˆ°Redpandaä¸­ï¼Œå°±å¯ä»¥å¯¹æ•°æ®è¿›è¡Œå®æ—¶å¤„ç†ï¼Œå¯¹ç”¨æˆ·åŠå…¶å‹å¥½ã€‚</p><p>ä¸Šé¢æ˜¯æˆ‘ä¸ªäººçš„ç†è§£ï¼Œä¸‹é¢æ˜¯å®˜æ–¹ç»™å‡ºçš„äº®ç‚¹ï¼š</p><ol><li>æ˜“ç”¨: ç”¨æˆ·åªéœ€ä½¿ç”¨wasmæ”¯æŒçš„è¯­è¨€ç¼–å†™TransFormé€»è¾‘ï¼Œç„¶åå°†å…¶æ³¨å†Œåˆ°Redpandä¸­å°±å¯ä»¥äº†ï¼Œæ— éœ€å…³kafkaçš„ä¾èµ–åº“ã€‚</li><li>é«˜æ•ˆ: Transformä»£ç ä¼šæ¨é€åˆ°é›†ç¾¤ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ä¸­ï¼ŒRedpandaèŠ‚ç‚¹ä¼šåƒè°ƒç”¨RPCé‚£æ ·è°ƒç”¨è¿™äº›æœ¬åœ°ä»£ç ã€‚</li><li>ç®€å•: Transformç®¡ç†è¾ƒç®€å•ï¼Œåªéœ€å°†å…¶æ³¨å†Œåˆ°Redpandaå³å¯ï¼Œå…¶ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„topicä¸­ï¼Œç”±Redpandaè‡ªå·±ç®¡ç†ã€‚</li></ol><h3 id="Data-Transformsæ¶æ„"><a href="#Data-Transformsæ¶æ„" class="headerlink" title="Data Transformsæ¶æ„"></a>Data Transformsæ¶æ„</h3><p>Data Transformsç”±4éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯<code>å®¢æˆ·ç«¯å·¥å…·</code>ã€<code>å­˜å‚¨å’ŒTransform code</code>ã€<code>Routing streams</code>å’Œ<code>æ‰§è¡Œå¼•æ“</code>ã€‚</p><p><img src="/blogimgs/wasm-realtime/arch.png" title="æ¶æ„å›¾"></p><blockquote><p>å®¢æˆ·ç«¯å·¥å…·(Client-side tooling)</p></blockquote><p>å®¢æˆ·ç«¯å·¥å…·<code>rpk</code>å¯ä»¥ç”Ÿæˆä¸€ä¸ªæ ‡å‡†å·¥ç¨‹æ¨¡ç‰ˆï¼Œå¼€å‘è€…åªéœ€å¡«å……æ•°æ®è½¬æ¢é€»è¾‘å³å¯ã€‚è¿˜å¯é€šè¿‡<code>rpk</code>è¿›è¡Œéƒ¨ç½²ã€æ›´æ–°<code>wasm</code>æ–‡ä»¶ã€‚</p><blockquote><p>å­˜å‚¨å’ŒTransform code(Storage and distribution of scripts)</p></blockquote><p>Redpandaæ ¸å¿ƒæ˜¯ä¸€ä¸ªå¯çº¿æ€§æ‰©å±•ã€æ”¯æŒäº‹åŠ¡çš„å­˜å‚¨å¼•æ“ï¼Œåº•å±‚ä½¿ç”¨raftåè®®ä¿è¯æ•°æ®å‰¯æœ¬ä¹‹é—´çš„ä¸€è‡´æ€§ã€‚Redpandaå®Œå…¨æ”¯æŒkafkaåè®®ï¼Œæ‰€ä»¥ä¹Ÿæ˜¯æŒ‰ç…§topicã€partitionå’Œreplicationè¿›è¡Œå­˜å‚¨çš„ï¼ŒåŒæ ·ä¹Ÿæ”¯æŒå‹ç¼©å­˜å‚¨ã€‚</p><p>å¼€å‘è€…æ³¨å†Œçš„<code>.wasm</code>æ–‡ä»¶å­˜åœ¨ä¸€ä¸ªå•ç‹¬çš„å†…ç½®topicä¸­ï¼Œå…¶topicä¹Ÿæ˜¯æ”¯æŒå‹ç¼©çš„ã€‚<code>wasm</code>æ–‡ä»¶é€šè¿‡åå­—æ¥åŒºåˆ†ï¼Œç›¸åŒåå­—çš„wasmæ ¹æ®æ—¶é—´é¡ºåºè¿›è¡Œæ›´æ–°ï¼Œå‹ç¼©æ—¶ä¼šå°†å†å²ç‰ˆæœ¬ç§»é™¤ã€‚</p><blockquote><p>Routing streams(pacemaker)</p></blockquote><p>Routing streamsä¸»è¦ç”¨æ¥å°†æ•°æ®æ ¹æ®è§„åˆ™è·¯ç”±ç»™ä¸åŒçš„transformè¿›è¡Œå¤„ç†ï¼Œè¿™ä¸ªç»„ä»¶è¢«ç§°ä¸º<code>pacemaker</code>ã€‚å®ƒæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå®ƒéœ€è¦åœ¨ä¿è¯é«˜æ•ˆçš„å‰æä¸‹è¿˜éœ€è¦ä¿è¯æ•°æ®çš„é¡ºåºæ€§ã€‚å…¶æ•´ä¸ªå·¥ä½œæµåŒ…å«3æ­¥ï¼š</p><ol><li>å¹¶è¡Œä»<code>input</code>ä¸­è¯»å–æ•°æ®</li><li>æ¯ä¸ªåå¤„ç†å™¨é€šè¿‡RPCè°ƒç”¨<code>wasm</code>æ‰§è¡Œå¼•æ“æ‰§è¡Œä¼ è¿‡æ¥çš„æ•°æ®å’Œç›¸å…³çš„å…ƒæ•°æ®</li><li>å°†æ‰§è¡Œç»“æœå’Œoffsetå†™å…¥ç»“æœtopicä¸­</li></ol><p><img src="/blogimgs/wasm-realtime/pacemaker.png" title="pacemakerå·¥ä½œæµ"><br>éœ€è¦æ³¨æ„çš„æ˜¯åœ¨å•ä¸ªåå¤„ç†å™¨ä¸­åªæœ‰åœ¨ç¬¬3æ­¥æ‰§è¡Œç»“æŸä¹‹åï¼Œç¬¬1æ­¥æ‰èƒ½å†æ¬¡è¢«æ‰§è¡Œï¼Œå¦åˆ™ç»“æœä¸­çš„æ•°æ®å°±ä¼šä¹±åºã€‚</p><p>peacemakerä¸­è¿˜ä¼šè®°å½•æ¯ä¸ªtransformå¤„ç†çš„offsetçŠ¶æ€ï¼Œä»¥ä¾¿å½“å¤„ç†å¤±è´¥æ—¶å·²è®°å½•çš„offsetå¤„è¿›è¡Œé‡æ”¾ï¼Œä»¥ä¿è¯å¹‚ç­‰æ€§ã€‚</p><blockquote><p>æ‰§è¡Œå¼•æ“(execution engine)</p></blockquote><p>æ‰§è¡Œå¼•æ“æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯åŒæ­¥å‡½æ•°è°ƒç”¨ï¼Œå¦ä¸€ç§æ˜¯åŸºäºå¼‚æ­¥çš„çŠ¶æ€è½¬æ¢ã€‚</p><ul><li>åŒæ­¥æ‰§è¡Œå¼•æ“<br>åŒæ­¥æ‰§è¡Œå¼•æ“ä¸»è¦åº”ç”¨åœ¨ä¸€äº›ç®€å•çš„æ•°æ®è¿‡æ»¤ã€æ•°æ®åŠ å¯†ç­‰è¾ƒä¸ºçº¯ç²¹çš„æ•°æ®å¤„ç†åœºæ™¯ä¸‹ï¼Œ<code>wasm</code>æ–‡ä»¶å°±åƒè°ƒç”¨åŒæ­¥å‡½æ•°é‚£æ ·è¢«æ‰§è¡Œã€‚å…¶æ¶æ„å¦‚å›¾ï¼š</li></ul><p><img src="/blogimgs/wasm-realtime/sync.png" title="åŒæ­¥æ‰§è¡Œå¼•æ“"></p><ul><li>å¼‚æ­¥æ‰§è¡Œå¼•æ“<br>å¼‚æ­¥æ‰§è¡Œå¼•æ“ä¸»è¦ç”¨äºåœ¨transformæ—¶éœ€è¦å¤–éƒ¨ä¾èµ–æˆ–è€…ä¸€äº›çŠ¶æ€çš„åœºæ™¯ä¸­ã€‚å› ä¸ºåœ¨è¿™äº›æƒ…å†µä¸‹<code>wasm</code>çš„æ‰§è¡Œæ—¶é•¿æ˜¯ä¸å—æ§åˆ¶çš„ï¼Œå®¹æ˜“é€ æˆé˜»å¡ï¼Œæ‰€ä»¥åœ¨å¼‚æ­¥æ‰§è¡Œå¼•æ“ä¸­ä¼šæ–°å»ºä¸€ä¸ªä¸åŸtopicåˆ†åŒºä¸€æ‘¸ä¸€æ ·çš„å­åˆ†åŒºï¼Œè¿™æ ·å°†producerã€transformå’Œconsumerè§£å¶ï¼Œæå‡æ•°æ®å¤„ç†èƒ½åŠ›ã€‚å…¶æ¶æ„å¦‚å›¾ï¼š</li></ul><p><img src="/blogimgs/wasm-realtime/async.png" title="å¼‚æ­¥æ‰§è¡Œå¼•æ“"></p><h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p><a href="https://redpanda.com/blog/change-data-capture-postgres-debezium-kafka-connect">è¿™é‡Œ</a>æ˜¯å®˜æ–¹çš„ä¸€ä¸ªdemoï¼Œä»pgä¸­é€šè¿‡cdcå°†æ•°æ®ä¼ å…¥Redpandaä¸­ï¼Œæµç¨‹è¾ƒä¸ºç®€å•ï¼Œè€Œä¸”éƒ½æ˜¯åŸºäºdockerç¯å¢ƒçš„ï¼Œå°±ä¸å†é‡å¤äº†ã€‚</p><!--https://www.youtube.com/watch?v=skzWrp8eU-Yhttps://redpanda.com/blog/data-transformation-engine-with-wasm-runtimehttps://redpanda.com/blog/wasm-architecture--><h2 id="fluvio"><a href="#fluvio" class="headerlink" title="fluvio"></a>fluvio</h2><p>fluvioå‡ºè‡ªInfinyOnï¼Œå®ƒä¹Ÿæ˜¯å¼€æºçš„ï¼Œå¯å¯¹æ•°æ®è¿›è¡Œå®æ—¶èšåˆã€å…³è”å’Œå¯ç¼–ç¨‹ã€‚</p><p><img src="/blogimgs/wasm-realtime/fluvio.png" title="fluvio"></p><p>åˆ†ä¸º4éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¸º<code>SmartModules</code>ã€<code>Data Streams</code>ã€<code>Immutable Store</code>å’Œ<code>Clients &amp; Connectors</code>ã€‚</p><ul><li><code>SmartModules</code>æ˜¯å¯ç¼–ç¨‹æ¨¡å—ï¼Œå¯ä»¥å®æ—¶å¯¹æ•°æ®è¿›è¡Œæ¸…æ´—ã€è¿‡æ»¤å’Œè®¡ç®—ï¼Œæ˜¯ç”¨<code>Rust</code>ç¼–å†™ç„¶åç¼–è¯‘ä¸º<code>wasm</code>è¿›è¡Œæ‰§è¡Œã€‚</li><li><code>Data Streams</code>æ˜¯åˆ†å¸ƒå¼æ¨¡å—ï¼Œæ”¯æŒå†—ä½™å’Œè‡ªåŠ¨æ¢å¤ã€‚</li><li><code>Immutable Store</code>æ˜¯ä¸€ä¸ªæŒä¹…ä¸å˜çš„å­˜å‚¨å±‚ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®</li><li><code>Clients &amp; Connectors</code>åŒ…å«ä¸€äº›å°è£…å¥½çš„APIï¼Œå¯ä»¥è¿›è¡Œç”Ÿäº§æ•°æ®å’Œæ¶ˆè´¹æ•°æ®ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›å·²å°è£…å¥½çš„connectorç”¨äºè¿æ¥ä¸€äº›å¸¸è§æ•°æ®æºï¼Œæ¯”å¦‚pgsql</li></ul><h3 id="fluvioæ¶æ„"><a href="#fluvioæ¶æ„" class="headerlink" title="fluvioæ¶æ„"></a>fluvioæ¶æ„</h3><p>fluvioç”±2ä¸ªç»„ä»¶ç»„æˆï¼Œåˆ†åˆ«ä¸º<code>Streaming Controller(SC)</code>å’Œ<code>Streaming Processing Units(SPU)</code>ï¼Œé‡‡ç”¨master/workerå½¢å¼ï¼Œå…¶æ¶æ„å¦‚å›¾ï¼š</p><p><img src="/blogimgs/wasm-realtime/fluvio-arch.png" title="fluvioæ¶æ„å›¾"></p><p>SCè´Ÿè´£SPUçš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬æ•´ä¸ªé›†ç¾¤å„ä¸ªèŠ‚ç‚¹çš„æ‹“æ‰‘å›¾å’Œåˆ†å¸ƒå¼æ•°æ®æµç›¸å…³çš„ä¼˜åŒ–ã€‚SPUè´Ÿè´£å®æ—¶æ•°æ®ã€‚SCå’ŒSPUæ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªæœåŠ¡éƒ½å¯å•ç‹¬é‡å¯ã€å‡çº§ã€‚</p><h3 id="SmartModules"><a href="#SmartModules" class="headerlink" title="SmartModules"></a>SmartModules</h3><p>SmartModulesæ˜¯å¼€å‘è€…å¯ç¼–ç¨‹çš„æ¨¡å—ï¼Œå¼€å‘è€…ä½¿ç”¨Rustè¯­è¨€è¿›è¡Œå¼€å‘ï¼Œç„¶åå°†å…¶ç¼–è¯‘ä¸ºwasmæäº¤ç»™fluvioï¼Œå°±å…è®¸å¼€å‘è€…ç›´æ¥æ§åˆ¶æ•°æ®æµã€‚<br>ç›®å‰å®˜æ–¹æä¾›çš„ç±»å‹æœ‰<code>Filter</code>ã€<code>Map</code>ï¼Œ<code>FilterMap</code>ï¼Œ<code>ArrayMap</code>å’Œ<code>Aggregate</code>ï¼Œä¸è¿‡å®˜æ–¹è¿˜æä¾›äº†ä¸€ä¸ªHubï¼Œæ–¹ä¾¿å¼€å‘è€…è´¡çŒ®è‡ªå·±çš„SmartModuleså’Œä¸‹è½½æ‰€éœ€çš„éå®˜æ–¹SmartModules</p><p>å®˜æ–¹ä¹Ÿæä¾›äº†ä¸€äº›Demoï¼Œéƒ½æ¯”è¾ƒç®€å•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡ŒæŸ¥çœ‹ã€‚</p><!-- https://www.infinyon.com/blog/2021/08/smartmodule-aggregates/https://www.infinyon.com/blog/2021/08/smartmodule-map-use-cases/https://www.infinyon.com/blog/2021/06/smartmodule-filters/--><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>è¿™ä¸¤ä¸ªå®æ—¶æ¡†æ¶éƒ½æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—ä¹‹ä¸Šçš„ï¼Œéƒ½æ˜¯é€šè¿‡<code>wasm</code>å°†æ•°æ®å¤„ç†åŠŸèƒ½å¼€å‘ç»™å¼€å‘è€…ï¼Œå…¶åŠŸèƒ½æœ‰ç‚¹åƒPlusarï¼Œåªä¸è¿‡Plusaræ˜¯ç”¨javaè¯­è¨€å¼€å‘çš„ï¼Œå…¶æ•°æ®å¤„ç†èƒ½åŠ›å¹¶æ²¡æœ‰ä½¿ç”¨<code>wasm</code>ï¼Œè€Œæ˜¯ä½¿ç”¨çš„æ˜¯åŸç”Ÿjavaè¯­è¨€ï¼Œä¸ªäººæ„Ÿè§‰å¯èƒ½æ˜¯å› ä¸ºjavaè¯­è¨€å—ä¼—æ¯”è¾ƒå¹¿å§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;éšç€å„è¡Œå„ä¸šå¯¹å®æ—¶è®¡ç®—çš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºçƒˆï¼Œå®æ—¶è®¡ç®—é¢†åŸŸçš„ç«äº‰ä¹Ÿè¶Šæ¥è¶Šæ¿€çƒˆï¼Œå‘ˆç°ç™¾èŠ±é½æ”¾çš„çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;è™½è¯´Flinkåœ¨å®æ—¶è®¡ç®—é¢†åŸŸå·²åç¨³è€å¤§å“¥ï¼Œä½†æ˜¯å´ä¹Ÿé˜»æŒ¡ä¸äº†å…¶å®ƒå®æ—¶è®¡ç®—æ¡†æ¶åœ¨æŸäº›ç»†åˆ†é¢†åŸŸå‘å…‰ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡ä¸»è¦ä»‹ç»å‡ æ¬¾åŸºäºwasmçš„è½»é‡å®æ—¶è®¡ç®—æ¡†æ¶ï¼Œæ¯”å¦‚Redpandaã€InfinyOnã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Realtime, BigData" scheme="http://yuanba.tech/categories/Realtime-BigData/"/>
    
    
    <category term="Wasm" scheme="http://yuanba.tech/tags/Wasm/"/>
    
    <category term="Redpanda" scheme="http://yuanba.tech/tags/Redpanda/"/>
    
    <category term="InfinyOn" scheme="http://yuanba.tech/tags/InfinyOn/"/>
    
    <category term="Pulsar" scheme="http://yuanba.tech/tags/Pulsar/"/>
    
    <category term="Realtime" scheme="http://yuanba.tech/tags/Realtime/"/>
    
  </entry>
  
  <entry>
    <title>scratchè‡ªå®šä¹‰æ‰©å±•</title>
    <link href="http://yuanba.tech/scratch-extensions-demo.html"/>
    <id>http://yuanba.tech/scratch-extensions-demo.html</id>
    <published>2021-12-14T14:30:20.000Z</published>
    <updated>2021-12-14T16:10:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»Šæ—¥æƒ³æä¸€æscratchï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°å®˜æ–¹ç»™çš„æ‰©å±•ç»„ä»¶ä¸­æœ‰äº›åœ¨å›½å†…ç”¨ä¸äº†ï¼Œæ‰€ä»¥å°±æƒ³æŠŠè¿™ä¸ªé—®é¢˜ç»™ä¿®å¤ä¸‹ï¼Œæ–¹ä¾¿å›½å†…ç”¨æˆ·ä½¿ç”¨ã€‚</p><p>åœ¨ä¿®å¤è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œç°ç†Ÿæ‚‰ä¸‹scratchï¼Œä»¥åŠå¦‚ä½•è‡ªå®šä¹‰æ‰©å±•ã€‚</p><span id="more"></span><h2 id="scratch"><a href="#scratch" class="headerlink" title="scratch"></a>scratch</h2><p>scratchæ˜¯MITå¼€æºçš„å°‘å„¿ç¼–ç¨‹å·¥å…·ï¼Œæä¾›å¯è§†åŒ–çš„ï¼Œç§¯æœ¨å¼ç¼–ç¨‹ï¼Œé™ä½å­¦ä¹ é—¨æ§›ï¼Œä¸°å¯Œåˆ›ä½œå½¢å¼ã€‚<br>æˆ‘ä½¿ç”¨çš„æ˜¯scratch3.0ï¼Œå®ƒæ˜¯ç”±å¤šä¸ªæ¨¡å—ç»„æˆçš„ï¼Œä¸æœ¬ç¯‡æ–‡ç« æ¶‰åŠæ¯”è¾ƒç´§å¯†çš„æ˜¯<code>scratch-gui</code>å’Œ<code>scratch-vm</code>ï¼Œå…¶ä¸­<code>scratch-gui</code>æä¾›äº†å¯è§†åŒ–çš„æ“ä½œç•Œé¢ï¼Œ<code>scratch-vm</code>æ˜¯æä¾›äº†è¿è¡Œç¯å¢ƒå’Œæ‰©å±•æ¨¡å—ã€‚</p><h2 id="è‡ªå®šä¹‰æ‰©å±•æ’ä»¶"><a href="#è‡ªå®šä¹‰æ‰©å±•æ’ä»¶" class="headerlink" title="è‡ªå®šä¹‰æ‰©å±•æ’ä»¶"></a>è‡ªå®šä¹‰æ‰©å±•æ’ä»¶</h2><h3 id="scratch-vmä¸­çš„æ”¹åŠ¨"><a href="#scratch-vmä¸­çš„æ”¹åŠ¨" class="headerlink" title="scratch-vmä¸­çš„æ”¹åŠ¨"></a>scratch-vmä¸­çš„æ”¹åŠ¨</h3><p>æ‰©å±•æ’ä»¶çš„å…·ä½“å®ç°åœ¨<code>scratch-vm</code>æ¨¡å—ä¸­çš„<code>src/extensions</code>ï¼Œå½“å‰ç›®å½•ä¸­å·²æœ‰ä¸€äº›å®˜æ–¹é›†æˆçš„æ’ä»¶ï¼Œæ¯”å¦‚ç¿»è¯‘ã€ä¹é«˜äº’è”ç›¸å…³çš„æ’ä»¶ï¼Œæ¯ä¸ªæ‰©å±•ä¸­éƒ½æœ‰ä¸ª<code>index.js</code>æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯è¯¥æ‰©å±•çš„ä¸»è¦å®ç°å…¥å£ã€‚</p><p>è‡ªå®šä¹‰æ‰©å±•ä¸­å¯ä»¥ä½¿ç”¨çš„ç§¯æœ¨å—æ‰€åœ¨<code>getInfo()</code>æ–¹æ³•ä¸­å®šä¹‰çš„ï¼Œçœ‹ä¸‹ç¿»è¯‘æ‰©å±•ä¸­<code>getInfo()</code>æ–¹æ³•ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">getInfo () &#123;</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">id</span>: <span class="string">&#x27;translate&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: formatMessage(&#123;</span><br><span class="line">            <span class="attr">id</span>: <span class="string">&#x27;translate.categoryName&#x27;</span>,</span><br><span class="line">            <span class="attr">default</span>: <span class="string">&#x27;Translate&#x27;</span>,</span><br><span class="line">            <span class="attr">description</span>: <span class="string">&#x27;Name of extension that adds translate blocks&#x27;</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="attr">blockIconURI</span>: blockIconURI,</span><br><span class="line">        <span class="attr">menuIconURI</span>: menuIconURI,</span><br><span class="line">        <span class="attr">blocks</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">opcode</span>: <span class="string">&#x27;getTranslate&#x27;</span>,</span><br><span class="line">                <span class="attr">text</span>: formatMessage(&#123;</span><br><span class="line">                    <span class="attr">id</span>: <span class="string">&#x27;translate.translateBlock&#x27;</span>,</span><br><span class="line">                    <span class="attr">default</span>: <span class="string">&#x27;translate [WORDS] to [LANGUAGE]&#x27;</span>,</span><br><span class="line">                    <span class="attr">description</span>: <span class="string">&#x27;translate some text to a different language&#x27;</span></span><br><span class="line">                &#125;),</span><br><span class="line">                <span class="attr">blockType</span>: BlockType.REPORTER,</span><br><span class="line">                <span class="attr">arguments</span>: &#123;</span><br><span class="line">                    <span class="attr">WORDS</span>: &#123;</span><br><span class="line">                        <span class="attr">type</span>: ArgumentType.STRING,</span><br><span class="line">                        <span class="attr">defaultValue</span>: formatMessage(&#123;</span><br><span class="line">                            <span class="attr">id</span>: <span class="string">&#x27;translate.defaultTextToTranslate&#x27;</span>,</span><br><span class="line">                            <span class="attr">default</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">                            <span class="attr">description</span>: <span class="string">&#x27;hello: the default text to translate&#x27;</span></span><br><span class="line">                        &#125;)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">LANGUAGE</span>: &#123;</span><br><span class="line">                        <span class="attr">type</span>: ArgumentType.STRING,</span><br><span class="line">                        <span class="attr">menu</span>: <span class="string">&#x27;languages&#x27;</span>,</span><br><span class="line">                        <span class="attr">defaultValue</span>: <span class="built_in">this</span>._randomLanguageCode</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">opcode</span>: <span class="string">&#x27;getViewerLanguage&#x27;</span>,</span><br><span class="line">                <span class="attr">text</span>: formatMessage(&#123;</span><br><span class="line">                    <span class="attr">id</span>: <span class="string">&#x27;translate.viewerLanguage&#x27;</span>,</span><br><span class="line">                    <span class="attr">default</span>: <span class="string">&#x27;language&#x27;</span>,</span><br><span class="line">                    <span class="attr">description</span>: <span class="string">&#x27;the languge of the project viewer&#x27;</span></span><br><span class="line">                &#125;),</span><br><span class="line">                <span class="attr">blockType</span>: BlockType.REPORTER,</span><br><span class="line">                <span class="attr">arguments</span>: &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        ...</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>blocks</code>å¯¹åº”çš„å€¼å°±æ˜¯ç§¯æœ¨å—ç±»å‹ï¼Œ<code>opcode</code>æ˜¯å…·ä½“æŸä¸ªç§¯æœ¨å—çš„å®ç°å†…å®¹ï¼Œå¦‚æœè¦ä¿®æ”¹ç§¯æœ¨å—çš„åŠŸèƒ½å°±ä¿®æ”¹æ­¤æ–¹æ³•å°±å¯ä»¥ã€‚</p><p>è‡ªå®šä¹‰æ‰©å±•çš„åŠŸèƒ½åœ¨æ­¤å®ç°ä¹‹åï¼Œè¿˜éœ€è¦åœ¨<code>src/extension-support/extension-manager.js</code>ä¸­æ³¨å†Œï¼Œè¿™æ ·åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå°†å…¶è‡ªå®šä¹‰æ‰©å±•è¿›è¡Œç¼–è¯‘ï¼Œå·²æ³¨å†Œçš„æ‰©å±•å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> builtinExtensions = &#123;</span><br><span class="line">    <span class="comment">// This is an example that isn&#x27;t loaded with the other core blocks,</span></span><br><span class="line">    <span class="comment">// but serves as a reference for loading core blocks as extensions.</span></span><br><span class="line">    <span class="attr">coreExample</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../blocks/scratch3_core_example&#x27;</span>),</span><br><span class="line">    <span class="comment">// These are the non-core built-in extensions.</span></span><br><span class="line">    <span class="attr">pen</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_pen&#x27;</span>),</span><br><span class="line">    <span class="attr">wedo2</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_wedo2&#x27;</span>),</span><br><span class="line">    <span class="attr">music</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_music&#x27;</span>),</span><br><span class="line">    <span class="attr">microbit</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_microbit&#x27;</span>),</span><br><span class="line">    <span class="attr">text2speech</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_text2speech&#x27;</span>),</span><br><span class="line">    <span class="attr">translate</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_translate&#x27;</span>),</span><br><span class="line">    <span class="attr">videoSensing</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_video_sensing&#x27;</span>),</span><br><span class="line">    <span class="attr">ev3</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_ev3&#x27;</span>),</span><br><span class="line">    <span class="attr">makeymakey</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_makeymakey&#x27;</span>),</span><br><span class="line">    <span class="attr">boost</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_boost&#x27;</span>),</span><br><span class="line">    <span class="attr">gdxfor</span>: <span class="function">() =&gt;</span> <span class="built_in">require</span>(<span class="string">&#x27;../extensions/scratch3_gdx_for&#x27;</span>),</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3 id="scratch-guiä¸­çš„æ”¹åŠ¨"><a href="#scratch-guiä¸­çš„æ”¹åŠ¨" class="headerlink" title="scratch-guiä¸­çš„æ”¹åŠ¨"></a>scratch-guiä¸­çš„æ”¹åŠ¨</h3><p>scratch-vmä¿®æ”¹ç»“æŸä¹‹åï¼Œè¿˜éœ€è¦åœ¨<code>scratch-gui</code>ä¸­å¯¼å…¥è¯¥æ‰©å±•çš„ä¸€äº›ä¿¡æ¯ä¸å…¥å£ï¼Œä¿®æ”¹<code>/src/lib/libraries/extensions/index.jsx</code>æ–‡ä»¶ï¼Œ<br>é¦–å…ˆå¯¼å…¥è‡ªå®šä¹‰æ‰©å±•æ˜¾ç¤ºå›¾æ ‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> translateIconURL <span class="keyword">from</span> <span class="string">&#x27;./translate/translate.png&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> translateInsetIconURL <span class="keyword">from</span> <span class="string">&#x27;./translate/translate-small.png&#x27;</span>;</span><br></pre></td></tr></table></figure><p>å…¶æ¬¡åœ¨<code>export default </code>ä»£ç å—ä¸­å¢åŠ è‡ªå®šä¹‰æ‰©å±•çš„ä¸€äº›æè¿°ä¿¡æ¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å…¶ä¸­çš„<code>extensionId</code>çš„å€¼éœ€è¦ä¸<code>scratch-vm</code>ä¸­<code>builtinExtensions</code>çš„å€¼å¯¹åº”ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">name</span>: (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">FormattedMessage</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">defaultMessage</span>=<span class="string">&quot;Translate&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">description</span>=<span class="string">&quot;Name for the Translate extension&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">id</span>=<span class="string">&quot;gui.extension.translate.name&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        /&gt;</span></span></span><br><span class="line">    ),</span><br><span class="line">    <span class="attr">extensionId</span>: <span class="string">&#x27;translate&#x27;</span>,</span><br><span class="line">    <span class="attr">collaborator</span>: <span class="string">&#x27;YuanbaLab&#x27;</span>,</span><br><span class="line">    <span class="attr">iconURL</span>: translateIconURL,</span><br><span class="line">    <span class="attr">insetIconURL</span>: translateInsetIconURL,</span><br><span class="line">    <span class="attr">description</span>: (</span><br><span class="line">        <span class="xml"><span class="tag">&lt;<span class="name">FormattedMessage</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">defaultMessage</span>=<span class="string">&quot;Translate text into many languages.&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">description</span>=<span class="string">&quot;Description for the Translate extension&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">            <span class="attr">id</span>=<span class="string">&quot;gui.extension.translate.description&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">        /&gt;</span></span></span><br><span class="line">    ),</span><br><span class="line">    <span class="attr">featured</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">internetConnectionRequired</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¼–è¯‘è°ƒè¯•"><a href="#ç¼–è¯‘è°ƒè¯•" class="headerlink" title="ç¼–è¯‘è°ƒè¯•"></a>ç¼–è¯‘è°ƒè¯•</h3><p>ç¼–è¯‘è°ƒè¯•éœ€è¦å…·å¤‡node.jsç¯å¢ƒï¼Œå®‰è£…<code>npm install -g webpack</code>å’Œ<code>npm install -g webpack-dev-server</code>ã€‚<br>è¿›å…¥<code>scratch-vm</code>é¡¹ç›®ç›®å½•ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm link</span><br><span class="line">npm run watch</span><br></pre></td></tr></table></figure><p>ç„¶åå†å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œè¿›å…¥<code>scratch-gui</code>ç›®å½•ä¸­ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install</span><br><span class="line">npm link scratch-vm </span><br><span class="line">npm start</span><br></pre></td></tr></table></figure><p>æ²¡æœ‰ä»»ä½•é”™è¯¯ä¿¡æ¯ä¹‹åï¼Œå°±å¯ä»¥åœ¨<code>http://127.0.0.1:8601/</code>åœ°å€ä½¿ç”¨scratch3.0äº†ã€‚</p><h2 id="ç¼–è¯‘æˆæ¡Œé¢ç¨‹åº"><a href="#ç¼–è¯‘æˆæ¡Œé¢ç¨‹åº" class="headerlink" title="ç¼–è¯‘æˆæ¡Œé¢ç¨‹åº"></a>ç¼–è¯‘æˆæ¡Œé¢ç¨‹åº</h2><p>git clone <a href="mailto:&#103;&#x69;&#116;&#x40;&#103;&#105;&#x74;&#x68;&#117;&#98;&#46;&#99;&#111;&#x6d;">&#103;&#x69;&#116;&#x40;&#103;&#105;&#x74;&#x68;&#117;&#98;&#46;&#99;&#111;&#x6d;</a>:hunshenshi/scratch-desktop.git</p><p>cd scratch-gui<br>npm install<br>npm link</p><p>cd scratch-desktop<br>npm install<br>npm link scratch-gui<br>npm run dist</p><p>electron æŠ¥é”™<br>è¿›å…¥ electronç›®å½•ï¼Œæ‰§è¡Œnode install.js</p><p>Cannot find module â€˜autoprefixerâ€™â€<br>npm install â€“save autoprefixer@^9.0.1</p><p>å°† æœ¬åœ°scratch-vmå’Œscratch-gui cpåˆ°desktopä¸­   or     npm link scratch-vm scratch-blocks<br>npm run clean &amp;&amp; npm run compile &amp;&amp; npm run doBuild â€“ â€“mode=dev</p><p>npm run dist # ç¼–è¯‘åçš„å®‰è£…åŒ…Scratch Desktop-3.8.0.AppImageå’Œscratch-desktop_3.8.0_amd64.snapä¿å­˜åœ¨scratch-desktop/dist/æ–‡ä»¶å¤¹ä¸­ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä»Šæ—¥æƒ³æä¸€æscratchï¼Œä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°å®˜æ–¹ç»™çš„æ‰©å±•ç»„ä»¶ä¸­æœ‰äº›åœ¨å›½å†…ç”¨ä¸äº†ï¼Œæ‰€ä»¥å°±æƒ³æŠŠè¿™ä¸ªé—®é¢˜ç»™ä¿®å¤ä¸‹ï¼Œæ–¹ä¾¿å›½å†…ç”¨æˆ·ä½¿ç”¨ã€‚&lt;/p&gt;
&lt;p&gt;åœ¨ä¿®å¤è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œç°ç†Ÿæ‚‰ä¸‹scratchï¼Œä»¥åŠå¦‚ä½•è‡ªå®šä¹‰æ‰©å±•ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="kidsCode" scheme="http://yuanba.tech/categories/kidsCode/"/>
    
    
    <category term="scratch" scheme="http://yuanba.tech/tags/scratch/"/>
    
    <category term="æ‰©å±•" scheme="http://yuanba.tech/tags/%E6%89%A9%E5%B1%95/"/>
    
    <category term="kidsCode" scheme="http://yuanba.tech/tags/kidsCode/"/>
    
  </entry>
  
  <entry>
    <title>metabaseå¯¼å…¥IDEè°ƒè¯•</title>
    <link href="http://yuanba.tech/metabase-import-ide.html"/>
    <id>http://yuanba.tech/metabase-import-ide.html</id>
    <published>2021-12-13T15:31:22.000Z</published>
    <updated>2021-12-13T15:51:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨è°ƒç ”BIæŠ¥è¡¨ç›¸å…³çš„å·¥å…·ï¼Œæœ€åå†³å®šæ·±å…¥è°ƒç ”ä¸‹metabaseï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚</p><p>ä¹‹æ‰€ä»¥é€‰æ‹©metabaseæ˜¯å› ä¸ºä¸€ä¸‹å‡ ç‚¹ï¼š</p><ol><li>ä½é—¨æ§›ï¼Œå¯¹æ— sqlåŸºç¡€çš„äººå‘˜å‹å¥½</li><li>åˆ†æåŠŸèƒ½è¾ƒå…¨ï¼Œæ”¯æŒjoin</li><li>å›¾è¡¨åŠŸèƒ½OK</li><li>éƒ¨ç½²æ–¹ä¾¿<br>å¯¹äºæˆ‘æ¥è¯´ï¼Œå”¯ä¸€ä¸è¶³çš„æ˜¯å®ƒæ˜¯ç”±clojureå¼€å‘çš„ï¼ŒäºŒå¼€æˆæœ¬æœ‰ç‚¹é«˜ï¼Œè¿™æ‰æ˜¯è¿™ç¯‡æ–‡ç« çš„è¯ç”Ÿçš„çœŸæ­£åŸå› ï¼Œå› ä¸ºå¯¼å…¥IDEç¼–è¯‘æˆåŠŸå°±ç”¨äº†å¥½å‡ å¤©ã€‚        </li></ol><span id="more"></span><h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>metabaseå‰ç«¯ä¾èµ–nodeï¼Œåç«¯ä»¥æ¥jdkå’Œclojureã€‚</p><blockquote><p>æˆ‘æ˜¯åœ¨macç¯å¢ƒä¸‹çš„ï¼Œä¸‹é¢çš„å‘½ä»¤éƒ½æ˜¯åŸºäºmacçš„ã€‚</p></blockquote><p>1ã€å®‰è£…node<br>ä¹‹å‰åœ¨ç”µè„‘ä¸Šè£…è¿‡nodeï¼Œä½¿ç”¨tarå®‰è£…çš„ï¼Œåªæ˜¯ç‰ˆæœ¬æ¯”è¾ƒè€ï¼Œäºæ˜¯ç”¨taråŒ…å‡çº§äº†nodeï¼Œç‰ˆæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">âœ cnpm -v</span><br><span class="line">cnpm@7.1.0 </span><br><span class="line">npm@6.14.15 </span><br><span class="line">node@16.13.0 </span><br><span class="line">npminstall@5.2.2 </span><br></pre></td></tr></table></figure><p>2ã€å®‰è£…yarn<br>nodeå®‰è£…å¥½ä¹‹åï¼Œå†å®‰è£…yarnï¼Œå®‰è£…æ—¶è¦é€‰æ‹©å…¨å±€å®‰è£…ï¼Œä½¿ç”¨å‘½ä»¤<br><code>npm install --global yarn</code></p><p>3ã€å®‰è£…jdk<br>jdkçš„å®‰è£…åªå¼ºè°ƒä¸€ç‚¹ï¼Œ<strong>ä¸€å®šè¦jdk11ã€jdk11ã€jdk11</strong></p><p>4ã€å®‰è£…clojure<br>åˆ©ç”¨brewå®‰è£…<br><code>brew install clojure/tools/clojure</code></p><blockquote><p>ç”±äºClojureä¹Ÿä¾èµ–mavenï¼Œé»˜è®¤çš„mavenæºåœ¨å›½å†…ç»å¸¸æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥éœ€è¦æ›¿æ¢mavenæº</p></blockquote><p>åœ¨Clojureçš„å®‰è£…ç›®å½•ä¸­æ‰¾åˆ°<code>deps.edn</code>ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">:mvn/repos &#123;</span><br><span class="line">  &quot;central&quot; &#123;:url &quot;http://maven.aliyun.com/nexus/content/repositories/central/&quot;&#125; </span><br><span class="line">  &quot;clojars&quot; &#123;:url &quot;https://repo.clojars.org/&quot;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨å‘½ä»¤è¡Œè¾“å…¥<code>clj</code> æˆ–è€… <code>clojure</code>ï¼Œå³å¯è¿›å…¥äº¤äº’ç•Œé¢ã€‚</p><p>5ã€IDEå¼€å‘ç¯å¢ƒè®¾ç½®<br>æˆ‘ä½¿ç”¨çš„æ˜¯intellij ideaï¼Œå®‰è£…æ’ä»¶<code>cursive</code>å³å¯ï¼Œä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯cursiveä¸ä¸€äº›æ’ä»¶æœ‰å†²çªï¼Œè€Œä¸”å¯¹IDEçš„ç‰ˆæœ¬ä¹Ÿæœ‰è¦æ±‚ã€‚(å¯ä»¥è¯´æ˜¯ä¸ºäº†æè¿™å¥—ç¯å¢ƒï¼Œæˆ‘æŠŠæˆ‘çš„è€å¤è‘£å¼€å‘ç¯å¢ƒå…¨éƒ½å‡çº§äº†ä¸€ä¸‹ã€‚)</p><blockquote><p><code>cursive</code>æ’ä»¶ä¸La Clojureã€ clojure-kitã€ Leiningenå†²çªï¼Œéœ€è¦IDEä¸º2018.x, 2019.x, 2020.1 and the 2020.2</p></blockquote><h2 id="æœ¬åœ°ç¼–è¯‘"><a href="#æœ¬åœ°ç¼–è¯‘" class="headerlink" title="æœ¬åœ°ç¼–è¯‘"></a>æœ¬åœ°ç¼–è¯‘</h2><p>1ã€å‡†å¤‡æºç <br>ä»githubä¸Šcloneæœ€æ–°çš„ä»£ç <code>git clone git@github.com:metabase/metabase.git</code><br>cloneä¸‹æ¥çš„ä»£ç é»˜è®¤ä¸Šmasteråˆ†æ”¯ï¼Œæˆ‘åˆ‡äº†ä¸‹åˆ†æ”¯ï¼Œåˆ‡åˆ°äº†æœ€æ–°çš„releaseç‰ˆæœ¬ï¼Œ<code>git checkout -b 1.41.2 v1.41.2</code></p><p>2ã€å¯¼å…¥IDE<br>é€‰æ‹©File -&gt; Open -&gt; åœ¨metabaseç›®å½•ä¸­é€‰æ‹©<code>deps.edn</code> -&gt; Open an Project<br>å‰©ä¸‹çš„å°±æ˜¯è‡ªåŠ¨åŠ è½½ä¾èµ–ã€‚</p><p>3ã€ç¼–è¯‘uberjar<br>åœ¨metabase_homeç›®å½•ä¸‹æ‰§è¡Œ<code>clojure -X:deps prep</code><br>æˆåŠŸä¹‹åæ‰§è¡Œ<code>cd modules/drivers &amp;&amp; clojure -X:deps prep</code></p><blockquote><p>ä»¥ä¸Šä¸¤ä¸ªå‘½ä»¤æ‰§è¡Œä¸€æ¬¡å°±è¡Œ</p></blockquote><p>å†æ¬¡åˆ°metabase_homeç›®å½•ä¸‹ï¼Œæ‰§è¡Œ<code>./bin/build</code>è¿›è¡Œç¼–è¯‘ï¼Œåœ¨<code>target/uberjar</code>ç›®å½•ä¸‹ä¼šå‡ºç°ä¸€ä¸ªjaråŒ…ï¼Œæœ€åæ‰§è¡Œ<code>java -jar metabase.jar</code>å³å¯å¯åŠ¨ã€‚</p><h2 id="æœ¬åœ°è°ƒè¯•"><a href="#æœ¬åœ°è°ƒè¯•" class="headerlink" title="æœ¬åœ°è°ƒè¯•"></a>æœ¬åœ°è°ƒè¯•</h2><p>åœ¨<code>deps.edn</code>ä¸­æ‰¾åˆ°ç¨‹åºçš„å…¥å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:run</span><br><span class="line">&#123;:main-opts [&quot;-m&quot; &quot;metabase.core&quot;]</span><br><span class="line"> :jvm-opts  [&quot;-Dmb.run.mode=dev&quot;</span><br><span class="line">             &quot;-Djava.awt.headless=true&quot;                   ; prevent Java icon from randomly popping up in macOS dock</span><br><span class="line">             &quot;-Dmb.jetty.port=3000&quot;]&#125;</span><br></pre></td></tr></table></figure><p><code>main-opts</code>å°±æ˜¯ç¨‹åºçš„å…¥å£ï¼Œæ˜¯<code>metabase</code>åŒ…çš„<code>core</code>ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">;;; ------------------------------------------------ <span class="type">App</span> <span class="type">Entry</span> <span class="type">Point</span> -------------------------------------------------</span><br><span class="line"></span><br><span class="line">(defn -main</span><br><span class="line">  <span class="string">&quot;Launch Metabase in standalone mode.&quot;</span></span><br><span class="line">  [&amp; [cmd &amp; args]]</span><br><span class="line">  (maybe-enable-tracing)</span><br><span class="line">  (<span class="keyword">if</span> cmd</span><br><span class="line">    (run-cmd cmd args) ; run a command like `java -jar metabase.jar migrate release-locks` or `clojure -<span class="type">M</span>:run migrate release-locks`</span><br><span class="line">    (start-normally))) ; <span class="keyword">with</span> no command line args just start <span class="type">Metabase</span> normally</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ°è¿™å°±å¯ä»¥è·Ÿè¯»è°ƒè¯•ä»£ç äº†ã€‚</p><h2 id="é‡åˆ°çš„é—®é¢˜"><a href="#é‡åˆ°çš„é—®é¢˜" class="headerlink" title="é‡åˆ°çš„é—®é¢˜"></a>é‡åˆ°çš„é—®é¢˜</h2><p>æ¥è§¦ä¸€ä¸ªæ–°äº‹ç‰©ï¼Œå…¶è¿‡ç¨‹æ²¡æœ‰ä¸€å¸†é£é¡ºçš„ï¼Œè¿™æ¬¡ä¹Ÿä¸ä¾‹å¤–ï¼Œè¿™é‡Œè®°å½•ä¸‹é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ¡ˆã€‚<br>1ã€<strong>æ–¹å‘æ€§é”™è¯¯</strong><br>åœ¨ç€æ‰‹æœ¬åœ°ç¼–è¯‘æ—¶åšäº†äº›è°ƒç ”å·¥ä½œï¼Œç½‘ä¸Šä¹Ÿæœ‰äº›ç›¸å…³æ•™ç¨‹ï¼Œä¸è¿‡è¿™äº›å¯¼å…¥IDEçš„æ•™ç¨‹éƒ½æ˜¯åŸºäº<code>Leiningen</code>çš„ï¼Œmetabaseä¹‹å‰æ˜¯åŸºäº<code>Leiningen</code>ï¼Œä½†æ˜¯åœ¨å‰æ®µæ—¶é—´ä»<code>Leiningen</code>åˆ‡åˆ°äº†<code>tools.deps</code>ï¼Œè¿™å°±å¯¼è‡´ç½‘ä¸Šæ‰€æœ‰çš„æ•™ç¨‹éƒ½è¿‡æ—¶äº†ã€‚å…·ä½“ä¿¡æ¯è§<a href="https://github.com/metabase/metabase/wiki/Migrating-from-Leiningen-to-tools.deps">å®˜æ–¹ä¿¡æ¯</a></p><p><code>Leiningen</code>å’Œ<code>tools.deps</code>çš„æ˜æ˜¾åŒºåˆ«æ˜¯ä»£ç ä¸­çš„<code>project.clj</code>æ–‡ä»¶å˜æˆäº†<code>deps.edn</code>æ–‡ä»¶(å½“åˆå‚»å‚»çš„ä»¥ä¸º<code>project.clj</code>ä¸­projectåªæ˜¯ä¸ªå˜é‡å‘¢ã€‚ã€‚ã€‚)</p><p>åæ¥æ„è¯†åˆ°<code>project.clj</code>å°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒæŸ¥çœ‹æºç çš„æäº¤è®°å½•å‘ç°äº†å…¶ä»<code>Leiningen</code>åˆ‡åˆ°äº†<code>tools.deps</code>ï¼Œæ‰€ä»¥IDEçš„æ’ä»¶éœ€è¦å˜ä¸º<code>cursive</code></p><p>2ã€ä½¿ç”¨Clojureæ—¶mavenæºæŠ¥UnknownHostException<br>å®‰è£…å®ŒClojureä¹‹åï¼ŒéªŒè¯æ˜¯å¦å¯ç”¨æ—¶ï¼Œåœ¨ç»ˆç«¯è¾“å…¥<code>clj</code>ï¼ŒæŠ¥<code>UnknownHostException: repo.maven.apache.org</code><br>ç¬¬ä¸€æ„Ÿè§‰å»ä¿®æ”¹æœ¬æœºçš„mavené…ç½®ï¼Œä¿®æ”¹ä¹‹åä¾ç„¶æŠ¥åŒæ ·çš„é”™ã€‚<br>å»Clojureçš„å®‰è£…ç›®å½•ä¸­å…³é”®å­—æ£€ç´¢<code>repo.maven.apache.org</code>ï¼Œå‘ç°åœ¨<code>deps.edn</code>ä¸­é…ç½®çš„ï¼Œæ”¹æˆå›½å†…çš„æºå³å¯ï¼Œå…·ä½“ä¿®æ”¹æ–¹å¼è§ä¸Šé¢çš„å®‰è£…æ­¥éª¤ã€‚</p><p>3ã€æœ¬åœ°ç¼–è¯‘æŠ¥<code>SSL_ERROR_SYSCALL in connection to github.com:443</code><br>æ˜¯å› ä¸ºgithubé€šè¿‡httpé“¾æ¥æ—¶éœ€è¦å®‰å…¨è®¤è¯ï¼Œæ‰€ä»¥æ‰§è¡Œ<code>git config --global http.sslVerify false</code>å…³é—­ï¼Œ(æœ‰æ—¶é—´å¥½ç”¨æœ‰æ—¶é—´ä¸å¥½ç”¨ï¼Œå¤šæ¬¡å‡ æ¬¡ï¼Œéšç¼˜å§)ã€‚</p><p>4ã€è¿è¡ŒjaråŒ…æŠ¥é”™ï¼Œé”™è¯¯å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2021-11-30 00:24:59,891 WARN servicelocator.DefaultPackageScanClassResolver :: Cannot search jar file &#x27;/Users/metabase/target/uberjar/metabase.jar&#x27; for classes due to an IOException: invalid code lengths set</span><br><span class="line">java.util.zip.ZipException: invalid code lengths set</span><br></pre></td></tr></table></figure><p>ç½‘ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆè§£å†³æ–¹æ¡ˆï¼Œæƒ³åˆ°æˆ‘çš„ä»£ç æ‹‰çš„æ˜¯masteråˆ†æ”¯ï¼Œæ˜¯ä¸æ˜¯ä»£ç çš„é—®é¢˜ï¼Œäºæ˜¯åˆ‡åˆ°äº†æœ€æ–°çš„releaseç‰ˆæœ¬ï¼Œæ‰“åŒ…ä¹‹åä¾ç„¶æŠ¥é”™ã€‚<br>ä¸‹è½½äº†å®˜æ–¹releaseç‰ˆæœ¬çš„jaråŒ…ï¼Œåœ¨æœ¬åœ°æ­£å¸¸è¿è¡Œï¼Œæ’é™¤ä»£ç é—®é¢˜ï¼Œé‚£é—®é¢˜å°±å‡ºåœ¨ç¼–è¯‘ç¯å¢ƒä¸Šï¼Œæ­¤æ—¶æƒ³åˆ°<strong>æ–‡æ¡£ä¸Šè¦æ±‚jdkç‰ˆæœ¬ä¸º11</strong>ï¼Œå‡çº§jdkä¸º11ä¹‹åï¼Œå†æ¬¡æ‰“åŒ…è¿è¡ŒæˆåŠŸã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ€è¿‘åœ¨è°ƒç ”BIæŠ¥è¡¨ç›¸å…³çš„å·¥å…·ï¼Œæœ€åå†³å®šæ·±å…¥è°ƒç ”ä¸‹metabaseï¼Œäºæ˜¯å°±æœ‰äº†è¿™ç¯‡æ–‡ç« ã€‚&lt;/p&gt;
&lt;p&gt;ä¹‹æ‰€ä»¥é€‰æ‹©metabaseæ˜¯å› ä¸ºä¸€ä¸‹å‡ ç‚¹ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä½é—¨æ§›ï¼Œå¯¹æ— sqlåŸºç¡€çš„äººå‘˜å‹å¥½&lt;/li&gt;
&lt;li&gt;åˆ†æåŠŸèƒ½è¾ƒå…¨ï¼Œæ”¯æŒjoin&lt;/li&gt;
&lt;li&gt;å›¾è¡¨åŠŸèƒ½OK&lt;/li&gt;
&lt;li&gt;éƒ¨ç½²æ–¹ä¾¿&lt;br&gt;å¯¹äºæˆ‘æ¥è¯´ï¼Œå”¯ä¸€ä¸è¶³çš„æ˜¯å®ƒæ˜¯ç”±clojureå¼€å‘çš„ï¼ŒäºŒå¼€æˆæœ¬æœ‰ç‚¹é«˜ï¼Œè¿™æ‰æ˜¯è¿™ç¯‡æ–‡ç« çš„è¯ç”Ÿçš„çœŸæ­£åŸå› ï¼Œå› ä¸ºå¯¼å…¥IDEç¼–è¯‘æˆåŠŸå°±ç”¨äº†å¥½å‡ å¤©ã€‚        &lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yuanba.tech/categories/BigData/"/>
    
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="metabase" scheme="http://yuanba.tech/tags/metabase/"/>
    
    <category term="BI" scheme="http://yuanba.tech/tags/BI/"/>
    
  </entry>
  
  <entry>
    <title>Flink Connectorè°ƒç ”</title>
    <link href="http://yuanba.tech/flink-connector-example.html"/>
    <id>http://yuanba.tech/flink-connector-example.html</id>
    <published>2021-11-10T14:30:20.000Z</published>
    <updated>2021-11-10T14:51:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸Šä¸€ç¯‡<a href="https://bigdatadecode.top/Flink-standlone-Flinkx.html">Flink standloneæ¨¡å¼ä¸‹Flinkxæµ‹è¯•</a>ä»‹ç»äº†ä½¿ç”¨FlinkxåŒæ­¥mysqlï¼Œä½†æ˜¯Flinkxåœ¨åŒæ­¥binlogæ—¥å¿—æ—¶ï¼Œä¸ªäººæ„Ÿè§‰æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å°±å¯¹æ¯”ä¸‹Flink Connectorã€‚</p><span id="more"></span><h2 id="Flink-standloneéƒ¨ç½²"><a href="#Flink-standloneéƒ¨ç½²" class="headerlink" title="Flink standloneéƒ¨ç½²"></a>Flink standloneéƒ¨ç½²</h2><p>éƒ¨ç½²æ¯”è¾ƒç®€å•ï¼Œå…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡<a href="https://bigdatadecode.top/Flink-standlone-Flinkx.html">Flink standloneæ¨¡å¼ä¸‹Flinkxæµ‹è¯•</a></p><h2 id="å¯åŠ¨sql-client"><a href="#å¯åŠ¨sql-client" class="headerlink" title="å¯åŠ¨sql client"></a>å¯åŠ¨sql client</h2><p>ä¸»è¦æ˜¯ä¸ºäº†æµ‹è¯•ä¸‹sqlåŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•é‡‡ç”¨äº†sql clientæ¨¡å¼ã€‚<br>åœ¨${Flink_HOME}ç›®å½•æ‰§è¡Œ<code>./bin/sql-client.sh embedded</code>å¯åŠ¨sql client</p><h2 id="mysqlå¼€å¯binlog"><a href="#mysqlå¼€å¯binlog" class="headerlink" title="mysqlå¼€å¯binlog"></a>mysqlå¼€å¯binlog</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">server_id=1  # ä¸åŒèŠ‚ç‚¹çš„server_idå¿…é¡»ä¸åŒ</span><br><span class="line">log_bin=/opt/data/mysql-data/mysql-bin  # binlogæ—¥å¿—ç›®å½•</span><br><span class="line">binlog_format=ROW   </span><br><span class="line">expire_logs_days=30</span><br></pre></td></tr></table></figure><p>é‡å¯mysqlæœåŠ¡ï¼Œæ‰§è¡Œ<code>show variables like &#39;%bin%&#39;;</code>æ£€æŸ¥æ˜¯å¦å·²ç»å¼€å¯æˆåŠŸã€‚</p><h2 id="Flink-sqlå®æ—¶åŒæ­¥mysql"><a href="#Flink-sqlå®æ—¶åŒæ­¥mysql" class="headerlink" title="Flink sqlå®æ—¶åŒæ­¥mysql"></a>Flink sqlå®æ—¶åŒæ­¥mysql</h2><p>åˆ›å»ºsourceè¡¨ï¼Œmysqlæ•°æ®æºè¡¨</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> source</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span>,</span><br><span class="line">    name        <span class="type">varchar</span>,</span><br><span class="line">    money       <span class="type">decimal</span>,</span><br><span class="line">    dateone     <span class="type">timestamp</span>,</span><br><span class="line">    age         <span class="type">bigint</span>,</span><br><span class="line">    datethree   <span class="type">timestamp</span>,</span><br><span class="line">    datesix     <span class="type">timestamp</span>,</span><br><span class="line">    phone       <span class="type">bigint</span>,</span><br><span class="line">    wechat      STRING,</span><br><span class="line">    income      <span class="type">decimal</span>,</span><br><span class="line">    birthday    <span class="type">timestamp</span>,</span><br><span class="line">    dtdate      <span class="type">date</span>,</span><br><span class="line">    dttime      <span class="type">time</span>,</span><br><span class="line">    today       <span class="type">date</span>,</span><br><span class="line">    timecurrent <span class="type">time</span>,</span><br><span class="line">    aboolean    <span class="type">boolean</span>,</span><br><span class="line">    adouble     <span class="keyword">double</span>,</span><br><span class="line">    afloat      <span class="type">float</span>,</span><br><span class="line">    achar       <span class="type">char</span>,</span><br><span class="line">    abinary     BYTES,</span><br><span class="line">    atinyint    tinyint</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">      <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;mysql-cdc&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;hostname&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;192.168.2.1&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;port&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root@321&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;database-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;test&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;flink_type&#x27;</span></span><br><span class="line">      );</span><br></pre></td></tr></table></figure><p>åˆ›å»ºsinkè¡¨ï¼Œè¿™é‡Œä¸ºäº†é¡ºä¾¿æµ‹è¯•ä¸‹connectorè¿mysqlï¼Œæ‰€ä»¥sinkåˆ°mysqlä¸­ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> mysql_sink</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span>,</span><br><span class="line">    name        <span class="type">varchar</span>,</span><br><span class="line">    money       <span class="type">decimal</span>,</span><br><span class="line">    dateone     <span class="type">timestamp</span>,</span><br><span class="line">    age         <span class="type">bigint</span>,</span><br><span class="line">    datethree   <span class="type">timestamp</span>,</span><br><span class="line">    datesix     <span class="type">timestamp</span>,</span><br><span class="line">    phone       <span class="type">bigint</span>,</span><br><span class="line">    wechat      STRING,</span><br><span class="line">    income      <span class="type">decimal</span>,</span><br><span class="line">    birthday    <span class="type">timestamp</span>,</span><br><span class="line">    dtdate      <span class="type">date</span>,</span><br><span class="line">    dttime      <span class="type">time</span>,</span><br><span class="line">    today       <span class="type">date</span>,</span><br><span class="line">    timecurrent <span class="type">time</span>,</span><br><span class="line">    aboolean    <span class="type">boolean</span>,</span><br><span class="line">    adouble     <span class="keyword">double</span>,</span><br><span class="line">    afloat      <span class="type">float</span>,</span><br><span class="line">    achar       <span class="type">char</span>,</span><br><span class="line">    abinary     BYTES,</span><br><span class="line">    atinyint    tinyint,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (id) <span class="keyword">NOT</span> ENFORCED <span class="comment">-- å¢é‡æ—¶ï¼Œå¿…é¡»æŒ‡å®šä¸»é”®</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">      <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;driver&#x27;</span><span class="operator">=</span><span class="string">&#x27;com.mysql.jdbc.Driver&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://192.168.2.1:3306/test?useUnicode=true&amp;characterEncoding=utf8&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;flink_type_cp&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root@321&#x27;</span></span><br><span class="line">      );</span><br></pre></td></tr></table></figure><p>é€šè¿‡sql insertåˆ°sinkè¡¨ä¸­ï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> mysql_sink</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> source u;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œè¿™ä¸ªè¯­å¥ä¹‹åï¼Œä»»åŠ¡ä¼šæäº¤åˆ°flinké›†ç¾¤ï¼Œåœ¨æºè¡¨ä¸­ä¿®æ”¹è¡¨å†…å®¹ä¹‹åï¼Œä¼šå®æ—¶åŒæ­¥åˆ°ç›®æ ‡è¡¨ä¸­ã€‚</p><p>å…·ä½“ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒä»¥ä¸‹å†…å®¹<br><a href="https://ververica.github.io/flink-cdc-connectors/master/content/%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/mysql-postgres-tutorial-zh.html">Flink CDC</a><br><a href="https://ci.apache.org/projects/flink/flink-docs-master/zh/docs/connectors/table/jdbc/">Flink jdbc</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸Šä¸€ç¯‡&lt;a href=&quot;https://bigdatadecode.top/Flink-standlone-Flinkx.html&quot;&gt;Flink standloneæ¨¡å¼ä¸‹Flinkxæµ‹è¯•&lt;/a&gt;ä»‹ç»äº†ä½¿ç”¨FlinkxåŒæ­¥mysqlï¼Œä½†æ˜¯Flinkxåœ¨åŒæ­¥binlogæ—¥å¿—æ—¶ï¼Œä¸ªäººæ„Ÿè§‰æœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œæ‰€ä»¥å°±å¯¹æ¯”ä¸‹Flink Connectorã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Flink" scheme="http://yuanba.tech/categories/Flink/"/>
    
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="Flink" scheme="http://yuanba.tech/tags/Flink/"/>
    
    <category term="Connector" scheme="http://yuanba.tech/tags/Connector/"/>
    
    <category term="CDC" scheme="http://yuanba.tech/tags/CDC/"/>
    
  </entry>
  
  <entry>
    <title>Flink standloneæ¨¡å¼ä¸‹Flinkxæµ‹è¯•</title>
    <link href="http://yuanba.tech/Flink-standlone-Flinkx.html"/>
    <id>http://yuanba.tech/Flink-standlone-Flinkx.html</id>
    <published>2021-11-06T15:05:20.000Z</published>
    <updated>2021-11-06T15:55:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>FlinkXæ˜¯ä¸€ä¸ªåŸºäºFlinkçš„æ‰¹æµç»Ÿä¸€çš„æ•°æ®åŒæ­¥å·¥å…·ï¼Œæ—¢å¯ä»¥é‡‡é›†é™æ€çš„æ•°æ®ï¼Œæ¯”å¦‚MySQLï¼ŒHDFSç­‰ï¼Œä¹Ÿå¯ä»¥é‡‡é›†å®æ—¶å˜åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚MySQL binlogï¼ŒKafkaç­‰ã€‚ åŒæ—¶ï¼ŒFlinkXä¹Ÿæ˜¯æ”¯æŒåŸç”ŸFlinkSqlæ‰€æœ‰è¯­æ³•å’Œç‰¹æ€§çš„è®¡ç®—æ¡†æ¶ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ<a href="https://github.com/DTStack/flinkx">githubä¸Šçš„é¡¹ç›®ä»‹ç»</a></p><p>æœ¬ç¯‡è®°å½•ä¸‹åœ¨Flink standloneæ¨¡å¼ä¸‹ä½¿ç”¨FlinxåŒæ­¥mysqlæ•°æ®ã€‚</p><span id="more"></span><h2 id="Flinkéƒ¨ç½²standloneæ¨¡å¼"><a href="#Flinkéƒ¨ç½²standloneæ¨¡å¼" class="headerlink" title="Flinkéƒ¨ç½²standloneæ¨¡å¼"></a>Flinkéƒ¨ç½²standloneæ¨¡å¼</h2><p>ä¸‹è½½flink-1.12.2ç‰ˆæœ¬ï¼ˆå› ä¸ºflinkxä½¿ç”¨çš„æ˜¯1.12ç‰ˆæœ¬ï¼‰ï¼Œç®€å•é…ç½®ä¸‹å³å¯ã€‚ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim masters</span><br><span class="line">127.0.0.1</span><br><span class="line"></span><br><span class="line">vim workers</span><br><span class="line">127.0.0.1</span><br><span class="line"></span><br><span class="line">vim flink-conf.yaml</span><br><span class="line">jobmanager.rpc.address: 127.0.0.1</span><br><span class="line">jobmanager.rpc.port: 6124 # 6123ç«¯å£å¯èƒ½ä¼šå†²çªï¼Œæ”¹æˆ6124</span><br><span class="line">jobmanager.memory.process.size: 5120m</span><br><span class="line">taskmanager.memory.process.size: 10240m</span><br><span class="line">taskmanager.numberOfTaskSlots: 2  </span><br><span class="line">parallelism.default: 1 </span><br><span class="line"></span><br><span class="line">bin/jobmanager.sh start</span><br><span class="line">bin/taskmanager.sh start # ä¹Ÿå¯ç›´æ¥æ‰§è¡Œbin/start-cluster.sh</span><br></pre></td></tr></table></figure><p>Flink standloneæ¨¡å¼éƒ¨ç½²æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œä¸‹é¢éƒ¨ç½²Flinkx</p><h2 id="ç¼–è¯‘Flinkx"><a href="#ç¼–è¯‘Flinkx" class="headerlink" title="ç¼–è¯‘Flinkx"></a>ç¼–è¯‘Flinkx</h2><p>ä»githubä¸Šä¸‹è½½äº†æœ€æ–°releaseç‰ˆæœ¬ï¼Œå‘ç°ç›®å½•ç»“æ„å’Œæ–‡æ¡£ä¸­çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å°±ä¸‹è½½äº†æºç è¿›è¡Œç¼–è¯‘ã€‚</p><p>ç”±äºflinkxæ”¯æŒçš„connectorè¾ƒå¤šï¼Œç¼–è¯‘æ—¶é—´è¾ƒé•¿ï¼Œè€Œä¸”æœ‰äº›jaråŒ…ä»“åº“ä¸­ä¹Ÿæ²¡æœ‰ï¼Œéœ€è¦ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ‰€ä»¥æˆ‘æ³¨é‡Šäº†äº›connectorï¼Œå¯ä»¥åœ¨<code>flinkx/flinkx-connectors/pom.xml</code>æ–‡ä»¶ä¸­æ³¨é‡Šã€‚</p><p>ç¼–è¯‘å‘½ä»¤ä¸º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package -DskipTests </span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¹‹åçš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--   1 test test    11K 10 21 11:26 LICENSE</span><br><span class="line">-rw-r--r--   1 test test   7.1K 10 21 11:26 README.md</span><br><span class="line">-rw-r--r--   1 test test   9.1K 10 21 11:26 README_CH.md</span><br><span class="line">drwxr-xr-x   5 test test   160B 11  3 13:02 bin</span><br><span class="line">drwxr-xr-x   3 test test    96B 10 21 14:36 build</span><br><span class="line">drwxr-xr-x   4 test test   128B 10 21 11:26 ci</span><br><span class="line">drwxr-xr-x  17 test test   544B 10 21 11:26 docs</span><br><span class="line">drwxr-xr-x   7 test test   224B 11  3 09:41 flinkx-clients</span><br><span class="line">drwxr-xr-x  41 test test   1.3K 10 22 16:25 flinkx-connectors</span><br><span class="line">drwxr-xr-x   7 test test   224B 11  3 09:39 flinkx-core</span><br><span class="line">drwxr-xr-x   6 test test   192B 10 22 16:10 flinkx-dirtydata-collectors</span><br><span class="line">drwxr-xr-x   6 test test   192B 11  3 09:40 flinkx-dist                    ## ç¼–è¯‘ä¹‹åçš„ç›®å½•</span><br><span class="line">drwxr-xr-x   6 test test   192B 11  3 09:41 flinkx-docker</span><br><span class="line">drwxr-xr-x   4 test test   128B 10 21 11:26 flinkx-examples</span><br><span class="line">drwxr-xr-x   4 test test   128B 10 22 16:10 flinkx-formats</span><br><span class="line">drwxr-xr-x   4 test test   128B 10 21 11:26 flinkx-local-test</span><br><span class="line">drwxr-xr-x   7 test test   224B 10 22 16:10 flinkx-metrics</span><br><span class="line">-rw-r--r--   1 test test   1.9K 10 22 16:10 flinkx-parent.iml</span><br><span class="line">drwxr-xr-x  12 test test   384B 10 21 11:26 jars</span><br><span class="line">drwxr-xr-x   3 test test    96B 10 22 16:31 lib</span><br><span class="line">-rw-r--r--   1 test test   627B 10 21 11:26 license.txt</span><br><span class="line">-rw-------   1 test test    98K 10 22 18:07 nohup.out</span><br><span class="line">-rw-r--r--   1 test test   6.7K 10 21 11:26 pom.xml</span><br></pre></td></tr></table></figure><h2 id="Flinkx-jsonæ¨¡å¼æ‰¹é‡åŒæ­¥mysqlè¡¨"><a href="#Flinkx-jsonæ¨¡å¼æ‰¹é‡åŒæ­¥mysqlè¡¨" class="headerlink" title="Flinkx jsonæ¨¡å¼æ‰¹é‡åŒæ­¥mysqlè¡¨"></a>Flinkx jsonæ¨¡å¼æ‰¹é‡åŒæ­¥mysqlè¡¨</h2><p>FlinkxåŒæ­¥mysqlè¡¨æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯jobï¼Œå¦ä¸€ç§æ˜¯sqlã€‚jobå½¢å¼éœ€è¦é…ç½®ä¸€ä¸ªjsonæ–‡ä»¶ï¼Œä¸»è¦æ˜¯éœ€è¦åŒæ­¥çš„åº“è¡¨ä¿¡æ¯ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;job&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;content&quot;</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;reader&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;mysqlreader&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;parameter&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;column&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;varchar&quot;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;varchar&quot;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;varchar&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;root@321&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;connection&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;jdbcUrl&quot;</span>: [</span><br><span class="line">                  <span class="string">&quot;jdbc:mysql://192.168.0.1:3306/test?useSSL=false&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">&quot;table&quot;</span>: [</span><br><span class="line">                  <span class="string">&quot;t&quot;</span></span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;writer&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;mysqlwriter&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;parameter&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;root@321&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;connection&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;jdbcUrl&quot;</span>: <span class="string">&quot;jdbc:mysql://192.168.0.1:3306/test1?useSSL=false&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;table&quot;</span>: [</span><br><span class="line">                  <span class="string">&quot;t_1&quot;</span></span><br><span class="line">                ]</span><br><span class="line">              &#125;</span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">&quot;writeMode&quot;</span>: <span class="string">&quot;insert&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;column&quot;</span>: [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;id&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;varchar&quot;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;name&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;varchar&quot;</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;category&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;varchar&quot;</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;setting&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;speed&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;channel&quot;</span>: <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;bytes&quot;</span>: <span class="number">0</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åœ¨Flinxçš„homeç›®å½•ä¸­æ‰§è¡Œjobå¯åŠ¨å‘½ä»¤ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/flinkx -mode standalone -jobType sync -job /$&#123;FLINKX_HOME&#125;/flinkx-examples/json/mysql/mysql_mysql_batch.json -flinkxDistDir flinkx-dist -flinkConfDir $FLINK_HOME/conf -confProp &quot;&#123;\&quot;flink.checkpoint.interval\&quot;:60000&#125;&quot;</span><br></pre></td></tr></table></figure><p>ä»»åŠ¡å¾ˆé¡ºåˆ©çš„æ‰§è¡Œç»“æŸï¼Œä¸‹é¢çœ‹ä½¿ç”¨sqlå¦‚ä½•åŒæ­¥mysqlè¡¨ã€‚</p><h2 id="Flinkx-sqlæ¨¡å¼åŒæ­¥mysqlè¡¨"><a href="#Flinkx-sqlæ¨¡å¼åŒæ­¥mysqlè¡¨" class="headerlink" title="Flinkx sqlæ¨¡å¼åŒæ­¥mysqlè¡¨"></a>Flinkx sqlæ¨¡å¼åŒæ­¥mysqlè¡¨</h2><p>åœ¨<code>flinkx-examples</code>ä¸‹é¢æœ‰å¾ˆå¤šä¾‹å­ï¼Œè¿™é‡Œæ‰§è¡Œä¸‹sqlå®æ—¶å¢é‡åŒæ­¥mysqlï¼Œsqlä¸ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> source</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span>,</span><br><span class="line">    name        <span class="type">varchar</span>,</span><br><span class="line">    money       <span class="type">decimal</span>,</span><br><span class="line">    dateone     <span class="type">timestamp</span>,</span><br><span class="line">    age         <span class="type">bigint</span>,</span><br><span class="line">    datethree   <span class="type">timestamp</span>,</span><br><span class="line">    datesix     <span class="type">timestamp</span>,</span><br><span class="line">    phone       <span class="type">bigint</span>,</span><br><span class="line">    wechat      STRING,</span><br><span class="line">    income      <span class="type">decimal</span>,</span><br><span class="line">    birthday    <span class="type">timestamp</span>,</span><br><span class="line">    dtdate      <span class="type">date</span>,</span><br><span class="line">    dttime      <span class="type">time</span>,</span><br><span class="line">    today       <span class="type">date</span>,</span><br><span class="line">    timecurrent <span class="type">time</span>,</span><br><span class="line">    aboolean    <span class="type">boolean</span>,</span><br><span class="line">    adouble     <span class="keyword">double</span>,</span><br><span class="line">    afloat      <span class="type">float</span>,</span><br><span class="line">    achar       <span class="type">char</span>,</span><br><span class="line">    abinary     BYTES,</span><br><span class="line">    atinyint    tinyint</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">      <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;mysql-x&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://192.168.0.1:3306/test&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;flink_type&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;Shujupingtai@321&#x27;</span></span><br><span class="line"></span><br><span class="line">      ,<span class="string">&#x27;scan.polling-interval&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;3000&#x27;</span> <span class="comment">--é—´éš”è½®è®­æ—¶é—´ã€‚éå¿…å¡«(ä¸å¡«ä¸ºç¦»çº¿ä»»åŠ¡)ï¼Œæ— é»˜è®¤</span></span><br><span class="line"></span><br><span class="line">      ,<span class="string">&#x27;scan.parallelism&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="comment">-- å¹¶è¡Œåº¦</span></span><br><span class="line">      ,<span class="string">&#x27;scan.fetch-size&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;2&#x27;</span> <span class="comment">-- æ¯æ¬¡ä»æ•°æ®åº“ä¸­fetchå¤§å°ã€‚é»˜è®¤ï¼š1024æ¡</span></span><br><span class="line">      ,<span class="string">&#x27;scan.query-timeout&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;10&#x27;</span> <span class="comment">-- æ•°æ®åº“è¿æ¥è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤ï¼šä¸è¶…æ—¶</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">-- ,&#x27;scan.partition.column&#x27; = &#x27;id&#x27; -- å¤šå¹¶è¡Œåº¦è¯»å–çš„åˆ‡åˆ†å­—æ®µï¼Œå¿…é¡»æ˜¯è¡¨ä¸­å­—æ®µã€‚æ— é»˜è®¤</span></span><br><span class="line">      <span class="comment">-- ,&#x27;scan.partition.strategy&#x27; = &#x27;range&#x27; -- æ•°æ®åˆ†ç‰‡ç­–ç•¥ã€‚é»˜è®¤ï¼šrangeï¼Œå¦‚æœå¹¶è¡Œåº¦å¤§äº1ï¼Œä¸”æ˜¯å¢é‡ä»»åŠ¡æˆ–è€…é—´éš”è½®è¯¢ï¼Œåˆ™ä¼šä½¿ç”¨modåˆ†ç‰‡</span></span><br><span class="line"></span><br><span class="line">      ,<span class="string">&#x27;scan.increment.column&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;id&#x27;</span> <span class="comment">-- å¢é‡å­—æ®µåç§°ï¼Œå¿…é¡»æ˜¯è¡¨ä¸­çš„å­—æ®µã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤</span></span><br><span class="line">      ,<span class="string">&#x27;scan.increment.column-type&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;int&#x27;</span>  <span class="comment">-- å¢é‡å­—æ®µç±»å‹ã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤</span></span><br><span class="line">      ,<span class="string">&#x27;scan.start-location&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;10&#x27;</span> <span class="comment">-- å¢é‡å­—æ®µå¼€å§‹ä½ç½®,å¦‚æœä¸æŒ‡å®šåˆ™å…ˆåŒæ­¥æ‰€æœ‰ï¼Œç„¶ååœ¨å¢é‡ã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤ã€‚å¦‚æœæ²¡é…ç½®scan.increment.columnï¼Œåˆ™ä¸ç”Ÿæ•ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--       ,&#x27;scan.restore.columnname&#x27; = &#x27;id&#x27; -- å¼€å¯äº†cpï¼Œä»»åŠ¡ä»sp/cpç»­è·‘å­—æ®µåç§°ã€‚å¦‚æœç»­è·‘ï¼Œåˆ™ä¼šè¦†ç›–scan.start-locationå¼€å§‹ä½ç½®ï¼Œä»ç»­è·‘ç‚¹å¼€å§‹ã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤</span></span><br><span class="line"><span class="comment">--       ,&#x27;scan.restore.columntype&#x27; = &#x27;int&#x27; -- å¼€å¯äº†cpï¼Œä»»åŠ¡ä»sp/cpç»­è·‘å­—æ®µç±»å‹ã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sink</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span>,</span><br><span class="line">    name        <span class="type">varchar</span>,</span><br><span class="line">    money       <span class="type">decimal</span>,</span><br><span class="line">    dateone     <span class="type">timestamp</span>,</span><br><span class="line">    age         <span class="type">bigint</span>,</span><br><span class="line">    datethree   <span class="type">timestamp</span>,</span><br><span class="line">    datesix     <span class="type">timestamp</span>,</span><br><span class="line">    phone       <span class="type">bigint</span>,</span><br><span class="line">    wechat      STRING,</span><br><span class="line">    income      <span class="type">decimal</span>,</span><br><span class="line">    birthday    <span class="type">timestamp</span>,</span><br><span class="line">    dtdate      <span class="type">date</span>,</span><br><span class="line">    dttime      <span class="type">time</span>,</span><br><span class="line">    today       <span class="type">date</span>,</span><br><span class="line">    timecurrent <span class="type">time</span>,</span><br><span class="line">    aboolean    <span class="type">boolean</span>,</span><br><span class="line">    adouble     <span class="keyword">double</span>,</span><br><span class="line">    afloat      <span class="type">float</span>,</span><br><span class="line">    achar       <span class="type">char</span>,</span><br><span class="line">    abinary     BYTES,</span><br><span class="line">    atinyint    tinyint</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">      <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;stream-x&#x27;</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sink</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> source;</span><br></pre></td></tr></table></figure><p>åœ¨Flinxçš„homeç›®å½•ä¸­æ‰§è¡Œsqlæ‰§è¡Œå‘½ä»¤ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/finkx -mode standalone -jobType sql -job /$&#123;FLINKX_HOME&#125;/flinkx-examples/sql/mysql/mysql_source_realtime.sql -flinkxDistDir flinkx-dist -flinkConfDir /Users/hunhun/dev/flink/conf -confProp &quot;&#123;\&quot;flink.checkpoint.interval\&quot;:60000&#125;&quot;</span><br></pre></td></tr></table></figure><p>æäº¤ä¹‹åï¼Œæç¤ºjobå¤±è´¥ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºæ‰¾ä¸åˆ°ç±»ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassNotFoundExceptionï¼šcom.dtstack.flinkx.metrics.prometheus.PrometheusReport</span><br></pre></td></tr></table></figure><p>å°†<code>flinkx-dist/metrics/prometheus</code>ç›®å½•ä¸‹çš„<code>flinkx-metrics-prometheus-master.jar</code>æ”¾åˆ°flinkçš„libç›®å½•ä¸‹ï¼Œé‡å¯flinké›†ç¾¤ï¼Œå†æ¬¡æäº¤åˆæç¤º<code>com.dtstack.flinkx.conf.MetricParam</code>ç±»æ‰¾ä¸åˆ°ï¼Œå°†<code>flinkx-core-master.jar</code>åŒ…æ”¾åˆ°flinkçš„libä¸‹ï¼Œé‡å¯ä¹‹åä¾ç„¶æŠ¥æ‰¾ä¸åˆ°ç±»ï¼Œåº”è¯¥æ˜¯ç±»åŠ è½½å†²çªäº†ã€‚</p><p>å†çœ‹æŠ¥é”™ä¿¡æ¯æ˜¯å°†<code>metrics</code>ä¸ŠæŠ¥åˆ°<code>prometheus</code>æ—¶ï¼Œæ‰¾ä¸åˆ°ç›¸å…³çš„ç±»ï¼Œé‚£ç¦æ­¢ä¸ŠæŠ¥å°±å¯ä»¥äº†ï¼Œè€Œä¸”æˆ‘ä¹Ÿæ²¡æœ‰é…ç½®ç›¸å…³çš„ä¿¡æ¯ï¼Œéš¾é“æ˜¯é»˜è®¤é…ç½®çš„ï¼Ÿè€Œä¸”jsonæ¨¡å¼ä¸‹å¹¶æ²¡æœ‰è§¦å‘è¿™ä¸ªé”™è¯¯ã€‚</p><p>äºæ˜¯å¯¹æ¯”ä¸‹sqlå’Œjsonè¿™ä¸¤ä¸ªä»»åŠ¡çš„åŒºåˆ«(<em>ä¸ºä»€ä¹ˆå¯¹æ¯”å‘¢ï¼Ÿæ˜¯å› ä¸ºæˆ‘æ²¡æœ‰æ‰¾åˆ°ç¦æ­¢metricsä¸ŠæŠ¥åˆ°prometheusçš„é…ç½®ã€‚ã€‚ã€‚</em>)ï¼Œå‘ç°sqlæ˜¯å¢é‡æ‹‰å–è¡¨ï¼Œäºæ˜¯å°†sqlä¸­çš„å¢é‡æ‹‰å–é…ç½®æ³¨é‡Šæ‰ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--       ,&#x27;scan.polling-interval&#x27; = &#x27;3000&#x27; --é—´éš”è½®è®­æ—¶é—´ã€‚éå¿…å¡«(ä¸å¡«ä¸ºç¦»çº¿ä»»åŠ¡)ï¼Œæ— é»˜è®¤</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--       ,&#x27;scan.increment.column&#x27; = &#x27;id&#x27; -- å¢é‡å­—æ®µåç§°ï¼Œå¿…é¡»æ˜¯è¡¨ä¸­çš„å­—æ®µã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤</span></span><br><span class="line"><span class="comment">--       ,&#x27;scan.increment.column-type&#x27; = &#x27;int&#x27;  -- å¢é‡å­—æ®µç±»å‹ã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤</span></span><br><span class="line"><span class="comment">--       ,&#x27;scan.start-location&#x27; = &#x27;10&#x27; -- å¢é‡å­—æ®µå¼€å§‹ä½ç½®,å¦‚æœä¸æŒ‡å®šåˆ™å…ˆåŒæ­¥æ‰€æœ‰ï¼Œç„¶ååœ¨å¢é‡ã€‚éå¿…å¡«ï¼Œæ— é»˜è®¤ã€‚å¦‚æœæ²¡é…ç½®scan.increment.columnï¼Œåˆ™ä¸ç”Ÿæ•ˆ</span></span><br></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰å†æ¬¡æäº¤ï¼Œä»»åŠ¡è¿è¡ŒæˆåŠŸäº†ã€‚</p><p>ç”±æ­¤æ¨æ–­å¹¶ä¸æ˜¯sqlé»˜è®¤ä¼šä¸ŠæŠ¥prometheusï¼Œè€Œæ˜¯å¢é‡æ‹‰å–æ—¶è§¦å‘äº†ä¸ŠæŠ¥çš„é€»è¾‘ï¼Œé‚£æ¥ä¸‹æ¥è·Ÿä¸‹ä»£ç ï¼Œçœ‹ä¸‹å…·ä½“é€»è¾‘æ˜¯ä»€ä¹ˆï¼Œæ˜¯å¦å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„é…ç½®é¡¹è¿›è¡Œè°ƒæ•´ã€‚</p><p>ä»é”™è¯¯æ—¥å¿—ä¸­å®šä½<code>BaseRichInputFormat</code>ç±»çš„<code>175</code>è¡Œé™„è¿‘ï¼Œçœ‹åˆ°å½“<code>useCustomReporter</code>ä¸ºtrueæ—¶ï¼Œä¼šè‡ªå®šä¹‰metricsä¸ŠæŠ¥é€»è¾‘ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (useCustomReporter()) &#123;</span><br><span class="line">    customReporter =</span><br><span class="line">            DataSyncFactoryUtil.discoverMetric(</span><br><span class="line">                    config, getRuntimeContext(), makeTaskFailedWhenReportFailed());</span><br><span class="line">    customReporter.open();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯åœ¨<code>BaseRichInputFormat</code>ç±»ä¸­ï¼Œ<code>useCustomReporter</code>ä¸ºfalseï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** BaseRichInputFormat.class */</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">useCustomReporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨è¿”å›trueï¼Œåº”è¯¥æ˜¯åœ¨å…¶å­ç±»ä¸­è¢«é‡å†™äº†ï¼Œå®šä½<code>JdbcInputFormat</code>å­ç±»ï¼Œå‘ç°<code>useCustomReporter</code>çš„å€¼ä¸<code>jdbcConf.isIncrement()</code>ç»‘å®šåœ¨ä¸€èµ·äº†ï¼Œå½“jobæ˜¯å¢é‡ä»»åŠ¡æ—¶ï¼Œåˆ™<code>useCustomReporter</code>ä¸ºtrueï¼Œè¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆsqlçš„å¢é‡ä»»åŠ¡æŠ¥é”™ï¼Œè€Œæ‰¹é‡ä»»åŠ¡ä¸æŠ¥é”™ã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">useCustomReporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> jdbcConf.isIncrement();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆæœ‰è¿™ä¸ªé€»è¾‘ï¼Œä¸å¤ªå¥½æ£æ‘©å…¶ç”¨é€”ï¼Œä¸è¿‡å°†å…¶æ”¹æˆfalseï¼Œä¸ä¼šå½±å“ä¸»æµç¨‹ï¼Œé‚å°†å…¶ä¿®æ”¹æˆå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">useCustomReporter</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//    return jdbcConf.isIncrement();</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆåˆ«ç€æ€¥ç¼–è¯‘æ‰“åŒ…è¿è¡Œï¼Œè¿˜æœ‰ä¸€å¤„éœ€è¦ä¿®æ”¹ï¼Œåœ¨<code>initMetric</code>æ–¹æ³•ä¸­çš„<code>customReporter</code>å¤„å¢åŠ åˆ¤æ–­é€»è¾‘ï¼Œå½“<code>customReporter</code>ä¸º<code>true</code>æ—¶ï¼Œè¿›è¡Œè®¾ç½®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initMetric</span><span class="params">(InputSplit inputSplit)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!jdbcConf.isIncrement()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¢åŠ customReporterç›¸å…³çš„åˆ¤æ–­ï¼Œ</span></span><br><span class="line">    <span class="keyword">if</span> (useCustomReporter()) &#123;</span><br><span class="line">        customReporter.registerMetric(startLocationAccumulator, Metrics.START_LOCATION);</span><br><span class="line">        customReporter.registerMetric(endLocationAccumulator, Metrics.END_LOCATION);</span><br><span class="line">    &#125;</span><br><span class="line">    getRuntimeContext().addAccumulator(start, startLocationAccumulator);</span><br><span class="line">    getRuntimeContext().addAccumulator(end, endLocationAccumulator);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ¬¡å¯ä»¥æ‰“åŒ…ï¼Œæäº¤sqlä»»åŠ¡äº†ã€‚</p><h2 id="Flinkx-sqlæ¨¡å¼binlogåŒæ­¥mysqlè¡¨"><a href="#Flinkx-sqlæ¨¡å¼binlogåŒæ­¥mysqlè¡¨" class="headerlink" title="Flinkx sqlæ¨¡å¼binlogåŒæ­¥mysqlè¡¨"></a>Flinkx sqlæ¨¡å¼binlogåŒæ­¥mysqlè¡¨</h2><p>ä¸Šé¢çš„sqlå¢é‡åŒæ­¥mysqlè¡¨ï¼Œä»ä»»åŠ¡é…ç½®ä¸Šå¯ä»¥æ¨æ–­å…¶å¢é‡åŒæ­¥çš„é€»è¾‘æ˜¯å‘¨æœŸæ€§çš„æ‰§è¡Œsqlï¼Œé€šè¿‡æŸä¸ªå­—æ®µæ¥åˆ¤æ–­å“ªäº›æ˜¯å¢é‡æ•°æ®ï¼Œè¿™ç§æ¨¡å¼æœ‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹å°±æ˜¯æ•°æ®çš„æ›´æ–°ä¸å¤Ÿå®æ—¶ã€‚<br>æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¢é˜…mysqlçš„binlogæ–¹å¼(<strong>å‰ææ˜¯mysqlå¼€å¯binlogé…ç½®</strong>)ï¼Œå®æ—¶åŒæ­¥è¡¨çš„å˜åŒ–ã€‚å…¶ä»»åŠ¡é…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> source</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span>,</span><br><span class="line">    name        <span class="type">varchar</span>,</span><br><span class="line">    money       <span class="type">decimal</span>,</span><br><span class="line">    dateone     <span class="type">timestamp</span>,</span><br><span class="line">    age         <span class="type">bigint</span>,</span><br><span class="line">    datethree   <span class="type">timestamp</span>,</span><br><span class="line">    datesix     <span class="type">timestamp</span>,</span><br><span class="line">    phone       <span class="type">bigint</span>,</span><br><span class="line">    wechat      STRING,</span><br><span class="line">    income      <span class="type">decimal</span>,</span><br><span class="line">    birthday    <span class="type">timestamp</span>,</span><br><span class="line">    dtdate      <span class="type">date</span>,</span><br><span class="line">    dttime      <span class="type">time</span>,</span><br><span class="line">    today       <span class="type">date</span>,</span><br><span class="line">    timecurrent <span class="type">time</span>,</span><br><span class="line">    aboolean    <span class="type">boolean</span>,</span><br><span class="line">    adouble     <span class="keyword">double</span>,</span><br><span class="line">    afloat      <span class="type">float</span>,</span><br><span class="line">    achar       <span class="type">char</span>,</span><br><span class="line">    abinary     BYTES,</span><br><span class="line">    atinyint    tinyint</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">      <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;binlog-x&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;cat&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;insert,delete,update&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/tudou?useSSL=false&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;host&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;localhost&#x27;</span>  <span class="comment">--  canal åœ°å€</span></span><br><span class="line">      ,<span class="string">&#x27;port&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;3306&#x27;</span></span><br><span class="line"><span class="comment">--   ,&#x27;journal-name&#x27; = &#x27;mysql-bin.000001&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;table&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;tudou.type&#x27;</span></span><br><span class="line">      ,<span class="string">&#x27;timestamp-format.standard&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;SQL&#x27;</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sink</span><br><span class="line">(</span><br><span class="line">    id          <span class="type">int</span>,</span><br><span class="line">    name        <span class="type">varchar</span>,</span><br><span class="line">    money       <span class="type">decimal</span>,</span><br><span class="line">    dateone     <span class="type">timestamp</span>,</span><br><span class="line">    age         <span class="type">bigint</span>,</span><br><span class="line">    datethree   <span class="type">timestamp</span>,</span><br><span class="line">    datesix     <span class="type">timestamp</span>,</span><br><span class="line">    phone       <span class="type">bigint</span>,</span><br><span class="line">    wechat      STRING,</span><br><span class="line">    income      <span class="type">decimal</span>,</span><br><span class="line">    birthday    <span class="type">timestamp</span>,</span><br><span class="line">    dtdate      <span class="type">date</span>,</span><br><span class="line">    dttime      <span class="type">time</span>,</span><br><span class="line">    today       <span class="type">date</span>,</span><br><span class="line">    timecurrent <span class="type">time</span>,</span><br><span class="line">    aboolean    <span class="type">boolean</span>,</span><br><span class="line">    adouble     <span class="keyword">double</span>,</span><br><span class="line">    afloat      <span class="type">float</span>,</span><br><span class="line">    achar       <span class="type">char</span>,</span><br><span class="line">    abinary     BYTES,</span><br><span class="line">    atinyint    tinyint</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">      <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;print&#x27;</span></span><br><span class="line">      );</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> sink</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> source u;</span><br></pre></td></tr></table></figure><p>flinkxçš„binlogåŒæ­¥éœ€è¦ç»“åˆcanalï¼Œè¿™ç§æ–¹å¼ä¸ªäººæ„Ÿè§‰ä¸å¤ªæ–¹ä¾¿ï¼Œç»„ä»¶è¾ƒå¤šï¼Œè€Œä¸”æ‰©å±•æ€§ä¹Ÿè¾ƒå·®ï¼Œæ²¡å†è¿›è¡Œå°è¯•ï¼Œè€Œæ‰“ç®—ä½¿ç”¨<code>Flink CDC</code>åŠŸèƒ½è¿›è¡Œæµ‹è¯•ï¼Œéšåä¼šæœ‰ä¸€ç¯‡æ–‡ç« è¿›è¡Œä»‹ç»ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æµ‹è¯•ä½¿ç”¨äº†flinkxçš„jsonæ¨¡å¼å’Œsqlæ¨¡å¼å¯¹mysqlè¡¨è¿›è¡Œæ‰¹é‡å’Œå¢é‡åŒæ­¥ï¼Œflinkxè¿˜æ”¯æŒå¾ˆå¤šsourceï¼ŒåŠŸèƒ½æ¯”è¾ƒä¸°å¯Œï¼Œè€Œä¸”æ‰¹é‡åŒæ­¥ä¸ç®¡æ˜¯jsonæ¨¡å¼è¿˜æ˜¯sqlæ¨¡å¼é…ç½®éƒ½æ¯”è¾ƒæ–¹ä¾¿è€Œä¸”ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦é€šè¿‡binlogåŒæ­¥mysqlçš„è¯ï¼Œå°±æ¯”è¾ƒéº»çƒ¦äº†ï¼Œéœ€è¦é…åˆcanalï¼Œä¸ªäººæ„Ÿè§‰ä¸å¤ªæ–¹ä¾¿ã€‚</p><p>å¦‚æœå¯¹æ•°æ®çš„å®æ—¶æ€§è¦æ±‚ä¸é«˜çš„è¯ï¼Œflinkxå¯ä»¥å¼€ç®±å³ç”¨ï¼Œè¿˜æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;FlinkXæ˜¯ä¸€ä¸ªåŸºäºFlinkçš„æ‰¹æµç»Ÿä¸€çš„æ•°æ®åŒæ­¥å·¥å…·ï¼Œæ—¢å¯ä»¥é‡‡é›†é™æ€çš„æ•°æ®ï¼Œæ¯”å¦‚MySQLï¼ŒHDFSç­‰ï¼Œä¹Ÿå¯ä»¥é‡‡é›†å®æ—¶å˜åŒ–çš„æ•°æ®ï¼Œæ¯”å¦‚MySQL binlogï¼ŒKafkaç­‰ã€‚ åŒæ—¶ï¼ŒFlinkXä¹Ÿæ˜¯æ”¯æŒåŸç”ŸFlinkSqlæ‰€æœ‰è¯­æ³•å’Œç‰¹æ€§çš„è®¡ç®—æ¡†æ¶ï¼Œå…·ä½“ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ&lt;a href=&quot;https://github.com/DTStack/flinkx&quot;&gt;githubä¸Šçš„é¡¹ç›®ä»‹ç»&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡è®°å½•ä¸‹åœ¨Flink standloneæ¨¡å¼ä¸‹ä½¿ç”¨FlinxåŒæ­¥mysqlæ•°æ®ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Flink" scheme="http://yuanba.tech/categories/Flink/"/>
    
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="Flink" scheme="http://yuanba.tech/tags/Flink/"/>
    
    <category term="Flinkx" scheme="http://yuanba.tech/tags/Flinkx/"/>
    
    <category term="Connector" scheme="http://yuanba.tech/tags/Connector/"/>
    
  </entry>
  
  <entry>
    <title>openGaussæç®€ç‰ˆå®‰è£…ä½¿ç”¨</title>
    <link href="http://yuanba.tech/openGauss-deploy.html"/>
    <id>http://yuanba.tech/openGauss-deploy.html</id>
    <published>2021-05-13T14:35:20.000Z</published>
    <updated>2021-05-13T15:55:20.000Z</updated>
    
    <content type="html"><![CDATA[<p>openGaussæ˜¯GaussDBçš„å¼€æºç‰ˆï¼Œä»<a href="https://opengauss.org/zh/download.html">å®˜ç½‘</a>ä¸‹è½½å³å¯ã€‚</p><p>è¿™é‡Œåªæ˜¯ä¸ºäº†æµ‹è¯•ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼Œæ‰€ä»¥åªä¸‹è½½äº†æç®€ç‰ˆã€‚ä¸‹é¢è®°å½•ä¸‹å®‰è£…æ­¥éª¤å’Œé‡åˆ°çš„é—®é¢˜ã€‚</p><span id="more"></span><h2 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h2><p>GaussDBå®‰è£…ä¸èƒ½ç”¨rootç”¨æˆ·ï¼Œå…ˆæ–°å»ºä¸€ä¸ªä¸“ç”¨ç”¨æˆ·<code>gaussdb</code>ï¼Œæ‰§è¡Œå‘½ä»¤<code>groupadd gaussdb &amp;&amp; useradd -d /home/gaussdb -m gaussdb -g gaussdb</code><br>è§£å‹å®‰è£…åŒ…ï¼Œæ‰§è¡Œå‘½ä»¤<code>tar -jxvf openGauss-2.0.0-CentOS-64bit.tar.bz2 -C gaussdb-2.0.0</code><br>ç„¶åè¿›å…¥<code>simpleInstall</code>ç›®å½•ï¼Œæ‰§è¡Œ<code>sh install.sh -w xx</code>å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚</p><p>å¦‚æœä¸Šè¿°æµç¨‹æ­£å¸¸ï¼Œåˆ™GaussDBå®‰è£…åˆæ­¥å®Œæˆã€‚ä½†æ˜¯æˆ‘æ²¡æœ‰è¿™ä¹ˆé¡ºåˆ©ï¼Œé‡åˆ°äº›é—®é¢˜ã€‚</p><h3 id="é—®é¢˜1"><a href="#é—®é¢˜1" class="headerlink" title="é—®é¢˜1"></a>é—®é¢˜1</h3><p>æ‰§è¡Œ<code>install.sh</code>å‘½ä»¤æ—¶ï¼ŒæŠ¥é”™<code>SEMMNI</code>å‚æ•°è®¾ç½®ä¸å¯¹ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š<br><code>On systemwide basis, the maximum number of SEMMNI is not correct. the current SEMMNI value is: 128. Please check it.</code></p><blockquote><p>è§£å†³<br>SEMMNIæ˜¯åœ¨<code>/proc/sys/kernel/sem</code>æ–‡ä»¶ä¸­é…ç½®çš„ï¼Œä¿®æ”¹ä¸‹å°±å¥½äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¿®æ”¹æ–¹å¼ä¸èƒ½ç›´æ¥vimï¼Œéœ€è¦ç”¨echoå‘½ä»¤å†™å…¥ï¼Œå¦åˆ™ä¼šå†™å…¥ä¸æˆåŠŸã€‚<br>æ‰§è¡Œå‘½ä»¤<code>echo 250    32000    32    2048 &gt; /proc/sys/kernel/sem</code></p></blockquote><p>å®‰è£…æˆåŠŸä¹‹åï¼Œéœ€è¦å…ˆéªŒè¯ä¸‹èƒ½å¦æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”è¾ƒå®‰è£…ä¸æŠ¥é”™å’Œèƒ½æ­£å¸¸ä½¿ç”¨æ˜¯ä¸¤å›äº‹ã€‚</p><p>æ‰§è¡Œ<code>gsql -d postgres -p 5432</code>ï¼Œå…¶ä¸­ç«¯å£<code>5432</code>æ˜¯é»˜è®¤ç«¯å£ï¼Œå…·ä½“ç«¯å£ä¿¡æ¯å¯ä»¥åœ¨<code>$&#123;GAUSSDB_HOME&#125;/data/single_node/postgresql.conf</code>ä¸­æŸ¥çœ‹ã€‚</p><p>åˆæŠ¥é”™äº†ã€‚ã€‚</p><h3 id="é—®é¢˜2"><a href="#é—®é¢˜2" class="headerlink" title="é—®é¢˜2"></a>é—®é¢˜2</h3><p>æ˜¯opensslçš„é—®é¢˜ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š<br><code>openssl: error while loading shared libraries: libssl.so.1.1: cannot open shared object file: No such file or directory</code></p><blockquote><p>è§£å†³<br>æ‰§è¡Œ<code>openssl version</code>æŸ¥çœ‹å½“å‰opensslçš„ç‰ˆæœ¬ï¼Œæˆ‘çš„ç‰ˆæœ¬æ˜¯1.0.2ï¼Œéœ€è¦å…ˆå°†opensslå‡çº§åˆ°1.1ï¼Œå¦‚æœè¿˜æŠ¥ä¸Šé¢çš„é”™ï¼Œåœ¨æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š</p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/local/lib64/libssl.so.1.1 /usr/lib64/libssl.so.1.1</span><br><span class="line">ln -s /usr/local/lib64/libcrypto.so.1.1 /usr/lib64/libcrypto.so.1.1</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé—®é¢˜è§£å†³å®Œå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼Œä¸€äº›å¸¸ç”¨å‘½ä»¤æœ‰<code>\c</code>åˆ‡æ¢æ•°æ®åº“ï¼Œ<code>\l</code>æŸ¥çœ‹æ•°æ®åº“ã€<code>\dt</code>æŸ¥çœ‹è¡¨ã€<code>\d tablename</code>æŸ¥çœ‹è¡¨ç»“æ„ã€‚</p><h2 id="è¿œç¨‹è¿æ¥"><a href="#è¿œç¨‹è¿æ¥" class="headerlink" title="è¿œç¨‹è¿æ¥"></a>è¿œç¨‹è¿æ¥</h2><p>ç®¡ç†å‘˜å¸å·æ— æ³•è¿›è¡Œè¿œç¨‹è¿æ¥ï¼Œæ–°å»ºä¸ªç”¨æˆ·ç”¨äºæµ‹è¯•è¿œç¨‹è¿æ¥åŠŸèƒ½ï¼Œæ–°å»ºç”¨æˆ·å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER test PASSWORD &#x27;Test@123&#x27;;</span><br><span class="line"><span class="meta">#</span><span class="bash"> å°† schoolåº“èµ‹æƒç»™<span class="built_in">test</span>ç”¨æˆ·</span></span><br><span class="line">GRANT ALL PRIVILEGES ON DATABASE school to test;</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ”¹<span class="built_in">test</span>è§’è‰²</span></span><br><span class="line">ALTER ROLE test CREATEDB;</span><br><span class="line"><span class="meta">#</span><span class="bash"> èµ‹äºˆç”¨æˆ·æƒé™</span></span><br><span class="line">GRANT ALL PRIVILEGES To test;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–°å»ºçš„ç”¨æˆ·è¿æ¥æµ‹è¯•ï¼Œæ‰§è¡Œå‘½ä»¤<code>gsql -h xx.xx.xx.xx -d school -U test -p 5432 -r</code><br>æŠ¥é”™æ— æ³•è¿æ¥ï¼ŒæŠ¥æƒé™é”™è¯¯ï¼Œæ‰§è¡Œå‘½ä»¤<code>gs_guc set -N all -I all -h &quot;host all test 192.168.xx.xx/32 sha256&quot;</code>ï¼Œæ‚²å‚¬çš„æ˜¯åˆæŠ¥é”™äº†ï¼Œé”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">realpath(/home/gaussdb/gaussdb-2.0.0/bin/cluster_static_config) failed : æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•!</span><br><span class="line">The gs_guc run with the following arguments: [gs_guc -N all -I all -h host all jack 192.168.xx.xx/32 sha256 set ].</span><br><span class="line">gs_guc: malloc 0</span><br></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶æ˜¯å› ä¸ºæç®€ç‰ˆä¸­å¾ˆå¤šå‘½ä»¤éƒ½æ²¡æœ‰ï¼Œæ¯”å¦‚<code>gs_om</code>ã€‚</p><p>æç®€ç‰ˆå°‘å¾ˆå¤šå‘½ä»¤æ–‡ä»¶æ€ä¹ˆè§£å†³ï¼Œæˆ‘åªèƒ½ä»æ–°å®‰è£…ä¸ªä¼ä¸šç‰ˆï¼Ÿå¥½éº»çƒ¦ã€‚çªç„¶æƒ³åˆ°åœ¨æœç´¢<code>gs_guc</code>è¿™ä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå®ƒä¿®æ”¹çš„æ˜¯<code>pg_hba.conf</code>è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥ç»•è¿‡<code>gs_guc</code>å‘½ä»¤ç›´æ¥ä¿®æ”¹é…ç½®æ–‡ä»¶å°±å¯ä»¥è§£å†³ï¼Œç«‹é©¬å»å®è·µã€‚</p><p><code>pg_hba.conf</code>åœ¨<code>$&#123;GAUSSDB_HOME&#125;/data/single_node</code>ä¸­ï¼Œé€šè¿‡vimä¿®æ”¹ï¼Œå¢åŠ <code>host    all             all             192.168.xx.xx/32            sha256</code><br>ä¿®æ”¹å®Œä¹‹åé‡å¯ä¸‹æœåŠ¡å°±è¡Œï¼Œæç¬‘çš„äº‹æƒ…å‘ç”Ÿäº†ï¼Œé‡å¯æœåŠ¡éœ€è¦ç”¨åˆ°<code>gs_om</code>å‘½ä»¤ï¼Œå¯æ˜¯æ²¡æœ‰å’‹åŠã€‚ã€‚ã€‚</p><p>æç®€ç‰ˆæ˜¯é€šè¿‡æ‰§è¡Œ<code>install.sh</code>å‘½ä»¤è¿›è¡Œå®‰è£…å¯åŠ¨çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªé‡Œé¢åº”è¯¥æœ‰å¯åŠ¨å‘½ä»¤ï¼Œæœç„¶å‘ç°äº†ï¼Œæç®€ç‰ˆçš„å¯åœå‘½ä»¤ä¸ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs_ctl start -D /home/gaussdb/gaussdb-2.0.0/data/single_node -Z single_node</span><br><span class="line">gs_ctl stop -D /home/gaussdb/gaussdb-2.0.0/data/single_node -Z single_node</span><br></pre></td></tr></table></figure><p>ç»ˆäºæå®šäº†ï¼Œå¯ä»¥è¿œç¨‹è¿æ¥äº†ã€‚</p><h2 id="JDBCè¿æ¥æµ‹è¯•"><a href="#JDBCè¿æ¥æµ‹è¯•" class="headerlink" title="JDBCè¿æ¥æµ‹è¯•"></a>JDBCè¿æ¥æµ‹è¯•</h2><p>ä»£ç ç”¨å®˜æ–¹çš„å°±è¡Œï¼ŒåŠ ä¸ªä¾èµ–åŒ…ï¼Œå®˜æ–¹ä¹Ÿæä¾›äº†ã€‚<br>å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºæ•°æ®åº“è¿æ¥</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">GetConnection</span><span class="params">(String username, String passwd)</span> </span>&#123;</span><br><span class="line">    String driver = <span class="string">&quot;org.postgresql.Driver&quot;</span>;</span><br><span class="line">    String sourceURL = <span class="string">&quot;jdbc:postgresql://192.168.xx.xx:5432/school?useUnicode=true&amp;characterEncoding=utf8&quot;</span>;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//åŠ è½½æ•°æ®åº“é©±åŠ¨ã€‚</span></span><br><span class="line">        Class.forName(driver).newInstance();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ•°æ®åº“è¿æ¥ã€‚</span></span><br><span class="line">        conn = DriverManager.getConnection(sourceURL, username, passwd);</span><br><span class="line">        System.out.println(<span class="string">&quot;Connection succeed!&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> conn;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="å¹¸è¿ä¹‹æƒ³"><a href="#å¹¸è¿ä¹‹æƒ³" class="headerlink" title="å¹¸è¿ä¹‹æƒ³"></a>å¹¸è¿ä¹‹æƒ³</h2><p>æ•´ä¸ªå®‰è£…æµ‹è¯•è¿‡ç¨‹æ¯”è¾ƒåå·ä½†ä¹Ÿå¾ˆå¹¸è¿ï¼Œæ‰€é‡çš„é—®é¢˜éƒ½èƒ½æ¯”è¾ƒç®€å•ï¼Œæ¯”è¾ƒå®¹æ˜“æå®šã€‚</p><p>å®‰è£…ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°äº›é—®é¢˜ï¼Œæœ‰çš„é—®é¢˜æ¯”è¾ƒæ™®éå¯ä»¥é€šè¿‡æœç´¢å¼•æ“è§£å†³ï¼Œä½†æ˜¯æœ‰äº›é—®é¢˜æ¯”è¾ƒç‹¬ç‰¹ï¼Œæ— æ³•é€šè¿‡æœç´¢å¼•æ“è§£å†³ï¼Œæ­¤æ—¶å°±éœ€è¦æˆ‘ä»¬æœ‰è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼Œè¿™ä¸ªèƒ½åŠ›ä»ä½•è€Œæ¥ï¼Œæˆ‘è®¤ä¸ºèƒ½åŠ›æ˜¯ä»æ€è·¯ä¸­è€Œæ¥ï¼Œè€Œæ€è·¯åˆæ˜¯ä»ç»éªŒè§è¯†ä¸­è€Œæ¥ã€‚æ‰€ä»¥å‘¢è¿˜æ˜¯é‚£å¥è€è¯ï¼Œé‡åˆ°é—®é¢˜ä¸è¦æ…Œï¼Œè¦å¤šæƒ³æƒ³ï¼Œè¦è®°ä½ä¸€ç‚¹ï¼Œé—®é¢˜è‚¯å®šæ˜¯èƒ½è§£å†³çš„ï¼Œåªæ˜¯æœ‰çš„é—®é¢˜è§£å†³å®Œå°±æ²¡æœ‰äº†ï¼Œè€Œæœ‰çš„é—®é¢˜è§£å†³å®Œä¸€ä¸ªåˆä¼šå‡ºç°Nä¸ªã€‚</p><p>ä¹Ÿè®¸ç°åœ¨è¯´è¿™äº›éƒ½æ˜¯é£å‡‰è¯ï¼Œä½†ç°åœ¨æƒ³æƒ³å¦‚æœå½“æ—¶è§£å†³è¿œç¨‹è¿æ¥é—®é¢˜æ—¶ï¼Œæ²¡æœ‰å»å¤šæƒ³ä¸‹ï¼Œå¯èƒ½å°±ç›´æ¥æ›´æ¢ä¼ä¸šç‰ˆï¼Œç„¶åå®‰è£…éƒ¨ç½²ï¼Œé‡åˆ°æ–°çš„é—®é¢˜ç»§ç»­è§£å†³é—®é¢˜ã€‚<br>ä½†æ˜¯æˆ‘å¾ˆåº†å¹¸æˆ‘æ²¡æœ‰ç«‹é©¬å»æ›´æ¢ä¼ä¸šç‰ˆï¼Œè€Œæ˜¯å¤šæƒ³äº†ä¸€æ­¥ï¼Œå¹¶é ç€è‡ªå·±çš„ç»éªŒæŠŠé‡åˆ°çš„é—®é¢˜ç»™è§£å†³äº†ï¼ŒèŠ‚çœäº†ä¸€äº›æ—¶é—´ä¹Ÿå¢åŠ äº†è‡ªå·±ç‹¬ç«‹è§£å†³é—®é¢˜çš„ä¿¡å¿ƒã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;openGaussæ˜¯GaussDBçš„å¼€æºç‰ˆï¼Œä»&lt;a href=&quot;https://opengauss.org/zh/download.html&quot;&gt;å®˜ç½‘&lt;/a&gt;ä¸‹è½½å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;è¿™é‡Œåªæ˜¯ä¸ºäº†æµ‹è¯•ä¸€äº›åŸºæœ¬åŠŸèƒ½ï¼Œæ‰€ä»¥åªä¸‹è½½äº†æç®€ç‰ˆã€‚ä¸‹é¢è®°å½•ä¸‹å®‰è£…æ­¥éª¤å’Œé‡åˆ°çš„é—®é¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="BigData" scheme="http://yuanba.tech/categories/BigData/"/>
    
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="GaussDB" scheme="http://yuanba.tech/tags/GaussDB/"/>
    
    <category term="deploy" scheme="http://yuanba.tech/tags/deploy/"/>
    
  </entry>
  
  <entry>
    <title>å§—å§—æ¥è¿Ÿçš„æœå®</title>
    <link href="http://yuanba.tech/my-book.html"/>
    <id>http://yuanba.tech/my-book.html</id>
    <published>2021-04-26T15:35:20.000Z</published>
    <updated>2021-04-26T15:55:13.000Z</updated>
    
    <content type="html"><![CDATA[<p>2021å¹´ä¹Ÿæ¥è¿‘ä¸€åŠäº†ï¼Œè¿‡å»çš„2020å¹´å¯¹è°éƒ½æ˜¯ä¸å¹³å‡¡çš„ä¸€å¹´ï¼Œå¯¹æˆ‘å°¤æ˜¯ã€‚<br>2020å¹´åœ¨å„ä½ç¼–è¾‘è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œå¯¹ä¹¦è¿›è¡Œäº†å¾®è°ƒï¼Œç»ˆäºåœ¨2021å¹´è¦è·Ÿè¯»è€…è§é¢äº†ï¼Œè™½ç„¶æ•´ä¸ªæˆ˜çº¿ç”±äºç–«æƒ…åŸå› è¢«æ‹‰äº†å¾ˆé•¿ï¼Œä½†ç°åœ¨å¿ƒé‡Œä¾ç„¶å¾ˆæ¿€åŠ¨ã€‚</p><p>è¿™æ˜¯ä¸€æœ¬å…³äºHadoop 3çš„ä¹¦ï¼Œä¹¦çš„åå­—å«ã€ŠHadoop 3å®æˆ˜æŒ‡å—ã€‹</p><span id="more"></span><p>å…¶å®æœ¬ä¹¦æŒ‰åŸå…ˆçš„è®¡åˆ’æ˜¯æ‰“ç®—åœ¨2020å¹´è·Ÿå¤§å®¶è§é¢çš„ï¼Œå½“æ—¶å›½å†…å¹¶æ²¡æœ‰å…³äºHadoop 3çš„ç›¸å…³ä¹¦ç±ï¼Œè€Œå½“æ—¶æ­£åœ¨æä¸€äº›Hadoop 3çš„äº‹æƒ…ï¼Œæ‰€ä»¥æˆ‘å°±æ‰“ç®—æŠŠè‡ªå·±å¯¹Hadoop 3çš„ç†è§£ä»¥åŠå·¥ä½œä¹‹ååœ¨ä»äº‹Hadoopç›¸å…³å·¥ä½œæ—¶ç§¯ç´¯çš„ç»éªŒåˆ†äº«ç»™å¤§å®¶ï¼Œæ‰€ä»¥å°±æœ‰äº†è¿™æœ¬ä¹¦ï¼Œç”±äºæœ¬äººèƒ½åŠ›æœ‰é™ï¼Œä¹¦ä¸­éš¾å…ä¼šæœ‰ç†è§£ä¸åˆ°ä½çš„åœ°æ–¹ï¼Œè¯·å„ä½å¤§ä½¬å¸®å¿™æŒ‡æ­£ã€‚</p><p>æœ¬ä¹¦é•¿è¿™ä¸ªæ ·å­ï¼Œé¢„è®¡5æœˆä»½åœ¨å„å¤§ç”µå•†å¼€å”®ã€‚<br><img src="/blogimgs/my-book/book.png"></p><p>æœ¬ä¹¦ç›®å½•ï¼š<br>ç¬¬1ç«  Hadoop<br>    1.1 ç®€ä»‹<br>        1.1.1 Hadoop 1.0<br>        1.1.2 Hadoop 2.0<br>    1.2 Hadoop 3.0<br>    1.3 é˜…è¯» Hadoop æºç <br>        1.3.1 å•å…ƒæµ‹è¯•<br>        1.3.2 æ–­ç‚¹è°ƒè¯•ä»£ç <br>    1.4 å°ç»“<br>ç¬¬2ç«  HDFS<br>    2.1 HDFS ç®€ä»‹<br>    2.2 è§£æNameNodeä¸­çš„å…ƒæ•°æ®åŠå…¶å†…å­˜ç»“æ„<br>        2.2.1 è§£æNameNodeä¸­çš„å…ƒæ•°æ®<br>        2.2.2 è§£æNameNodeçš„å†…å­˜ç»“æ„<br>    2.3 è§£æNameNodeçš„HAåŠŸèƒ½<br>        2.3.1 åŸºäºQJMçš„HA<br>        2.3.2 æ•…éšœè½¬ç§»<br>        2.3.3 å¤šNameNodeæ¨¡å¼<br>    2.4 HDFS çš„ Federation<br>        2.4.1 åŸºäº viewfs çš„ Federation<br>        2.4.2 åŸºäºRouterçš„Federation<br>    2.5 çº åˆ ç <br>        2.5.1 çº åˆ ç çš„åŸç†<br>        2.5.2 HDFS EC<br>        2.5.3 HDFS EC çš„å®ç°<br>        2.5.4 å¯¹æ¯”HDFS ECç­–ç•¥ä¸ä¸‰å‰¯æœ¬ç­–ç•¥<br>    2.6 ä¸‹ä¸€ä»£å¯¹è±¡å­˜å‚¨ç³»ç»ŸOzone<br>        2.6.1 Ozone åˆä½“éªŒ<br>        2.6.2 Ozone æ¶æ„<br>    2.7 å°ç»“<br>ç¬¬3ç«  YARN<br>    3.1 YARN ç®€ä»‹<br>    3.2 è§£æResourceManagerçš„HAåŠŸèƒ½<br>        3.2.1 æ•…éšœè½¬ç§»<br>        3.2.2 æ•°æ®æ¢å¤<br>    3.3 YARN Federation<br>        3.3.1 æ¶æ„<br>        3.3.2 Router<br>        3.3.3 State Storeå’ŒPolicy Store<br>        3.3.4 AMRMProxy<br>        3.3.5 è·¨å­é›†ç¾¤è¿è¡Œ<br>    3.4 ä¸­å¤®è°ƒåº¦å™¨<br>        3.4.1 Capacity è°ƒåº¦å™¨<br>        3.4.2 Fair è°ƒåº¦å™¨<br>        3.4.3 è°ƒåº¦æ‰©å±•<br>    3.5 åˆ†å¸ƒå¼è°ƒåº¦å™¨<br>        3.5.1 åˆ†å¸ƒå¼è°ƒåº¦å™¨çš„æ¶æ„<br>        3.5.2 opportunistic container<br>    3.6 YARN Shared Cache<br>        3.6.1 èµ„æºæœ¬åœ°åŒ–<br>        3.6.2 Shared Cache çš„æ¶æ„<br>        3.6.3 Shared Cache å®ä¾‹<br>    3.7 å°ç»“<br>ç¬¬4ç«  Application on YARN<br>    4.1 MapReduce çš„ç®€ä»‹<br>    4.2 MapReduce çš„æºç åˆ†æ<br>        4.2.1 InputSplit<br>        4.2.2 ç¯å½¢ç¼“å†²åŒº<br>        4.2.3 æº¢å†™å’Œå½’å¹¶<br>        4.2.4 Shuffle<br>    4.3 MapReduce on YARN<br>        4.3.1 YARN çš„äº‹ä»¶æœºåˆ¶å’ŒçŠ¶æ€æœºæœºåˆ¶<br>        4.3.2 MR ApplicationMaster<br>    4.4 Application on YARN<br>    4.5 å°ç»“<br>ç¬¬5ç«  å®æˆ˜æŒ‡å—<br>    5.1 Hadoop 3.x çš„éƒ¨ç½²<br>        5.1.1 Hadoop 3.x HAçš„éƒ¨ç½²<br>        5.1.2 Hadoop 3.x Federation çš„éƒ¨ç½²<br>    5.2 Hadoop å‡çº§<br>        5.2.1 Hadoop 2.0 å‡çº§ä¸º Hadoop 3.0<br>        5.2.2 Hadoop 3.0 é™çº§ä¸º Hadoop 2.0<br>        5.2.3 å‡çº§/é™çº§ä¸­é‡åˆ°çš„é—®é¢˜<br>    5.3 äºŒæ¬¡å¼€å‘<br>        5.3.1 ä¸å…¶ä»–è‡ªç ”ç³»ç»Ÿèåˆ<br>        5.3.2 è‡ªèº«åŠŸèƒ½æ‰©å±•ä¹‹è‡ªåŠ¨è¯†åˆ«ä¿®å¤åçš„æ•°æ®ç›˜<br>        5.3.3 åˆå¹¶ç¤¾åŒº Patch<br>        5.3.4 æäº¤PullRequest<br>    5.4 å‘¨è¾¹ç³»ç»Ÿå¹³å°<br>        5.4.1 ä»»åŠ¡è°ƒåº¦å¹³å°<br>        5.4.2 ç›‘æ§å¹³å°<br>        5.4.3 é›†ç¾¤è¯Šæ–­åˆ†æå¹³å°<br>    5.5 å°ç»“</p><p>å¸Œæœ›å¤§å®¶å¤šå¤šæ”¯æŒï¼Œæœ‰ä»€ä¹ˆé—®é¢˜å¯ä»¥éšæ—¶æ‰¾æˆ‘æ²Ÿé€šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2021å¹´ä¹Ÿæ¥è¿‘ä¸€åŠäº†ï¼Œè¿‡å»çš„2020å¹´å¯¹è°éƒ½æ˜¯ä¸å¹³å‡¡çš„ä¸€å¹´ï¼Œå¯¹æˆ‘å°¤æ˜¯ã€‚&lt;br&gt;2020å¹´åœ¨å„ä½ç¼–è¾‘è€å¸ˆçš„å¸®åŠ©ä¸‹ï¼Œå¯¹ä¹¦è¿›è¡Œäº†å¾®è°ƒï¼Œç»ˆäºåœ¨2021å¹´è¦è·Ÿè¯»è€…è§é¢äº†ï¼Œè™½ç„¶æ•´ä¸ªæˆ˜çº¿ç”±äºç–«æƒ…åŸå› è¢«æ‹‰äº†å¾ˆé•¿ï¼Œä½†ç°åœ¨å¿ƒé‡Œä¾ç„¶å¾ˆæ¿€åŠ¨ã€‚&lt;/p&gt;
&lt;p&gt;è¿™æ˜¯ä¸€æœ¬å…³äºHadoop 3çš„ä¹¦ï¼Œä¹¦çš„åå­—å«ã€ŠHadoop 3å®æˆ˜æŒ‡å—ã€‹&lt;/p&gt;</summary>
    
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/categories/Hadoop/"/>
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/tags/Hadoop/"/>
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="YARN" scheme="http://yuanba.tech/tags/YARN/"/>
    
    <category term="HDFS" scheme="http://yuanba.tech/tags/HDFS/"/>
    
  </entry>
  
  <entry>
    <title>å‘å¨ƒ-é˜²æ²‰è¿·App</title>
    <link href="http://yuanba.tech/android-app-timeup.html"/>
    <id>http://yuanba.tech/android-app-timeup.html</id>
    <published>2021-02-11T02:31:19.000Z</published>
    <updated>2021-02-12T05:30:10.000Z</updated>
    
    <content type="html"><![CDATA[<p>çŒ¿çˆ¸ï¼šå±å­©ï¼Œå·²ç»çœ‹äº†å¾ˆé•¿xxäº†ï¼Œè¯¥è®©çœ¼ç›ä¼‘æ¯ä¸‹äº†ã€‚<br>å±å­©ï¼šä¸æƒ…ä¸æ„¿çš„å…³äº†ï¼Œå»ç©åˆ«çš„ã€‚<br>å¾ˆå’Œè°æ˜¯ä¸æ˜¯ï¼Ÿå½“ä½ ä¸åœ¨å®¶çš„æ—¶å€™ï¼Œå±å­©å°±æ²¡è¿™ä¹ˆä¹–äº†ï¼Œæ˜¯ä¸æ˜¯ï¼Œè®¤åŒä¸ï¼Ÿ<br>è¿™æ—¶å°±éœ€è¦æœ‰ä¸€ä¸ªå¼ºåŠ¿çš„â€œäººâ€æ¥é˜»æ­¢ä»–ï¼Œè¿™ä¸ªå¯åˆ«å¥¢æœ›è€äººæ¥é˜»æ­¢ä»–ï¼Œäºæ˜¯åªèƒ½è®©â€œæœºå™¨äººâ€æ¥æäº†ã€‚</p><p>äºæ˜¯æäº†ä¸ªAppï¼Œåå­—å«<strong>å‘å¨ƒç¥å™¨</strong>ï¼ˆä¸çŸ¥é“è‹¥å¹²å¹´åï¼Œå±å­©çœ‹åˆ°è¿™ä¸ªæ–‡ç« å¿ƒé‡Œæ˜¯ä»€ä¹ˆæ»‹å‘³ã€‚ã€‚ã€‚ï¼‰ï¼ŒåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç›‘æ§æŒ‡å®šappçš„æ´»åŠ¨çŠ¶æ€ï¼Œå¦‚æœè¿ç»­è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå‘å¨ƒç¥å™¨å°±ä¼šè‡ªåŠ¨ä»åå°åˆ‡åˆ°å‰å°è¿›è¡Œå€’è®¡æ—¶ï¼Œå€’è®¡æ—¶ç»“æŸä¹‹åå¯ä»¥ç»§ç»­å¨±ä¹ã€‚</p><p>è¿™ä¸ªAppç›®å‰åªæ˜¯å¤„äºåŸå§‹ç¤¾ä¼šç‰ˆï¼Œå¸Œæœ›æœ‰èƒ½åŠ›çš„çŒ¿çˆ¸ä»¬åŠ å…¥ï¼Œæˆ‘ä»¬ä¸€èµ·å°†å…¶å®Œå–„ï¼Œå¸®åŠ©ä¸‹ä¸€ä»£å…»æˆä¸€ä¸ªå¥½çš„è‡ªå¾‹èƒ½åŠ›ï¼Œæ­¤Appå·²åœ¨githubä¸Šå¼€æºï¼Œæ¬¢è¿è´¡çŒ®ï¼Œé¡¹ç›®åœ°å€<a href="https://github.com/hunshenshi/timeup.git">https://github.com/hunshenshi/timeup.git</a></p><span id="more"></span><h2 id="è°ƒç ”â€“å‡†å¤‡å·¥ä½œ"><a href="#è°ƒç ”â€“å‡†å¤‡å·¥ä½œ" class="headerlink" title="è°ƒç ”â€“å‡†å¤‡å·¥ä½œ"></a>è°ƒç ”â€“å‡†å¤‡å·¥ä½œ</h2><p>æ‰¾äº†ä¸‹ç›®å‰å¸‚é¢å·²æœ‰çš„å·¥å…·å’Œä¸€äº›æ‰‹æœºè‡ªå¸¦çš„å¥åº·ä½¿ç”¨çš„åŠŸèƒ½ï¼Œä¸å¤ªæ»¡è¶³æˆ‘çš„éœ€æ±‚ï¼Œ<br>1ã€å¤§å¤šæ•°éƒ½æ˜¯é™åˆ¶æ¯å¤©ç´¯è®¡ä½¿ç”¨æ—¶é•¿ï¼Œè€Œæˆ‘å¸Œæœ›æ¯ä½¿ç”¨ä¸€æ®µæ—¶é—´å°±ä¼‘æ¯ä¸€ä¼šï¼Œè€Œä¸å…³æ³¨ç´¯è®¡æ—¶é•¿<br>2ã€ç”±äºå¸‚é¢ä¸Šéƒ½æ˜¯ä¸€äº›é¢å‘å¹¿å¤§ç”¨æˆ·çš„äº§å“ï¼Œè¾¾åˆ°æ—¶é•¿ä¹‹åä¼šæœ‰æç¤ºï¼Œè€Œä¸ä¼šæœ‰æ›´æ¿€çƒˆçš„è¡Œä¸ºã€‚è€Œæˆ‘çš„éœ€æ±‚å¼ºç¡¬ï¼Œå†å¼ºç¡¬ï¼ˆåæ­£ç”¨æˆ·åªæœ‰å®¶é•¿çš„å¨ƒï¼‰</p><blockquote><p>æˆ‘æƒ³è¦çš„åŠŸèƒ½ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯å½“æ£€æµ‹åˆ°å‰å°è§†é¢‘ç±»çš„è½¯ä»¶è¿ç»­è¿è¡Œä¸€æ®µæ—¶é—´ä¹‹åï¼Œä¾ç„¶åœ¨è¿è¡Œï¼Œå°±å°†å…¶åˆ‡æ¢åˆ°åå°ï¼Œå¹¶å°†å€’è®¡æ—¶é¡µé¢åˆ‡æ¢è‡³å‰å°ï¼Œç­‰å¾…å€’è®¡æ—¶ç»“æŸã€‚éšåå†æ¬¡è¿›è¡Œä¸‹ä¸€è½®ç›‘æ§ï¼Œä¸ç›‘æ§ç´¯è®¡æ—¶é•¿ï¼Œåªç›‘æ§è¿ç»­ä½¿ç”¨æ—¶é•¿ï¼Œå¹¶ä¸”å¼ºåˆ¶åˆ‡æ¢Appã€‚</p></blockquote><p>æ²¡æœ‰ç°æˆçš„è½®å­é‚£å°±è‡ªå·±é€ ä¸€ä¸ªå§ï¼Œæ¢³ç†ä¸‹ä¼šç”¨åˆ°çš„æŠ€æœ¯ç‚¹ï¼š<br>1ã€Appä¿æ´»ï¼Œå› ä¸ºéœ€è¦å‘å¨ƒç¥å™¨é•¿æœŸå­˜æ´»äºåå°è¿›è¡Œç›‘æ§<br>2ã€å¦‚ä½•æ‹¿åˆ°æ­£åœ¨è¿è¡Œçš„app<br>3ã€å®šæ—¶æ‰§è¡Œï¼Œéœ€è¦å‘å¨ƒç¥å™¨å®šæœŸæ£€æµ‹å‰å°è¿è¡Œçš„appæ˜¯ä»€ä¹ˆ<br>4ã€åå°å”¤é†’ï¼Œéœ€è¦å‘å¨ƒç¥å™¨ä»åå°å”¤é†’åˆ°å‰å°è¿›è¡Œå€’è®¡æ—¶</p><p>çœ‹äº†äº›ç›¸å…³çš„æ–‡ç« ï¼Œæ„Ÿè§‰åŠŸèƒ½å¤§éƒ½å¯ä»¥å®ç°ï¼Œåªæ˜¯å®‰å“çš„ç‰ˆæœ¬å¤ªå¤šäº†ï¼Œå„ç§åŠŸèƒ½åœ¨å„ä¸ªç‰ˆæœ¬ä¸­å®ç°æ–¹å¼åˆä¸ä¸€æ ·ï¼Œåœ¨è¿™ç‰¹åˆ«åŒæƒ…æå®‰å“çš„æœ‹å‹ï¼ŒçœŸä¸å®¹æ˜“å‘€ã€‚ã€‚ã€‚</p><h2 id="ç¬¬ä¸€ä¸ªAndroid-Application"><a href="#ç¬¬ä¸€ä¸ªAndroid-Application" class="headerlink" title="ç¬¬ä¸€ä¸ªAndroid Application"></a>ç¬¬ä¸€ä¸ªAndroid Application</h2><p>å†³å®šè¦æäº†ï¼Œé‚£å°±å…ˆä»Hello Worldå¼€å§‹å§ï¼Œé¦–å…ˆä¸‹è½½ä¸ªAndroid Studioï¼Œç„¶åæ ¹æ®å‘å¯¼åˆ›å»ºä¸€ä¸ªandroidåº”ç”¨ï¼Œè¿™é‡Œè¯­è¨€æˆ‘é€‰çš„æ˜¯javaï¼Œä¸€è·¯ä¸‹æ¥å°±èƒ½è¿è¡Œä¸€ä¸ªdemo appäº†ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š<br><img src="/blogimgs/android-monitor/app01.png" alt="æ–°å»ºproject" title="æ–°å»ºproject"><br>æ–°å»ºprojectä¹‹åï¼Œè¿›å…¥é€‰æ‹©æ¨¡ç‰ˆé¡µé¢ï¼Œè¿™é‡Œæˆ‘é€‰çš„æ˜¯basicï¼Œä¸‹é¢è¿˜æœ‰å¾ˆå¤šæ¨¡ç‰ˆå¯ä»¥é€‰<br><img src="/blogimgs/android-monitor/app02.png" alt="é€‰æ‹©project" title="é€‰æ‹©project"><br>é€‰æ‹©ä¸‹ä¸€æ­¥ä¹‹åï¼Œå¡«å†™projectç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚projectåå­—ï¼Œéœ€è¦çš„è¯­è¨€å’Œsdk<br><img src="/blogimgs/android-monitor/app03.png" alt="å¡«å†™projectä¿¡æ¯" title="å¡«å†™projectä¿¡æ¯"><br>ç‚¹å‡»Finishå°±ç»“æŸäº†ï¼Œç­‰å¾…IDEåŠ è½½ç¨‹åºå°±è¡Œäº†ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œä¸»è¦æ˜¯gradle-5.6.4-all.zipä¸‹è½½æ…¢ï¼Œä½ å¯ä»¥ä½¿ç”¨è¿…é›·ä¸‹è½½ï¼Œç„¶åæ”¾åˆ°æŒ‡å®šçš„ç›®å½•å°±OKäº†ã€‚</p><h2 id="Appä¿æ´»"><a href="#Appä¿æ´»" class="headerlink" title="Appä¿æ´»"></a>Appä¿æ´»</h2><p>Appä¿æ´»è¿™ä¸ªè¯é¢˜ï¼Œä¸æœä¸çŸ¥é“ï¼Œä¸€æœæ˜¯æ‰“å¼€çœ¼ç•Œå‘€ï¼Œå……åˆ†å±•ç°äº†ç¾¤ä¼—çš„æ™ºæ…§å‘€ã€‚ä»€ä¹ˆåŒActivityç›¸äº’å”¤é†’ã€æ’­æ”¾æ— å£°éŸ³é¢‘å„ç§å¥‡æ·«å·§æŠ€ã€‚<br>ä¸è¿‡æˆ‘è¿™é‡Œå°±è‡ªå·±ç”¨ï¼Œè¿™ä¹ˆå¤šçš„å¥‡æ·«å·§æŠ€æˆ‘æ˜¯ç”¨ä¸ä¸Šäº†ï¼ˆå°±ç®—éœ€è¦ç”¨ä¸Šæˆ‘ä¹Ÿæ²¡æœ‰é‚£ä¹ˆé«˜æ·±çš„åŠŸåŠ›ï¼‰ï¼Œè§„è§„çŸ©çŸ©çš„ç”³è¯·æƒé™å§ã€‚</p><p>å¸¸é©»åå°éœ€è¦ç”³è¯·ç”µæ± ç™½åå•æƒé™ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šä»£ç ç¤ºä¾‹ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_REQUEST_IGNORE_BATTERY_OPTIMIZATIONS);</span><br><span class="line">context.startActivity(intent);</span><br></pre></td></tr></table></figure><h2 id="è·å–æ­£åœ¨è¿è¡Œçš„App"><a href="#è·å–æ­£åœ¨è¿è¡Œçš„App" class="headerlink" title="è·å–æ­£åœ¨è¿è¡Œçš„App"></a>è·å–æ­£åœ¨è¿è¡Œçš„App</h2><p>å¦‚ä½•é€šè¿‡ä»£ç æ‹¿åˆ°æ­£åœ¨å‰å°å±•ç¤ºçš„appï¼Œä¹Ÿæ˜¯å›°éš¾é‡é‡ï¼Œå¯¹äºä¸€æ— æ‰€çŸ¥çš„æˆ‘ä¾ç„¶æ˜¯å…ˆç½‘ä¸Šæœä¸€å †demoï¼Œç„¶åæµ‹è¯•ã€‚<br>æœç´ çš„ç»“æœå¤§ä½“åˆ†ä¸º3ç§ï¼Œä¸»è¦åˆ†å¸ƒåœ¨ä¸åŒçš„sdkç‰ˆæœ¬ä¸­ï¼Œå·²ç»è¿‡æ—¶çš„æœ‰<code>getRunningTasks</code>å’Œ<code>getRunningAppProcesses</code>ï¼Œåœ¨æ–°ç‰ˆsdkä¸­éƒ½æ™®éä½¿ç”¨<code>UsageStatsManager</code>ï¼Œä½¿ç”¨<code>UsageStatsManager</code>æ—¶éœ€è¦ç”³è¯·æƒé™ï¼Œè€Œä¸”é€šè¿‡å®ƒè·å–appçš„æ–¹æ³•ç½‘ä¸Šä¹Ÿæœ‰å¥½å‡ ç§ï¼Œæˆ‘å¯¹æ¯”äº†å‡ ç§ä½¿ç”¨çš„æ˜¯<code>queryUsageStats</code>æ–¹æ³•ï¼Œè¿˜å¯ä»¥ä½¿ç”¨<code>queryEvents</code>æ–¹æ³•ï¼Œä¸è¿‡æˆ‘æµ‹è¯•å‘ç°<code>queryEvents</code>çŠ¶æ€å˜æ›´æ²¡æœ‰<code>queryUsageStats</code>åŠæ—¶ã€‚ï¼ˆä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆæµ‹è¯•äº†è¿™ä¹ˆå¤šæ–¹æ³•ã€‚ã€‚ï¼‰</p><p>æ•´ä½“æ€è·¯æ˜¯é€šè¿‡<code>queryUsageStats</code>æŸ¥è¯¢ä¸€æ®µæ—¶é—´å†…çš„Appä½¿ç”¨ä¿¡æ¯ï¼Œç„¶åå¯¹Appçš„æœ€åæ›´æ–°æ—¶é—´è¿›è¡Œæ’åºï¼Œæ—¶é—´æœ€å¤§çš„å°±æ˜¯æ­£åœ¨å‰å°å±•ç¤ºçš„Appã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–UsageStatsé›†åˆ</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;UsageStats&gt;  <span class="title">getUsageStatsList</span><span class="params">(Context context, <span class="keyword">long</span> startTime, <span class="keyword">long</span> endTime)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">        UsageStatsManager manager = (UsageStatsManager) context.getApplicationContext().getSystemService(Context.USAGE_STATS_SERVICE);</span><br><span class="line">        List&lt;UsageStats&gt;  usageStatses = manager.queryUsageStats(UsageStatsManager.INTERVAL_BEST, startTime, endTime);</span><br><span class="line">        <span class="keyword">if</span> (usageStatses == <span class="keyword">null</span> || usageStatses.size() == <span class="number">0</span>) &#123;<span class="comment">// æ²¡æœ‰æƒé™ï¼Œè·å–ä¸åˆ°æ•°æ®</span></span><br><span class="line">            Log.i(<span class="string">&quot;AppUtil getUsageStatsList &quot;</span>, <span class="string">&quot;no permission for UsageStatsManager&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> usageStatses;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹æœ€åæ›´æ–°æ—¶é—´è¿›è¡Œæ’åºè·å–å‰å°App</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> UsageStats <span class="title">getForegroundUsageStats</span><span class="params">(Context context, <span class="keyword">long</span> startTime, <span class="keyword">long</span> endTime)</span> </span>&#123;</span><br><span class="line">    UsageStats usageStatsResult = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">        List&lt;UsageStats&gt; usageStatses = getUsageStatsList(context, startTime, endTime);</span><br><span class="line">        <span class="keyword">if</span> (usageStatses == <span class="keyword">null</span> || usageStatses.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (UsageStats usageStats : usageStatses) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡åå°„è·å–Appçš„äº‹ä»¶ç±»å‹</span></span><br><span class="line">            <span class="keyword">int</span> lastEvent = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Field mLastEventField = UsageStats.class.getField(<span class="string">&quot;mLastEvent&quot;</span>);</span><br><span class="line">                mLastEventField.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                lastEvent = mLastEventField.getInt(usageStats);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (usageStatsResult == <span class="keyword">null</span> || usageStatsResult.getLastTimeUsed() &lt; usageStats.getLastTimeUsed()) &#123;</span><br><span class="line">                usageStatsResult = usageStats;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> usageStatsResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®šæ—¶å‘¨æœŸæ‰§è¡Œä»»åŠ¡"><a href="#å®šæ—¶å‘¨æœŸæ‰§è¡Œä»»åŠ¡" class="headerlink" title="å®šæ—¶å‘¨æœŸæ‰§è¡Œä»»åŠ¡"></a>å®šæ—¶å‘¨æœŸæ‰§è¡Œä»»åŠ¡</h2><p>ç”±äºè¿™åªæ˜¯ä¸ªå‘å¨ƒçš„Appï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥ç®€å•ç²—æš´çš„ä½¿ç”¨å®šæ—¶ä»»åŠ¡æ¥checkå‰å°Appæ˜¯å¦ä¸ºæ‰€è¦ç›‘æ§çš„Appï¼Œè€Œæ²¡æœ‰ä½¿ç”¨å„ç§Triggerã€‚<br>Androidä¸­çš„å®šæ—¶ä»»åŠ¡ä¸»è¦æ˜¯<code>Timer</code>å’Œ<code>AlarmManager</code>ï¼Œæ¨èä½¿ç”¨<code>AlarmManager</code>ï¼Œè€Œä¸”ä¸éœ€è¦ç”³è¯·æƒé™ã€‚</p><p><code>AlarmManager</code>ç»“åˆ<code>Service</code>ä½¿ç”¨ï¼Œåœ¨é«˜ç‰ˆæœ¬çš„sdkä¸­ï¼Œ<code>AlarmManager</code>æ²¡æœ‰é‡å¤æ‰§è¡Œçš„åŠŸèƒ½ï¼Œéœ€è¦åœ¨<code>Service</code>å†æ¬¡è°ƒç”¨<code>AlarmManager</code>ä»è€Œèµ·åˆ°é‡å¤æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ã€‚è€Œä¸”åœ¨é«˜ç‰ˆä¸­ä¸ºäº†èŠ‚çœç”µé‡ä¹Ÿè¿›è¡Œäº†å¾ˆå¤šä¼˜åŒ–ï¼Œè¦æƒ³ç²¾å‡†å‡ºå‘å®šæ—¶å™¨éœ€è¦ä½¿ç”¨<code>setExactAndAllowWhileIdle</code>æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">AlarmManager am = (AlarmManager) context.getSystemService(Context.ALARM_SERVICE);</span><br><span class="line"><span class="comment">// CheckServiceæ˜¯å®šæ—¶å™¨è§¦å‘ä¹‹åè¦å…·ä½“æ‰§è¡Œçš„ä»»åŠ¡é€»è¾‘</span></span><br><span class="line">Intent intent = <span class="keyword">new</span> Intent(context, CheckService.class);</span><br><span class="line">pendingIntent = PendingIntent.getService(context, <span class="number">0</span>, intent, <span class="number">0</span>);</span><br><span class="line"><span class="comment">// AlarmManager.ELAPSED_REALTIME_WAKEUPæ˜¯ä¸ºäº†èƒ½ä¸»åŠ¨å”¤é†’CPU</span></span><br><span class="line">am.setExactAndAllowWhileIdle(AlarmManager.ELAPSED_REALTIME_WAKEUP,</span><br><span class="line">                    SystemClock.elapsedRealtime(), pendingIntent);</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨CheckServiceçš„onStartCommandæ–¹æ³•ä¸­æ‰§è¡Œå®šæ—¶ä»»åŠ¡é€»è¾‘ï¼Œå¹¶ä¸”æ‰§è¡Œå®Œä¹‹åç»§ç»­è®¾ç½®å®šæ—¶å™¨ï¼Œèµ·åˆ°é‡å¤æ‰§è¡Œçš„æ•ˆæœ</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CheckService</span> <span class="keyword">extends</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// checkå‰å°Appæ˜¯å¦ä¸ºéœ€è¦ç›‘æ§çš„Appï¼Œå¦‚æœæ˜¯æ‰§è¡Œç›¸åº”çš„æ“ä½œ</span></span><br><span class="line">        <span class="comment">// å†æ¬¡è°ƒç”¨å®šæ—¶å™¨</span></span><br><span class="line">        am.setExactAndAllowWhileIdle(AlarmManager.ELAPSED_REALTIME_WAKEUP,</span><br><span class="line">                    SystemClock.elapsedRealtime() + TIME_INTERVAL, pendingIntent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸¤æ¬¡è°ƒç”¨å®šæ—¶å™¨çš„ä¸åŒï¼Œåœ¨<code>CheckService</code>ä¸­è°ƒç”¨æ—¶Triggerä¸º<code>SystemClock.elapsedRealtime() + TIME_INTERVAL</code>ï¼Œä»£è¡¨å»¶å<code>TIME_INTERVAL</code>ä¹‹åè§¦å‘ã€‚</p><h2 id="åå°å”¤é†’"><a href="#åå°å”¤é†’" class="headerlink" title="åå°å”¤é†’"></a>åå°å”¤é†’</h2><p>åå°å”¤é†’æ˜¯æŒ‡æ­£åœ¨åå°è¿è¡Œçš„Appç”±äºæŸç§åŸå› è¢«åˆ‡æ¢åˆ°å‰å°ã€‚</p><p>å¦‚æœæ˜¯åœ¨ä½ç‰ˆæœ¬çš„sdkä¸­å¯ä»¥ä½¿ç”¨<code>getRunningTasks</code>ï¼Œæ‹¿åˆ°å¯¹åº”packageçš„taskä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬taskIdï¼Œç„¶åè°ƒç”¨<code>moveTaskToFront</code>æ–¹æ³•å°†å…¶ä»»åŠ¡åˆ‡æ¢åˆ°å‰å°ï¼Œä½†æ˜¯<code>getRunningTasks</code>å·²è¢«æ ‡æ³¨ä¸ºè¿‡æ—¶çš„ï¼Œæ‰€ä»¥åœ¨ä¸Šé¢è·å–å‰å°Appæ—¶ä¹Ÿæ²¡ç”¨è¯¥æ–¹æ³•ã€‚</p><p>è¿™é‡Œä½¿ç”¨äº†æ–°å»ºActivityçš„æ–¹æ³•ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">toRunningForeground</span><span class="params">(String packageNameTarget)</span> </span>&#123;</span><br><span class="line">    PackageManager packageManager = getPackageManager();</span><br><span class="line"></span><br><span class="line">    Intent intent = packageManager.getLaunchIntentForPackage(packageNameTarget);</span><br><span class="line">    intent.addCategory(Intent.CATEGORY_LAUNCHER);</span><br><span class="line">    intent.setFlags(Intent.FLAG_ACTIVITY_RESET_TASK_IF_NEEDED | Intent.FLAG_ACTIVITY_NEW_TASK);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**android.intent.action.MAINï¼šæ‰“å¼€å¦ä¸€ç¨‹åº</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    intent.setAction(<span class="string">&quot;android.intent.action.MAIN&quot;</span>);</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * FLAG_ACTIVITY_SINGLE_TOP:</span></span><br><span class="line"><span class="comment">     * å¦‚æœå½“å‰æ ˆé¡¶çš„activityå°±æ˜¯è¦å¯åŠ¨çš„activity,åˆ™ä¸ä¼šå†å¯åŠ¨ä¸€ä¸ªæ–°çš„activity</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP);</span><br><span class="line">    activity.startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è¸©å‘å®å½•"><a href="#è¸©å‘å®å½•" class="headerlink" title="è¸©å‘å®å½•"></a>è¸©å‘å®å½•</h2><p>ä¸»è¦åŠŸèƒ½å¼€å‘å®Œæˆï¼Œå¹¶åœ¨IDEä¸­æ­£å¸¸è¿è¡Œï¼Œä¸‹é¢å°±è¦å®æœºæµ‹è¯•äº†ï¼Œå‰æ–¹å†°å†·çš„æ´ªæ°´è¿é¢æ‹æ¥ï¼ï¼ï¼</p><p>å°†Appå®‰è£…åˆ°å¹³æ¿ä¸Šä¹‹åï¼Œè¿›è¡Œæµ‹è¯•å‘ç°åº”è¯¥åˆ‡æ¢å€’è®¡æ—¶é¡µé¢æ—¶å¹¶æ²¡æœ‰æ­£å¸¸åˆ‡æ¢ï¼Œäºæ˜¯ä¸‹é¢å°±å¼€å§‹äº†å–ç»ä¹‹åï¼š</p><ol><li>sdkç‰ˆæœ¬ä¸å…¼å®¹<br>å› ä¸ºAndroid sdkå„ç‰ˆæœ¬æœ‰å¯èƒ½ä¸å…¼å®¹ï¼Œæ‰€ä»¥é¦–å…ˆæ€€ç–‘æ˜¯ä¸æ˜¯sdkçš„é—®é¢˜ï¼Œäºæ˜¯åœ¨IDEä¸­è®¾ç½®äº†å¯¹åº”ç‰ˆæœ¬ï¼Œå‘ç°ç¡®å®æ²¡æœ‰ç”Ÿæ•ˆï¼Œäºæ˜¯æœç´¢å¯¹åº”sdkåå°åˆ‡æ¢å‰å°çš„ç›¸å…³é—®é¢˜ï¼Œå‘ç°å¯èƒ½æ˜¯æƒé™é—®é¢˜ï¼Œsdk 29ä¹‹åé™åˆ¶äº†Appçš„ç›¸åº”æƒé™ï¼Œéœ€è¦ç”³è¯·æµ®çª—æƒé™ï¼Œç”³è¯·ä»£ç å¦‚ä¸‹ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">requestOverlayPermission</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">    Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_MANAGE_OVERLAY_PERMISSION);</span><br><span class="line">    context.startActivity(intent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>è·å–å½“å‰App<br>ç”³è¯·ç›¸åº”æƒé™ä¹‹åï¼Œåœ¨IDEä¸­å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œå†æ¬¡éƒ¨ç½²åˆ°å¹³æ¿ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œå‘ç°ä¾ç„¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œç»§ç»­æ’æŸ¥ã€‚<br>åœ¨IDEä¸­å¤šæ¬¡æ’æŸ¥æ—¶å¶ç„¶å‘ç°è·å–å½“å‰Appæ—¶ï¼Œæœ‰æ¬¡æ‹¿åˆ°äº†<code>com.xx.android.launcher</code>ï¼Œä»¥ä¸ºæ˜¯è·å–å‰å°Appä¸å‡†ç¡®åŸå› é€ æˆçš„ï¼Œäºæ˜¯å°±ç”¨äº†å¥½å¤šç§æ–¹æ³•è¿›è¡Œæµ‹è¯•ï¼Œå‘ç°å§‹ç»ˆæœªç”Ÿæ•ˆã€‚ä½†æ˜¯åœ¨çœŸæœºæµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€ä¸ªè§„å¾‹ï¼Œ<strong>åªè¦æ’ä¸Šusbï¼ŒAppå°±è¿è¡Œæ­£å¸¸</strong>ï¼Œåœ¨IDEä¸­æŸ¥çœ‹Appåœ¨å¹³æ¿ä¸Šçš„è¿è¡Œæ—¥å¿—ä¹Ÿæ­£å¸¸ï¼Œå¯æ˜¯æ‹”æ‰usbå°±ä¸ç”Ÿæ•ˆï¼Œä¹Ÿçœ‹ä¸åˆ°å½“æ—¶çš„æ—¥å¿—ï¼Œäºæ˜¯å°±æƒ³æ‰“å°äº›å…³é”®ä¿¡æ¯åœ¨å¹³æ¿ä¸ŠæŸ¥çœ‹è¿›è¡Œæ’æŸ¥é—®é¢˜ã€‚</p></li><li><p>çœŸæœºä¸ŠæŸ¥çœ‹è¿è¡Œæ—¥å¿—<br>çœ‹ä¸€äº›æ—¥å¿—æ•™ç¨‹å¥½å¤æ‚ï¼Œä¸“é—¨æä¸€ä¸‹çœŸçš„ä¸å€¼å¾—å‘€ï¼Œäºæ˜¯æƒ³åˆ°æ˜¯ä¸æ˜¯å¯ä»¥æŠŠå…³ç³»ä¿¡æ¯å†™åˆ°ä¸€ä¸ªå¯è¯»çš„æ–‡ä»¶é‡Œï¼Œäºæ˜¯å°†å…¶å†™å…¥ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeFile</span><span class="params">(Context context, String filename, String filecontent)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    FileOutputStream output = context.openFileOutput(filename, Context.MODE_APPEND);</span><br><span class="line">    output.write(filecontent.getBytes());</span><br><span class="line">    output.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ—¶åªä¼ å…¥æ–‡ä»¶åå°±è¡Œï¼Œé»˜è®¤å†™åˆ°<code>/data/data/app/com.xx/files</code>ç›®å½•ä¸‹ï¼Œå»å¹³æ¿ä¸Šæ‰¾è¿™ä¸ªç›®å½•ï¼Œå´æ²¡æœ‰æ‰¾åˆ°ã€‚ã€‚ã€‚ä¸è¿‡è¿ä¸Šusbå¯ä»¥åœ¨IDEçš„<code>Device File Explorer</code>ä¸­æ‰¾åˆ°ï¼Œäºæ˜¯å†æ¬¡çš„æµ‹è¯•æµç¨‹å°±æ˜¯æ‹”æ‰usbè¿›è¡Œæµ‹è¯•ï¼Œç„¶åè¿ä¸Šusbè¿›è¡Œæ–‡ä»¶æŸ¥çœ‹è¿è¡Œä¿¡æ¯ã€‚</p></li><li><p>æ€€ç–‘AlarmMangeråœ¨åå°ä¸ç”Ÿæ•ˆ<br>æŸ¥çœ‹Appå†™å…¥æ–‡ä»¶çš„ä¿¡æ¯ä¹‹åï¼Œå‘ç°å®šæ—¶å™¨åªæ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨äº†ï¼Œéšåçš„å®šæ—¶å™¨å¹¶æœªè§¦å‘ã€‚<br>åœ¨ä½¿ç”¨<code>AlarmManger</code>æ—¶ä¹Ÿæ²¡æœ‰è¦æ±‚ç”³è¯·ä»€ä¹ˆæƒé™ï¼Œæœç´¢ä¹‹åä¹Ÿæ²¡æœ‰æ‰¾åˆ°ä»»ä½•çº¿ç´¢ï¼Œäºæ˜¯èµ„æºä¸€äº›ä¸“ä¸šäººå£«ï¼Œæœ‹å‹è¯´å¯èƒ½æ˜¯å®šæ—¶å™¨è§¦å‘é—´éš”æ—¶é—´å¤ªçŸ­ï¼Œç³»ç»Ÿç»™ä¼˜åŒ–äº†ï¼Œå¹¶é™„ä¸Šäº†æºç ä¸­çš„æ–¹æ³•æ³¨é‡Šï¼Œå¯ä¿¡åº¦å¾ˆé«˜å‘€ï¼Œæˆ‘ä¹Ÿå¾ˆå¼€å¿ƒï¼Œè¦æå®šäº†ï¼Œå¯æ˜¯ä¿®æ”¹å®‰è£…ä¹‹åä¾ç„¶æ˜¯æš´å‡»å‘€ã€‚</p></li></ol><p>æ­¤æ—¶çœŸçš„é™·å…¥äº†æ­»èƒ¡åŒï¼Œæ²¡æœ‰ä»»ä½•çº¿ç´¢ï¼Œä¸€è¿å¥½å‡ å¤©æ²¡æœ‰ä»»ä½•è¿›å±•ï¼Œå¶ç„¶åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹åº”ç”¨æƒé™çš„æ—¶å€™ï¼Œæƒ³åˆ°æ˜¯ä¸æ˜¯å¹³æ¿è‡ªåŠ¨å¯åœçš„åŸå› ï¼Œäºæ˜¯å°†Appçš„è‡ªåŠ¨ç®¡ç†åˆ‡æ¢ä¸ºæ‰‹åŠ¨ç®¡ç†ï¼Œå†æ¬¡è¿›è¡Œæµ‹è¯•ï¼Œç”Ÿæ•ˆäº†ã€‚</p><p>å¤ªè‰°è¾›äº†ï¼Œä¸ºäº†å‘ä¸ªå¨ƒå¤ªä¸å®¹æ˜“äº†ã€‚ã€‚ã€‚</p><p>è¿™ä¸ªAppç›®å‰åªæ˜¯å¤„äºåŸå§‹ç¤¾ä¼šç‰ˆï¼Œå¸Œæœ›æœ‰èƒ½åŠ›çš„çŒ¿çˆ¸ä»¬åŠ å…¥ï¼Œæˆ‘ä»¬ä¸€èµ·å°†å…¶å®Œå–„ï¼Œå¸®åŠ©ä¸‹ä¸€ä»£å…»æˆä¸€ä¸ªå¥½çš„è‡ªå¾‹èƒ½åŠ›ï¼Œæ­¤Appå·²åœ¨githubä¸Šå¼€æºï¼Œæ¬¢è¿è´¡çŒ®ï¼Œé¡¹ç›®åœ°å€<a href="https://github.com/hunshenshi/timeup.git">https://github.com/hunshenshi/timeup.git</a></p><h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>å…¶å®å†™è¿™ä¸ªAppå¹¶ä¸å®Œå…¨æ˜¯ä¸ºäº†å®Œå…¨é˜»æ­¢ä»–ç©å¹³æ¿ï¼Œåªæ˜¯ä¸ºäº†åŸ¹å…»ä»–è§£å†³é—®é¢˜ï¼Œå–„äºæ€è€ƒçš„èƒ½åŠ›ï¼Œè®©ä»–çŸ¥é“å¦‚ä½•å»è¾¾åˆ°è‡ªå·±çš„ç›®çš„ã€‚å› ä¸ºè¿™ä¸ªAppæœ¬èº«æ¯”è¾ƒç®€å•ï¼Œå¯èƒ½åªèƒ½é˜»æ­¢ä»–å‡ å¤©ï¼Œç„¶åä»–ä¼šå‘ç°è¿™ä¸ªAppçš„é€»è¾‘æ¼æ´ï¼Œç„¶åæˆ‘å†æƒ³åŠæ³•æŠŠè¿™ä¸ªæ¼æ´å µä¸Šï¼Œç»§ç»­ç­‰å¾…ä»–å‘ç°æ–°çš„æ¼æ´ï¼Œå¸Œæœ›åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­èƒ½åŸ¹å…»ä»–çš„å¥½å¥‡æ¬²ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;çŒ¿çˆ¸ï¼šå±å­©ï¼Œå·²ç»çœ‹äº†å¾ˆé•¿xxäº†ï¼Œè¯¥è®©çœ¼ç›ä¼‘æ¯ä¸‹äº†ã€‚&lt;br&gt;å±å­©ï¼šä¸æƒ…ä¸æ„¿çš„å…³äº†ï¼Œå»ç©åˆ«çš„ã€‚&lt;br&gt;å¾ˆå’Œè°æ˜¯ä¸æ˜¯ï¼Ÿå½“ä½ ä¸åœ¨å®¶çš„æ—¶å€™ï¼Œå±å­©å°±æ²¡è¿™ä¹ˆä¹–äº†ï¼Œæ˜¯ä¸æ˜¯ï¼Œè®¤åŒä¸ï¼Ÿ&lt;br&gt;è¿™æ—¶å°±éœ€è¦æœ‰ä¸€ä¸ªå¼ºåŠ¿çš„â€œäººâ€æ¥é˜»æ­¢ä»–ï¼Œè¿™ä¸ªå¯åˆ«å¥¢æœ›è€äººæ¥é˜»æ­¢ä»–ï¼Œäºæ˜¯åªèƒ½è®©â€œæœºå™¨äººâ€æ¥æäº†ã€‚&lt;/p&gt;
&lt;p&gt;äºæ˜¯æäº†ä¸ªAppï¼Œåå­—å«&lt;strong&gt;å‘å¨ƒç¥å™¨&lt;/strong&gt;ï¼ˆä¸çŸ¥é“è‹¥å¹²å¹´åï¼Œå±å­©çœ‹åˆ°è¿™ä¸ªæ–‡ç« å¿ƒé‡Œæ˜¯ä»€ä¹ˆæ»‹å‘³ã€‚ã€‚ã€‚ï¼‰ï¼ŒåŠŸèƒ½æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç›‘æ§æŒ‡å®šappçš„æ´»åŠ¨çŠ¶æ€ï¼Œå¦‚æœè¿ç»­è¿è¡Œä¸€æ®µæ—¶é—´ï¼Œå‘å¨ƒç¥å™¨å°±ä¼šè‡ªåŠ¨ä»åå°åˆ‡åˆ°å‰å°è¿›è¡Œå€’è®¡æ—¶ï¼Œå€’è®¡æ—¶ç»“æŸä¹‹åå¯ä»¥ç»§ç»­å¨±ä¹ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªAppç›®å‰åªæ˜¯å¤„äºåŸå§‹ç¤¾ä¼šç‰ˆï¼Œå¸Œæœ›æœ‰èƒ½åŠ›çš„çŒ¿çˆ¸ä»¬åŠ å…¥ï¼Œæˆ‘ä»¬ä¸€èµ·å°†å…¶å®Œå–„ï¼Œå¸®åŠ©ä¸‹ä¸€ä»£å…»æˆä¸€ä¸ªå¥½çš„è‡ªå¾‹èƒ½åŠ›ï¼Œæ­¤Appå·²åœ¨githubä¸Šå¼€æºï¼Œæ¬¢è¿è´¡çŒ®ï¼Œé¡¹ç›®åœ°å€&lt;a href=&quot;https://github.com/hunshenshi/timeup.git&quot;&gt;https://github.com/hunshenshi/timeup.git&lt;/a&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="tool" scheme="http://yuanba.tech/categories/tool/"/>
    
    
    <category term="android" scheme="http://yuanba.tech/tags/android/"/>
    
    <category term="app" scheme="http://yuanba.tech/tags/app/"/>
    
    <category term="é˜²æ²‰è¿·" scheme="http://yuanba.tech/tags/%E9%98%B2%E6%B2%89%E8%BF%B7/"/>
    
    <category term="ç”Ÿæ´»" scheme="http://yuanba.tech/tags/%E7%94%9F%E6%B4%BB/"/>
    
  </entry>
  
  <entry>
    <title>elasticsearchè¿ç»´è¸©å‘</title>
    <link href="http://yuanba.tech/elasticsearch-op.html"/>
    <id>http://yuanba.tech/elasticsearch-op.html</id>
    <published>2020-08-03T03:33:12.000Z</published>
    <updated>2020-08-03T03:33:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ¥è§¦ESä¹Ÿå°åŠå¹´äº†ï¼ŒESè™½ç„¶ä½¿ç”¨æ–¹ä¾¿ï¼Œè¿ç»´ç®€å•ä½†æ˜¯é›†ç¾¤è§„æ¨¡å’Œæ•°æ®é‡å¤§çš„è¯è¿ç»´ä¹Ÿå¾ˆå¤´ç–¼ï¼Œè¿™é‡Œæ¢³ç†ä¸‹è¿™åŠå¹´çš„è¿ç»´ç»éªŒã€‚</p><span id="more"></span><h2 id="ç£ç›˜å‘"><a href="#ç£ç›˜å‘" class="headerlink" title="ç£ç›˜å‘"></a>ç£ç›˜å‘</h2><p>é›†ç¾¤éšç€ä½¿ç”¨ï¼Œæ•°æ®ä¼šç§¯ç´¯è¶Šæ¥è¶Šå¤šï¼Œç£ç›˜æ¶ˆè€—ä¹Ÿä¼šè¶Šæ¥è¶Šå¤§ï¼Œæ­¤æ—¶ä¸ºäº†ä¿æŠ¤æŸä¸ªç£ç›˜è¢«å†™æ»¡ï¼Œéœ€è¦ç»™ç£ç›˜è®¾ç½®é˜ˆå€¼ï¼Œé…ç½®é¡¹ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç£ç›˜ä½¿ç”¨è¶…è¿‡æ­¤å€¼ï¼Œå°†ä¸å†æ¥å—shardçš„å‡è¡¡ï¼Œåªæ¥å—ä¸»shardçš„å†™å…¥</span></span><br><span class="line">cluster.routing.allocation.disk.watermark.low</span><br><span class="line"><span class="comment"># ç£ç›˜ä½¿ç”¨è¶…è¿‡æ­¤å€¼ï¼Œç£ç›˜ä¸Šçš„shardå¼€å§‹å‘å…¶ä»–ç£ç›˜è¿ç§»ï¼Œé‡Šæ”¾ç£ç›˜ç©ºé—´</span></span><br><span class="line">cluster.routing.allocation.disk.watermark.high</span><br><span class="line"><span class="comment"># ç£ç›˜ä½¿ç”¨è¶…è¿‡æ­¤å€¼ï¼ŒèŠ‚ç‚¹å°†ä¸å†æä¾›æœåŠ¡</span></span><br><span class="line">cluster.routing.allocation.disk.watermark.flood_stage</span><br></pre></td></tr></table></figure><p>é…ç½®é¡¹å€¼çš„é»˜è®¤å½¢å¼æ˜¯ç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹å€¼ã€‚<br>å¦‚æœé›†ç¾¤è¿›è¡Œäº†æ‰©å®¹ï¼Œå„ä¸ªæœºå™¨çš„ç£ç›˜å¤§å°ä¸ä¸€ï¼Œæ­¤æ—¶ä¾ç„¶ä½¿ç”¨ç™¾åˆ†æ¯”çš„è¯å¯¹ç£ç›˜å¤§æœºå™¨å°±ä¼šé€ æˆå­˜å‚¨ç©ºé—´æµªè´¹ï¼Œå°†ç™¾åˆ†æ¯”æ”¹ä¸ºç»å¯¹å€¼å¯ä»¥å……åˆ†ä½¿ç”¨å„ä¸ªä¸åŒå¤§å°çš„ç£ç›˜ã€‚</p><h2 id="shardé‡æ–°åˆ†é…"><a href="#shardé‡æ–°åˆ†é…" class="headerlink" title="shardé‡æ–°åˆ†é…"></a>shardé‡æ–°åˆ†é…</h2><p>é›†ç¾¤ä¸­æŸä¸ªDataNodeå®ä¾‹æŒ‚æ‰æˆ–è€…é›†ç¾¤ä¸­æŸä¸ªç£ç›˜çš„ä½¿ç”¨ç‡è¾¾åˆ°ä¸Šçº¿ï¼Œå°±éœ€è¦å¯¹shardè¿›è¡Œé‡æ–°åˆ†é…ï¼Œæœ‰å‡ ä¸ªé…ç½®é¡¹å¯ä»¥å¯¹å…¶è°ƒæ•´ï¼ŒåŠ å¿«åˆ†é…çš„é€Ÿåº¦ï¼Œé…ç½®é¡¹ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å®ä¾‹ç”¨æ¥æ§åˆ¶æ¥æ”¶å’Œåˆ†å‘shardçš„çº¿ç¨‹æ•°</span></span><br><span class="line">cluster.routing.allocation.node_concurrent_recoveries</span><br><span class="line"><span class="comment"># æ§åˆ¶ä»æœ¬åœ°æ¢å¤ä¸»åˆ†ç‰‡çš„çº¿ç¨‹æ•°</span></span><br><span class="line">cluster.routing.allocation.node_initial_primaries_recoveries</span><br></pre></td></tr></table></figure><p><code>node_concurrent_recoveries</code>ä¸å®œè®¾ç½®çš„å¤ªå¤§ï¼Œå¦‚æœé›†ç¾¤è§„æ¨¡æ²¡æœ‰è¶…è¿‡ç™¾å°ï¼Œè®¾ç½®ä¸ºDataNodeå®ä¾‹ä¸ªæ•°çš„ä¸€åŠå³å¯ã€‚<br><code>node_initial_primaries_recoveries</code>æ­¤å€¼å¯æ ¹æ®æœºå™¨é…ç½®è¿›è¡Œè®¾ç½®å³å¯ã€‚</p><h2 id="é‡å¯å‘"><a href="#é‡å¯å‘" class="headerlink" title="é‡å¯å‘"></a>é‡å¯å‘</h2><p>å½“é›†ç¾¤å®ä¾‹å®•æœºå‡ºç°é›ªå´©æ— æ³•æ¢å¤æ—¶ï¼Œéœ€è¦é‡å¯é›†ç¾¤è¿›è¡Œæ¢å¤ã€‚ä½†æ˜¯ç”±äºESé‡å¯ä¹‹åéœ€è¦åŠ è½½æ‰€æœ‰ç´¢å¼•çš„shardä¹‹åé›†ç¾¤æ‰å¯æ­£å¸¸ä½¿ç”¨ï¼Œè€ŒESä¼šè‡ªåŠ¨å¯¹ç´¢å¼•shardæ ¹æ®ç°æœ‰çš„é›†ç¾¤çŠ¶æ€å¯¹shardè¿›è¡Œé‡åˆ†é…ï¼Œè¿™ä¸ªåˆ†é…è¿‡ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶è€Œä¸”é’ˆå¯¹<strong>é›†ç¾¤é‡å¯</strong>çš„åœºæ™¯æ˜¯æ²¡æœ‰æ„ä¹‰çš„ï¼Œå› ä¸ºé›†ç¾¤åªæ˜¯é‡å¯ï¼Œshardå¹¶æ²¡æœ‰ä¸¢å¤±ã€‚<br>æ‰€ä»¥åœ¨é›†ç¾¤é‡å¯ä¹‹æ—¶å¯ä»¥å°†<code>cluster.routing.allocation.enable</code>è®¾ç½®ä¸ºnoneï¼Œç­‰æ‰€æœ‰çš„DataNodeå®ä¾‹å¯åŠ¨ä¹‹åå†å°†å…¶è®¾ç½®ä¸ºallã€‚</p><h2 id="å¤§æŸ¥è¯¢"><a href="#å¤§æŸ¥è¯¢" class="headerlink" title="å¤§æŸ¥è¯¢"></a>å¤§æŸ¥è¯¢</h2><p>æ•°æ®æŸ¥è¯¢é‡å¤§ï¼Œä¼šè§¦å‘ESçš„å†…å­˜ä¿æŠ¤æœºåˆ¶è¿›è¡Œç†”æ–­ï¼Œå¯ä»¥å¢åŠ å•ç‹¬çš„æŸ¥è¯¢å®¢æˆ·ç«¯ï¼Œå¹¶å¢åŠ å®¢æˆ·ç«¯å®ä¾‹çš„å†…å­˜ã€‚éšåè®¾ç½®é›†ç¾¤é…ç½®ï¼Œé…ç½®é¡¹ä¸ºï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># </span></span><br><span class="line">indices.breaker.total.limit</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">indices.breaker.fielddata.limit</span><br><span class="line"><span class="comment"># </span></span><br><span class="line">indices.breaker.request.limit</span><br></pre></td></tr></table></figure><h2 id="æ’æŸ¥é—®é¢˜å·¥å…·"><a href="#æ’æŸ¥é—®é¢˜å·¥å…·" class="headerlink" title="æ’æŸ¥é—®é¢˜å·¥å…·"></a>æ’æŸ¥é—®é¢˜å·¥å…·</h2><ul><li>é›†ç¾¤çŠ¶æ€å‘ç”Ÿå˜åŒ–<ul><li>ä½¿ç”¨å‘½ä»¤<code>ip:9200/_cluster/health?pretty</code>æŸ¥è¯¢é›†ç¾¤çŠ¶æ€ï¼Œå¦‚æœé›†ç¾¤çŠ¶æ€å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯ä»¥ä»ä¸­åˆ†æåŸå› </li></ul></li><li>èŠ‚ç‚¹æ­£å¸¸ï¼Œä½†æ˜¯é›†ç¾¤çŠ¶æ€ä¸æ˜¯green<ul><li>ä½¿ç”¨å‘½ä»¤<code>ip:9200/_cat/indices?v</code>ï¼Œæ­¤å‘½ä»¤ä¼šè¿”å›æ‰€æœ‰ç´¢å¼•çš„çŠ¶æ€ï¼Œæ‰¾åˆ°égreençš„ç´¢å¼•ï¼Œç„¶åå…·ä½“åˆ†æã€‚</li></ul></li><li>æŸ¥è¯¢åˆ†ç‰‡å¤±è´¥åŸå› <ul><li>å‘½ä»¤<code>ip:9200/_cluster/allocation/explain</code></li></ul></li><li>æŸ¥è¯¢ç´¢å¼•åˆ†ç‰‡çŠ¶æ€<ul><li>å‘½ä»¤<code>ip:9200/_cat/shards/index_name?v</code></li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ¥è§¦ESä¹Ÿå°åŠå¹´äº†ï¼ŒESè™½ç„¶ä½¿ç”¨æ–¹ä¾¿ï¼Œè¿ç»´ç®€å•ä½†æ˜¯é›†ç¾¤è§„æ¨¡å’Œæ•°æ®é‡å¤§çš„è¯è¿ç»´ä¹Ÿå¾ˆå¤´ç–¼ï¼Œè¿™é‡Œæ¢³ç†ä¸‹è¿™åŠå¹´çš„è¿ç»´ç»éªŒã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="bigdata" scheme="http://yuanba.tech/categories/bigdata/"/>
    
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="ElasticSearch" scheme="http://yuanba.tech/tags/ElasticSearch/"/>
    
    <category term="è¿ç»´" scheme="http://yuanba.tech/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>golangæŒ‡é’ˆ*å’Œå–å€&amp;å‚»å‚»åˆ†ä¸æ¸…æ¥š</title>
    <link href="http://yuanba.tech/golang-point-address.html"/>
    <id>http://yuanba.tech/golang-point-address.html</id>
    <published>2020-05-03T09:24:05.000Z</published>
    <updated>2020-05-03T15:33:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>golangä¸­æœ‰æŒ‡é’ˆçš„æ¦‚å¿µï¼Œæœ‰æŒ‡é’ˆç›¸å¯¹çš„å°±æœ‰å–å€ï¼Œä½•æ—¶ä½¿ç”¨æŒ‡é’ˆä½•æ—¶ä½¿ç”¨å–å€å¯¹äºåˆšæ¥è§¦çš„åŒå­¦æ€»æ˜¯æœ‰ç‚¹å‚»å‚»åˆ†ä¸æ¸…æ¥šã€‚<br>æœ¬ç¯‡ä¸»è¦ä»‹ç»ä¸‹æŒ‡é’ˆå’Œå–å€çš„æ¦‚å¿µå’ŒåŒºåˆ«ã€‚</p><span id="more"></span><p>æŒ‡é’ˆç±»ä¼¼äºå˜é‡å’Œå¸¸é‡ï¼Œåœ¨ä½¿ç”¨æŒ‡é’ˆå‰ä½ éœ€è¦å£°æ˜æŒ‡é’ˆã€‚æŒ‡é’ˆå£°æ˜æ ¼å¼å¦‚ä¸‹ï¼š<code>var name *Type</code>ã€‚<br>æŒ‡é’ˆæ˜¯æŒ‡å‘ä¸€ä¸ª<strong>å€¼çš„å†…å­˜åœ°å€</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡é’ˆå˜é‡å­˜æ”¾çš„æ˜¯æŸä¸ªå€¼æˆ–è€…å¯¹è±¡çš„<strong>å†…å­˜åœ°å€</strong>ï¼Œå³æŒ‡é’ˆå˜é‡å ç”¨å­—èŠ‚çš„å¤§å°ä¸æ‰€æŒ‡å‘çš„å€¼çš„å¤§å°æ— å…³ã€‚<em>å½“ä¸€ä¸ªæŒ‡é’ˆè¢«å®šä¹‰åæ²¡æœ‰åˆ†é…åˆ°ä»»ä½•å˜é‡æ—¶ï¼Œå®ƒçš„é»˜è®¤å€¼ä¸ºnilã€‚</em></p><p>æŒ‡é’ˆå˜é‡å­˜æ”¾çš„æ˜¯ä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€ï¼Œé‚£å¦‚ä½•è·å–ä¸€ä¸ªå˜é‡çš„å†…å­˜åœ°å€å‘¢ï¼Ÿé‚£å°±éœ€è¦ä½¿ç”¨å–å€ç¬¦å·<code>&amp;</code>ã€‚<br>å°†ä¸€ä¸ªå€¼çš„å†…å­˜åœ°å€é€šè¿‡<code>&amp;</code>èµ‹å€¼ç»™äº†æŒ‡é’ˆï¼Œé‚£åˆåº”è¯¥å¦‚ä½•é€šè¿‡æŒ‡é’ˆæ¥è¯»å–å¯¹åº”çš„å€¼ï¼Ÿéœ€è¦ä½¿ç”¨ç¬¦å·<code>*</code>ï¼Œéœ€è¦ä¸æŒ‡é’ˆå£°æ˜æ—¶çš„<code>*</code>è¿›è¡ŒåŒºåˆ«ã€‚</p><p>çœ‹ä¸ªä»£ç æ„Ÿå—ä¸‹å§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªæŒ‡é’ˆ</span></span><br><span class="line"><span class="keyword">var</span> addr *<span class="keyword">string</span></span><br><span class="line"><span class="keyword">var</span> house = <span class="string">&quot;Malibu Point 10880, 90265&quot;</span></span><br><span class="line"><span class="comment">// é€šè¿‡&amp;å°†ä¸€ä¸ªå˜é‡çš„å†…å­˜åœ°å€èµ‹å€¼ç»™æŒ‡é’ˆ</span></span><br><span class="line">addr = &amp;house</span><br><span class="line"><span class="comment">// é€šè¿‡*è·å–æŒ‡é’ˆä¸­å­˜å‚¨çš„åœ°å€å¯¹åº”çš„å€¼</span></span><br><span class="line">value := *addr</span><br><span class="line">fmt.Printf(<span class="string">&quot;addr type: %T\n&quot;</span>, addr)</span><br><span class="line"><span class="comment">// è¾“å‡ºæŒ‡é’ˆå­˜å‚¨çš„å†…å­˜åœ°å€ï¼Œä¹Ÿå°±æ˜¯houseçš„å†…å­˜åœ°å€</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;address: %p\n&quot;</span>, addr)</span><br><span class="line"><span class="comment">// è¾“å‡ºaddrè‡ªèº«çš„å†…å­˜åœ°å€</span></span><br><span class="line">fmt.Printf(<span class="string">&quot;address: %p\n&quot;</span>, &amp;addr)</span><br><span class="line">fmt.Printf(<span class="string">&quot;value type: %T\n&quot;</span>, value)</span><br><span class="line">fmt.Printf(<span class="string">&quot;value: %s\n&quot;</span>, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// addr type: *string</span></span><br><span class="line"><span class="comment">// address: 0xc000010200</span></span><br><span class="line"><span class="comment">// address: 0xc00000e028</span></span><br><span class="line"><span class="comment">// value type: string</span></span><br><span class="line"><span class="comment">// value: Malibu Point 10880, 90265</span></span><br></pre></td></tr></table></figure><p>ä»£ç å…ˆé€šè¿‡æŒ‡é’ˆå£°æ˜æ–¹å¼å£°æ˜äº†ä¸€ä¸ª<code>addr</code>æŒ‡é’ˆï¼Œåˆé€šè¿‡å–å€ç¬¦å·<code>&amp;</code>å°†houseçš„åœ°å€èµ‹å€¼ç»™<code>addr</code>ï¼Œç„¶ååˆé€šè¿‡<code>*</code>å°†æŒ‡é’ˆ<code>addr</code>å­˜å‚¨å†…å­˜åœ°å€å¯¹åº”çš„å€¼èµ‹å€¼ç»™æ™®é€šå˜é‡<code>value</code>ã€‚ç”±äºæŒ‡é’ˆ<code>addr</code>å˜é‡å­˜å‚¨çš„æ˜¯å˜é‡<code>house</code>çš„å†…å­˜åœ°å€ï¼Œæ‰€ä»¥è¾“å‡ºçš„<code>addr</code>çš„å€¼ä¸ºä¸€ä¸ªå†…å­˜åœ°å€ï¼Œè€Œåˆå› ä¸ºæŒ‡é’ˆ<code>addr</code>æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªå†…å­˜å—æ¥å­˜å‚¨è‡ªå·±ï¼Œæ‰€ä»¥é€šè¿‡å–å€ç¬¦å·<code>&amp;</code>å¾—åˆ°çš„åœ°å€æ˜¯æŒ‡é’ˆå˜é‡çš„å†…å­˜åœ°å€ã€‚</p><p>åˆçœ‹ä¸Šé¢çš„ä»£ç ï¼Œå¯¹å…¶ä¸­çš„<code>*</code>å’Œ<code>&amp;</code>æ˜¯ä¸æ˜¯å‚»å‚»åˆ†ä¸æ¸…æ¥šã€‚<code>&amp;</code>åŠŸèƒ½æ¯”è¾ƒå•ä¸€ï¼Œå°±æ˜¯å–å€ï¼Œè·å–å˜é‡çš„å†…å­˜åœ°å€ã€‚<code>*</code>æœ‰<em>ä¸¤ç§å«ä¹‰</em>ï¼Œç¬¬ä¸€ç§æ˜¯åœ¨æŒ‡é’ˆå£°æ˜æ—¶è·Ÿåœ¨å˜é‡çš„åé¢ï¼Œç´§è·Ÿå˜é‡ç±»å‹ï¼Œä»£è¡¨è¯¥å˜é‡æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œå¦‚æœä½¿ç”¨<code>%p</code>æ¥è¾“å‡ºçš„è¯ï¼Œå®ƒå°†æ˜¯ä¸€ä¸ª16è¿›åˆ¶æ•°ï¼Œç¬¬äºŒç§æ˜¯ç´§è·ŸæŒ‡é’ˆå˜é‡ï¼Œå‡ºç°åœ¨æŒ‡é’ˆå˜é‡çš„å‰é¢ï¼Œä»£è¡¨è·å–è¯¥æŒ‡é’ˆå­˜å‚¨å†…å­˜åœ°å€çš„å€¼ï¼Œä¸€èˆ¬æ˜¯ä¸€ä¸ªå’ŒæŒ‡é’ˆç±»å‹ä¸€è‡´çš„å˜é‡æˆ–è€…å¸¸é‡ã€‚åœ¨ä¸Šé¢çš„demoä»£ç ä¸­éƒ½æœ‰ä½“ç°ã€‚</p><blockquote><p>Tips<br>goä¸­ä½•æ—¶ä½¿ç”¨æŒ‡é’ˆï¼Ÿ</p></blockquote><ul><li>å½“ç»“æ„ä½“è¾ƒå¤§çš„æ—¶å€™ä½¿ç”¨æŒ‡é’ˆä¼šæ›´é«˜æ•ˆï¼Œå¯ä»¥é¿å…å†…å­˜æ‹·è´</li><li>å¦‚æœè¦ä¿®æ”¹ç»“æ„ä½“å†…éƒ¨çš„æ•°æ®æˆ–çŠ¶æ€å¿…é¡»ä½¿ç”¨æŒ‡é’ˆ</li><li>å¦‚æœæ–¹æ³•çš„receiveræ˜¯mapã€slice ã€channelç­‰å¼•ç”¨ç±»å‹ä¸è¦ä½¿ç”¨æŒ‡é’ˆ</li><li>å¦‚æœè¯¥å‡½æ•°éœ€è¦å°†ä¼ å…¥å˜é‡çš„ä¿®æ”¹çŠ¶æ€ä¼ é€’å‡ºå»ï¼Œå¯ä»¥ä½¿ç”¨æŒ‡é’ˆ</li></ul><!--åˆ‡ç‰‡sliceã€å­—å…¸mapã€ç®¡é“channelå¼•ç”¨ç±»å‹çš„ç‰¹ç‚¹æ˜¯ï¼šå˜é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€å¯¹åº”çš„ç©ºé—´é‡Œæ‰æ˜¯çœŸæ­£å­˜å‚¨çš„å€¼ï¼Œå†…å­˜é€šå¸¸åœ¨å †ä¸­åˆ†é…golangä¸­åˆ°åº•æœ‰æ²¡æœ‰å¼•ç”¨ç±»å‹æŒ‰ç…§Golangçš„è¯´æ³•,Golangä¸­æ‰€æœ‰çš„ç±»å‹éƒ½æ˜¯å±äºå€¼ç±»å‹,ä½†æ˜¯æœ‰å‡ ä¸ªç±»å‹æ¯”è¾ƒç‰¹æ®Š,è¡¨ç°å‡ºå¼•ç”¨ç±»å‹çš„ç‰¹å¾go life, golang[å¤Ÿæµª]unsafeæ˜¯ä»€ä¹ˆå¼•ç”¨ç±»å‹ æ˜¯ä»€ä¹ˆï¼Œ å€¼ç±»å‹å¼•ç”¨ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿgolangä¸­æ˜¯å¦æœ‰å¼•ç”¨ç±»å‹ï¼ŸGoè¯­è¨€ä¸­æœ‰4ä¸ªç±»å‹æ¯”è¾ƒç‰¹åˆ«ï¼Œçœ‹èµ·æ¥åƒå¼•ç”¨ç±»å‹å¼•ç”¨ç±»å‹ ä¸ å¼•ç”¨è¯­ä¹‰å¼•ç”¨ï¼šå°±æ˜¯å˜é‡çš„ä¸€ä¸ªåˆ«åã€‚java å¼•ç”¨å˜é‡-->]]></content>
    
    
    <summary type="html">&lt;p&gt;golangä¸­æœ‰æŒ‡é’ˆçš„æ¦‚å¿µï¼Œæœ‰æŒ‡é’ˆç›¸å¯¹çš„å°±æœ‰å–å€ï¼Œä½•æ—¶ä½¿ç”¨æŒ‡é’ˆä½•æ—¶ä½¿ç”¨å–å€å¯¹äºåˆšæ¥è§¦çš„åŒå­¦æ€»æ˜¯æœ‰ç‚¹å‚»å‚»åˆ†ä¸æ¸…æ¥šã€‚&lt;br&gt;æœ¬ç¯‡ä¸»è¦ä»‹ç»ä¸‹æŒ‡é’ˆå’Œå–å€çš„æ¦‚å¿µå’ŒåŒºåˆ«ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="golang" scheme="http://yuanba.tech/categories/golang/"/>
    
    
    <category term="go" scheme="http://yuanba.tech/tags/go/"/>
    
    <category term="golang" scheme="http://yuanba.tech/tags/golang/"/>
    
    <category term="æŒ‡é’ˆ" scheme="http://yuanba.tech/tags/%E6%8C%87%E9%92%88/"/>
    
    <category term="å–å€" scheme="http://yuanba.tech/tags/%E5%8F%96%E5%9D%80/"/>
    
  </entry>
  
  <entry>
    <title>golangéšæ³¢é€æµä¹‹cache2goçŸ¥è¯†ç‚¹è§£è¯»</title>
    <link href="http://yuanba.tech/golang-cache2go-sec.html"/>
    <id>http://yuanba.tech/golang-cache2go-sec.html</id>
    <published>2020-04-13T16:17:00.000Z</published>
    <updated>2020-05-03T09:22:39.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://bigdatadecode.top/golang-cache2go-src.html">ä¸Šç¯‡</a>ä»‹ç»äº†cache2goçš„ä»£ç é€»è¾‘ï¼Œæ¢³ç†ä»£ç é€»è¾‘æ—¶ä¹Ÿèƒ½ä»ä¸­äº†è§£golangçš„ä¸€äº›è¯­æ³•ä»¥åŠä½¿ç”¨æŠ€å·§ï¼Œæœ¬ç¯‡é›†ä¸­å°†æºç ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹æ¢³ç†ä¸‹ã€‚</p><span id="more"></span><h2 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h2><blockquote><p>ç»“æ„ä½“</p></blockquote><p>åœ¨mycachedapp.goæ–‡ä»¶ä¸­ï¼Œçœ‹åˆ°çš„ç¬¬ä¸€è¡Œæœ‰æ•ˆä»£ç æ˜¯<code>type myStruct struct</code>ï¼Œæ„Ÿè§‰æœ‰ç‚¹åƒCè¯­è¨€ä¸­çš„ç»“æ„ä½“ã€‚<br>è¿™ä¸ªè¯­å¥å—å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œç»“æ„ä½“æ˜¯golangä¸­ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ç‚¹ï¼ŒåŠŸèƒ½ç±»ä¼¼äºJAVAä¸­çš„ç±»ã€‚</p><p>ä½¿ç”¨<code>type xName struct&#123;&#125;</code>å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œmycachedapp.goä¸­ç»“æ„ä½“ç›¸å…³çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> myStruct <span class="keyword">struct</span> &#123;</span><br><span class="line">text     <span class="keyword">string</span></span><br><span class="line">moreData []<span class="keyword">byte</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®åŠ›åŒ–myStructçš„å¯¹è±¡</span></span><br><span class="line">val := myStruct&#123;<span class="string">&quot;This is a test!&quot;</span>, []<span class="keyword">byte</span>&#123;&#125;&#125;</span><br></pre></td></tr></table></figure><!-- // åŒºåˆ«ï¼Œvalç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆï¼Œä¸€ä¸ªå¼•ç”¨ç±»å‹val := &myStruct{"This is a test!", []byte{}}--><p>ä¸Šè¿°ä»£ç å£°æ˜äº†ä¸€ä¸ªåå­—ä¸º<code>myStruct</code>çš„ç»“æ„ä½“ï¼Œå…¶æˆå‘˜å˜é‡ä¸º<code>string</code>ç±»å‹çš„<code>text</code>å’Œ<code>byte</code>ç±»å‹çš„æ•°ç»„<code>moreData</code>ã€‚<br>ç´§ç€è¿™åˆå§‹åŒ–äº†ä¸€ä¸ª<code>myStruct</code>å¯¹è±¡å¹¶åœ¨åˆå§‹åŒ–æ—¶å¯¹æˆå‘˜å˜é‡èµ‹å€¼ï¼Œé»˜è®¤æ˜¯æŒ‰ç…§å˜æˆå£°æ˜çš„é¡ºåºä¾æ¬¡èµ‹å€¼ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºçš„æŒ‡å®šå˜é‡è¿›è¡Œèµ‹å€¼ï¼Œä¾‹å¦‚<code>val := myStruct&#123;text: &quot;This xx&quot;&#125;</code>ï¼Œæœªèµ‹å€¼çš„ä¸ºç±»å‹çš„é»˜è®¤å€¼ï¼Œæœ‰ç‚¹ç±»ä¼¼pythonã€‚</p><p>ç»“æ„ä½“é™¤äº†å¯ä»¥å®šä¹‰è‡ªå·±çš„æˆå‘˜å˜é‡ï¼Œä¹Ÿå¯ä»¥å®šä¹‰æˆå‘˜æ–¹æ³•ã€‚æˆå‘˜å‘æ–¹æ³•çš„å®šä¹‰ä¸æ™®é€šå‡½æ•°çš„å®šä¹‰ç±»ä¼¼ï¼Œåªæ˜¯åœ¨å…³é”®å­—<code>func</code>å’Œå‡½æ•°åä¹‹é—´å¢åŠ äº†å‡½æ•°å½’å±å“ªä¸ªç»“æ„ä½“çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç»“æ„ä½“</span></span><br><span class="line"><span class="keyword">type</span> Rect <span class="keyword">struct</span> &#123; </span><br><span class="line">x, y <span class="keyword">float64</span></span><br><span class="line">width, height <span class="keyword">float64</span> </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å®šä¹‰è¯¥ç»“æ„ä½“çš„æˆå‘˜æ–¹æ³•</span></span><br><span class="line"><span class="comment">// åœ¨å…³é”®å­—funcå’Œæ–¹æ³•åä¹‹é—´å¢åŠ æ–¹æ³•å½’å±çš„ç»“æ„ä½“</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Rect)</span> <span class="title">Area</span><span class="params">()</span> <span class="title">float64</span></span> &#123; </span><br><span class="line"><span class="keyword">return</span> r.width * r.height</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ç»“æ„ä½“è™½ç„¶ç±»ä¼¼å…¶ä»–è¯­è¨€ä¸­çš„ç±»ï¼Œä½†æ˜¯golangç»“æ„ä½“ä¸­å¹¶æ²¡æœ‰æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼Œ<strong>å¯¹è±¡çš„åˆ›å»ºé€šå¸¸äº¤ç”±ä¸€ä¸ªå…¨å±€çš„åˆ›å»ºå‡½æ•°æ¥å®Œæˆ</strong>ï¼Œä»¥<code>NewXXX</code>æ¥å‘½åï¼Œè¡¨ç¤ºâ€æ„é€ å‡½æ•°â€ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…¨å±€å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRect</span><span class="params">(x, y, width, height <span class="keyword">float64</span>)</span> *<span class="title">Rect</span></span> &#123; </span><br><span class="line"><span class="keyword">return</span> &amp;Rect&#123;x, y, width, height&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é€šè¿‡&quot;æ„é€ å‡½æ•°&quot;åˆ›å»ºRect</span></span><br><span class="line">rect := NewRect(<span class="number">3.3</span>, <span class="number">4.4</span>, <span class="number">5.5</span>, <span class="number">6.6</span>)</span><br></pre></td></tr></table></figure><p>æ–°ç±»å‹å¯ä»¥åƒç»“æ„ä½“é‚£æ ·æ–°å»ºï¼Œä¹Ÿå¯ä»¥åŸºäºå·²æœ‰çš„ç±»å‹è¿›è¡Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å‹ï¼Œè¯­æ³•ä¸º<code>type NewType Type</code>ï¼Œ<code>cachetable.go</code>æ–‡ä»¶ä¸­çš„<code>CacheItemPairList</code>å°±æ˜¯åŸºäºå·²æœ‰ç±»å‹è¿›è¡Œæ–°å»ºçš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheItemPair <span class="keyword">struct</span> &#123;</span><br><span class="line">Key         <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">AccessCount <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CacheItemPairList []CacheItemPair</span><br></pre></td></tr></table></figure><p>ä¸åŸºäºå·²æœ‰ç±»å‹æ–°å»ºç±»å‹çš„å†™æ³•ç±»ä¼¼çš„æ˜¯<code>ç±»å‹åˆ«å</code>ï¼Œå…¶è¯­æ³•ä¸º<code>type alias = Type</code>ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç­‰å·ã€‚è€Œä¸”æ–°å»ºç±»å‹æ—¶Typeå·²ç»å‘ç”Ÿäº†å˜åŒ–ï¼Œè€Œåˆ«åçš„Typeå¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚</p><blockquote><p>æ•°ç»„ VS åˆ‡ç‰‡</p></blockquote><p>æ•°ç»„å‡ ä¹æ˜¯æ‰€æœ‰ç¼–ç¨‹è¯­è¨€ä¸­å¸¸ç”¨çš„æ•°æ®ç»“æ„ï¼Œæƒ³å¿…å¤§å®¶å¯¹å…¶ä¹Ÿæ¯”è¾ƒäº†è§£ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®å…¶å€¼ã€‚æ•°ç»„çš„å£°æ˜æ–¹å¼ä¸º<code>var variable_name [SIZE] variable_type</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x [<span class="number">32</span>]<span class="keyword">byte</span> =</span><br><span class="line"><span class="keyword">var</span> y [<span class="number">1000</span>]*<span class="keyword">float64</span> </span><br><span class="line"><span class="keyword">var</span> z [<span class="number">3</span>][<span class="number">5</span>]<span class="keyword">int</span> </span><br><span class="line"><span class="keyword">var</span> w [<span class="number">2</span>][<span class="number">2</span>][<span class="number">2</span>]<span class="keyword">float64</span></span><br><span class="line"><span class="keyword">var</span> a [<span class="number">10</span>]<span class="keyword">int</span> = [<span class="number">10</span>]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">arr := [...]<span class="keyword">int</span>&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125; <span class="comment">// é•¿åº¦ä¸º5ï¼Œ...ä»£è¡¨è‡ªåŠ¨è®¡ç®—é•¿åº¦</span></span><br></pre></td></tr></table></figure><p>æ•°ç»„åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æœ‰ä¸ªè¯Ÿç—…å°±æ˜¯é•¿åº¦åœ¨åˆå§‹åŒ–æ—¶éœ€è¦æŒ‡å®šï¼Œå¹¶ä¸”åç»­æ— æ³•æ”¹å˜ã€‚ä¸ºäº†è§£å†³æ­¤é—®é¢˜å„ç§è¯­è¨€éƒ½å¢åŠ å…¶å®ƒæ•°æ®ç»“æ„ï¼Œgolangä¸­å¢åŠ çš„æ˜¯åˆ‡ç‰‡(slice)ã€‚<br>åˆ‡ç‰‡æœ‰ä¸€ä¸ªåˆå§‹æ•°æ®é•¿åº¦ï¼Œä½¿ç”¨<code>len</code>å‡½æ•°è·å–ï¼Œè¿˜æœ‰ä¸€ä¸ªé¢„ç•™ç©ºé—´é•¿åº¦ï¼Œé¢„ç•™ç©ºé—´ç”¨å…‰ä¹‹åä¼šè‡ªåŠ¨æ‰©å®¹ï¼Œä½¿ç”¨<code>cap</code>å‡½æ•°è·å–é¢„ç•™ç©ºé—´é•¿åº¦ã€‚åˆ‡ç‰‡çš„åˆ›å»ºæœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯ç›´æ¥åˆ›å»ºï¼Œå¦ä¸€ç§æ˜¯æ ¹æ®æ•°ç»„åˆ›å»ºã€‚</p><ul><li>ç›´æ¥åˆ›å»ºéœ€è¦ä½¿ç”¨å…³é”®å­—<code>make</code>ï¼Œä»£ç ä¸º<code>var mySlice []int or mySlice1 := make([]int, 5)</code></li><li>æ ¹æ®æ•°ç»„åˆ›å»ºçš„è¯éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªæ•°æ®ï¼Œç„¶åå°†æ•°ç»„çš„å€¼èµ‹å€¼ç»™åˆ‡ç‰‡ï¼Œä»£ç ä¸º</li></ul><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myArray [<span class="number">10</span>]<span class="keyword">int</span> = [<span class="number">10</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>&#125; <span class="comment">// åŸºäºæ•°ç»„åˆ›å»ºä¸€ä¸ªæ•°ç»„åˆ‡ç‰‡</span></span><br><span class="line"><span class="keyword">var</span> mySlice []<span class="keyword">int</span> = myArray[:<span class="number">5</span>]</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">mySlice := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125; <span class="comment">// æ³¨æ„è¿™é‡Œä¸­æ‹¬å·ä¸­æ²¡æœ‰é•¿åº¦ï¼Œå¦‚æœæœ‰é•¿åº¦å°±å˜æˆæ•°ç»„çš„åˆ›å»ºäº†</span></span><br></pre></td></tr></table></figure><p>æ•°ç»„å’Œåˆ‡ç‰‡è¿˜æœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯<em>æ•°ç»„ä½œä¸ºå‚æ•°æˆ–è€…å˜é‡ä¹‹é—´èµ‹å€¼æ—¶ï¼Œæ˜¯å¤åˆ¶ä¸€ä»½ï¼Œç›¸äº’ä¹‹é—´ä¸å½±å“</em>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = [<span class="number">3</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125; <span class="keyword">var</span> b = a</span><br><span class="line">b[<span class="number">1</span>]++</span><br><span class="line">fmt.Println(a, b) <span class="comment">// aå’Œbä¹‹é—´ä¸å—å½±å“ï¼Œprint [1 2 3] [1 3 3]</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯<strong>åˆ‡ç‰‡å´å¯ä»¥åœ¨å‚æ•°ä¼ é€’ä¸­ï¼Œå°†ä¿®æ”¹çš„ç»“æœä½œç”¨åœ¨åŒä¸€ä»½æ•°æ®ä¸Š</strong>ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">slice1 := []<span class="keyword">int</span>&#123;<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>&#125;</span><br><span class="line">fmt.Println(slice1)</span><br><span class="line">modify(slice1)</span><br><span class="line">fmt.Println(slice1) <span class="comment">// è¾“å‡º1,6,6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modify</span><span class="params">(slice1 []<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">fmt.Println(slice1)</span><br><span class="line">slice1[<span class="number">0</span>]=<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ‡ç‰‡sliceè¡¨ç°å‡ºæ¥çš„ç°è±¡æœ‰ç‚¹åƒå¼•ç”¨ç±»å‹ï¼Œä½†æ˜¯<strong>è¦åˆ‡è®°sliceå¹¶ä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œåªæ˜¯è¡¨ç°å‡ºæ¥å¼•ç”¨è¯­ä¹‰è€Œå·²</strong>ã€‚åœ¨<strong>golangä¸­å…¶å®åªæœ‰å€¼ä¼ é€’</strong>ï¼Œsliceè¡¨ç°å‡ºæ¥çš„å¼•ç”¨è¯­ä¹‰å…¶å®åªæ˜¯golangçš„ä¸€ä¸ªè¯­æ³•ç³–ï¼Œå…·ä½“çœ‹ä¸‹è¿™ä¸ªè¯­æ³•ç³–æ˜¯æ€ä¹ˆå®ç°çš„ã€‚<br>sliceçš„å£°æ˜å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> slice <span class="keyword">struct</span> &#123;</span><br><span class="line">array unsafe.Pointer</span><br><span class="line"><span class="built_in">len</span>   <span class="keyword">int</span></span><br><span class="line"><span class="built_in">cap</span>   <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sliceç»“æ„ä½“æœ‰ä¸€ä¸ª<code>unsafe.Poiniter</code>çš„æŒ‡é’ˆï¼Œä»–æŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œå‰©ä¸‹ä¸¤ä¸ªå±æ€§ä¸€ä¸ªä»£è¡¨æ•°æ®çš„é•¿åº¦å¦ä¸€ä¸ªä»£è¡¨å®¹é‡ã€‚<br>å½“sliceè¿›è¡Œå˜é‡ä¼ é€’æˆ–è€…å‚æ•°ä¼ é€’æ—¶ï¼Œä¾ç„¶æ˜¯å°†å…¶å€¼æ‹·è´ä¸€ä»½ï¼Œæ­¤æ—¶<code>unsafe.Poiniter</code>ç±»å‹çš„æŒ‡é’ˆ<code>array</code>å°†å…¶å­˜å‚¨çš„<strong>æ•°ç»„åœ°å€</strong>ä¹Ÿæ‹·è´äº†ä¸€ä»½ï¼Œæ‰€ä»¥å¯¹ä¼ é€’ä¹‹åçš„å˜é‡è¿›è¡Œä¿®æ”¹ä¼šå½±å“åŸå§‹sliceçš„ç»“æœã€‚ç¤ºæ„å›¾å¦‚ä¸‹ï¼š<br><img src="/blogimgs/golang-grammar/slice.png" alt="sliceå˜é‡" title="sliceå˜é‡"><br>å…¶ä¸­<code>[]int</code>æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜æ”¾sliceä¸­çš„æ•°æ®ï¼Œ<code>slice1</code>æ˜¯sliceçš„ä¸€ä¸ªå®ä¾‹ï¼Œ<code>slice1</code>å¯¹<code>slice2</code>è¿›è¡Œäº†èµ‹å€¼ã€‚èµ‹å€¼æ—¶è¿›è¡Œäº†å€¼ä¼ é€’ï¼Œå°†<code>slice1</code>ä¸­çš„æ•°æ®æ‹·è´äº†ä¸€ä»½ç»™<code>slice2</code>ï¼Œ<code>slice1</code>ä¸­çš„<code>array</code>æŒ‡é’ˆå°†å…¶å€¼ä¹Ÿå°±æ˜¯<code>[]int</code>çš„åœ°å€æ‹·è´äº†ä¸€ä»½ç»™<code>slice2</code>ä¸­çš„<code>array</code>æŒ‡é’ˆï¼Œè¿™å°±ç±»ä¼¼æŒ‡é’ˆçš„èµ‹å€¼ï¼Œæ‰€ä»¥å¯¹<code>slice2</code>çš„ä¿®æ”¹å¯ä»¥å½±å“åˆ°<code>slice1</code>ã€‚<br>å¦‚æœä¸æƒ³æ‹·è´ä¸€ä»½åˆ™å¯ä»¥ä½¿ç”¨æŒ‡é’ˆä¼ é€’ï¼Œç›´æ¥ä¼ é€’sliceçš„æŒ‡é’ˆï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">slice1 := []<span class="keyword">int</span>&#123;<span class="number">6</span>,<span class="number">6</span>,<span class="number">6</span>&#125;</span><br><span class="line">fmt.Println(slice1)</span><br><span class="line">modify(&amp;slice1)</span><br><span class="line">fmt.Println(slice1) <span class="comment">// è¾“å‡º1,6,6</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">modify</span><span class="params">(slice1 *[]<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">fmt.Println(*slice1)</span><br><span class="line">(*slice1)[<span class="number">0</span>] =<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åè®°ä½å…³é”®çš„ä¸€å¥è¯<strong>golangåªæœ‰å€¼ä¼ é€’</strong>ã€‚</p><h2 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h2><blockquote><p>Timer</p></blockquote><p>Timeræ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨cache2goä¸­ç”¨æ¥å®šæ—¶æ£€æŸ¥ç¼“å­˜ä¸­å¯¹è±¡çš„è¿‡æœŸæ—¶é—´ã€‚åœ¨golangä¸­æœ‰ä¸¤ç§å®šæ—¶å™¨ï¼Œåˆ†åˆ«ä¸º<code>Timer</code>å’Œ<code>Ticker</code>ã€‚<code>Timer</code>åªè§¦å‘ä¸€æ¬¡ï¼Œå¦‚æœè¿˜éœ€ç»§ç»­è§¦å‘éœ€è¦ä½¿ç”¨Resetè¿›è¡Œé‡ç½®ï¼Œè€Œ<code>Ticker</code>æ˜¯é—´éš”ç‰¹å®šæ—¶é—´è§¦å‘ã€‚</p><p>Timerå¯ä»¥é€šè¿‡<code>NewTimer</code>åˆ›å»ºæˆ–è€…ä½¿ç”¨<code>AfterFunc</code>åˆ›å»ºã€‚ä½¿ç”¨<code>NewTimer</code>åˆ›å»ºæ—¶ï¼Œå½“Timeråˆ°æœŸæ—¶ï¼Œä¼šå°†å½“æ—¶çš„æ—¶é—´å‘é€ç»™channelã€‚<br>Timerç±»å‹å®šä¹‰å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Timer <span class="keyword">struct</span> &#123;</span><br><span class="line">    C &lt;-<span class="keyword">chan</span> Time     <span class="comment">// The channel on which the time is delivered.</span></span><br><span class="line">    r runtimeTimer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„Cå°±æ˜¯ä¸Šæ–‡ä¸­ï¼Œè¯´çš„ä¼šå°†å½“å‰æ—¶é—´å‘é€çš„channelï¼Œ<code>NewTimer</code>åˆ›å»ºTimerçš„demoå¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">timer := time.NewTimer(time.Second * <span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§å½¢å¼åˆ›å»ºçš„Timerï¼Œä½¿ç”¨æ—¶éœ€è¦ç›‘å¬channel Cä¸­çš„ä¿¡å·ï¼Œä½¿ç”¨demoå¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    d := time.Duration(time.Second*<span class="number">2</span>)</span><br><span class="line">    t := time.NewTimer(d)</span><br><span class="line">    <span class="keyword">defer</span> t.Stop()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="comment">// ç­‰å¾…channel Cä¸­çš„ä¿¡å·</span></span><br><span class="line">        &lt;- t.C</span><br><span class="line"></span><br><span class="line">        fmt.Println(<span class="string">&quot;do someting...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡ç½®å®šæ—¶å™¨ï¼Œå› ä¸ºTimeræ˜¯ä¸€æ¬¡è§¦å‘</span></span><br><span class="line"><span class="comment">// Reset ä¼šå…ˆè°ƒç”¨ stopTimer å†è°ƒç”¨ startTimerï¼Œç±»ä¼¼äºåºŸå¼ƒä¹‹å‰çš„å®šæ—¶å™¨ï¼Œé‡æ–°å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨</span></span><br><span class="line">t.Reset(time.Second*<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>cache2goä¸­å¹¶æ²¡æœ‰ä½¿ç”¨è¿™ç§æ–¹å¼åˆ›å»ºTimerï¼Œè€Œæ˜¯ä½¿ç”¨äº†<code>AfterFunc</code>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">table.cleanupTimer = time.AfterFunc(smallestDuration, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">go</span> table.expirationCheck()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>AfterFuncä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ—¶é—´å‚æ•°ï¼Œé—´éš”å¤šä¹…è§¦å‘ï¼Œç¬¬äºŒä¸ªæ˜¯æ‰§è¡Œé€»è¾‘ï¼Œä½¿ç”¨ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ã€‚å½“Timerç»è¿‡smallestDurationé•¿æ—¶é—´ä¹‹åï¼Œä¼šæ‰§è¡Œåç¨‹<code>table.expirationCheck()</code>ï¼Œè¿™ä¸ªä¹Ÿæ˜¯ä¸€æ¬¡è§¦å‘ï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½éœ€è¦é€šè¿‡<code>AfterFunc</code>å†æ¬¡åˆ›å»ºä¸€ä¸ªTimerã€‚</p><p>å¦ä¸€ä¸ªå®šæ—¶å™¨æ˜¯Tickerï¼Œæ˜¯å‘¨æœŸæ€§çš„è§¦å‘ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯é™¤éç¨‹åºç»ˆæ­¢å¦åˆ™å®šæ—¶å™¨ä¼šä¸€ç›´è§¦å‘ï¼Œåœæ­¢æ—¶åº”è¯¥è°ƒç”¨<code>Ticker.Stop</code>æ¥é‡Šæ”¾ç›¸å…³èµ„æºã€‚Tickerä½¿ç”¨<code>NewTicker</code>åˆ›å»ºï¼Œdemoå¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    t := time.NewTicker(<span class="number">2</span>*time.Second)</span><br><span class="line">    <span class="keyword">defer</span> t.Stop()</span><br><span class="line"></span><br><span class="line">    fmt.Println(time.Now())</span><br><span class="line">    time.Sleep(<span class="number">5</span>*time.Second)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-t.C:</span><br><span class="line">            fmt.Println(time.Now())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!-- éœ€è¦æ³¨æ„çš„æ˜¯golang timerå®šæ—¶å™¨æ˜¯ä¸èƒ½stopåœæ­¢çš„ï¼Œåªèƒ½åœ¨é€»è¾‘ä¸Šé€šè¿‡æ ‡ç¤ºä½æ¥é€€å‡ºå®šæ—¶ä»»åŠ¡ï¼Œ ä¸ºä»€ä¹ˆï¼Ÿï¼Ÿï¼Ÿï¼Ÿ --><blockquote><p>goåç¨‹</p></blockquote><p>goå…³é”®å­—è¡¨ç¤ºåç¨‹goroutineï¼Œæ˜¯Goè¯­è¨€ä¸­çš„è½»é‡çº§çº¿ç¨‹å®ç°ï¼Œç”±Goè¿è¡Œæ—¶(runtime)ç®¡ç†ã€‚</p><p>åç¨‹æ˜¯å¯¹çº¿ç¨‹çš„ä¸€ç§è¡¥å……ï¼Œçº¿ç¨‹æ˜¯ç”±ç³»ç»Ÿå†…æ ¸ç®¡ç†çš„ï¼Œ<strong>çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢ä¼šè§¦å‘ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢</strong>ï¼Œæ­¤æ—¶éœ€è¦ä¿å­˜ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ¯”è¾ƒæ¶ˆè€—èµ„æºï¼Œè€Œä¸”çº¿ç¨‹å¤ªå¤šä¹Ÿä¼šè¾¾åˆ°çº¿ç¨‹ä¸Šé™çš„ç“¶é¢ˆã€‚<br>è€Œåç¨‹å®Œå…¨æ˜¯ç”±ç¨‹åºæ‰€æ§åˆ¶(ä¹Ÿå°±æ˜¯åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œæ‰€ä»¥ä¹Ÿå«<strong>ç”¨æˆ·æ€çº¿ç¨‹</strong>)ï¼Œæ˜¯åœ¨åº”ç”¨å±‚æ¨¡æ‹Ÿçº¿ç¨‹ï¼Œå› æ­¤é¿å…äº†ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„é¢‘ç¹åˆ‡æ¢ã€‚<br>ç¨‹åºæœ€ç»ˆæ˜¯è¦ç”±CPUåŠç›¸å…³å­˜å‚¨å™¨è¿›è¡Œæ‰§è¡Œï¼Œè€Œåç¨‹åœ¨ç”¨æˆ·æ€æ‰§è¡Œï¼Œä¸ç”±ç³»ç»Ÿå†…æ ¸è°ƒåº¦ï¼Œé‚£ä¹ˆä»–æ˜¯å¦‚ä½•è°ƒåº¦åˆ°CPUçš„ï¼Ÿåœ¨golangä¸­ï¼Œåç¨‹æ˜¯åŸºäºçº¿ç¨‹çš„ï¼Œå¹¶ä¸”å®ç°äº†ä¸€ä¸ªé€»è¾‘æµè°ƒåº¦(ä¹Ÿå°±æ˜¯åç¨‹è°ƒåº¦å™¨)ï¼Œå¯ä»¥åƒè°ƒåº¦çº¿ç¨‹é‚£æ ·åœ¨ç”¨æˆ·æ€ä¹Ÿèƒ½æ ¹æ®ä»£ç çš„æ‰§è¡ŒçŠ¶æ€è¿›è¡Œè°ƒåº¦åç¨‹ï¼Œ<em>æ›´å……åˆ†çš„åˆ©ç”¨å¹¶å‘çš„ä¼˜åŠ¿ï¼Œåˆé¿å…åå¤ç³»ç»Ÿè°ƒç”¨ï¼Œè¿˜æœ‰è¿›ç¨‹åˆ‡æ¢é€ æˆçš„å¼€é”€</em>ã€‚</p><p>æ›´é€šä¿—çš„è¯´<em>åç¨‹æ˜¯å­å‡½æ•°çš„ä¸€ä¸ªç‰¹ä¾‹</em>ï¼Œåœ¨çº¿ç¨‹ä¸­å‡½æ•°ä¹‹é—´çš„è°ƒç”¨åªéœ€è¦å°†å„è‡ªçš„æ‰§è¡ŒçŠ¶æ€å‹å…¥æ ˆä¸­å³å¯ï¼Œæ‰€ä»¥åç¨‹åˆ‡æ¢æ—¶ä¹Ÿæ˜¯å‹æ ˆæ“ä½œï¼Œæ¯”è¾ƒè½»é‡ã€‚</p><p>äº†è§£è¿‡åç¨‹ä¹‹åï¼Œå‘ç°åç¨‹ç¡®å®æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œæ›´å¥½çš„æ˜¯golangä»ç¼–è¯‘å™¨å’Œè¯­è¨€åŸºç¡€åº“å¤šä¸ªå±‚é¢å¯¹åç¨‹åšäº†å®ç°ï¼Œä¾‹å¦‚golangå¯¹å„ç§ioå‡½æ•°è¿›è¡Œäº†å°è£…ï¼Œå†…éƒ¨è°ƒç”¨æ“ä½œç³»ç»Ÿçš„å¼‚æ­¥ioå‡½æ•°ï¼Œæ ¹æ®è¿™äº›å‡½æ•°è¿”å›çš„çŠ¶æ€å°†ç°æœ‰çš„æ‰§è¡Œåºåˆ—å‹æ ˆï¼Œè®©çº¿ç¨‹å»æ‹‰å¦ä¸€ä¸ªåç¨‹æ‰§è¡Œï¼Œæ˜¯ç›®å‰å„ç±»æœ‰åç¨‹æ¦‚å¿µçš„è¯­è¨€ä¸­å®ç°çš„æœ€å®Œæ•´å’Œæˆç†Ÿçš„ï¼Œæœ€é‡è¦çš„æ˜¯ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼Œåªéœ€åœ¨æ™®é€šå‡½æ•°ä¹‹å‰æ·»åŠ <code>go</code>å…³é”®å­—å³å¯ï¼Œä½¿å¼€å‘è€…æ›´å¤šçš„å…³æ³¨ä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œæ›´å°‘çš„åœ¨è¿™äº›å…³é”®çš„åŸºç¡€æ„ä»¶ä¸Šè€—è´¹å¤ªå¤šç²¾åŠ›ã€‚</p><p>cache2goä¸­åªæœ‰ä¸€å¤„ä½¿ç”¨äº†åç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">expirationCheck</span><span class="params">()</span></span> &#123;</span><br><span class="line">...</span><br><span class="line">table.cleanupTimer = time.AfterFunc(smallestDuration, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">go</span> table.expirationCheck()</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>go</code>å…³é”®å­—åŠ æ™®é€šå‡½æ•°ä»£è¡¨åç¨‹ï¼Œä¸åŒäºå‡½æ•°è°ƒç”¨ï¼Œä¸ä¼šç­‰å¾…è°ƒç”¨å‡½æ•°ç»“æŸï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå‰©ä¸‹çš„ä»£ç ç‰‡æ®µï¼Œè¢«è°ƒç”¨çš„å‡½æ•°ä¼šåœ¨é€‚å½“çš„æ—¶é—´è¢«è°ƒåº¦ã€‚<em>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°æœ‰è¿”å›å€¼ï¼Œé‚£ä¹ˆè¿™ä¸ª è¿”å›å€¼ä¼šè¢«ä¸¢å¼ƒã€‚</em></p><!--åç¨‹å°±æ˜¯åœ¨ç”¨æˆ·ç¨‹åºä¸­å®ç°äº†åä½œå¼ä»»åŠ¡è°ƒåº¦(å½“ä»»åŠ¡å¾—ä¸€ä¸ªåˆ°äº† CPU æ—¶é—´ï¼Œé™¤éå®ƒè‡ªå·±æ”¾å¼ƒä½¿ç”¨ CPU ï¼Œå¦åˆ™å°†å®Œå…¨éœ¸å  CPU)å¹¶å‘ ä¸€ä¸ªæ—¶é—´æ®µå†…ï¼Œå¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œå¹¶è¡Œ åŒä¸€æ—¶åˆ»ï¼Œå¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œåç¨‹çš„ä¼˜åŠ¿ï¼šæœ€å¤§çš„ä¼˜åŠ¿å°±æ˜¯åç¨‹æé«˜çš„æ‰§è¡Œæ•ˆç‡ã€‚å› ä¸ºå­ç¨‹åºåˆ‡æ¢ä¸æ˜¯çº¿ç¨‹åˆ‡æ¢ï¼Œè€Œæ˜¯ç”±ç¨‹åºè‡ªèº«æ§åˆ¶ï¼Œå› æ­¤ï¼Œæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œå’Œå¤šçº¿ç¨‹æ¯”ï¼Œçº¿ç¨‹æ•°é‡è¶Šå¤šï¼Œåç¨‹çš„æ€§èƒ½ä¼˜åŠ¿å°±è¶Šæ˜æ˜¾ã€‚ç¬¬äºŒå¤§ä¼˜åŠ¿å°±æ˜¯ä¸éœ€è¦å¤šçº¿ç¨‹çš„é”æœºåˆ¶ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸å­˜åœ¨åŒæ—¶å†™å˜é‡å†²çªï¼Œåœ¨åç¨‹ä¸­æ§åˆ¶å…±äº«èµ„æºä¸åŠ é”ï¼Œåªéœ€è¦åˆ¤æ–­çŠ¶æ€å°±å¥½äº†ï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡æ¯”å¤šçº¿ç¨‹é«˜å¾ˆå¤šã€‚åç¨‹ä¹Ÿå¯ä»¥åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´åˆ‡æ¢ï¼Œ--><!--> å‡½æ•° func(key interface{}, args ...interface{})   å¯å˜å‚æ•°é•¿åº¦å‡½æ•°å˜é‡>test golangå­—ç¬¦ä¸²ï¼Œbyteæ•°ç»„ byteåŒºåˆ«## è¯­æ³•æŠ€å·§åŒ¿åå‡½æ•°åŒ¿åå±æ€§å‡½æ•°å‚æ•°res.Data().(*myStruct).text è¿™æ˜¯ä»€ä¹ˆç”¨æ³•ï¼Œå¼ºåˆ¶è½¬æ¢ç±»å‹ï¼Ÿ æ¥å£ç±»å‹å¼ºåˆ¶è½¬æ¢å£°æ˜å¤šä¸ªå˜é‡å¯ä»¥ç¼©å†™ï¼Œç”¨å°æ‹¬å·æ‹¬èµ·æ¥<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">cache = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*CacheTable)</span><br><span class="line">mutex sync.RWMutex</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>map æ¥å£<br>t, ok := cache[table] åˆ¤æ–­æ˜¯å¦æœ‰å€¼</p><p>RLockä¸Lockçš„åŒºåˆ«<br>sync.WaitGroup<br>â€“&gt;</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;http://bigdatadecode.top/golang-cache2go-src.html&quot;&gt;ä¸Šç¯‡&lt;/a&gt;ä»‹ç»äº†cache2goçš„ä»£ç é€»è¾‘ï¼Œæ¢³ç†ä»£ç é€»è¾‘æ—¶ä¹Ÿèƒ½ä»ä¸­äº†è§£golangçš„ä¸€äº›è¯­æ³•ä»¥åŠä½¿ç”¨æŠ€å·§ï¼Œæœ¬ç¯‡é›†ä¸­å°†æºç ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹æ¢³ç†ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="golang" scheme="http://yuanba.tech/categories/golang/"/>
    
    
    <category term="go" scheme="http://yuanba.tech/tags/go/"/>
    
    <category term="golang" scheme="http://yuanba.tech/tags/golang/"/>
    
    <category term="cache2go" scheme="http://yuanba.tech/tags/cache2go/"/>
    
    <category term="æºç " scheme="http://yuanba.tech/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>golangéšæ³¢é€æµä¹‹cache2goæºç è§£è¯»</title>
    <link href="http://yuanba.tech/golang-cache2go-src.html"/>
    <id>http://yuanba.tech/golang-cache2go-src.html</id>
    <published>2020-03-30T15:17:05.000Z</published>
    <updated>2020-04-13T16:00:12.000Z</updated>
    
    <content type="html"><![CDATA[<p>æƒ³å­¦ä¹ golangäº†ï¼Œå·¥ä½œä¸­åˆæ¥è§¦ä¸åˆ°ï¼ŒåŸºç¡€è¯­æ³•ä¸€çœ‹å…¨æ˜ç™½ï¼ŒçœŸåˆ°ç”¨çš„æ—¶å€™å´æ˜¯çªçœ¼çï¼Œæ€ä¹ˆåŠï¼Ÿ<br>å¯ä»¥æ‰¾ç®€å•çš„å¼€æºé¡¹ç›®ï¼Œçœ‹ä¸‹æºç ï¼Œçœ‹çœ‹è¿™äº›è¯­æ³•çš„å¸¸ç”¨æ–¹å¼ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è‡ªå·±å°è¯•ç€å»è‡ªå·±å®ç°ä¸‹ã€‚<br><a href="https://github.com/muesli/cache2go">cache2go</a>å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„é¡¹ç›®ï¼Œä¹Ÿæ˜¯åˆå­¦è€…å¿…æ’¸çš„é¡¹ç›®äº†å§ã€‚<br>æœ¬ç¯‡æ˜¯æˆ‘æ¢³ç†cache2goçš„å­¦ä¹ ç¬”è®°ã€‚</p><span id="more"></span><h2 id="cache2goæ¦‚è§ˆ"><a href="#cache2goæ¦‚è§ˆ" class="headerlink" title="cache2goæ¦‚è§ˆ"></a>cache2goæ¦‚è§ˆ</h2><p>cache2goæ˜¯ç”¨Goå®ç°çš„å¹¶å‘å®‰å…¨çš„ç¼“å­˜åº“ï¼Œä¸»è¦åŠŸèƒ½æœ‰ï¼š</p><ul><li>å¹¶å‘å®‰å…¨</li><li>ç¼“å­˜å‘½ä¸­æ¬¡æ•°</li><li>ç¼“å­˜è¿‡æœŸ</li></ul><p>é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">xx/cache2go</span><br><span class="line">â”œâ”€â”€ LICENSE.txt</span><br><span class="line">â”œâ”€â”€ README.md</span><br><span class="line">â”œâ”€â”€ benchmark_test.go</span><br><span class="line">â”œâ”€â”€ cache.go</span><br><span class="line">â”œâ”€â”€ cache_test.go</span><br><span class="line">â”œâ”€â”€ cacheitem.go</span><br><span class="line">â”œâ”€â”€ cachetable.go</span><br><span class="line">â”œâ”€â”€ errors.go</span><br><span class="line">â””â”€â”€ examples</span><br><span class="line">    â”œâ”€â”€ callbacks</span><br><span class="line">    â”‚Â Â  â””â”€â”€ callbacks.go</span><br><span class="line">    â”œâ”€â”€ dataloader</span><br><span class="line">    â”‚Â Â  â””â”€â”€ dataloader.go</span><br><span class="line">    â””â”€â”€ mycachedapp</span><br><span class="line">        â””â”€â”€ mycachedapp.go</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ŒåŠŸèƒ½ä»£ç ä¸€å…±ä¹Ÿå°±å››ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­ä¸€ä¸ªè¿˜æ˜¯ä¸ªerroræ–‡ä»¶ï¼Œé‡Œé¢åªå®šä¹‰äº†ä¸¤ä¸ªerrorç±»å‹ï¼Œå…¶æ ¸å¿ƒæ–‡ä»¶ä¹Ÿå°±ä¸‰ä¸ªã€‚<br>æ ¸å¿ƒä»£ç è™½ç„¶ä¸å¤šï¼Œä½†æ˜¯ä»”ç»†è¯»è¿™ä¸‰ä¸ªæ–‡ä»¶ï¼Œè¿˜æ˜¯å¯ä»¥ä»ä¸­å­¦ä¹ å¾ˆå¤šgolangè¯­æ³•å’ŒçŸ¥è¯†ç‚¹çš„ï¼Œæ¯”å¦‚lockã€goroutineã€åŒ¿åå‡½æ•°ç­‰ç­‰ã€‚</p><h2 id="å¼ºæ’¸ç°é£çƒŸç­"><a href="#å¼ºæ’¸ç°é£çƒŸç­" class="headerlink" title="å¼ºæ’¸ç°é£çƒŸç­"></a>å¼ºæ’¸ç°é£çƒŸç­</h2><p>å¯¹äºä¸€ä¸ªç¨‹åºå‘˜æ¥è¯´ï¼Œé˜…è¯»ä»£ç æ˜¯ä¸€é¡¹å¿…å¤‡çš„æŠ€èƒ½ï¼Œå› ä¸ºåœ¨å·¥ä½œä¸­è‚¯å®šä¼šé‡åˆ°å¼€å‘ç»´æŠ¤é—ç•™é¡¹ç›®çš„æƒ…å†µã€‚<br>é‚£ä¹ˆå¦‚ä½•å¿«é€Ÿé«˜æ•ˆçš„é˜…è¯»ä»£ç å‘¢ï¼Ÿä¿—è¯è¯´å¼ºæ’¸ç°é£çƒŸç­ï¼Œæ‰€ä»¥è‚¯å®šä¸èƒ½ä¸Šæ¥å°±ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ã€‚<br>é’ˆå¯¹ä¸åŒå¼€å‘äººå‘˜å¼€å‘çš„é¡¹ç›®ä»¥åŠä¸åŒç±»å‹çš„é¡¹ç›®éœ€è¦æœ‰ä¸åŒçš„æ–¹æ³•ï¼Œè¿™é‡Œè°ˆä¸‹æˆ‘ä¸ªäººçš„å‡ ç‚¹çœ‹æ³•ï¼š<br>1ã€å…¬å¸å†…éƒ¨é¡¹ç›®å¯ç»“åˆå£å¤´æµä¼ æˆ–è€…wikiä»¥åŠé¡¹ç›®æœ¬èº«çš„æŠ€æœ¯æ¡†æ¶ï¼Œä»æŸä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œåˆ‡å…¥<br>2ã€å¼€æºé¡¹ç›®æ™®éæœ‰è¾ƒä¸ºå®Œå–„çš„æ–‡æ¡£å’Œå•å…ƒæµ‹è¯•æˆ–è€…examplesï¼Œå¯ä»¥ä»æ–‡æ¡£å…¥æ‰‹äº†è§£åŠŸèƒ½åŠä½¿ç”¨æ–¹å¼ï¼Œç„¶åä»¥å•å…ƒæµ‹è¯•æˆ–è€…examplesä½œä¸ºä»£ç çš„åˆ‡å…¥ç‚¹ã€‚</p><p>cache2goæ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé‡Œé¢æœ‰æµ‹è¯•ç›¸å…³çš„ä»£ç ï¼Œä¹Ÿæœ‰examplesï¼Œæ‰€ä»¥å…ˆä»examplesä»£ç å…¥æ‰‹ã€‚<br>examplesä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºmycachedapp.goã€dataloader.goå’Œcallbacks.goï¼Œçœ‹åå­—åº”è¯¥å…ˆçœ‹mycachedapp.goè¿™ä¸ªæ–‡ä»¶ï¼Œå®ƒåº”è¯¥æ˜¯ç¼“å­˜çš„ä½¿ç”¨æ–¹å¼ã€‚</p><p>mycachedapp.goæ–‡ä»¶ä¸­ä»‹ç»äº†cacheçš„è¯»å†™å’Œåˆ ç­‰å¸¸ç”¨æ“ä½œï¼Œè§£æä¸‹å…³é”®ä»£ç ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®åŠ›åŒ–ä¸€ä¸ªç¼“å­˜cacheï¼Œåå­—ä¸ºmyCahe</span></span><br><span class="line">cache := cache2go.Cache(<span class="string">&quot;myCache&quot;</span>)</span><br><span class="line"><span class="comment">// å‘ç¼“å­˜ä¸­åŠ å…¥å…ƒç´ ï¼Œkvæ ¼å¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ—¶keyçš„è¿‡æœŸæ—¶é—´ï¼Œ0ä»£è¡¨ç”¨ä¸è¿‡æœŸ</span></span><br><span class="line">cache.Add(<span class="string">&quot;someKey&quot;</span>, <span class="number">5</span>*time.Second, &amp;val)</span><br><span class="line"><span class="comment">// ç¼“å­˜ä¸­è¯»å–keyå¯¹åº”çš„å€¼</span></span><br><span class="line">res, err := cache.Value(<span class="string">&quot;someKey&quot;</span>)</span><br><span class="line"><span class="comment">// è®¾ç½®åˆ é™¤æŸä¸ªkeyæ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">cache.SetAboutToDeleteItemCallback(<span class="function"><span class="keyword">func</span><span class="params">(e *cache2go.CacheItem)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Deleting:&quot;</span>, e.Key(), e.Data().(*myStruct).text, e.CreatedOn())</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ä»ç¼“å­˜ä¸­åˆ é™¤æŸä¸ªkey</span></span><br><span class="line">cache.Delete(<span class="string">&quot;someKey&quot;</span>)</span><br><span class="line"><span class="comment">// æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">cache.Flush()</span><br></pre></td></tr></table></figure><p>é€šè¯»mycachedapp.goä¹‹åï¼Œäº†è§£äº†cacheçš„åŸºæœ¬ç”¨æ³•ï¼Œä¸‹é¢æˆ‘ä»¬æ›´æ·±ä¸€æ­¥ï¼Œå»æ¢å¯»ä»–å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ã€‚</p><h2 id="Cache"><a href="#Cache" class="headerlink" title="Cache"></a>Cache</h2><p>mycachedapp.goä¸­è°ƒç”¨<code>cache2go.Cache()</code>åˆå§‹åŒ–äº†ä¸€ä¸ªç¼“å­˜å®ä¾‹ï¼Œæ¥ç€è·Ÿè¿›è¿™ä¸ªæ–¹æ³•çœ‹ä¸‹å…·ä½“çš„ç»†èŠ‚ã€‚æ­¤æ–¹æ³•ä½äº<code>cache.go</code>æ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> (</span><br><span class="line">cache = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]*CacheTable)</span><br><span class="line">mutex sync.RWMutex</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Cache</span><span class="params">(table <span class="keyword">string</span>)</span> *<span class="title">CacheTable</span></span> &#123;</span><br><span class="line"><span class="comment">// RLockè¯»é”ï¼Œè¯»é”ä¹‹é—´å¯ä»¥å…±äº«ï¼ŒLockéœ€è¦ç­‰å¾…Rlocké‡Šæ”¾æ‰èƒ½å¾—åˆ°é”</span></span><br><span class="line">mutex.RLock()</span><br><span class="line"><span class="comment">// ä»map cacheä¸­è·å–tableå¯¹åº”çš„å€¼</span></span><br><span class="line">t, ok := cache[table]</span><br><span class="line">mutex.RUnlock()</span><br><span class="line">    <span class="comment">// okä¸ºtrueä»£è¡¨æœ‰å€¼ï¼Œfalseä»£è¡¨æ— å€¼</span></span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="comment">// äº’æ–¥é”</span></span><br><span class="line">mutex.Lock()</span><br><span class="line">t, ok = cache[table]</span><br><span class="line"><span class="comment">// Double check whether the table exists or not.</span></span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªCacheTableå¯¹è±¡</span></span><br><span class="line">t = &amp;CacheTable&#123;</span><br><span class="line">name:  table,</span><br><span class="line">items: <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*CacheItem),</span><br><span class="line">&#125;</span><br><span class="line">cache[table] = t</span><br><span class="line">&#125;</span><br><span class="line">mutex.Unlock()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> t</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cache.go</code>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå…ˆå£°æ˜äº†ä¸¤ä¸ªå…¨å±€å˜é‡ï¼Œæ¥ç€å°±æ˜¯<code>Cache()</code>æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæ ¹æ®ä¼ å…¥çš„å‚æ•°tableä»mapç±»å‹çš„cacheä¸­å–å‡ºå¯¹åº”çš„å€¼ï¼Œæœ‰å€¼åˆ™ç›´æ¥è¿”å›ï¼Œæ— å€¼åˆ™åˆ›å»ºä¸€ä¸ª<code>CacheTable</code>ç±»å‹çš„å¯¹è±¡ã€‚è¿™é‡Œä½¿ç”¨äº†<code>Double check</code>æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p><h2 id="CacheTable"><a href="#CacheTable" class="headerlink" title="CacheTable"></a>CacheTable</h2><p>å…³é”®ç‚¹å°±åœ¨äº<code>CacheTable</code>ï¼Œæ¥ä¸‹æ¥çœ‹ä¸‹<code>CacheTable</code>çš„å…·ä½“å®ç°ã€‚</p><p><code>CacheTable</code>ä½äº<code>cachetable.go</code>æ–‡ä»¶ä¸­ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheTable <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åŒ¿åå±æ€§</span></span><br><span class="line">sync.RWMutex</span><br><span class="line"></span><br><span class="line"><span class="comment">// The table&#x27;s name.</span></span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line"><span class="comment">// All cached items.</span></span><br><span class="line">items <span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*CacheItem</span><br><span class="line"></span><br><span class="line"><span class="comment">// Timer responsible for triggering cleanup.</span></span><br><span class="line">cleanupTimer *time.Timer</span><br><span class="line"><span class="comment">// å½“å‰è®¡æ—¶å™¨æŒç»­æ—¶é—´</span></span><br><span class="line"><span class="comment">// Current timer duration.</span></span><br><span class="line">cleanupInterval time.Duration</span><br><span class="line"></span><br><span class="line"><span class="comment">// The logger used for this table.</span></span><br><span class="line">logger *log.Logger</span><br><span class="line"></span><br><span class="line"><span class="comment">// Callback method triggered when trying to load a non-existing key.</span></span><br><span class="line">loadData <span class="function"><span class="keyword">func</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;, args ...<span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">CacheItem</span></span></span><br><span class="line"><span class="comment">// Callback method triggered when adding a new item to the cache.</span></span><br><span class="line"><span class="comment">// è§¦å‘å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°å¯ä»¥ä¸æ­¢ä¸€ä¸ª</span></span><br><span class="line">addedItem []<span class="function"><span class="keyword">func</span><span class="params">(item *CacheItem)</span></span></span><br><span class="line"><span class="comment">// Callback method triggered before deleting an item from the cache.</span></span><br><span class="line">aboutToDeleteItem []<span class="function"><span class="keyword">func</span><span class="params">(item *CacheItem)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>CacheTable</code>çš„æˆå‘˜å˜é‡é‡ç‚¹ä»‹ç»ä¸‹<code>items</code>ã€<code>cleanupTimer</code>å’Œä¸€äº›ç”¨äºå›è°ƒå‡½æ•°çš„å‡½æ•°å˜é‡ï¼Œå…¶ä¸­<code>items</code>æ˜¯ä¸€ä¸ªmapï¼Œä»¥key/valueçš„å½¢å¼å­˜å‚¨å…·ä½“çš„ç¼“å­˜æ•°æ®ï¼›<code>cleanupTimer</code>æ˜¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç”¨äºæ£€æŸ¥ç¼“å­˜å¯¹è±¡çš„è¿‡æœŸæ—¶é—´ï¼›å‰©ä¸‹çš„<code>loadDataã€addedItemå’ŒaboutToDeleteItem</code>ç”¨äºæŸäº›æ“ä½œçš„å›è°ƒå‡½æ•°ã€‚</p><p>æ¥ä¸‹æ¥çœ‹ä¸‹mycachedapp.goæ–‡ä»¶ä¸­å¯¹ç¼“å­˜ä½¿ç”¨ç›¸å…³çš„æ–¹æ³•ï¼Œå¢åŠ ç¼“å­˜çš„æ–¹æ³•Addï¼Œè¯»å–ç¼“å­˜ä¸­æ•°æ®çš„æ–¹æ³•Valueå’Œåˆ é™¤ç¼“å­˜ä¸­æ•°æ®çš„æ–¹æ³•Deleteï¼Œè¿™å‡ ä¸ªæ–¹æ³•çš„é¦–å­—æ¯éƒ½æ˜¯å¤§å†™ï¼Œä»£è¡¨æ–¹æ³•æ˜¯publicã€‚</p><blockquote><p>Add</p></blockquote><p>å…ˆçœ‹ä¸‹Addæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// keyæ˜¯ç¼“å­˜å¯¹è±¡çš„keyï¼Œdataæ˜¯ç¼“å­˜å¯¹è±¡çš„å€¼ï¼ŒlifeSpanæ˜¯å¯¹è±¡çš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">Add</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;, lifeSpan time.Duration, data <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">CacheItem</span></span> &#123;</span><br><span class="line"><span class="comment">// golangä¸­çš„â€œæ„é€ å‡½æ•°â€</span></span><br><span class="line">item := NewCacheItem(key, lifeSpan, data)</span><br><span class="line"><span class="comment">// å°†itemåŠ å…¥CacheTableä¸­ï¼Œè¿™é‡Œæ¶‰åŠåˆ°å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥éœ€è¦åŠ é”</span></span><br><span class="line"><span class="comment">// é”çš„é‡Šæ”¾åœ¨addInternalæ–¹æ³•ä¸­ï¼Œæ˜¯å¯¹é”ç²’åº¦è¿›è¡Œçš„ä¼˜åŒ–</span></span><br><span class="line">table.Lock()</span><br><span class="line">table.addInternal(item)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> item</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Addæ–¹æ³•ä¼šæ ¹æ®ä¼ å…¥çš„å‚æ•°è°ƒç”¨<code>NewCacheItem</code>æ–¹æ³•æ„å»ºä¸€ä¸ªCacheItemå¯¹è±¡ï¼Œç”±äºgolangä¸­çš„ç»“æ„ä½“å¹¶æ²¡æœ‰æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼Œå¯¹äºéœ€è¦æ„é€ å‡½æ•°çš„åœºæ™¯ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨<code>NewStructName()</code>çš„æ–¹å¼å£°æ˜ä¸€ä¸ªæ–¹æ³•ï¼Œä½œä¸ºç»“æ„ä½“çš„æ„é€ å‡½æ•°ä½¿ç”¨ã€‚NewCacheItemä½äºcacheitem.goä¸­ï¼Œä¼šåœ¨ä¸‹ä¸€èŠ‚ä»‹ç»ã€‚</p><p>itemåˆ›å»ºæˆåŠŸä¹‹åï¼Œéœ€è¦å°†å…¶åŠ å…¥åˆ°mapç±»å‹çš„itemsä¸­ï¼Œä»¥ä¾¿äºåç»­æ•°æ®çš„è¯»å–ã€‚ç”±äºæ­¤æ“ä½œæ¶‰åŠåˆ°è¯»å†™æ“ä½œï¼Œåœ¨å¤šçº¿ç¨‹ä¸‹éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨<code>addInternal</code>æ–¹æ³•ä¹‹å‰å…ˆè·å–é”ï¼Œä½†æ˜¯é‡Šæ”¾é”å¹¶æ²¡æœ‰åœ¨<code>addInternal</code>æ–¹æ³•æ‰§è¡Œç»“æŸå†é‡Šæ”¾ï¼Œè€Œæ˜¯åœ¨<code>addInternal</code>ä»£ç ä¸­å¯¹ç›¸åº”èµ„æºè¯»å†™ç»“æŸä¹‹åé‡Šæ”¾ï¼Œè¿™æ ·åšå‡å°‘äº†æŒæœ‰é”çš„æ—¶é—´ï¼Œæé«˜äº†å¹¶è¡Œåº¦ã€‚<code>addInternal</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">addInternal</span><span class="params">(item *CacheItem)</span></span> &#123;</span><br><span class="line"><span class="comment">// Careful: do not run this method unless the table-mutex is locked!</span></span><br><span class="line"><span class="comment">// It will unlock it for the caller before running the callbacks and checks</span></span><br><span class="line">table.log(<span class="string">&quot;Adding item with key&quot;</span>, item.key, <span class="string">&quot;and lifespan of&quot;</span>, item.lifeSpan, <span class="string">&quot;to table&quot;</span>, table.name)</span><br><span class="line"><span class="comment">// å°†æ•°æ®åŠ å…¥ç¼“å­˜ä¸­</span></span><br><span class="line">table.items[item.key] = item</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†å€¼è¿›è¡Œæå‰ç¼“å­˜ï¼ŒåŠæ—¶é‡Šæ”¾é”</span></span><br><span class="line">expDur := table.cleanupInterval</span><br><span class="line"><span class="comment">// å¾—åˆ°Addçš„å›è°ƒå‡½æ•°åˆ—è¡¨</span></span><br><span class="line">addedItem := table.addedItem</span><br><span class="line"><span class="comment">// æœªæŒæœ‰é”ï¼Œè€Œç›´æ¥è¿›è¡Œé‡Šæ”¾æ—¶ï¼Œä¼šæŠ¥å¼‚å¸¸</span></span><br><span class="line">table.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trigger callback after adding an item to cache.</span></span><br><span class="line"><span class="keyword">if</span> addedItem != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, callback := <span class="keyword">range</span> addedItem &#123;</span><br><span class="line">callback(item)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// If we haven&#x27;t set up any expiration check timer or found a more imminent item.</span></span><br><span class="line"><span class="comment">// å¦‚æœitemçš„è¿‡æœŸæ—¶é—´å°äºä¸‹æ¬¡æ£€æŸ¥çš„æ—¶é—´é—´éš”ï¼Œåˆ™è§¦å‘è¿‡æœŸæ£€æŸ¥ï¼Œé‡ç½®è¿‡æœŸæ—¶é—´é—´éš”</span></span><br><span class="line"><span class="keyword">if</span> item.lifeSpan &gt; <span class="number">0</span> &amp;&amp; (expDur == <span class="number">0</span> || item.lifeSpan &lt; expDur) &#123;</span><br><span class="line">table.expirationCheck()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>addInternal</code>æ–¹æ³•æ‰ä¼šçœŸæ­£çš„å°†æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¸­ï¼Œå¹¶ä¸”è°ƒç”¨ç›¸åº”çš„å›è°ƒå‡½æ•°ï¼Œå¹¶ä¸”è¿™é‡Œè¿˜ä¼šè§¦å‘è¿‡æœŸæ£€æŸ¥ã€‚<br>æ•°æ®çš„è¿‡æœŸæ£€æŸ¥ä½¿ç”¨äº†<code>Timer</code>çš„å®šæ—¶åŠŸèƒ½ï¼Œä½†æ˜¯ç»†å¿ƒçš„ç«¥é‹ä¼šå‘ç°<code>CacheTable</code>åœ¨åˆ›å»ºçš„æ—¶å€™å¹¶æ²¡æœ‰ç»™<code>Timer</code>è¿›è¡Œèµ‹å€¼ï¼Œ<code>Timer</code>æ˜¯é€šè¿‡ç¬¬ä¸€ä¸ªåŠ å…¥åˆ°ç¼“å­˜ä¸­çš„æ•°æ®æ¿€æ´»çš„ã€‚<br>è¿™æ ·å¥½å¤„æ˜¯ç¼“å­˜åˆå§‹åŒ–ä¹‹åï¼Œåœ¨æ·»åŠ æ•°æ®ä¹‹å‰ä¸ç”¨è®©<code>Timer</code>å»å®šæœŸæ‰§è¡Œä¸€äº›æ— æ„ä¹‰çš„æ“ä½œï¼Œè€Œä¸”åœ¨æ¯åŠ å…¥ä¸€ä¸ªæ•°æ®å°±è§¦å‘è¿‡æœŸæ£€æŸ¥æ›´èƒ½æ›´åŠæ—¶çš„è°ƒæ•´è¿›è¡Œè¿‡æœŸæ£€æŸ¥çš„æ—¶é—´ç‚¹ï¼Œ<strong>å› ä¸ºç¼“å­˜ä¸­æ•°æ®çš„è¿‡æœŸæ—¶é—´ä¸å®šï¼Œæ— æ³•è®¾ç½®ä¸€ä¸ªåˆç†çš„å®šæœŸæ—¶é—´å»å‘¨æœŸæ€§çš„æ‰§è¡Œï¼Œè€Œä¸”éå†ä¸€éæ‰€æœ‰æ•°æ®æ‰¾å‡ºæœ€å…ˆè¿‡æœŸçš„æ•°æ®ï¼Œå°†å…¶å‰©ä½™æ—¶é—´ä½œä¸ºä¸‹æ¬¡æ£€æŸ¥çš„æ—¶é—´é—´éš”</strong>ã€‚<br><code>expirationCheck</code>æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">expirationCheck</span><span class="params">()</span></span> &#123;</span><br><span class="line">table.Lock()</span><br><span class="line"><span class="comment">// Timerå®šæ—¶åŠŸèƒ½çš„ä¸€ç§ç”¨æ³•ï¼Œç»“åˆä¸‹é¢å¯¹cleanupTimerçš„èµ‹å€¼æ–¹å¼å³å¯ç†è§£</span></span><br><span class="line"><span class="keyword">if</span> table.cleanupTimer != <span class="literal">nil</span> &#123;</span><br><span class="line">table.cleanupTimer.Stop()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> table.cleanupInterval &gt; <span class="number">0</span> &#123;</span><br><span class="line">table.log(<span class="string">&quot;Expiration check triggered after&quot;</span>, table.cleanupInterval, <span class="string">&quot;for table&quot;</span>, table.name)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// cleanupInterval ä¸º0æ—¶ï¼Œä»£è¡¨æ²¡æœ‰å®šæ—¶å»æ‰§è¡Œè¿‡æœŸæ£€æŸ¥ä»»åŠ¡</span></span><br><span class="line">table.log(<span class="string">&quot;Expiration check installed for table&quot;</span>, table.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// To be more accurate with timers, we would need to update &#x27;now&#x27; on every</span></span><br><span class="line"><span class="comment">// loop iteration. Not sure it&#x27;s really efficient though.</span></span><br><span class="line">now := time.Now()</span><br><span class="line">smallestDuration := <span class="number">0</span> * time.Second</span><br><span class="line"><span class="comment">// éå†ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œæ‰¾å‡ºæœ€å…ˆè¿‡æœŸçš„æ—¶é—´å·®</span></span><br><span class="line"><span class="keyword">for</span> key, item := <span class="keyword">range</span> table.items &#123;</span><br><span class="line"><span class="comment">// Cache values so we don&#x27;t keep blocking the mutex.</span></span><br><span class="line">item.RLock()</span><br><span class="line">lifeSpan := item.lifeSpan</span><br><span class="line">accessedOn := item.accessedOn</span><br><span class="line">item.RUnlock()</span><br><span class="line"><span class="comment">// lifeSpanä¸º0ï¼Œä»£è¡¨ç”¨ä¸è¿‡æœŸ</span></span><br><span class="line"><span class="keyword">if</span> lifeSpan == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> now.Sub(accessedOn) &gt;= lifeSpan &#123;</span><br><span class="line"><span class="comment">// è¿‡æœŸçš„åˆ™åˆ æ‰</span></span><br><span class="line">table.deleteInternal(key)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">// Find the item chronologically closest to its end-of-lifespan.</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªåˆ†æ”¯ä¸­ lifeSpan-now.Sub(accessedOn) ä¸€å®šå¤§äº 0ï¼Œå¦‚æœå°äº0çš„è¯ï¼Œä¼šè¢«ifæ‹¦æˆª</span></span><br><span class="line"><span class="keyword">if</span> smallestDuration == <span class="number">0</span> || lifeSpan-now.Sub(accessedOn) &lt; smallestDuration &#123;</span><br><span class="line">smallestDuration = lifeSpan - now.Sub(accessedOn)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Setup the interval for the next cleanup run.</span></span><br><span class="line">table.cleanupInterval = smallestDuration</span><br><span class="line"><span class="comment">// smallestDuration &lt;= 0æ—¶ï¼Œä¸å†æ‰§è¡Œå®šæ—¶æ£€æŸ¥ä»»åŠ¡</span></span><br><span class="line"><span class="comment">// smallestDuration åªèƒ½ç­‰äºæˆ–è€…å¤§äº0</span></span><br><span class="line"><span class="keyword">if</span> smallestDuration &gt; <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// smallestDurationå¤§äº0ï¼Œåˆ™è®¾ç½®å®šæ—¶æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">table.cleanupTimer = time.AfterFunc(smallestDuration, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="comment">// åç¨‹</span></span><br><span class="line"><span class="keyword">go</span> table.expirationCheck()</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line">table.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Addç›¸å…³çš„ä»£ç å°±ä»‹ç»åˆ°è¿™é‡Œï¼Œä¸‹é¢çœ‹ä¸‹Value</p><blockquote><p>Value</p></blockquote><p>Valueæ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;, args ...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(*CacheItem, error)</span></span> &#123;</span><br><span class="line">table.RLock()</span><br><span class="line">r, ok := table.items[key]</span><br><span class="line"><span class="comment">// ç¼“å­˜ä¸­æ²¡æœ‰å‘½ä¸­æ—¶åˆ°å›è°ƒå‡½æ•°</span></span><br><span class="line">loadData := table.loadData</span><br><span class="line">table.RUnlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ok &#123;</span><br><span class="line"><span class="comment">// ç¼“å­˜ä¸­æœ‰æ•°æ®ï¼Œè°ƒç”¨CacheItemçš„KeepAliveæ›´æ–°è®¿é—®æ—¶é—´å’Œè®¿é—®æ¬¡æ•°</span></span><br><span class="line">r.KeepAlive()</span><br><span class="line"><span class="keyword">return</span> r, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°ä¸ä¸ºnullæ—¶ï¼Œæ‰§è¡Œå…·ä½“çš„å›è°ƒå‡½æ•°ï¼Œ</span></span><br><span class="line"><span class="comment">// argså‚æ•°æ˜¯ä¼ é€’ç»™å›è°ƒå‡½æ•°çš„</span></span><br><span class="line"><span class="keyword">if</span> loadData != <span class="literal">nil</span> &#123;</span><br><span class="line">item := loadData(key, args...)</span><br><span class="line"><span class="keyword">if</span> item != <span class="literal">nil</span> &#123;</span><br><span class="line">table.Add(key, item.lifeSpan, item.data)</span><br><span class="line"><span class="keyword">return</span> item, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰é”™è¯¯ç±»å‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, ErrKeyNotFoundOrLoadable</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰é”™è¯¯ç±»å‹</span></span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, ErrKeyNotFound</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨mycachedapp.goä¸­è°ƒç”¨çš„Valueæ–¹æ³•æ˜¯<code>cache.Value(&quot;someKey&quot;)</code>ï¼Œè€Œè¿™é‡Œçš„Valueå‡½æ•°å´æ˜¯ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œè¿™é‡Œçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯å˜é•¿åº¦çš„å‚æ•°ï¼Œé•¿åº¦å¯ä»¥ä¸º0ï¼Œæ‰€ä»¥å¯ä»¥ä¼ å¦‚ä¸€ä¸ªå‚æ•°ã€‚</p><blockquote><p>Delete</p></blockquote><p>Deleteæ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">Delete</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(*CacheItem, error)</span></span> &#123;</span><br><span class="line">table.Lock()</span><br><span class="line"><span class="comment">// åœ¨æ–¹æ³•æ‰§è¡Œå®Œä¹‹åï¼Œæ‰§è¡ŒUnlock</span></span><br><span class="line"><span class="keyword">defer</span> table.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> table.deleteInternal(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">deleteInternal</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(*CacheItem, error)</span></span> &#123;</span><br><span class="line"><span class="comment">// golangä»mapä¸­å–å€¼é¿å…nullå€¼çš„è¯­æ³•</span></span><br><span class="line">r, ok := table.items[key]</span><br><span class="line"><span class="keyword">if</span> !ok &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span>, ErrKeyNotFound</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Cache value so we don&#x27;t keep blocking the mutex.</span></span><br><span class="line"><span class="comment">// åˆ é™¤æ•°æ®æ—¶çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">aboutToDeleteItem := table.aboutToDeleteItem</span><br><span class="line">table.Unlock()</span><br><span class="line"></span><br><span class="line"><span class="comment">// Trigger callbacks before deleting an item from cache.</span></span><br><span class="line"><span class="keyword">if</span> aboutToDeleteItem != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, callback := <span class="keyword">range</span> aboutToDeleteItem &#123;</span><br><span class="line">callback(r)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r.RLock()</span><br><span class="line"><span class="comment">// è¿™é‡Œçš„deferæ˜¯åœ¨å‡½æ•°çš„æœ€åæ‰§è¡ŒRUnlockå§</span></span><br><span class="line"><span class="keyword">defer</span> r.RUnlock()</span><br><span class="line"><span class="comment">// ä¸ºä»€ä¹ˆä¸¤ä¸ªå›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="keyword">if</span> r.aboutToExpire != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">for</span> _, callback := <span class="keyword">range</span> r.aboutToExpire &#123;</span><br><span class="line">callback(key)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">table.Lock()</span><br><span class="line">table.log(<span class="string">&quot;Deleting item with key&quot;</span>, key, <span class="string">&quot;created on&quot;</span>, r.createdOn, <span class="string">&quot;and hit&quot;</span>, r.accessCount, <span class="string">&quot;times from table&quot;</span>, table.name)</span><br><span class="line"><span class="comment">// mapçš„ç³»ç»Ÿå‡½æ•°è¿›è¡Œæ•°æ®åˆ é™¤</span></span><br><span class="line"><span class="built_in">delete</span>(table.items, key)</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> r, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Deleteæ–¹æ³•äºAddç±»ä¼¼ï¼Œéƒ½æ˜¯åœ¨å…¶å†…éƒ¨è°ƒç”¨äº†å¦ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œå…·ä½“çš„é€»è¾‘åœ¨å…¶å†…éƒ¨å‡½æ•°ä¸­ï¼Œè¿™é‡Œæ˜¯<code>deleteInternal</code>æ–¹æ³•ã€‚ä»£ç å’Œè¯­æ³•éƒ½æ¯”è¾ƒç®€å•ï¼Œå°±ä¸è¿‡å¤šå±•å¼€äº†ã€‚<br>æ¥ä¸‹æ¥çœ‹ä¸‹å¦‚ä½•æ¸…ç©ºç¼“å­˜ï¼Œæ–¹æ³•æ˜¯<code>Flush</code>ã€‚</p><blockquote><p>Flush</p></blockquote><p>Flushæ–¹æ³•çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(table *CacheTable)</span> <span class="title">Flush</span><span class="params">()</span></span> &#123;</span><br><span class="line">table.Lock()</span><br><span class="line"><span class="keyword">defer</span> table.Unlock()</span><br><span class="line"></span><br><span class="line">table.log(<span class="string">&quot;Flushing table&quot;</span>, table.name)</span><br><span class="line"><span class="comment">// ç›´æ¥å°†ä¸€ä¸ªæ–°çš„mapèµ‹å€¼ç»™itemsï¼Œè€mapç­‰ç€è‡ªåŠ¨å›æ”¶</span></span><br><span class="line">table.items = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*CacheItem)</span><br><span class="line">table.cleanupInterval = <span class="number">0</span></span><br><span class="line"><span class="keyword">if</span> table.cleanupTimer != <span class="literal">nil</span> &#123;</span><br><span class="line">table.cleanupTimer.Stop()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»‹ç»åˆ°è¿™é‡Œï¼Œ<code>cachetable.go</code>ä¸­çš„ä»£ç å°±å‡ ä¹æ’¸å®Œäº†ï¼Œä¸è¿‡è¿˜æœ‰ä¸ªåŠŸèƒ½éœ€è¦æä¸‹ï¼Œå°±æ˜¯ç»Ÿè®¡ç¼“å­˜ä¸­è®¿é—®æ¬¡æ•°æœ€å¤šçš„æ•°æ®ï¼Œæ–¹æ³•åä¸º<code>MostAccessed</code>ï¼Œä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œé‡ç‚¹ä»‹ç»ä¸‹è¿™ä¸ªæ’åºåŠŸèƒ½ã€‚<br>æ’åºæ˜¯å…ˆå°†ç¼“å­˜ä¸­çš„æ•°æ®æ”¾å…¥åˆ‡ç‰‡ä¸­ï¼Œç„¶åè°ƒç”¨<code>sort.Sort</code>å¯¹åˆ‡ç‰‡è¿›è¡Œæ’åºï¼Œè°ƒç”¨<code>sort.Sort</code>æ—¶ï¼Œéœ€è¦ä¼ å…¥çš„é›†åˆæ˜¯å¯æ¯”ç±»å‹çš„ï¼Œè€Œä¸”è¿˜å¯ä»¥é‡å†™æ¯”è¾ƒå™¨ï¼Œç±»ä¼¼javaä¸­çš„ä½¿ç”¨æ–¹å¼ã€‚<br>ä»£ç ä¸­å…ˆå£°æ˜äº†ä¸€ä¸ª<code>CacheItemPair</code>ç»“æ„ä½“ï¼Œç”¨æ¥ä½œä¸ºæ¯”è¾ƒå¯¹è±¡ï¼Œåªå­˜å‚¨Keyå’Œè®¿é—®æ¬¡æ•°å…³é”®ä¿¡æ¯ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ï¼Œå…¶æ¬¡å£°æ˜ä¸€ä¸ªåˆ‡ç‰‡ç±»å‹çš„<code>CacheItemPairList</code>ï¼Œå¹¶å®ç°äº†å¯æ¯”çš„ç›¸å…³å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheItemPair <span class="keyword">struct</span> &#123;</span><br><span class="line">Key         <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">AccessCount <span class="keyword">int64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CacheItemPairList []CacheItemPair</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p CacheItemPairList)</span> <span class="title">Swap</span><span class="params">(i, j <span class="keyword">int</span>)</span></span>      &#123; p[i], p[j] = p[j], p[i] &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p CacheItemPairList)</span> <span class="title">Len</span><span class="params">()</span> <span class="title">int</span></span>           &#123; <span class="keyword">return</span> <span class="built_in">len</span>(p) &#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p CacheItemPairList)</span> <span class="title">Less</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123; <span class="keyword">return</span> p[i].AccessCount &gt; p[j].AccessCount &#125;</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œ<code>cachetable.go</code>çš„ç›¸å…³ä»£ç å°±ç®—ä»‹ç»å®Œäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯äº›å›è°ƒå‡½æ•°çš„è®¾ç½®ä»¥åŠä¸€äº›å¸¸è§„ç”¨æ³•ï¼Œæ¯”è¾ƒç®€å•ã€‚<br>äº†è§£äº†<code>cachetable.go</code>ç›¸å…³ä»£ç ä¹‹åï¼Œç¼“å­˜çš„å†…å­˜ç»“æ„å…¶å®ä¹Ÿå°±æ¸…æ¥šäº†ï¼Œä¹Ÿå°±å¯¹æ•´ä¸ªç¼“å­˜çš„æ¶æ„æœ‰äº†åˆæ­¥çš„äº†è§£ï¼Œå°±æ„Ÿè§‰å…¶å®å¾ˆç®€å•ï¼Œå…¶å†…å­˜ç»“æ„å›¾å¦‚ä¸‹ï¼š<br><img src="/blogimgs/cache2go-src/cache2go.png" alt="cache2goå†…å­˜ç»“æ„" title="cache2goå†…å­˜ç»“æ„"></p><h2 id="CacheItem"><a href="#CacheItem" class="headerlink" title="CacheItem"></a>CacheItem</h2><p>CacheTableäº†è§£ä¹‹åï¼Œå†æ¥çœ‹ä¸‹CacheItemï¼Œåœ¨è¯»CacheTableç›¸å…³ä»£ç çš„æ—¶å€™å…¶å®å·²ç»æ¶‰åŠåˆ°ä¸€äº›CacheItemç›¸å…³çš„ä»£ç ï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºCacheItemä»£ç å¹¶ä¸å¤æ‚ï¼Œæ¯”è¾ƒç®€å•æ˜“æ‡‚ã€‚</p><p>CacheItemç›¸å…³çš„å±æ€§å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> CacheItem <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// åŒ¿åå˜é‡</span></span><br><span class="line">sync.RWMutex</span><br><span class="line"></span><br><span class="line"><span class="comment">// The item&#x27;s key.</span></span><br><span class="line">key <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="comment">// The item&#x27;s data.</span></span><br><span class="line">data <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"><span class="comment">// How long will the item live in the cache when not being accessed/kept alive.</span></span><br><span class="line">lifeSpan time.Duration</span><br><span class="line"></span><br><span class="line"><span class="comment">// Creation timestamp.</span></span><br><span class="line">createdOn time.Time</span><br><span class="line"><span class="comment">// Last access timestamp.</span></span><br><span class="line">accessedOn time.Time</span><br><span class="line"><span class="comment">// How often the item was accessed.</span></span><br><span class="line">accessCount <span class="keyword">int64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Callback method triggered right before removing the item from the cache</span></span><br><span class="line">aboutToExpire []<span class="function"><span class="keyword">func</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨golangä¸­ï¼Œé’ˆå¯¹ç»“æ„ä½“å¹¶æ²¡æœ‰å¯¹è¡Œçš„<strong>æ„é€ å‡½æ•°</strong>ï¼Œä½†æ˜¯å¯¹äºä¹ æƒ¯ä½¿ç”¨æ„é€ å‡½æ•°çš„äººæ¥è¯´è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿäºæ˜¯æœ‰äº†ä¸€ç§çº¦å®šä¿—æˆçš„è¯­æ³•ï¼Œé‚£å°±æ˜¯å°†å‡½æ•°å‘½åä¸º<code>NewXXX</code>å½¢å¼ï¼Œä»¥æ­¤è¡¨ç¤ºè¯¥ç»“æ„ä½“çš„æ„é€ å‡½æ•°ï¼Œcacheitem.goä¸­å°±ç”¨åˆ°äº†è¿™ç§å‘½åæ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCacheItem</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;, lifeSpan time.Duration, data <span class="keyword">interface</span>&#123;&#125;)</span> *<span class="title">CacheItem</span></span> &#123;</span><br><span class="line">t := time.Now()</span><br><span class="line"><span class="keyword">return</span> &amp;CacheItem&#123;</span><br><span class="line">key:           key,</span><br><span class="line">lifeSpan:      lifeSpan,</span><br><span class="line">createdOn:     t,</span><br><span class="line">accessedOn:    t,</span><br><span class="line">accessCount:   <span class="number">0</span>,</span><br><span class="line">aboutToExpire: <span class="literal">nil</span>,</span><br><span class="line">data:          data,</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç çœ‹åˆ°è¿™é‡Œåº”è¯¥å¯¹cache2goæ•´ä¸ªæºç éƒ½å·²äº†è§£äº†ï¼Œè€Œä¸”å¯¹golangä¹Ÿæœ‰äº†è¿›ä¸€æ­¥çš„ç†è§£å§ï¼Œåªæ˜¯å…¶ä¸­è¿˜æœ‰å¾ˆå¤šè¯­æ³•ä»¥åŠç”¨æ³•ä¸å¤ªç†Ÿæ‚‰ï¼Œéšåå¤šçœ‹å¤šå†™å°±OKäº†ï¼Œä¸‹ä¸€ç¯‡æˆ‘ä¼šæ ¹æ®è¿™ä¸ªé¡¹ç›®ä¸­æ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿›è¡Œæ¢³ç†æ‰©å±•ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æƒ³å­¦ä¹ golangäº†ï¼Œå·¥ä½œä¸­åˆæ¥è§¦ä¸åˆ°ï¼ŒåŸºç¡€è¯­æ³•ä¸€çœ‹å…¨æ˜ç™½ï¼ŒçœŸåˆ°ç”¨çš„æ—¶å€™å´æ˜¯çªçœ¼çï¼Œæ€ä¹ˆåŠï¼Ÿ&lt;br&gt;å¯ä»¥æ‰¾ç®€å•çš„å¼€æºé¡¹ç›®ï¼Œçœ‹ä¸‹æºç ï¼Œçœ‹çœ‹è¿™äº›è¯­æ³•çš„å¸¸ç”¨æ–¹å¼ï¼Œå¹¶ä¸”ä¹Ÿå¯ä»¥è‡ªå·±å°è¯•ç€å»è‡ªå·±å®ç°ä¸‹ã€‚&lt;br&gt;&lt;a href=&quot;https://github.com/muesli/cache2go&quot;&gt;cache2go&lt;/a&gt;å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„é¡¹ç›®ï¼Œä¹Ÿæ˜¯åˆå­¦è€…å¿…æ’¸çš„é¡¹ç›®äº†å§ã€‚&lt;br&gt;æœ¬ç¯‡æ˜¯æˆ‘æ¢³ç†cache2goçš„å­¦ä¹ ç¬”è®°ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="golang" scheme="http://yuanba.tech/categories/golang/"/>
    
    
    <category term="go" scheme="http://yuanba.tech/tags/go/"/>
    
    <category term="golang" scheme="http://yuanba.tech/tags/golang/"/>
    
    <category term="cache2go" scheme="http://yuanba.tech/tags/cache2go/"/>
    
    <category term="æºç " scheme="http://yuanba.tech/tags/%E6%BA%90%E7%A0%81/"/>
    
  </entry>
  
  <entry>
    <title>Flink windowè§£å¯†</title>
    <link href="http://yuanba.tech/Flink-Window-Decode.html"/>
    <id>http://yuanba.tech/Flink-Window-Decode.html</id>
    <published>2019-12-05T13:52:53.000Z</published>
    <updated>2019-12-10T15:52:53.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿‘å‡ å¹´æµå¤„ç†ç®€ç›´ç«çš„ä¸€å¡Œç³Šæ¶‚ï¼ŒFlinkä¹Ÿåœ¨é˜¿é‡Œçš„æ¨å¹¿ä¸‹é€æ¸æˆä¸ºä¸šç•Œä¸»æµï¼Œæ­£åœ¨é€æ­¥å–ä»£Stormå’ŒSpark Streamingã€‚<br>Flinkå¤©ç”Ÿå°±æ˜¯ä¸ºäº†å¤„ç†æµï¼Œè€Œä¸”ç›¸å¯¹äºå…¶ä»–æµå¤„ç†æ¡†æ¶é›†æˆäº†å¾ˆå¤šå®ç”¨åŠŸèƒ½ï¼Œæ¯”å¦‚çŠ¶æ€ç®¡ç†ï¼›Flinkè¿˜ä¸°å¯Œäº†windowçš„åŠŸèƒ½ï¼Œä½¿windowä¹Ÿæˆä¸ºäº†Flinkçš„ä¸€ä¸ªç‰¹è‰²ã€‚<br>æœ¬ç¯‡ä¸»è¦å¯¹windowä»å¤šç§è§’åº¦è¿›è¡Œè§£å¯†ï¼Œä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>ä½•ä¸ºwindow</li><li>å¦‚ä½•ä½¿ç”¨</li><li>å¦‚ä½•å®ç°</li><li>å„ç»„ä»¶åŸç†</li></ul><blockquote><p>åœ¨è§£å¯†windowä¹‹å‰ï¼Œç®€å•ä»‹ç»ä¸‹ä½•ä¸ºæµå¤„ç†ï¼Ÿ</p></blockquote><span id="more"></span><p>æµæ˜¯æŒ‡ä¸€ç§æºæºä¸æ–­çš„å½¢æ€ï¼Œæµå¤„ç†æ˜¯ä¸€ç§è¢«è®¾è®¡æ¥å¤„ç†æ— ç•Œæ•°æ®é›†çš„æ•°æ®å¤„ç†ç³»ç»Ÿå¼•æ“ï¼Œæ— ç•Œçš„æ•°æ®é›†æ˜¯æŒ‡æ²¡æœ‰è¾¹ç•Œï¼Œæ•°é‡ä¸Šæ˜¯æ— ç©·çš„ä¸€ç±»æ•°æ®é›†ã€‚<br>Flinkå°†æµå¤„ç†æ€»ç»“ä¸ºå››ä¸ªå•è¯ï¼š what where when how</p><ul><li><p>what â€“ What results are calculated(è®¡ç®—çš„ç»“æœæ˜¯ä»€ä¹ˆ)</p></li><li><p>where â€“ Where in event time are results calculated(åœ¨äº‹ä»¶æ—¶é—´ä¸­çš„å“ªä¸ªä½ç½®è®¡ç®—ç»“æœ)</p></li><li><p>when â€“ When in processing time are results materialized(åœ¨å¤„ç†æ—¶é—´ä¸­çš„å“ªä¸ªæ—¶åˆ»è§¦å‘è®¡ç®—ç»“æœ)</p></li><li><p>how â€“ How do refinements of results relate(å¦‚ä½•ä¿®æ­£ç»“æœ)</p></li></ul><!-- ä¸ºä»€ä¹ˆFlinkå¤©ç”Ÿå°±æ˜¯ç”¨æ¥å¤„ç†æµçš„ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ windowä¸ä¹Ÿç›¸å½“äºä¸€ä¸ªå¾®æ‰¹å—ï¼Ÿ --><blockquote><p>æ—¢ç„¶æµå¤„ç†æœ‰è¿™ä¹ˆå¤šçš„é—®é¢˜éœ€è¦è§£å†³ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦è¿›è¡Œæµè®¡ç®—ï¼Ÿ</p></blockquote><ol><li>åœ¨å•†ä¸šç«äº‰ä¸­æåº¦æ¸´æœ›æ›´å¿«çš„æ•°æ®ï¼Œè€Œè½¬æ¢æˆæµè®¡ç®—åˆ™æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ³•æ¥é™ä½å»¶è¿Ÿã€‚</li><li>æµ·é‡çš„ã€æ— ç©·æ•°æ®é›†åœ¨ç°åœ¨çš„å•†ä¸šç¯å¢ƒé‡Œå˜çš„è¶Šæ¥è¶Šå¸¸è§ï¼Œè€Œç”¨ä¸“é—¨è®¾è®¡æ¥å¤„ç†è¿™æ ·æ•°æ®çš„ç³»ç»Ÿæ¥åº”å¯¹è¿™äº›æ•°æ®åˆ™æ›´ä¸ºå®¹æ˜“ã€‚</li><li>åœ¨æ•°æ®åˆ°è¾¾æ—¶å°±å¯¹ä»–ä»¬è¿›è¡Œå¤„ç†èƒ½å¤Ÿæ›´åŠ å¹³å‡åœ°æŠŠè´Ÿè½½è¿›è¡Œå‡è¡¡ï¼Œå–å¾—æ›´å¥½çš„ä¸€è‡´æ€§å’Œæ›´å¯é¢„æµ‹çš„è®¡ç®—èµ„æºæ¶ˆè€—ã€‚</li></ol><!--æµæ•°æ®ï¼Œwhen where what how ç‰¹ç‚¹ æ— ç•Œ    è®¡ç®—çš„ç»“æœæ˜¯ä»€ä¹ˆï¼ˆWhat results are calculatedï¼‰ï¼Ÿ é€šè¿‡transformationsæ“ä½œ transformationsæ˜¯ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªstreamä½œä¸ºè¾“å…¥çš„æŸç§operation  æ•°æ®é›†ä¹‹é—´çš„è½¬æ¢    åœ¨äº‹ä»¶æ—¶é—´ä¸­çš„å“ªä¸ªä½ç½®è®¡ç®—ç»“æœï¼ˆWhere in event time are results calculatedï¼‰ï¼Ÿ ä½¿ç”¨çª—å£ï¼ˆwindowingï¼‰çš„æ¦‚å¿µ    åœ¨å¤„ç†æ—¶é—´ä¸­çš„å“ªä¸ªæ—¶åˆ»è§¦å‘è®¡ç®—ç»“æœï¼ˆWhen in processing time are results materializedï¼‰ï¼Ÿ ä½¿ç”¨triggers + watermarksè¿›è¡Œè§¦å‘è®¡ç®—    å¦‚ä½•ä¿®æ­£ç»“æœï¼ˆHow do refinements of results relateï¼‰ï¼Ÿé€šè¿‡accumulationçš„ç±»å‹ä¿®æ­£ç»“æœæ•°æ®--><h2 id="ä½•ä¸ºwindow"><a href="#ä½•ä¸ºwindow" class="headerlink" title="ä½•ä¸ºwindow"></a>ä½•ä¸ºwindow</h2><p>windowå›ç­”äº†whereè¿™ä¸ªé—®é¢˜ï¼Œå› ä¸ºåœ¨æµå¤„ç†åº”ç”¨ä¸­ï¼Œæ•°æ®æ˜¯è¿ç»­ä¸æ–­çš„ï¼Œæˆ‘ä»¬ä¸å¯èƒ½ç­‰åˆ°æ‰€æœ‰æ•°æ®éƒ½åˆ°äº†æ‰å¼€å§‹å¤„ç†ï¼Œå†µä¸”æˆ‘ä»¬ä¹Ÿæ— æ³•åˆ¤æ–­æ‰€æœ‰çš„æ•°æ®ä½•æ—¶èƒ½å®Œæ•´åˆ°æ¥ã€‚è€Œä¸”åœ¨å®é™…çš„ç¯å¢ƒä¸­ä¹Ÿéœ€è¦åšä¸€äº›èšåˆè®¡ç®—ï¼Œä¾‹å¦‚è®¡ç®—è¿‡å»5åˆ†é’ŸæŸä¸ªé¡µé¢çš„UVï¼Œè¿™å°±å¿…é¡»å®šä¹‰ä¸€ä¸ªçª—å£ï¼Œç”¨æ¥æ”¶é›†å¹¶è®¡ç®—è¿™5åˆ†é’Ÿå†…çš„æ•°æ®ã€‚æ‰€ä»¥windowå¾ˆå¥½çš„å›ç­”äº†whereè¿™ä¸ªé—®é¢˜ï¼Œä»–å†³å®šäº†æ•°æ®åœ¨å“ªé‡Œè¢«è®¡ç®—ã€‚</p><p>windowæ˜¯æ— é™æµä¸Šä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼Œå…¶æŒ‰ç…§æ—¶é—´è¾¹ç•Œå¯¹æ•°æ®æºè¿›è¡Œåˆ‡åˆ†ï¼Œåˆ‡åˆ†æ–¹å¼åˆ†ä¸ºå›ºå®šçª—å£ã€æ»‘åŠ¨çª—å£å’Œä¼šè¯çª—å£ä¸‰ç§ï¼ŒåŒæ—¶ï¼Œåœ¨å¯ä»¥åœ¨çª—å£å†…è¿›è¡Œèšåˆï¼Œä»è€ŒæŠŠæºæºä¸æ–­äº§ç”Ÿçš„æ•°æ®æ ¹æ®ä¸åŒçš„æ¡ä»¶åˆ’åˆ†æˆä¸€æ®µä¸€æ®µæœ‰è¾¹ç•Œçš„æ•°æ®åŒºé—´ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿåˆ©ç”¨çª—å£åŠŸèƒ½å®ç°å¾ˆå¤šå¤æ‚çš„ç»Ÿè®¡åˆ†æéœ€æ±‚ã€‚å…·ä½“å®ç°æ—¶ï¼Œçª—å£åˆå¯ä»¥æ˜¯ä¸¥æ ¼æŒ‰ç…§æ—¶é—´æ¥é©±åŠ¨ï¼Œä¾‹å¦‚TimeWindowï¼›ä¹Ÿå¯ä»¥ç”±æ•°æ®é©±åŠ¨ï¼Œä¾‹å¦‚CountWindowã€‚åˆ‡åˆ†æ–¹å¼å¦‚å›¾<br><img src="/blogimgs/flink-window/windowing-chop.jpg" alt="windowåˆ‡åˆ†æ–¹å¼" title="windowåˆ‡åˆ†æ–¹å¼"></p><blockquote><p>å›ºå®šçª—å£(Fixed windows)</p></blockquote><p>å›ºå®šçª—å£æŒ‰ç…§å›ºå®šçš„é•¿åº¦è¿›è¡Œåˆ†ç‰‡ï¼Œè¿™ä¸ªå›ºå®šçš„é•¿åº¦å¯ä»¥æ—¶é—´ç»´åº¦ä¹Ÿå¯ä»¥æ˜¯æ•°æ®ç»´åº¦ã€‚å¦‚ä¸Šå›¾ä¸­çº¢è‰²çš„åˆ’åˆ†æ–¹å¼ï¼Œè¿™ä¸ªå›ºå®šçš„é•¿åº¦å¯ä»¥æ˜¯æ¯1åˆ†é’Ÿä¹Ÿå¯ä»¥æ˜¯æ¯100ä¸ªå…ƒç´ ã€‚<br>å›ºå®šçª—å£å…¸å‹åœ°ä¼šå¯¹æ‰€æœ‰çš„æ•°æ®é›†è¿›è¡Œç­‰ä»½åˆ’åˆ†ï¼Œä¹Ÿå«å¯¹é½çª—å£ã€‚åœ¨æŸäº›æƒ…å½¢ä¸‹ï¼Œå¯èƒ½ä¼šå¸Œæœ›å¯¹ä¸åŒçš„æ•°æ®å­é›†åº”ç”¨ä¸åŒçš„ç›¸ä½åç§»ï¼Œä»è€Œèƒ½è®©åˆ†ç‰‡çš„å®Œæ•´åº¦æ›´åŠ çš„å¹³å‡ã€‚è¿™æ—¶å°±ä¸å†æ˜¯å¯¹é½çª—å£ï¼Œè€Œæ˜¯éå¯¹é½çª—å£ã€‚</p><blockquote><p>æ»‘åŠ¨çª—å£(Sliding windows)</p></blockquote><p>æ»‘åŠ¨çª—å£æ˜¯å›ºå®šçª—å£çš„ä¸€ä¸ªæ›´ä¸€èˆ¬åŒ–çš„å½¢å¼ï¼Œæ»‘åŠ¨çª—å£ä¸€èˆ¬ä¼šå®šä¹‰ä¸¤ä¸ªå±æ€§ï¼Œå³çª—å£å¤§å°ï¼ˆæ—¶é—´é•¿çŸ­ï¼‰å’Œæ»‘åŠ¨æ—¶é—´ã€‚<strong>å¦‚æœæ»‘åŠ¨æ—¶é—´æ¯”çª—å£è¦å°ï¼Œåˆ™çª—å£ä¼šé‡å ï¼›å¦‚æœç›¸ç­‰ï¼Œè¿™å°±æ˜¯å›ºå®šçª—å£ï¼›å¦‚æœæ»‘åŠ¨æ—¶é—´æ¯”çª—å£å¤§ï¼Œå°±äº§ç”Ÿäº†ä¸€ç§ç‰¹æ®Šçš„æ•°æ®é‡‡æ ·ï¼Œä¹Ÿå°±æ˜¯æŒ‰æ—¶é—´åªçœ‹æ•°æ®é›†é‡Œçš„ä¸€éƒ¨åˆ†å­é›†çš„æ•°æ®ã€‚</strong>ç±»ä¼¼äºå›ºå®šçª—å£ï¼Œæ»‘åŠ¨çª—å£ä¸€èˆ¬ä¹Ÿæ˜¯å¯¹é½çš„ã€‚å‡ºäºæ€§èƒ½è€ƒè™‘ä¹Ÿä¼šåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯éå¯¹é½çš„ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šå›¾ä¸­è“è‰²éƒ¨åˆ†ä¸ºäº†èƒ½è¡¨æ˜æ»‘åŠ¨çš„æ€§è´¨è€Œæ²¡æœ‰æŠŠæ¯ä¸ªçª—å£å¯¹åº”åˆ°æ‰€æœ‰çš„é”®ã€‚å®é™…æƒ…å†µé‡Œæ˜¯éƒ½è¦å¯¹åº”åˆ°çš„ã€‚</p><blockquote><p>ä¼šè¯çª—å£(Sessions)</p></blockquote><p>ä¼šè¯æ˜¯æŒ‡åœ¨ä¸æ´»è·ƒæ—¶é—´æ®µä¹‹é—´çš„ä¸€è¿ä¸²äº‹ä»¶ï¼Œè¿™ä¸ªä¸æ´»è·ƒæ—¶é—´ä¸€èˆ¬æ˜¯è®¾å®šçš„æ¯”è¶…æ—¶çš„æ—¶é—´è¦é•¿ï¼Œä¼šè¯çª—å£æ˜¯ä¸€ç§åŠ¨æ€çª—å£ã€‚<strong>ä¼šè¯å•å…ƒä¸€èˆ¬ç”¨æ¥åšç”¨æˆ·è¡Œä¸ºåˆ†æ</strong>ï¼Œå³è§‚å¯Ÿåœ¨ä¸€ä¸ªä¼šè¯å•å…ƒé‡Œç”¨æˆ·çš„ä¸€ç³»åˆ—äº‹ä»¶ã€‚ä¼šè¯å•å…ƒçš„é•¿åº¦ä¸€èˆ¬éƒ½æ²¡æ³•æå‰ç¡®å®šï¼Œå®Œå…¨å–å†³äºå®é™…æ•°æ®çš„æƒ…å†µã€‚ä¼šè¯å•å…ƒä¹Ÿæ˜¯éå¯¹é½çª—å£çš„ä¸€ä¸ªç»å…¸æ¡ˆä¾‹ï¼Œå› ä¸ºå®é™…æƒ…å†µä¸‹ï¼Œä¸åŒå­é›†æ•°æ®çš„ä¼šè¯å•å…ƒé•¿åº¦å‡ ä¹ä¸å¯èƒ½ä¸€è‡´åœ°å¯¹é½ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œwindowæ˜¯åœ¨æ— é™çš„æµä¸Šå®šä¹‰äº†ä¸€ä¸ªæœ‰é™çš„å…ƒç´ é›†åˆã€‚è¿™ä¸ªé›†åˆå¯ä»¥æ˜¯åŸºäºæ—¶é—´çš„ï¼Œå…ƒç´ ä¸ªæ•°çš„ï¼Œæ—¶é—´å’Œä¸ªæ•°ç»“åˆçš„ï¼Œä¼šè¯é—´éš™çš„ï¼Œæˆ–è€…æ˜¯è‡ªå®šä¹‰çš„ã€‚Flinkæä¾›äº†ç®€æ´çš„ç®—å­æ¥æ»¡è¶³å¸¸ç”¨çš„çª—å£æ“ä½œï¼ŒåŒæ—¶æä¾›äº†é€šç”¨çš„çª—å£æœºåˆ¶æ¥å…è®¸ç”¨æˆ·è‡ªå·±å®šä¹‰çª—å£åˆ†é…é€»è¾‘ã€‚ä¸‹é¢çœ‹ä¸‹Flinkå†…ç½®çš„çª—å£ã€‚</p><h2 id="Flinkæä¾›çš„å†…ç½®çª—å£ä½¿ç”¨åŠå…¶å®ç°"><a href="#Flinkæä¾›çš„å†…ç½®çª—å£ä½¿ç”¨åŠå…¶å®ç°" class="headerlink" title="Flinkæä¾›çš„å†…ç½®çª—å£ä½¿ç”¨åŠå…¶å®ç°"></a>Flinkæä¾›çš„å†…ç½®çª—å£ä½¿ç”¨åŠå…¶å®ç°</h2><p>Flinkå°†çª—å£çš„åˆ‡åˆ†è§„åˆ™åˆ†ä¸º3ç§ï¼Œ3ç§åˆ‡åˆ†è§„åˆ™Flinkéƒ½æœ‰å¯¹åº”å†…ç½®çª—å£å®ç°ï¼Œå†…ç½®çª—å£åŒ…æ‹¬æ»šåŠ¨æ—¶é—´çª—å£ã€æ»‘åŠ¨æ—¶é—´çª—å£ã€æ»šåŠ¨è®¡æ•°çª—å£ã€æ»‘åŠ¨è®¡æ•°çª—å£å’Œä¼šè¯çª—å£ã€‚è¿™é‡Œä¸ºäº†æ–¹ä¾¿å°†å†…ç½®çª—å£åˆ†ä¸º3ç±»è¿›è¡Œä»‹ç»ï¼Œä¾æ¬¡ä¸ºè®¡æ•°çª—å£countWindowã€æ—¶é—´çª—å£timeWindowå’Œä¼šè¯çª—å£sessionWindowã€‚</p><ul><li>è®¡æ•°çª—å£<br>è®¡æ•°çª—å£æ˜¯æ ¹æ®å…ƒç´ ä¸ªæ•°å¯¹æ•°æ®æµè¿›è¡Œåˆ†ç»„çš„ï¼Œåˆ†ä¸ºæ»šåŠ¨è®¡æ•°çª—å£å’Œæ»‘åŠ¨è®¡æ•°çª—å£ã€‚ä½¿ç”¨è®¡æ•°çª—å£æ—¶å…ˆå°†DataStreamè½¬æ¢ä¸ºKeyedStreamï¼Œç„¶åé€šè¿‡è°ƒç”¨countWindowå‡½æ•°è¿›è¡Œä½¿ç”¨ã€‚</li></ul><p>ä¾‹å¦‚éœ€è¦ç»Ÿè®¡æ¯100ä¸ªè®¢å•ä¸­çš„æ€»æ•°ï¼Œåˆ™ä½¿ç”¨æ»šåŠ¨è®¡æ•°çª—å£ï¼Œæ¯100ä¸ªå…ƒç´ æ»šåŠ¨ä¸€æ¬¡ï¼Œä»£ç å®ç°ä¸ºï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream of (userId, buyCnts)</span></span><br><span class="line"><span class="keyword">val</span> buyCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> tumblingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = buyCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">// æ»šåŠ¨è®¡æ•°çª—å£ï¼Œæ¯100ä¸ªå…ƒç´ æ»šåŠ¨ä¸€æ¬¡</span></span><br><span class="line">  .countWindow(<span class="number">100</span>)</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ä¸æ»šåŠ¨è®¡æ•°çª—å£ç›¸å¯¹çš„æ˜¯æ»‘åŠ¨è®¡æ•°çª—å£ï¼Œå¦‚æœè¦è®¡ç®—æ¯10ä¸ªå…ƒç´ è®¡ç®—ä¸€æ¬¡æœ€è¿‘100ä¸ªå…ƒç´ çš„æ€»å’Œï¼Œä½¿ç”¨æ»‘åŠ¨çª—å£ï¼Œçª—å£å¤§å°ä¸º100ï¼Œæ¯10ä¸ªå…ƒç´ æ»‘åŠ¨ä¸€æ¬¡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slidingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = vehicleCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">// æ»‘åŠ¨è®¡æ•°çª—å£ï¼Œçª—å£å¤§å°ä¸º100ï¼Œæ¯10ä¸ªæ»‘åŠ¨ä¸€æ¬¡</span></span><br><span class="line">  .countWindow(<span class="number">100</span>, <span class="number">10</span>)</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œè¿™é‡Œçœ‹ä¸‹countWindowçš„å…·ä½“æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä¸¤ä¸ªcountWindowå‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ»šåŠ¨è®¡æ•°çª—å£</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WindowedStream&lt;T, KEY, GlobalWindow&gt; <span class="title">countWindow</span><span class="params">(<span class="keyword">long</span> size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> window(GlobalWindows.create()).trigger(PurgingTrigger.of(CountTrigger.of(size)));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ»‘åŠ¨è®¡æ•°çª—å£</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WindowedStream&lt;T, KEY, GlobalWindow&gt; <span class="title">countWindow</span><span class="params">(<span class="keyword">long</span> size, <span class="keyword">long</span> slide)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> window(GlobalWindows.create())</span><br><span class="line">            .evictor(CountEvictor.of(size))</span><br><span class="line">            .trigger(CountTrigger.of(slide));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±countWindowçš„å®ç°å¯ä»¥çœ‹å‡ºwindowä¸°å¯Œçš„åŠŸèƒ½æ˜¯ç”±ä¸€äº›å…³é”®ç»„ä»¶ç»„åˆå®ç°çš„ï¼Œè¿™äº›ç»„ä»¶åŒ…æ‹¬evictorå’Œtriggerã€‚ä¸¤è€…ä½¿ç”¨çš„çª—å£åˆ†é…å™¨éƒ½æ˜¯<code>GlobalWindows</code>ï¼Œä¸¤è€…çš„åŒºåˆ«æ˜¯triggerï¼Œå› ä¸ºGlobalWindowsçš„é»˜è®¤triggeræ˜¯<code>NeverTrigger</code>ï¼Œæ„æ€æ˜¯ä¸è§¦å‘çª—å£è®¡ç®—ã€‚æ»šåŠ¨çª—å£çš„triggeræ˜¯å°†<code>CountTrigger</code>å°è£…æˆ<code>PurgingTrigger</code>ï¼Œæ ¹æ®çª—å£åˆ†é…çš„å…ƒç´ ä¸ªæ•°è¿›è¡Œè§¦å‘è®¡ç®—ï¼Œå¹¶ä¸”åœ¨è®¡ç®—ä¹‹åæ¸…é™¤çª—å£ä¸­çš„æ•°æ®ï¼Œä»è€Œè¾¾åˆ°æ»šåŠ¨çª—å£çš„æ•ˆæœã€‚æ»‘åŠ¨çª—å£çš„triggeråªæ˜¯ä¸€ä¸ªå•çº¯çš„<code>CountTrigger</code>ï¼Œæ ¹æ®æ»‘åŠ¨å…ƒç´ çš„ä¸ªæ•°è¿›è¡Œè®¡ç®—ï¼Œç”±äºcountWindowä½¿ç”¨çš„æ˜¯GlobalWindowsï¼Œåªæœ‰ä¸€å…±å…¨å±€çª—å£ï¼Œtriggerè§¦å‘è®¡ç®—æ—¶åˆåªæ˜¯å•çº¯çš„è®¡ç®—ç»“æœï¼Œå¹¶æœªåƒæ»šåŠ¨çª—å£é‚£æ ·æ¸…é™¤æ•°æ®ï¼Œæ‰€ä»¥æ»‘åŠ¨çª—å£ä¸­çš„æ•°æ®ä¼šè¶Šæ¥è¶Šå¤šï¼Œä¸ä»…æ€§èƒ½ä¸Šä¼šå—å½±å“ï¼Œè€Œä¸”æ•°æ®ä¹Ÿå¯èƒ½ä¼šè¢«é‡å¤è®¡ç®—ï¼Œè¿™é‡Œå¢åŠ äº†evictorå¯¹æ•°æ®è¿›è¡Œè¿‡æ»¤ã€‚</p><!-- è®¡æ•°çª—å£æ— è®ºæ˜¯æ»šåŠ¨è¿˜æ˜¯æ»‘åŠ¨çª—å£ï¼Œéƒ½åªæœ‰ä¸€ä¸ªçª—å£ï¼Œæ˜¯ä¸€ä¸ªå…¨å±€çª—å£ï¼Œä¸åƒæ—¶é—´çª—å£é‚£æ ·ï¼Œä¸€ä¸ªå…ƒç´ å¯ä»¥å½’å±å¤šä¸ªçª—å£ --><ul><li>æ—¶é—´çª—å£<br>æ—¶é—´çª—å£æ˜¯æ ¹æ®æ—¶é—´å¯¹æ•°æ®æµè¿›è¡Œåˆ†ç»„å¯¹ï¼Œä¹Ÿåˆ†ä¸ºæ»šåŠ¨æ—¶é—´çª—å£å’Œæ»‘åŠ¨æ—¶é—´çª—å£ã€‚æ—¶é—´çª—å£æŒ‰ç…§æ—¶é—´åˆ’åˆ†ï¼Œè¿™ä¸ªæ—¶é—´åœ¨Flinkä¸­æœ‰ä¸‰ç§æ¦‚å¿µï¼Œåˆ†åˆ«æ˜¯event time(äº‹ä»¶æ—¶é—´ï¼šäº‹ä»¶å‘ç”Ÿæ—¶çš„æ—¶é—´)ï¼Œingestion time(æ‘„å–æ—¶é—´ï¼šäº‹ä»¶è¿›å…¥æµå¤„ç†ç³»ç»Ÿçš„æ—¶é—´)ï¼Œprocessing time(å¤„ç†æ—¶é—´ï¼šæ¶ˆæ¯è¢«è®¡ç®—å¤„ç†çš„æ—¶é—´)ã€‚<strong>æ³¨ï¼šFlink ä¸­çª—å£æœºåˆ¶å’Œæ—¶é—´ç±»å‹æ˜¯å®Œå…¨è§£è€¦çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å½“éœ€è¦æ”¹å˜æ—¶é—´ç±»å‹æ—¶ä¸éœ€è¦æ›´æ”¹çª—å£é€»è¾‘ç›¸å…³çš„ä»£ç ã€‚</strong></li></ul><p>ä¾‹å¦‚æˆ‘ä»¬éœ€è¦ç»Ÿè®¡æ¯ä¸€åˆ†é’Ÿä¸­ç”¨æˆ·è´­ä¹°çš„å•†å“çš„æ€»æ•°ï¼Œéœ€è¦å°†ç”¨æˆ·çš„è¡Œä¸ºäº‹ä»¶æŒ‰æ¯ä¸€åˆ†é’Ÿè¿›è¡Œåˆ‡åˆ†æ±‡æ€»ï¼Œè¿™ç§åˆ‡åˆ†è¢«ç§°ä¸ºæ»šåŠ¨æ—¶é—´çª—å£ï¼Œä»£ç å¦‚ä¸‹:</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream of (userId, buyCnt)</span></span><br><span class="line"><span class="keyword">val</span> buyCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = ...</span><br><span class="line"><span class="comment">// å°†DataStreamè½¬æ¢ä¸ºKeyedStreamï¼Œç„¶åå†ä½¿ç”¨çª—å£å‡½æ•°</span></span><br><span class="line"><span class="keyword">val</span> tumblingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = buyCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>) </span><br><span class="line">  <span class="comment">// çª—å£é•¿åº¦ä¸º1åˆ†é’Ÿçš„æ»šåŠ¨æ—¶é—´çª—å£</span></span><br><span class="line">  .timeWindow(<span class="type">Time</span>.minutes(<span class="number">1</span>))</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>çª—å£è®¡ç®—æ—¶ï¼Œå¯ä»¥é€‰æ‹©çª—å£åˆ‡åˆ†æ—¶ä½¿ç”¨çš„æ—¶é—´æ–¹å¼ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯processtimeï¼Œä½¿ç”¨<code>env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)</code>å¯¹æ—¶é—´æ–¹å¼è¿›è¡Œæ›´æ”¹ã€‚</p><p>æ—¶é—´çª—å£çš„å¦ä¸€ç§æ–¹å¼æ˜¯æ»‘åŠ¨æ—¶é—´çª—å£ï¼Œä¸»è¦ç”¨äºå¹³æ»‘åœ°è¿›è¡Œçª—å£èšåˆè®¡ç®—ã€‚å¦‚æœï¼Œéœ€è¦æ¯åˆ†é’Ÿç»Ÿè®¡ä¸‹æœ€è¿‘5åˆ†é’Ÿç”¨æˆ·è´­ä¹°çš„å•†å“æ€»æ•°ï¼Œå°±å¯ä»¥ä½¿ç”¨æ»‘åŠ¨æ—¶é—´çª—å£è¿›è¡Œè®¡ç®—ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> slidingCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = buyCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>) </span><br><span class="line">  <span class="comment">// çª—å£é•¿åº¦ä¸º5åˆ†é’Ÿï¼Œæ¯1åˆ†é’Ÿæ»‘åŠ¨ä¸€æ¬¡</span></span><br><span class="line">  .timeWindow(<span class="type">Time</span>.minutes(<span class="number">5</span>), <span class="type">Time</span>.minutes(<span class="number">1</span>))</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>æ—¶é—´çª—å£ä½¿ç”¨æ—¶ä¾ç„¶å¾ˆç®€å•æ–¹ä¾¿ï¼Œå°†DataStreamæµè½¬æ¢ä¸ºKeyedStreamæµï¼Œè°ƒç”¨<code>timeWindow</code>è¿›è¡Œä½¿ç”¨ï¼Œä¼ å…¥ä¸€ä¸ªå‚æ•°ä»£è¡¨æ»šåŠ¨æ—¶é—´çª—å£ï¼Œä¼ å…¥ä¸¤ä¸ªå‚æ•°æ—¶ä»£è¡¨æ»‘åŠ¨æ—¶é—´çª—å£ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä»£è¡¨çª—å£çš„é•¿åº¦ï¼Œç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨æ»‘åŠ¨çš„é•¿åº¦ã€‚å…¶å…·ä½“çš„å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ»šåŠ¨æ—¶é—´çª—å£</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WindowedStream&lt;T, KEY, TimeWindow&gt; <span class="title">timeWindow</span><span class="params">(Time size)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) &#123;</span><br><span class="line">        <span class="keyword">return</span> window(TumblingProcessingTimeWindows.of(size));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> window(TumblingEventTimeWindows.of(size));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ»‘åŠ¨æ—¶é—´çª—å£</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WindowedStream&lt;T, KEY, TimeWindow&gt; <span class="title">timeWindow</span><span class="params">(Time size, Time slide)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (environment.getStreamTimeCharacteristic() == TimeCharacteristic.ProcessingTime) &#123;</span><br><span class="line">        <span class="keyword">return</span> window(SlidingProcessingTimeWindows.of(size, slide));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> window(SlidingEventTimeWindows.of(size, slide));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure><p>æ—¶é—´çª—å£çš„å®ç°æ¯”è®¡æ•°çª—å£è¾ƒå¤æ‚ï¼Œæ¯ç§çª—å£ç±»å‹æ ¹æ®ä¸åŒçš„æ—¶é—´è®¾ç½®éƒ½æœ‰ä¸“é—¨çš„å®ç°ï¼Œæ»šåŠ¨çª—å£çš„å®ç°æ˜¯<code>TumblingProcessingTimeWindows</code>å’Œ<code>TumblingEventTimeWindows</code>ï¼Œè€Œæ»‘åŠ¨çª—å£çš„å®ç°æ˜¯<code>SlidingProcessingTimeWindows</code>å’Œ<code>SlidingEventTimeWindows</code>ã€‚<code>TumblingProcessingTimeWindows</code>å’Œ<code>TumblingEventTimeWindows</code>çš„å®ç°é€»è¾‘ä¸€æ ·ï¼Œéƒ½æ˜¯æ ¹æ®å…ƒç´ çš„æ—¶é—´æŒ‡å®šä¸€ä¸ªæ—¶é—´çª—å£<code>TimeWindow</code>ï¼Œæ¯ä¸ªå…ƒç´ åªèƒ½å±äºä¸€ä¸ªçª—å£ï¼Œä¸åŒç‚¹åªæ˜¯è§¦å‘è®¡ç®—çš„triggerï¼Œæ ¹æ®è®¾ç½®çš„æ—¶é—´ç­–ç•¥æŒ‡å®šç›¸åº”çš„triggerï¼Œå…¶ä¸­<code>TumblingProcessingTimeWindows</code>çš„triggeræ˜¯<code>ProcessingTimeTrigger</code>ï¼Œ<code>TumblingEventTimeWindows</code>çš„triggeræ˜¯<code>EventTimeTrigger</code>ã€‚<code>SlidingProcessingTimeWindows</code>å’Œ<code>SlidingEventTimeWindows</code>åˆ’åˆ†çª—å£çš„é€»è¾‘è·Ÿ<code>TumblingProcessingTimeWindows</code>å’Œ<code>TumblingEventTimeWindows</code>ä¸€æ ·ï¼Œåªæ˜¯æ»‘åŠ¨çª—å£ä¸­ä¸€ä¸ªå…ƒç´ å¯ä»¥å½’å±å¤šä¸ªçª—å£ï¼Œæ‰€ä»¥è¿”å›çš„æ˜¯ä¸€ä¸ªçª—å£é›†åˆï¼Œè‡³äºè§¦å‘å™¨triggerå’Œæ»šåŠ¨çª—å£ä¸­çš„ä¸€æ ·ã€‚</p><ul><li>ä¼šè¯çª—å£<br>æ­¤å¤„çš„ä¼šè¯ç±»ä¼¼æµè§ˆé¡µé¢æ—¶æ‰€æŒ‡çš„ä¼šè¯ï¼Œä¼šè¯çª—å£å¹¶æ²¡æœ‰å›ºå®šæ—¶é—´é•¿åº¦ï¼Œè€Œæ˜¯æ ¹æ®äº‹ä»¶ä¹‹é—´çš„æ—¶é—´é—´éš”æ¥å†³å®šçš„ï¼Œå¦‚æœä¸¤ä¸ªäº‹ä»¶ä¹‹é—´çš„æ—¶é—´é—´éš”è¶…è¿‡é˜ˆå€¼ï¼Œåˆ™è¢«åˆ’åˆ†åˆ°ä¸åŒçš„çª—å£ä¸­ã€‚ä¾‹å¦‚ï¼Œéœ€è¦è®¡ç®—æ¯ä¸ªç”¨æˆ·åœ¨æ´»è·ƒæœŸé—´æ€»å…±è´­ä¹°çš„å•†å“æ•°é‡ï¼Œç”±äºæ¯ä¸ªç”¨æˆ·çš„æ´»è·ƒæ—¶é•¿ä¸å›ºå®šï¼Œä¸èƒ½ç»Ÿä¸€è®¾ç½®çª—å£æ—¶é•¿ï¼Œæ‰€ä»¥æ­¤æ—¶åº”è¯¥ä½¿ç”¨ä¼šè¯çª—å£ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Stream of (userId, buyCnts)</span></span><br><span class="line"><span class="keyword">val</span> buyCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = ...</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> sessionCnts: <span class="type">DataStream</span>[(<span class="type">Int</span>, <span class="type">Int</span>)] = vehicleCnts</span><br><span class="line">  .keyBy(<span class="number">0</span>)</span><br><span class="line">  <span class="comment">// äº‹ä»¶ä¹‹é—´è¶…è¿‡30ç§’åˆ™åˆ’åˆ†æ–°çª—å£</span></span><br><span class="line">  .window(<span class="type">ProcessingTimeSessionWindows</span>.withGap(<span class="type">Time</span>.seconds(<span class="number">30</span>)))</span><br><span class="line">  .sum(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¼šè¯çª—å£è°ƒç”¨<code>KeydeStream.window</code>æ–¹æ³•ï¼ŒåŒæ ·æ­¤æ–¹æ³•ä¹Ÿåœ¨<code>countWindow</code>å’Œ<code>timeWindow</code>ä¸­è¢«è°ƒç”¨ï¼Œå¹¶æ²¡æœ‰ä¸ºä¼šè¯çª—å£å°è£…å•ç‹¬çš„å‡½æ•°ï¼Œä½¿ç”¨æ—¶ä¼ å…¥å¯¹åº”æ—¶é—´çš„ä¼šè¯çª—å£åˆ†é…å™¨å³å¯ã€‚</p><!--æ»šåŠ¨çª—å£å…¶å®æ˜¯æ»‘åŠ¨çª—å£çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ--><!--å…¨å¤©UVæ—¥å¢UVè¿‡æ»¤æ¯5åˆ†é’Ÿæœªä¸‹å•çš„è®¢å•    æ»šåŠ¨çª—å£--><h2 id="çª—å£è¿›é˜¶"><a href="#çª—å£è¿›é˜¶" class="headerlink" title="çª—å£è¿›é˜¶"></a>çª—å£è¿›é˜¶</h2><p>å†…ç½®çª—å£ä½¿ç”¨æ¯”è¾ƒç®€å•ï¼Œ<code>WindowedStream</code>ä¹Ÿæä¾›äº†ä¸€äº›ç®€å•çš„è®¡ç®—å‡½æ•°ï¼Œä½†æ˜¯å¦‚æœè‡ªå®šä¹‰ä¸€äº›è®¡ç®—é€»è¾‘æ—¶å°±ç”¨åˆ°äº†çª—å£å‡½æ•°ã€‚<br>çª—å£å‡½æ•°åˆ†ä¸ºReduceFunctionã€AggregateFunctionã€FoldFunctionå’ŒProcessWindowFunctionã€‚å‰ä¸¤ä¸ªæ˜¯å¢é‡èšåˆå‡½æ•°ï¼Œæ€§èƒ½æ¯”è¾ƒé«˜æ•ˆï¼›ProcessWindowFunctionä¸­ä¼šåŒ…å«ä¸€ä¸ªè¿­ä»£å™¨ï¼Œè¿™ä¸ªè¿­ä»£å™¨ä¸­è®°å½•äº†çª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜åŒ…å«ä¸€äº›çª—å£çš„å…ƒä¿¡æ¯ã€‚æ¥ä¸‹æ¥çœ‹ä¸‹æ¯ä¸ªçª—å£å‡½æ•°å…·ä½“æ€ä¹ˆç”¨ã€‚</p><ul><li>ReduceFunction<br>å°†è¾“å…¥çš„ä¸¤ä¸ªå…ƒç´ è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªç›¸åŒç±»å‹çš„å…ƒç´ åšä¸ºè¾“å‡ºã€‚æ­¤å‡½æ•°æ˜¯å¢é‡çš„å¯¹çª—å£ä¸­çš„å…ƒç´ è¿›è¡Œè®¡ç®—ï¼Œç±»ä¼¼äºMRä¸­Reduceã€‚å…·ä½“ä½¿ç”¨ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String, Long&gt;&gt; input = ...;</span><br><span class="line"></span><br><span class="line">input</span><br><span class="line">    .keyBy(&lt;key selector&gt;)</span><br><span class="line">    .window(&lt;window assigner&gt;)</span><br><span class="line">    .reduce(<span class="keyword">new</span> ReduceFunction&lt;Tuple2&lt;String, Long&gt;&gt; &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Long&gt; <span class="title">reduce</span><span class="params">(Tuple2&lt;String, Long&gt; v1, Tuple2&lt;String, Long&gt; v2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(v1.f0, v1.f1 + v2.f1);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><ul><li>AggregateFunction<br>AggregateFunctionä¹Ÿæ˜¯ä¸€ä¸ªå¢é‡èšåˆçª—å£å‡½æ•°ï¼Œæ¯”ReduceFunctionæ›´åŠ é€šç”¨ï¼ŒåŒ…å«ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯çª—å£æµä¸­è¾“å…¥çš„å…ƒç´ ï¼Œç¬¬äºŒä¸ªæ˜¯ç´¯åŠ å™¨ï¼Œç¬¬ä¸‰ä¸ªå…ƒç´ æ˜¯è®¡ç®—ä¹‹åçš„è¾“å‡ºï¼Œç´¯åŠ å™¨å’Œè¾“å‡ºç»“æœçš„ç±»å‹éƒ½å¯ä»¥è‡ªå®šä¹‰ã€‚ä½¿ç”¨æ ·ä¾‹å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AverageAggregate</span></span></span><br><span class="line"><span class="class">    <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Long</span>&gt;, <span class="title">Tuple2</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt;, <span class="title">Double</span>&gt; </span>&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Tuple2&lt;Long, Long&gt; <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">0L</span>, <span class="number">0L</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Tuple2&lt;Long, Long&gt; <span class="title">add</span><span class="params">(Tuple2&lt;String, Long&gt; value, Tuple2&lt;Long, Long&gt; accumulator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(accumulator.f0 + value.f1, accumulator.f1 + <span class="number">1L</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Double <span class="title">getResult</span><span class="params">(Tuple2&lt;Long, Long&gt; accumulator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((<span class="keyword">double</span>) accumulator.f0) / accumulator.f1;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> Tuple2&lt;Long, Long&gt; <span class="title">merge</span><span class="params">(Tuple2&lt;Long, Long&gt; a, Tuple2&lt;Long, Long&gt; b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(a.f0 + b.f0, a.f1 + b.f1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DataStream&lt;Tuple2&lt;String, Long&gt;&gt; input = ...;</span><br><span class="line"></span><br><span class="line">input</span><br><span class="line">    .keyBy(&lt;key selector&gt;)</span><br><span class="line">    .window(&lt;window assigner&gt;)</span><br><span class="line">    .aggregate(<span class="keyword">new</span> AverageAggregate());</span><br></pre></td></tr></table></figure><ul><li>FoldFunction<br>çª—å£ä¸­çš„å…ƒç´ ä¸ç´¯åŠ å™¨è¿›è¡Œè®¡ç®—ï¼Œæ­¤æ—¶ç´¯åŠ å™¨æœ‰åˆå§‹å€¼ï¼Œå¹¶ä¸”è¾“å‡ºçš„ç»“æœç±»å‹å’Œç´¯åŠ å™¨ç›¸åŒã€‚æ­¤çª—å£å‡½æ•°ä¸èƒ½ç”¨åœ¨åˆå¹¶çª—å£ä¸­ï¼Œæ¯”å¦‚ä¼šè¯çª—å£ã€‚ä½¿ç”¨æ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String, Long&gt;&gt; input = ...;</span><br><span class="line"></span><br><span class="line">input</span><br><span class="line">    .keyBy(&lt;key selector&gt;)</span><br><span class="line">    .window(&lt;window assigner&gt;)</span><br><span class="line">    .fold(<span class="string">&quot;&quot;</span>, <span class="keyword">new</span> FoldFunction&lt;Tuple2&lt;String, Long&gt;, String&gt;&gt; &#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> String <span class="title">fold</span><span class="params">(String acc, Tuple2&lt;String, Long&gt; value)</span> </span>&#123;</span><br><span class="line">         <span class="keyword">return</span> acc + value.f1;</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><ul><li>ProcessWindowFunction<br>ProcessWindowFunctionæœ€çµæ´»ï¼ŒåŒ…å«çš„ä¿¡æ¯ä¹Ÿè¾ƒå¤šï¼Œå¯ä»¥å¯¹æ•´ä¸ªçª—å£ä¸­çš„å…ƒç´ è¿›è¡Œè¿­ä»£è®¡ç®—ï¼Œè¿˜å¯ä»¥è®¿é—®çª—å£çš„ä¸€äº›å…ƒä¿¡æ¯ã€‚ä½†æ˜¯å•çº¯ä½¿ç”¨ProcessWindowFunctionæ—¶ï¼Œç”±äºè¦ç¼“å­˜çª—å£ä¸­çš„æ‰€æœ‰å…ƒç´ ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—ä¸€äº›èµ„æºã€‚ä½¿ç”¨æ ·ä¾‹ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String, Long&gt;&gt; input = ...;</span><br><span class="line"></span><br><span class="line">input</span><br><span class="line">  .keyBy(t -&gt; t.f0)</span><br><span class="line">  .timeWindow(Time.minutes(<span class="number">5</span>))</span><br><span class="line">  .process(<span class="keyword">new</span> MyProcessWindowFunction());</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ... */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessWindowFunction</span> </span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">ProcessWindowFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Long</span>&gt;, <span class="title">String</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String key, Context context, Iterable&lt;Tuple2&lt;String, Long&gt;&gt; input, Collector&lt;String&gt; out)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (Tuple2&lt;String, Long&gt; in: input) &#123;</span><br><span class="line">      count++;</span><br><span class="line">    &#125;</span><br><span class="line">    out.collect(<span class="string">&quot;Window: &quot;</span> + context.window() + <span class="string">&quot;count: &quot;</span> + count);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ProcessWindowFunctionä¸­è®°å½•çš„çª—å£ä¿¡æ¯åœ¨æŠ½è±¡ç±»Contextä¸­ï¼ŒProcessWindowFunctionæŠ½è±¡ç±»å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessWindowFunction</span>&lt;<span class="title">IN</span>, <span class="title">OUT</span>, <span class="title">KEY</span>, <span class="title">W</span> <span class="keyword">extends</span> <span class="title">Window</span>&gt; <span class="keyword">implements</span> <span class="title">Function</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">            KEY key,</span></span></span><br><span class="line"><span class="params"><span class="function">            Context context,</span></span></span><br><span class="line"><span class="params"><span class="function">            Iterable&lt;IN&gt; elements,</span></span></span><br><span class="line"><span class="params"><span class="function">            Collector&lt;OUT&gt; out)</span> <span class="keyword">throws</span> Exception</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">/**</span></span><br><span class="line"><span class="comment">        * The context holding window metadata.</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">       <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Context</span> <span class="keyword">implements</span> <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span> </span>&#123;</span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * Returns the window that is being evaluated.</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> W <span class="title">window</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">           <span class="comment">/** Returns the current processing time. */</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">long</span> <span class="title">currentProcessingTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">           <span class="comment">/** Returns the current event-time watermark. */</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">long</span> <span class="title">currentWatermark</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * State accessor for per-key and per-window state.</span></span><br><span class="line"><span class="comment">            *</span></span><br><span class="line"><span class="comment">            * &lt;p&gt;&lt;b&gt;<span class="doctag">NOTE:</span>&lt;/b&gt;If you use per-window state you have to ensure that you clean it up</span></span><br><span class="line"><span class="comment">            * by implementing &#123;<span class="doctag">@link</span> ProcessWindowFunction#clear(Context)&#125;.</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> KeyedStateStore <span class="title">windowState</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">           <span class="comment">/**</span></span><br><span class="line"><span class="comment">            * State accessor for per-key global state.</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> KeyedStateStore <span class="title">globalState</span><span class="params">()</span></span>;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è™½ç„¶ProcessWindowFunctionæ¯”è¾ƒè€—èµ„æºï¼Œä½†æ˜¯åœ¨æœ‰äº›åœºæ™¯ä¸‹ä»–å¯ä»¥å’Œä¹‹å‰ä»‹ç»çš„å¢é‡èšåˆçª—å£å‡½æ•°ä¸€èµ·ä½¿ç”¨ï¼Œè¿™æ ·ä¸ä»…å¯ä»¥å°†å…ƒç´ è¿›è¡Œå¢é‡èšåˆå‡å°‘èµ„æºæ¶ˆè€—ï¼Œä¹Ÿå¯ä»¥è®¿é—®ProcessWindowFunctionä¸­è®°å½•çš„çª—å£å…ƒä¿¡æ¯ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¯ReduceFunctionå’ŒProcessWindowFunctionç»“åˆä½¿ç”¨çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;SensorReading&gt; input = ...;</span><br><span class="line"></span><br><span class="line">input</span><br><span class="line">  .keyBy(&lt;key selector&gt;)</span><br><span class="line">  .timeWindow(&lt;duration&gt;)</span><br><span class="line">  .reduce(<span class="keyword">new</span> MyReduceFunction(), <span class="keyword">new</span> MyProcessWindowFunction());</span><br><span class="line"></span><br><span class="line"><span class="comment">// Function definitions</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyReduceFunction</span> <span class="keyword">implements</span> <span class="title">ReduceFunction</span>&lt;<span class="title">SensorReading</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> SensorReading <span class="title">reduce</span><span class="params">(SensorReading r1, SensorReading r2)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> r1.value() &gt; r2.value() ? r2 : r1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcessWindowFunction</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">ProcessWindowFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Tuple2</span>&lt;<span class="title">Long</span>, <span class="title">SensorReading</span>&gt;, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(String key,</span></span></span><br><span class="line"><span class="params"><span class="function">                    Context context,</span></span></span><br><span class="line"><span class="params"><span class="function">                    Iterable&lt;SensorReading&gt; minReadings,</span></span></span><br><span class="line"><span class="params"><span class="function">                    Collector&lt;Tuple2&lt;Long, SensorReading&gt;&gt; out)</span> </span>&#123;</span><br><span class="line">      SensorReading min = minReadings.iterator().next();</span><br><span class="line">      out.collect(<span class="keyword">new</span> Tuple2&lt;Long, SensorReading&gt;(context.window().getStart(), min));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="çª—å£åº•å±‚å®ç°"><a href="#çª—å£åº•å±‚å®ç°" class="headerlink" title="çª—å£åº•å±‚å®ç°"></a>çª—å£åº•å±‚å®ç°</h2><p>çª—å£çš„å®ç°åŒ…å«ä¸‰ä¸ªç»„ä»¶ï¼Œåˆ†åˆ«æ˜¯çª—å£åˆ†é…å™¨(WindowAssigner)ã€è§¦å‘å™¨(Trigger)å’Œé©±é€å™¨(Evictor)ã€‚å…¶ä¸­çª—å£åˆ†é…å™¨å†³å®šå…ƒç´ è¯¥åˆ†å‘åˆ°å“ªä¸ªçª—å£ï¼›è§¦å‘å™¨å†³å®šçª—å£ä¸­çš„å…ƒç´ ä½•æ—¶è®¡ç®—æˆ–è€…æ¸…é™¤è¯¥çª—å£ä¸­çš„å…ƒç´ ï¼Œæ¯ä¸ªçª—å£éƒ½æœ‰è‡ªå·±çš„triggerï¼›é©±é€å™¨ç±»ä¼¼è¿‡æ»¤å™¨ï¼Œæ ¹æ®ä¸€å®šè§„åˆ™å°†çª—å£ä¸­éƒ¨åˆ†æ•°æ®æ¸…é™¤æ‰ã€‚å°†è¿™ä¸‰ä¸ªç»„ä»¶çš„ä¸åŒå®ç°ç»„åˆåœ¨ä¸€èµ·ï¼Œå°±èƒ½å®ç°å„ç§çª—å£è®¡ç®—ã€‚</p><ul><li>çª—å£åˆ†é…å™¨(WindowAssigner)</li></ul><blockquote><p>å…ˆçœ‹ä¸‹æ ¸å¿ƒå‡½æ•°<br>assignWindows: å°†å¯¹åº”çš„å…ƒç´ åˆ†é…åˆ°æŒ‡å®šçš„çª—å£ä¸­<br>getDefaultTrigger: è·å–è¯¥çª—å£åˆ†é…å™¨é»˜è®¤æŒ‡å®šçš„Trigger<br>isEventTime: æ˜¯å¦åŸºäºevent timeå¯¹å…ƒç´ è¿›è¡Œåˆ†é…</p></blockquote><p>countWindowä¸­ç”¨çš„æ˜¯GlobalWindowï¼Œæ‰€ä»¥è¯¥åˆ†é…å™¨åªæ˜¯è¿”å›å½“å‰çª—å£å³å¯ã€‚<br>é‡ç‚¹çœ‹ä¸‹timeWindowçš„assignWindowsæ–¹æ³•ï¼Œè¿™é‡Œåªå…³æ³¨ä¸‹<code>SlidingEventTimeWindows</code>çš„<code>assignWindows</code>ï¼Œå› ä¸ºæ»šåŠ¨çª—å£çš„åˆ†é…é€»è¾‘å’Œæ»‘åŠ¨çª—å£ç±»ä¼¼ã€‚<code>SlidingEventTimeWindows.assignWindows</code>ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Collection&lt;TimeWindow&gt; <span class="title">assignWindows</span><span class="params">(Object element, <span class="keyword">long</span> timestamp, WindowAssignerContext context)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (timestamp &gt; Long.MIN_VALUE) &#123;</span><br><span class="line">        <span class="comment">// è®¡ç®—çª—å£å¯ä»¥æœ‰å¤šå°‘ä¸ªæ»‘åŠ¨çª—å£</span></span><br><span class="line">        List&lt;TimeWindow&gt; windows = <span class="keyword">new</span> ArrayList&lt;&gt;((<span class="keyword">int</span>) (size / slide));</span><br><span class="line">        <span class="comment">// å½“å‰å…ƒç´ æ—¶é—´æ‰€åœ¨çš„æœ€è¿‘çª—å£çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">        <span class="keyword">long</span> lastStart = TimeWindow.getWindowStartWithOffset(timestamp, offset, slide);</span><br><span class="line">        <span class="comment">// ç”Ÿæˆè¯¥å…ƒç´ çš„çª—å£</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">long</span> start = lastStart;</span><br><span class="line">            start &gt; timestamp - size;</span><br><span class="line">            start -= slide) &#123;</span><br><span class="line">            <span class="comment">// çª—å£çš„åŒºé—´æ˜¯å‰é—­åå¼€</span></span><br><span class="line">            windows.add(<span class="keyword">new</span> TimeWindow(start, start + size));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> windows;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Record has Long.MIN_VALUE timestamp (= no timestamp marker). &quot;</span> +</span><br><span class="line">                <span class="string">&quot;Is the time characteristic set to &#x27;ProcessingTime&#x27;, or did you forget to call &quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#x27;DataStream.assignTimestampsAndWatermarks(...)&#x27;?&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¸å¿ƒä»£ç é€»è¾‘åœ¨<code>TimeWindow.getWindowStartWithOffset</code>ä¸­ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Method to get the window start for a timestamp.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> timestamp epoch millisecond to get the window start.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> offset The offset which window start would be shifted by.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> windowSize The size of the generated windows.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> window start</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * æ»‘åŠ¨çª—å£å’Œæ»šåŠ¨çª—å£éƒ½æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°è·å–çª—å£çš„èµ·å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * æ»‘åŠ¨çª—å£ä¼ å…¥çš„windowSizeæ˜¯æ»‘åŠ¨çš„å¤§å°ï¼Œå¯¹äºæ»‘åŠ¨çª—å£æŒ‰ç…§slideæ»‘åŠ¨ï¼Œå…¶å®å¯ä»¥ç†è§£æˆé•¿åº¦ä¸ºslideçš„æ»šåŠ¨çª—å£</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getWindowStartWithOffset</span><span class="params">(<span class="keyword">long</span> timestamp, <span class="keyword">long</span> offset, <span class="keyword">long</span> windowSize)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// offset å¯ä»¥ç†è§£æˆæœ€å¼€å§‹åˆ°é‚£ä¸ªçª—å£çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">    <span class="comment">// timestamp - offset ä¸º åˆ°æœ€å¼€å§‹é‚£ä¸ªçª—å£çš„è·ç¦»</span></span><br><span class="line">    <span class="comment">// (timestamp - offset + windowSize) % windowSize ç¦»æœ€è¿‘çª—å£çš„è·ç¦»ï¼Œç›¸å½“äºtimestamp - offset - windowSize - windowSize ...</span></span><br><span class="line">    <span class="comment">// timestamp - (timestamp - offset + windowSize) % windowSize åˆ™ä¸ºæœ€è¿‘çª—å£çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">    <span class="keyword">return</span> timestamp - (timestamp - offset + windowSize) % windowSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>è§¦å‘å™¨(Trigger)</li></ul><blockquote><p>å…ˆçœ‹ä¸‹æ ¸å¿ƒå‡½æ•°<br>onElement: å¤„ç†æ¯ä¸ªæ·»åŠ åˆ°çª—å£ä¸­çš„å…ƒç´ <br>onEventTime: TriggerContextä¸­æ³¨å†Œçš„event-time timerè¢«è§¦å‘æ—¶è°ƒç”¨<br>onProcessingTime: TriggerContextä¸­æ³¨å†Œçš„processing-time timerè¢«è§¦å‘æ—¶è°ƒç”¨<br>onMerge: windowè¢«mergeæ—¶è§¦å‘</p></blockquote><p>åœ¨WindowAssignerä¸­ï¼Œä¼šè°ƒç”¨getDefaultTriggerå¾—åˆ°è¯¥çª—å£çš„é»˜è®¤è§¦å‘å™¨ã€‚è¿™é‡Œçœ‹ä¸‹<code>SlidingEventTimeWindows</code>çš„é»˜è®¤triggerâ€“<code>EventTimeTrigger</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> TriggerResult <span class="title">onElement</span><span class="params">(Object element, <span class="keyword">long</span> timestamp, TimeWindow window, TriggerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// element æ‰€åœ¨çš„ windowï¼ŒmaxTimestampä¸ºend-1</span></span><br><span class="line">    <span class="comment">// wartermarkæ˜¯å®šæœŸç”Ÿæˆçš„ï¼ŒmaxTimestampæ­£å¸¸åº”è¯¥æ˜¯å¤§äºwartermarkçš„</span></span><br><span class="line">    <span class="comment">// windowçš„maxTimestampæ˜¯ä¸å˜çš„ï¼Œwartermarkæ˜¯å‘¨æœŸæ€§å˜åŒ–çš„</span></span><br><span class="line">    <span class="comment">// åˆ™onElementä¸€èˆ¬ä¸ä¼šè§¦å‘FIRE</span></span><br><span class="line">    <span class="comment">// è¿Ÿåˆ°æ—¶ä¼šè§¦å‘</span></span><br><span class="line">    <span class="comment">// å‡å¦‚ä¸€ç›´æ²¡æœ‰è¿Ÿåˆ°çš„æ•°æ®åˆ°è¾¾æ˜¯ä¸æ˜¯å°±ä¸ä¼šåœ¨è¿™é‡Œè§¦å‘ï¼Œ</span></span><br><span class="line">    <span class="comment">// å‡å¦‚è¿Ÿåˆ°çš„æ•°æ®åˆ°è¾¾äº†ï¼Œä½†æ˜¯è¯¥çª—å£å·²ç»ç”±Timeè§¦å‘äº†FIREæ€ä¹ˆåŠï¼Ÿï¼Ÿ</span></span><br><span class="line">    <span class="comment">// è¿Ÿåˆ°å’Œä¹±åºçš„ç†è§£ï¼šè¿Ÿåˆ°ä¼šå†æ¬¡è§¦å‘windowè®¡ç®—ï¼Œä¹±åºæ˜¯windowç­‰å¾…ä¸€æ®µæ—¶é—´è¿›è¡Œè®¡ç®—ï¼Œåªè®¡ç®—ä¸€æ¬¡ã€‚</span></span><br><span class="line">    <span class="comment">// è¿Ÿåˆ°ä¼šè§¦å‘å¤šæ¬¡ï¼Œåªè¦åœ¨è§„å®šçš„æœ€å¤§è¿Ÿåˆ°æ—¶é—´å†…éƒ½ä¼šè§¦å‘è®¡ç®—</span></span><br><span class="line">    <span class="keyword">if</span> (window.maxTimestamp() &lt;= ctx.getCurrentWatermark()) &#123;</span><br><span class="line">        <span class="comment">// if the watermark is already past the window fire immediately</span></span><br><span class="line">        <span class="keyword">return</span> TriggerResult.FIRE;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ctx.registerEventTimeTimer(window.maxTimestamp());</span><br><span class="line">        <span class="keyword">return</span> TriggerResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ€åä¸€ç§’ä¸­çš„ç¬¬ä¸€æ¡æ•°æ®è§¦å‘çª—å£è®¡ç®—ï¼Œé‚£è¿™ä¹‹åçš„æ•°æ®æ€ä¹ˆè®¡ç®—ï¼Ÿ</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> TriggerResult <span class="title">onEventTime</span><span class="params">(<span class="keyword">long</span> time, TimeWindow window, TriggerContext ctx)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> time == window.maxTimestamp() ?</span><br><span class="line">        TriggerResult.FIRE :</span><br><span class="line">        TriggerResult.CONTINUE;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><!--ContinuousEventTimeTriggerï¼šæŒ‡å®šçš„ interval ä»¥åŠ event window çš„è¾¹ç•Œå°äºå½“å‰ watermark æ—¶è§¦å‘ onEventTime è®¡ç®—ContinuousProessingTimeTriggerï¼šæŒ‡å®šçš„ interval è§¦å‘ onProcessingTime è®¡ç®—CountTrigger: æŒ‡å®šçš„ maxCount è§¦å‘ï¼Œå‡ºå‘å maxCount æ¸…é›¶é‡æ–°ç´¯åŠ DeltaTrigger: æä¾› delta å‡½æ•°å’Œå†å² datapoint å­˜å‚¨ï¼Œæ¯ä¸ªå…ƒç´ æ¶ˆè´¹æ—¶è§¦å‘ delta å‡½æ•°è®¡ç®—EventTimeTriggerï¼ševent window çš„è¾¹ç•Œå°äºå½“å‰ watermark æ—¶è§¦å‘ onEventTime è®¡ç®—  æ˜¯å°äºè¿˜æ˜¯å¤§äºï¼Ÿï¼Ÿï¼ŸProessingTimeTriggerï¼ševent window çš„è¾¹ç•Œå°äºå½“å‰ watermark æ—¶è§¦å‘ onProcessingTime è®¡ç®—--><ul><li>é©±é€å™¨(Evictor)</li></ul><blockquote><p>å…ˆçœ‹ä¸‹æ ¸å¿ƒå‡½æ•°<br>evictBefore: åœ¨è§¦å‘çª—å£å‡½æ•°è®¡ç®—ä¹‹å‰å¯¹çª—å£ä¸­çš„å…ƒç´ è¿›è¡Œè¿‡æ»¤<br>evictAfter: åœ¨è§¦å‘çª—å£å‡½æ•°è®¡ç®—ä¹‹åå¯¹çª—å£ä¸­çš„å…ƒç´ è¿›è¡Œè¿‡æ»¤<br>evict: è¿‡æ»¤çª—å£ä¸­å…ƒç´ çš„å…·ä½“å®ç°ï¼Œåœ¨evictBeforeæˆ–è€…evictAfterå†…è°ƒç”¨</p></blockquote><p>å®Œæ•´çš„çª—å£è®¡ç®—æµç¨‹ï¼Œç»å†äº† Window Assigner -&gt; Trigger -&gt; Evictor -&gt; Evaluation Function çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆè·å¾—ç»“æœã€‚</p><!--ä½•ä¸ºwindowï¼Œwindowç±»å‹ï¼Œå¦‚ä½•ä½¿ç”¨ä»¥åŠè‡ªå®šä¹‰ window functionå®ä¾‹ç”¨èµ·æ¥å¾ˆçˆ½ï¼Œä½†æ˜¯windowæ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿå¦‚ä½•å®ç°ï¼Œå€ŸåŠ©trigger ev watermarktriggerè®¡æ—¶å™¨çš„ä½œç”¨ï¼Ÿåœ¨å“ªç”¨ï¼Ÿ å¦‚ä½•è§¦å‘ï¼Ÿ æ˜¯å®šæ—¶å™¨è¿˜æ˜¯watermark    triggerä¼šç”Ÿæˆçª—å£ï¼Œtriggerè®¡æ—¶å™¨åˆ°ä¹‹åè¿›è¡Œçª—å£functionè®¡ç®—è§¦å‘å™¨ï¼ˆTriggerï¼‰æä¾›äº†ä¸€ç§çµæ´»çš„æœºåˆ¶æ¥å†³å®šçª—å£çš„è®¡ç®—ç»“æœåœ¨ä»€ä¹ˆæ—¶å€™å¯¹å¤–è¾“å‡ºã€‚ç†è®ºä¸Šæ¥è¯´ï¼Œåªæœ‰ä¸¤ç§ç±»å‹çš„è§¦å‘å™¨ï¼Œå¤§éƒ¨åˆ†çš„åº”ç”¨éƒ½æ˜¯é€‰æ‹©å…¶ä¸€æˆ–ç»„åˆä½¿ç”¨ï¼šRepeated update triggersï¼šé‡å¤æ›´æ–°çª—å£çš„è®¡ç®—ç»“æœï¼Œæ›´æ–°å¯ä»¥æ˜¯ç”±æ–°æ¶ˆæ¯åˆ°è¾¾æ—¶è§¦å‘ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¯ä¸ªä¸€æ®µæ—¶é—´ï¼ˆå¦‚1åˆ†é’Ÿï¼‰è¿›è¡Œè§¦å‘Completeness triggersï¼šåœ¨çª—å£ç»“æŸæ—¶è¿›è¡Œè§¦å‘ï¼Œè¿™æ˜¯æ›´ç¬¦åˆç›´è§‰çš„ä½¿ç”¨æ–¹æ³•ï¼Œä¹Ÿå’Œæ‰¹å¤„ç†æ¨¡å¼çš„è®¡ç®—ç»“æœç›¸å»åˆã€‚ä½†æ˜¯éœ€è¦ä¸€ç§æœºåˆ¶æ¥è¡¡é‡ä¸€ä¸ªçª—å£çš„æ‰€æœ‰æ¶ˆæ¯éƒ½å·²ç»è¢«æ­£ç¡®åœ°å¤„ç†äº†ã€‚ev åˆ©ç”¨çŠ¶æ€è¿›è¡Œè¿‡æ»¤watermark   Watermark æ˜¯ç”¨æ¥è¿½è¸ªä¸šåŠ¡äº‹ä»¶çš„æ¦‚å¿µï¼Œå¯ä»¥ç†è§£æˆ EventTime ä¸–ç•Œä¸­çš„æ—¶é’Ÿï¼Œç”¨æ¥æŒ‡ç¤ºå½“å‰å¤„ç†åˆ°ä»€ä¹ˆæ—¶åˆ»çš„æ•°æ®äº†    æ°´å°æ˜¯é’ˆå¯¹äº‹ä»¶æ—¶é—´çš„æ¦‚å¿µï¼Œæä¾›äº†ä¸€ç§äº‹ä»¶æ—¶é—´ç›¸å¯¹äºå¤„ç†æ—¶é—´æ˜¯ä¹±åºçš„ç³»ç»Ÿä¸­åˆç†æ¨æµ‹æ— ç•Œæ•°æ®é›†é‡Œæ•°æ®å®Œæ•´æ€§çš„å·¥å…·    ä½•ä¸ºwatermark    æœ‰ä½•ä½œç”¨    å¦‚ä½•ç”Ÿæˆ   è‡ªåŠ¨ç”Ÿæˆ setAutoWatermarkInterval    watermarkä¸triggerå¦‚ä½•ç›¸äº’ä½œç”¨    ä¸€ä¸ªçª—å£å¯ä»¥æœ‰å¤šä¸ªwatermarkï¼Œå¤šä¸ªwatermarkå¦‚ä½•è§¦å‘çª—å£çš„ï¼Œå½“å‰watermarkè§¦å‘ä¸Šä¸€ä¸ªçª—å£çš„è®¡ç®—ï¼Ÿï¼Ÿï¼Ÿ    å½“å‰ç³»ç»Ÿçš„ watermark ä¸ºæ—¶é—´ Tï¼Œé‚£ä¹ˆç³»ç»Ÿè®¤ä¸ºæ‰€æœ‰äº‹ä»¶æ—¶é—´å°äº T çš„æ¶ˆæ¯éƒ½å·²ç»åˆ°è¾¾ï¼Œå³ç³»ç»Ÿä»»åŠ¡å®ƒä¸ä¼šå†æ¥æ”¶åˆ°äº‹ä»¶æ—¶é—´å°äº T çš„æ¶ˆæ¯äº†å¤šæµä¹±åº    watermark å¤§çš„æ•°æ®ä¼šç¼“å­˜å—ï¼Ÿhttps://www.jianshu.com/p/b9b23a7cb880https://www.jianshu.com/p/c8c789ff5570window éƒ½æä¾›äº†window operator    åœ¨windowedStreamä¸­çš„windowFunctionæŒ‡å®šwindowOperatorç»¼åˆearly fireã€late fireã€æ°´å°æ—¶é—´ä¸çª—å£ç»“æŸæ—¶é—´ï¼Œç»¼åˆåˆ¤æ–­æ˜¯å¦è§¦å‘çª—å£å½“æœªæ¥æŸä¸ªwatermarkçš„æ—¶é—´æˆ³å¤§äºè¯¥triggerçš„æ³¨å†Œæ—¶é—´æ—¶ï¼Œå°±ä¼šè§¦å‘triggerï¼Œæ‰§è¡Œè¯¥triggeræ‰€åœ¨çš„window operatorçš„window processè¿›è¡Œè®¡ç®—ã€‚WindowOperator å®šä¹‰äº†window assigner, trigger, windowProcessFunction çš„æ‰§è¡Œé¡ºåºå¦‚ä½•ï¼Œå®ƒä»¬ä¹‹é—´çš„æ‰§è¡Œé€»è¾‘ç­‰triggerè¿‡æœŸè¿˜æ˜¯çª—å£è¿‡æœŸ watermarkè¿‡æœŸTimeræ€ä¹ˆè§¦å‘ï¼Ÿapplyï¼šè‡ªå®šä¹‰window functionprocessElementå¤„ç†æ•°æ®æµç¨‹ï¼šaã€ è·å–å½“å‰recordå…·æœ‰çš„äº‹ä»¶æ—¶é—´ï¼Œå¦‚æœæ˜¯Processing Timeæ¨¡å¼ï¼Œä»æ—¶é—´æœåŠ¡Serviceé‡Œé¢è·å–æ—¶é—´å³å¯bã€ä½¿ç”¨ä¸Šä¸€æ­¥è·å–çš„æ—¶é—´ï¼Œæ¥ç€è°ƒç”¨windowFunction.assignWindowç”Ÿæˆçª—å£ï¼Œå…¶å†…éƒ¨å®é™…ä¸Šæ˜¯è°ƒç”¨å„ç±»å‹çš„WindowAssignerç”Ÿæˆçª—å£ï¼ŒwindowFunctionæœ‰ä¸‰å¤§ç±»ï¼Œåˆ†åˆ«æ˜¯Panedï¼ˆæ»‘åŠ¨ï¼‰ã€Mergeï¼ˆä¼šè¯ï¼‰ã€Generalï¼ˆå‰ä¸¤ç§ä»¥å¤–çš„ï¼‰ï¼ŒWindowAssignerç±»å‹å¤§è‡´æœ‰5ç±»ï¼Œåˆ†åˆ«æ˜¯Tumblingï¼ˆç¿»è½¬ï¼‰ã€Slidingï¼ˆæ»‘åŠ¨ï¼‰ã€Sessionï¼ˆä¼šè¯ï¼‰ã€CountTumbling ã€CountSlideè¿™å‡ ç±»,æ ¹æ®è¾“å…¥çš„ä¸€æ¡æ•°æ®å’Œæ—¶é—´ï¼Œå¯ä»¥ç”Ÿæˆ1åˆ°å¤šä¸ªçª—å£cã€æ¥ä¸‹æ¥æ˜¯éå†æ¶‰åŠçš„çª—å£è¿›è¡Œèšåˆï¼ŒåŒ…æ‹¬ä»windowStateè·å–èšåˆå‰å€¼ã€ä½¿ç”¨å¥æŸ„è¿›è¡Œèšåˆã€æ›´æ–°çŠ¶æ€è‡³windowStateï¼Œå°†å½“å‰è½¬æ€dã€ä¸Šä¸€æ­¥èšåˆå®Œæˆåï¼Œå°±å¯ä»¥éå†çª—å£ï¼Œä½¿ç”¨TriggerContextï¼ˆå…¶å®å°±æ˜¯ä¸åŒç±»å‹çª—å£Triggerè§¦å‘å™¨çš„ä»£ç†ï¼‰ï¼Œç»¼åˆearly fireã€late fireã€æ°´å°æ—¶é—´ä¸çª—å£ç»“æŸæ—¶é—´ï¼Œç»¼åˆåˆ¤æ–­æ˜¯å¦è§¦å‘çª—å£å†™å‡ºeã€å¦‚æœTriggerContextåˆ¤æ–­å‡ºè§¦å‘æ¡ä»¶ä¸ºtrueï¼Œåˆ™è°ƒç”¨emitWindowResultå†™å‡ºï¼Œå…¶å†…éƒ¨æœ‰retractåˆ¤æ–­ï¼Œæ›´æ–°å½“å‰stateåŠprevious stateï¼Œå†™å‡ºæ•°æ®ç­‰æ“ä½œfã€å¦‚æœTriggerContextåˆ¤æ–­å‡ºè§¦å‘æ¡ä»¶ä¸ºfalseï¼Œåˆ™è§¦å‘éœ€è¦æ³¨å†ŒcleanupTimer,åˆ°è¾¾æŒ‡å®šæ—¶é—´åï¼Œè§¦å‘onEventTimeæˆ–onProcessingTimegã€onEventTimeæˆ–onProcessingTimeåŠŸèƒ½ååˆ†ç±»ä¼¼ï¼Œé¦–å…ˆä¼šè§¦å‘emitWindowResultæäº¤ç»“æœï¼Œå¦å¤–ä¼šåˆ¤æ–­çª—å£ç»“æŸæ—¶é—´+Latenesså’Œå½“å‰æ—¶é—´æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰åˆ™è¡¨ç¤ºå¯ä»¥æ¸…é™¤çª—å£æ•°æ®ã€å½“å‰stateåŠprevious stateã€çª—å£å¯¹åº”triggerã€‚å…ƒç´ åœ¨streaming dataflowå¼•æ“ä¸­æµåŠ¨åˆ°WindowOperatoræ—¶ï¼Œä¼šè¢«åˆ†ä¸ºä¸¤æ‹¨ï¼Œåˆ†åˆ«æ˜¯æ™®é€šäº‹ä»¶å’Œæ°´å°ã€‚WatermarkAssignerOperator.advanceWatermark -> OperatorChain.emitWatermark -> operator.processWatermark-->]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿‘å‡ å¹´æµå¤„ç†ç®€ç›´ç«çš„ä¸€å¡Œç³Šæ¶‚ï¼ŒFlinkä¹Ÿåœ¨é˜¿é‡Œçš„æ¨å¹¿ä¸‹é€æ¸æˆä¸ºä¸šç•Œä¸»æµï¼Œæ­£åœ¨é€æ­¥å–ä»£Stormå’ŒSpark Streamingã€‚&lt;br&gt;Flinkå¤©ç”Ÿå°±æ˜¯ä¸ºäº†å¤„ç†æµï¼Œè€Œä¸”ç›¸å¯¹äºå…¶ä»–æµå¤„ç†æ¡†æ¶é›†æˆäº†å¾ˆå¤šå®ç”¨åŠŸèƒ½ï¼Œæ¯”å¦‚çŠ¶æ€ç®¡ç†ï¼›Flinkè¿˜ä¸°å¯Œäº†windowçš„åŠŸèƒ½ï¼Œä½¿windowä¹Ÿæˆä¸ºäº†Flinkçš„ä¸€ä¸ªç‰¹è‰²ã€‚&lt;br&gt;æœ¬ç¯‡ä¸»è¦å¯¹windowä»å¤šç§è§’åº¦è¿›è¡Œè§£å¯†ï¼Œä¸»è¦åŒ…æ‹¬ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä½•ä¸ºwindow&lt;/li&gt;
&lt;li&gt;å¦‚ä½•ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;å¦‚ä½•å®ç°&lt;/li&gt;
&lt;li&gt;å„ç»„ä»¶åŸç†&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;åœ¨è§£å¯†windowä¹‹å‰ï¼Œç®€å•ä»‹ç»ä¸‹ä½•ä¸ºæµå¤„ç†ï¼Ÿ&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="Flink" scheme="http://yuanba.tech/categories/Flink/"/>
    
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="Flink" scheme="http://yuanba.tech/tags/Flink/"/>
    
    <category term="window" scheme="http://yuanba.tech/tags/window/"/>
    
  </entry>
  
  <entry>
    <title>golangæ–°æ‰‹å…¥é—¨</title>
    <link href="http://yuanba.tech/golang-newbie.html"/>
    <id>http://yuanba.tech/golang-newbie.html</id>
    <published>2019-11-02T03:33:12.000Z</published>
    <updated>2019-11-02T03:33:12.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Goå¼€å‘ç¯å¢ƒé…ç½®"><a href="#Goå¼€å‘ç¯å¢ƒé…ç½®" class="headerlink" title="Goå¼€å‘ç¯å¢ƒé…ç½®"></a>Goå¼€å‘ç¯å¢ƒé…ç½®</h2><p>â€‹    é€‰æ‹©æ“ä½œç³»ç»Ÿå¯¹åº”çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å®‰è£…åŒ…è¿›è¡Œä¸€é”®å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½tar/zipåŒ…è¿›è¡Œè‡ªå®šä¹‰å®‰è£…ã€‚è‡ªå®šä¹‰å®‰è£…æ—¶éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­æŒ‡å®š<code>GOROOT</code>å’Œ<code>GOPATH</code>ï¼Œ<code>GOROOT</code>æ˜¯taråŒ…çš„è§£å‹ç›®å½•ï¼Œ<code>GOPATH</code>æ˜¯Goå·¥ç¨‹é¡¹ç›®ç›®å½•ï¼Œè¿™é‡Œä¸ä»…å­˜å‚¨è¿™è‡ªå·±å¼€å‘çš„é¡¹ç›®ä¹Ÿå­˜æ”¾ç€é¡¹ç›®æ‰€ä¾èµ–åŒ…çš„æºç åŠäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><span id="more"></span><h2 id="Goé¡¹ç›®ç›®å½•"><a href="#Goé¡¹ç›®ç›®å½•" class="headerlink" title="Goé¡¹ç›®ç›®å½•"></a>Goé¡¹ç›®ç›®å½•</h2><p>â€‹    ä½¿ç”¨æŸç§ç¼–ç¨‹è¯­è¨€æˆ–è€…æŸä¸ªç¼–ç¨‹æ¡†æ¶å¼€å‘çš„é¡¹ç›®éƒ½æœ‰è‡ªå·±ç‰¹æœ‰çš„ç›®å½•ç»“æ„ï¼Œæ‰€ä»¥å­¦ä¹ ä¸€é—¨æ–°è¯­è¨€æˆ–è€…ç¼–ç¨‹æ¡†æ¶æ—¶è¦å…ˆç†Ÿæ‚‰å…¶é¡¹ç›®çš„å·¥ç¨‹ç›®å½•ç»“æ„ã€‚Goçš„å·¥ç¨‹ç›®å½•æ˜¯ä¸€ä¸ªå±‚çº§ç›®å½•ï¼Œç¬¬ä¸€å±‚æœ‰ä¸¤ä¸ªç›®å½•<code>bin</code>å’Œ<code>src</code>ä¸¤ä¸ªç›®å½•ï¼Œ<code>bin</code>æ–‡ä»¶ä¸­å­˜æ”¾çš„æ˜¯Goç¼–è¯‘ä¹‹åçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œ<code>src</code>æ–‡ä»¶å¤¹ä¸­å­˜æ”¾çš„éƒ½æ˜¯é¡¹ç›®æºæ–‡ä»¶ï¼Œé¡¹ç›®çš„ç›®å½•ç»“æ„å¯æ ¹æ®ä»£ç åŠŸèƒ½è¿›è¡Œåˆ’åˆ†ã€‚Goå·¥ç¨‹é¡¹ç›®ç»“æ„æ ·ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">bin/</span><br><span class="line">    hello                          <span class="comment"># command executable</span></span><br><span class="line">    outyet                         <span class="comment"># command executable</span></span><br><span class="line">src/</span><br><span class="line">    github.com/golang/example/</span><br><span class="line">        .git/                      <span class="comment"># Git repository metadata</span></span><br><span class="line">        hello/</span><br><span class="line">            hello.go               <span class="comment"># command source</span></span><br><span class="line">        outyet/</span><br><span class="line">            main.go                <span class="comment"># command source</span></span><br><span class="line">            main_test.go           <span class="comment"># test source</span></span><br><span class="line">        stringutil/</span><br><span class="line">            reverse.go             <span class="comment"># package source</span></span><br><span class="line">            reverse_test.go        <span class="comment"># test source</span></span><br><span class="line">    golang.org/x/image/</span><br><span class="line">        .git/                      <span class="comment"># Git repository metadata</span></span><br><span class="line">        bmp/</span><br><span class="line">            reader.go              <span class="comment"># package source</span></span><br><span class="line">            writer.go              <span class="comment"># package source</span></span><br><span class="line">    ... (many more repositories and packages omitted) ...</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„<code>src</code>ç›®å½•æœ‰ä¸¤ä¸ªGoé¡¹ç›®ï¼Œåˆ†åˆ«æ˜¯<code>example</code>å’Œ<code>image</code>ã€‚<code>example</code>ä¸­æœ‰ä¸‰ä¸ªæ–‡ä»¶å¤¹ï¼Œå…¶ä¸­<code>hello</code>å’Œ<code>outyet</code>åˆ†åˆ«åŒ…å«å¯æ‰§è¡Œå‘½ä»¤çš„æ–‡ä»¶ï¼Œ<code>stringutil</code>æ˜¯ä¸€ä¸ªå·¥å…·åŒ…ã€‚<code>image</code>ä¸­æ²¡æœ‰åŒ…å«å¯æ‰§è¡Œå‘½ä»¤çš„æ–‡ä»¶ï¼Œåªæœ‰ä¸€ä¸ªbmpçš„å·¥å…·åŒ…å’Œå…¶å®ƒå·¥å…·åŒ…ã€‚é€šè¿‡<code>go install</code>å‘½ä»¤ç¼–è¯‘<code>example</code>é¡¹ç›®ä¼š<code>bin</code>ç›®å½•ä¸­å¢åŠ ä¸¤ä¸ªå¯æ‰§è¡Œæ–‡ä»¶<code>hello</code>å’Œ<code>outyet</code></p><p>â€‹    Goçš„å·¥ç¨‹ç›®å½•å…¶å®å°±æ˜¯åœ¨ä¸Šä¸€èŠ‚ä¸­è®¾ç½®çš„<code>GOPATH</code>ï¼Œé»˜è®¤ç›®å½•åæ˜¯<code>go</code>ï¼Œä¼šå½“å‰ç”¨æˆ·homeç›®å½•ä¸‹åˆ›å»ºæ­¤æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚Linuxä¸º<code>$HOME/go</code>ï¼Œwinä¸º<code>C:\Users\YourName\go</code>ã€‚å¯ä»¥é€šè¿‡<code>export GOPATH=xx</code>è®¾ç½®ä»»æ„ç›®å½•ï¼Œä¸è¿‡ä¸èƒ½æ˜¯Goçš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå°±æ˜¯<code>GOROOT</code>ã€‚</p><p>â€‹    Goæä¾›äº†<code>env</code>å‘½ä»¤ï¼Œå®ƒå¯ä»¥è¾“å‡ºç¯å¢ƒå˜é‡çš„å€¼ï¼Œä¾‹å¦‚æ‰§è¡Œå‘½ä»¤<code>go env GOPATH</code>ï¼Œå¦‚æœä¸ºäº†æ‰§è¡ŒGoç¼–è¯‘çš„å¯æ‰§è¡Œæ–‡ä»¶æ–¹ä¾¿ï¼Œå¯å°†<code>GOPATH</code>ç›®å½•æ·»åŠ åˆ°PATHç¯å¢ƒå˜é‡é‡Œï¼Œå¢åŠ <code>export PATH=$PATH:$(go env GOPATH)/bin</code></p><h2 id="Go-Go-Go"><a href="#Go-Go-Go" class="headerlink" title="Go Go Go!"></a>Go Go Go!</h2><p>â€‹    ç¯å¢ƒéƒ¨ç½²å¥½ï¼Œä¹Ÿç†Ÿæ‚‰äº†Goé¡¹ç›®çš„ç›®å½•ç»“æ„ï¼Œä¸‹é¢æ¥ä¸ª<code>Go Go Go!</code>æ‰¾ä¸‹Hello Worldçš„æ„Ÿè§‰ã€‚åœ¨<code>$GOPATH/src</code>ç›®å½•ä¸‹åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹go-testï¼Œç„¶ååœ¨æ­¤ç›®å½•æ–°å»ºä¸€ä¸ª<code>hello.go</code>çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, Go Go Go!&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯åœ¨IDEä¸­å¯ä»¥ç›´æ¥ç‚¹å‡»å³é”®æ‰§è¡Œï¼Œä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œ<code>go run hello.go </code>æ‰§è¡Œã€‚Goå¯ä»¥ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ‰§è¡Œè¿è¡Œï¼Œæ‰§è¡Œå‘½ä»¤<code>go install go-test</code>ï¼Œå…¶ä¸­go-testæ˜¯é¡¹ç›®ç›¸å¯¹äºGOPATHçš„ç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨go-testç›®å½•ä¸‹æ‰§è¡Œ<code>go install</code>ï¼Œæ­¤å‘½ä»¤æˆåŠŸä¹‹åä¼šåœ¨<code>$GOPATH/bin</code>ç›®å½•ä¸‹å¢åŠ ä¸€ä¸ª<code>go-test</code>çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆå¦‚æœæ˜¯winï¼Œåˆ™æ˜¯<code>go-test.exe</code>ï¼‰ã€‚<code>go install</code>æ²¡æœ‰ä»»ä½•è¾“å‡ºä»£è¡¨æ‰§è¡ŒæˆåŠŸï¼Œæ‰§è¡Œå¼‚å¸¸æ—¶ä¼šæœ‰é”™è¯¯è¾“å‡ºï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  go-test go install</span><br><span class="line"><span class="comment"># go-test</span></span><br><span class="line">./t.go:3:6: main redeclared <span class="keyword">in</span> this block</span><br><span class="line">        previous declaration at ./hello.go:8:6</span><br></pre></td></tr></table></figure><p>æ‰§è¡ŒæˆåŠŸå¯ä»¥ç›´æ¥æ‰§è¡Œ<code>$GOPATH/bin/go-test</code>ã€‚</p><p>â€‹    Goå’Œå…¶å®ƒè¯­è¨€ç±»ä¼¼ï¼Œä¹Ÿéœ€è¦åœ¨æ–‡ä»¶å¼€å¤´å¼•å…¥ä¸€äº›åŒ…ï¼Œä½¿ç”¨å‘½ä»¤<code>import</code>ï¼Œä¾‹å¦‚<code>hello.go</code>ä¸­çš„<code>import &quot;fmt&quot;</code>ï¼Œ<code>fmt</code>æ˜¯Goè‡ªå¸¦çš„æ ‡å‡†ä¾èµ–åŒ…ï¼Œå¦‚æœè¦å¼•ç”¨å…¶å®ƒä¾èµ–åŒ…åˆ™éœ€è¦ä¾èµ–åŒ…åœ¨<code>$GOPATH</code>ä¸­çš„ç›¸å¯¹è·¯å¾„ï¼Œè¿™ä¸ªç›¸å¯¹è·¯å¾„æ˜¯æ¯ä¸ªä¾èµ–åŒ…çš„å”¯ä¸€æ ‡è¯†ã€‚</p><p>â€‹    ç”±äºGoè¯­è¨€å¤©ç”Ÿçš„å¼€æºç‰¹æ€§ï¼Œå¾ˆå¤šä¾èµ–åŒ…çš„å¼€æºä½œè€…éƒ½ä¹ æƒ¯ä½¿ç”¨GitHubæ¥ç®¡ç†è‡ªå·±çš„ä»£ç ï¼Œåœ¨importæ—¶å†™<code>github.com/user/pro</code>å³å¯ï¼Œè€Œä¸”è¿˜å¯ä»¥é€‰æ‹©ä¸åŒçš„ç‰ˆæœ¬ï¼Œæ–¹ä¾¿çš„å¾ˆã€‚æ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨<code>$GOPATH</code>ä¸­åˆ›å»ºè‡ªå·±çš„GitHubç›®å½•ï¼ˆå³ä½¿ä½ æ²¡æœ‰GitHubè´¦å·ï¼Œä½†ä¸ºäº†æ–¹ä¾¿ä½ æŸä¸€å¤©æƒ³æŠŠè‡ªå·±çš„ä»£ç å¼€æºå‡ºå»è®©æ›´å¤šçš„äººä½¿ç”¨ï¼‰ï¼Œå‡å¦‚Githubè´¦å·æ˜¯go-testï¼Œåˆ›å»ºç›®å½•<code>mkdir -p $GOPATH/src/github.com/go-test</code>ï¼Œç„¶åå°†ä¸Šé¢çš„<code>hello.go</code>ä»£ç ç§»åˆ°è¯¥ç›®å½•ä¸­ã€‚</p><p>â€‹    å¦‚æœåœ¨ä»£ç ä¸­å¼•å…¥äº†Githubä¸Šçš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…ï¼Œä½¿ç”¨<code>go get github.com/user/pro</code>ä¸‹è½½ä¾èµ–åˆ°æœ¬åœ°$GOPATHä¸­ï¼Œå¦‚ä½•å¼•å…¥è‡ªå·±å¼€å‘çš„ç¬¬ä¸‰æ–¹ä¾èµ–åŒ…å‘¢æˆ–è€…å¦‚ä½•å¼€å‘ä¸€ä¸ªä¾èµ–åŒ…ã€‚</p><p>â€‹    å¼€å‘ä¸€ä¸ªä¾èµ–åŒ…é¦–å…ˆæƒ³ä¸€ä¸ªåŒ…åï¼Œè¿™ä¸ªåŒ…ååœ¨è‡ªå·±å¼€å‘çš„é¡¹ç›®ä¸­ä¸èƒ½é‡å¤ï¼Œå› ä¸ºGoå¯¼å…¥ç¬¬ä¸‰æ–¹ä¾èµ–æ—¶æ˜¯å¯¼å…¥åŒ…è·¯å¾„ã€‚è¿™é‡Œç»™<code>hello.go</code>å¢åŠ ä¸€ä¸ª<code>stringutil</code>çš„ä¾èµ–ï¼Œåˆ›å»ºç›®å½•<code>mkdir $GOPATH/src/github.com/go-test/stringutil</code>ï¼Œåœ¨æ­¤ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª <code>reverse.go</code>çš„æ–‡ä»¶ï¼Œå¤åˆ¶å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package stringutil contains utility functions for working with strings.</span></span><br><span class="line"><span class="keyword">package</span> stringutil</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reverse returns its argument string reversed rune-wise left to right.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Reverse</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">r := []<span class="keyword">rune</span>(s)</span><br><span class="line"><span class="keyword">for</span> i, j := <span class="number">0</span>, <span class="built_in">len</span>(r)<span class="number">-1</span>; i &lt; <span class="built_in">len</span>(r)/<span class="number">2</span>; i, j = i+<span class="number">1</span>, j<span class="number">-1</span> &#123;</span><br><span class="line">r[i], r[j] = r[j], r[i]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">string</span>(r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾èµ–åŒ…ä½¿ç”¨ <code>go build</code>è¿›è¡Œç¼–è¯‘ï¼Œå‘½ä»¤æ‰§è¡Œä¹‹åä¸<code>go install</code>ä¸€æ ·ä¸ä¼šæ‰“å°ä»»ä½•ä¿¡æ¯ï¼Œä¸åŒçš„æ˜¯<code>go install</code>ä¼šåœ¨<code>$GOPATH/bin</code>ä¸­è¾“å‡ºä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè€Œ <code>go build</code>æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œåªæ˜¯å°†ç¼–è¯‘çš„ç»“æœæ”¾å…¥æœ¬åœ°build cacheä¸­ã€‚</p><p>â€‹    ä¾èµ–åŒ…ç¼–è¯‘æˆåŠŸä¹‹åå°±å¯ä»¥å¼•ç”¨äº†ï¼Œåœ¨ä¸Šè¿°çš„<code>hello.go</code>ä¸­æ·»åŠ ä¾èµ–ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;github.com/go-test/stringutil&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Hello, Go Go Go!&quot;</span>)</span><br><span class="line">fmt.Println(stringutil.Reverse(<span class="string">&quot;!oG ,olleH&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>go install</code>ï¼Œéšåå°±å¯ä»¥æ‰§è¡Œ<code>go-test</code>ã€‚</p><p>â€‹    å†™å®Œä¸Šé¢çš„ä»£ç ï¼Œæ­¤æ—¶å¯èƒ½æœ‰äº›ç–‘é—®ä¸ºä»€ä¹ˆ<code>hello.go</code>çš„packageæ˜¯<code>main</code>ï¼Œè€Œ <code>reverse.go</code>çš„packageæ˜¯<code>stringutil</code>ã€‚Goä»£ç çš„ç¬¬ä¸€è¡Œå¿…é¡»æ˜¯<code>package name</code>ï¼Œè¿™ä¸ªnameä¸€èˆ¬ä¸ºå½“å‰æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åï¼Œä¾‹å¦‚<code>reverse.go</code>åœ¨<code>stringutil</code>ç›®å½•ä¸­ï¼Œåˆ™ç¬¬ä¸€è¡Œä¸º<code>package stringutil</code>ï¼Œè¿™ä¸ªnameä¹Ÿæ˜¯ä¾èµ–æ­¤åŒ…æ—¶å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªç›®å½•ï¼Œå¦‚<code>hello.go</code>ä¸­è¦ä¾èµ–çš„æºç æ˜¯ <code>reverse.go</code>ï¼Œè€Œå®ƒåœ¨<code>stringutil</code>ç›®å½•ä¸­ï¼Œæ‰€ä»¥æ·»åŠ <code>import &quot;github.com/go-test/stringutil&quot;</code>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯æŸä¸ªpackageä¸­çš„æ‰€æœ‰æ–‡ä»¶å¿…é¡»æœ‰ä¸€æ ·çš„nameï¼Œè€Œä¸”å¦‚æœåŒ…å«å¯æ‰§è¡Œå‘½ä»¤ï¼Œnameå¿…é¡»ä¸º<code>main</code>ï¼Œä¹Ÿå°±æ˜¯åƒ<code>hello.go</code>é‚£æ ·ï¼Œè€Œä¸”è¿˜å¾—åŒ…å«<code>func main()</code>ã€‚</p><!-- å¯æ‰§è¡Œæ–‡ä»¶çš„åå­—æ˜¯æ€ä¹ˆæ¥çš„ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ ç›®å½•å --><h2 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h2><p>â€‹    äº†è§£ä¸Šè¿°å†…å®¹å…¶å®å°±å¯ä»¥å»ç©Goäº†ï¼Œä½†æ˜¯åœ¨ç©çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ç»™æ–‡ä»¶èµ·åå­—æ—¶ä»¥ <code>_test.go</code>çš„é—®é¢˜ï¼Œåœ¨å…¶å®ƒè¯­è¨€ä¸­å¯¹æ–‡ä»¶åå­—çš„å†…å®¹å¹¶æ²¡æœ‰é™åˆ¶ï¼Œä½†åœ¨Goä¸­æœ‰é™åˆ¶ï¼Œå¦‚æœä»¥ <code>_test.go</code>ç»“å°¾åˆ™ä»£è¡¨è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç±»ã€‚</p><p>â€‹    Goæœ‰ä¸€ä¸ªè½»é‡çš„æµ‹è¯•æ¡†æ¶ï¼Œä½¿ç”¨æ—¶å¯¼å…¥ <code>testing</code>åŒ…ï¼Œæ‰§è¡Œ<code>go test</code> ã€‚ä½¿ç”¨æµ‹è¯•æ¡†æ¶æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªä»¥<code>_test.go</code>ç»“å°¾æ–‡ä»¶ï¼Œæµ‹è¯•æŸä¸ªfuncçš„æ–¹æ³•åä¸º<code>func TestXXX(t *testing.T)</code>ï¼Œå¦‚æœè¿™ä¸ªæµ‹è¯•æ–¹æ³•è°ƒç”¨äº† <code>t.Error</code> æˆ–è€… <code>t.Fail</code>åˆ™è®¤ä¸ºæµ‹è¯•å¤±è´¥ã€‚ç»™ä¸Šè¿° <code>reverse.go</code>æ·»åŠ ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œåœ¨stringutilæ–‡ä»¶ä¸­åˆ›å»º<code>reverse_test.go</code>ï¼Œå¤åˆ¶å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> stringutil</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;testing&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestReverse</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">cases := []<span class="keyword">struct</span> &#123;</span><br><span class="line">in, want <span class="keyword">string</span></span><br><span class="line">&#125;&#123;</span><br><span class="line">&#123;<span class="string">&quot;Hello, world&quot;</span>, <span class="string">&quot;dlrow ,olleH&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;Hello, ä¸–ç•Œ&quot;</span>, <span class="string">&quot;ç•Œä¸– ,olleH&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> _, c := <span class="keyword">range</span> cases &#123;</span><br><span class="line">got := Reverse(c.in)</span><br><span class="line"><span class="keyword">if</span> got != c.want &#123;</span><br><span class="line">t.Errorf(<span class="string">&quot;Reverse(%q) == %q, want %q&quot;</span>, c.in, got, c.want)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åæ‰§è¡Œ<code>go test github.com/go-test/stringutil</code>æˆ–è€…ç›´æ¥åœ¨stringutilç›®å½•ä¸­æ‰§è¡Œ<code>go test</code>ï¼Œæ‰§è¡ŒæˆåŠŸè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ go <span class="built_in">test</span> github.com/go-test/stringutil</span><br><span class="line">ok  github.com/user/stringutil 0.165s</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Goå¼€å‘ç¯å¢ƒé…ç½®&quot;&gt;&lt;a href=&quot;#Goå¼€å‘ç¯å¢ƒé…ç½®&quot; class=&quot;headerlink&quot; title=&quot;Goå¼€å‘ç¯å¢ƒé…ç½®&quot;&gt;&lt;/a&gt;Goå¼€å‘ç¯å¢ƒé…ç½®&lt;/h2&gt;&lt;p&gt;â€‹    é€‰æ‹©æ“ä½œç³»ç»Ÿå¯¹åº”çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥ä¸‹è½½å®‰è£…åŒ…è¿›è¡Œä¸€é”®å®‰è£…ï¼Œä¹Ÿå¯ä»¥ä¸‹è½½tar/zipåŒ…è¿›è¡Œè‡ªå®šä¹‰å®‰è£…ã€‚è‡ªå®šä¹‰å®‰è£…æ—¶éœ€è¦åœ¨ç¯å¢ƒå˜é‡ä¸­æŒ‡å®š&lt;code&gt;GOROOT&lt;/code&gt;å’Œ&lt;code&gt;GOPATH&lt;/code&gt;ï¼Œ&lt;code&gt;GOROOT&lt;/code&gt;æ˜¯taråŒ…çš„è§£å‹ç›®å½•ï¼Œ&lt;code&gt;GOPATH&lt;/code&gt;æ˜¯Goå·¥ç¨‹é¡¹ç›®ç›®å½•ï¼Œè¿™é‡Œä¸ä»…å­˜å‚¨è¿™è‡ªå·±å¼€å‘çš„é¡¹ç›®ä¹Ÿå­˜æ”¾ç€é¡¹ç›®æ‰€ä¾èµ–åŒ…çš„æºç åŠäºŒè¿›åˆ¶æ–‡ä»¶ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="golang" scheme="http://yuanba.tech/categories/golang/"/>
    
    
    <category term="go" scheme="http://yuanba.tech/tags/go/"/>
    
    <category term="golang" scheme="http://yuanba.tech/tags/golang/"/>
    
    <category term="èœé¸Ÿ" scheme="http://yuanba.tech/tags/%E8%8F%9C%E9%B8%9F/"/>
    
    <category term="ç¯å¢ƒ" scheme="http://yuanba.tech/tags/%E7%8E%AF%E5%A2%83/"/>
    
  </entry>
  
  <entry>
    <title>YARN Capacity Scheduler</title>
    <link href="http://yuanba.tech/[%E8%AF%91]Yarn-capacity.html"/>
    <id>http://yuanba.tech/[%E8%AF%91]Yarn-capacity.html</id>
    <published>2019-07-28T15:35:23.000Z</published>
    <updated>2019-08-12T15:45:21.000Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡è¯‘æ–‡ï¼Œ<a href="https://hortonworks.com/blog/yarn-capacity-scheduler/">åŸæ–‡åœ°å€</a></p><p>ä¸»è¦ä»‹ç»äº†Capacity Schedulerç›¸å…³çš„å†…å®¹ã€‚</p><p>Capacity Scheduleråœ¨èµ„æºåˆ†é…æ—¶ä¸»è¦è€ƒè™‘ä¸¤ä¸ªä¸»è¦å±æ€§ï¼š<em>ç”¨æˆ·åå’Œåº”ç”¨ç¨‹åºID</em>ã€‚åœ¨æŒ‡å®šæœ€å°ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› ç´ çš„é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·ä¹‹é—´å…±äº«èµ„æºæ—¶ï¼Œå…³æ³¨çš„æ˜¯ç”¨æˆ·åæœ¬èº«ã€‚åœ¨é˜Ÿåˆ—ä¸­ï¼Œåº”ç”¨ç¨‹åºè·å–èµ„æºåˆ†é…ç”±å¶å­é˜Ÿåˆ—æ’åºç­–ç•¥é©±åŠ¨ï¼šFIFOæˆ–FAIRï¼Œå®ƒåªå…³å¿ƒåº”ç”¨ç¨‹åºè€Œä¸å…³å¿ƒå“ªä¸ªç”¨æˆ·æ­£åœ¨è¿è¡Œå®ƒã€‚åœ¨FIFOä¸­ï¼Œèµ„æºé¦–å…ˆè¢«åˆ†é…ç»™é˜Ÿåˆ—ä¸­æœ€å…ˆæäº¤çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒä¸å†éœ€è¦ä»»ä½•è¯·æ±‚æ—¶ï¼Œä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰ä¼šè·å¾—åˆ†é…ã€‚å¯¹äºä½¿ç”¨æœ€å°‘èµ„æºçš„FAIRåº”ç”¨ç¨‹åºï¼Œé¦–å…ˆè¯¢é—®æ˜¯å¦å­˜åœ¨å¾…å¤„ç†çš„åˆ†é…ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ†é…ï¼Œåˆ™å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ£€æŸ¥å…·æœ‰æœ€å°‘èµ„æºçš„ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼›è¿™æœ‰åŠ©äºä¸é€šå¸¸ä½¿ç”¨å®ƒä»¬çš„åº”ç”¨ç¨‹åºå¹³å‡å…±äº«é˜Ÿåˆ—ã€‚</p><span id="more"></span><h2 id="å®¹é‡å’Œåˆ†å±‚è®¾è®¡"><a href="#å®¹é‡å’Œåˆ†å±‚è®¾è®¡" class="headerlink" title="å®¹é‡å’Œåˆ†å±‚è®¾è®¡"></a>å®¹é‡å’Œåˆ†å±‚è®¾è®¡</h2><p>â€‹YARNå¯¹å…¶å¯åˆ†é…çš„èµ„æºå®šä¹‰äº†æœ€å°åˆ†é…é‡å’Œæœ€å¤§åˆ†é…é‡ï¼Œç›®å‰è¿™äº›èµ„æºåŒ…æ‹¬å†…å­˜å’Œå†…æ ¸ã€‚å¯è°ƒåº¦èµ„æºæ˜¯ç”±NodeManageæä¾›çš„ï¼Œæ¥è‡ªæ‰€æœ‰èŠ‚ç‚¹çš„èµ„æºèšåˆä¸ºå¯è¢«Capacityè°ƒåº¦çš„æ€»èµ„æºï¼Œæ€»èµ„æºç»„æˆrooté˜Ÿåˆ—ã€‚</p><p>â€‹Capacityè°ƒåº¦çš„åŸºç¡€è®¾ç½®æ˜¯å¦‚ä½•å¸ƒç½®é˜Ÿåˆ—ä»¥åŠä¸ºå®ƒä»¬åˆ†é…èµ„æºã€‚é˜Ÿåˆ—ä»¥åˆ†å±‚è®¾è®¡å¸ƒå±€ï¼Œæœ€é¡¶å±‚çš„çˆ¶èŠ‚ç‚¹æ˜¯é›†ç¾¤é˜Ÿåˆ—çš„â€œæ ¹â€ï¼Œå¯ä»¥ä»æ ¹åˆ†é…å­é˜Ÿåˆ—ï¼Œæˆ–è€…å¯ä»¥åœ¨è‡ªå·±é˜Ÿåˆ—çš„åŸºç¡€ä¸Šå†æ¬¡åˆ†é…å­é˜Ÿåˆ—ã€‚èµ„æºè¢«åˆ†é…ç»™è¿™äº›é˜Ÿåˆ—ï¼Œä½œä¸ºå±‚æ¬¡ç»“æ„ä¸­çˆ¶çº§èµ„æºçš„æœ€å°å’Œæœ€å¤§ç™¾åˆ†æ¯”ã€‚ æœ€å°å®¹é‡æ˜¯å¦‚æœç¾¤é›†ä¸Šçš„æ‰€æœ‰é˜Ÿåˆ—éƒ½å·²è¿è¡Œï¼Œå¹¶ä¸”é›†ç¾¤æ€»èµ„æºå·²ç”¨å®Œï¼Œæ­¤æ—¶å„é˜Ÿåˆ—åº”è¯¥å¯ä»¥ä½¿ç”¨çš„èµ„æºé‡ã€‚ æœ€å¤§å®¹é‡æ˜¯ç±»ä¼¼å¼¹æ€§çš„å®¹é‡ï¼Œå…è®¸é˜Ÿåˆ—åˆ©ç”¨ä¸ç”¨äºå¡«å……å…¶ä»–é˜Ÿåˆ—ä¸­çš„æœ€å°å®¹é‡éœ€æ±‚çš„èµ„æºã€‚<br><img src="/blogimgs/capacity/queue.png" alt="é˜Ÿåˆ—è®¾è®¡" title="é˜Ÿåˆ—è®¾è®¡"></p><h2 id="æœ€ä½ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› ç´ "><a href="#æœ€ä½ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› ç´ " class="headerlink" title="æœ€ä½ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› ç´ "></a>æœ€ä½ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› ç´ </h2><p>â€‹æœ€å°ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› å­æ˜¯æ§åˆ¶å¦‚ä½•å°†æ­£åœ¨ä½¿ç”¨çš„é˜Ÿåˆ—ä¸­çš„èµ„æºåˆ†é…ç»™ä»–ä»¬çš„æ–¹æ³•ã€‚ æœ€å°ç”¨æˆ·ç™¾åˆ†æ¯”æ˜¯å•ä¸ªç”¨æˆ·åœ¨è¯·æ±‚æ—¶åº”è®¿é—®çš„æœ€å°èµ„æºé‡ç™¾åˆ†æ¯”ï¼Œæ˜¯ä¸€ä¸ªè½¯é™åˆ¶ã€‚ ä¾‹å¦‚ï¼Œ10ï¼…çš„æœ€å°ç”¨æˆ·ç™¾åˆ†æ¯”æ„å‘³ç€10ä¸ªç”¨æˆ·å°†è·å¾—10ï¼…; è¿™ä¸ªå€¼ä¸æ˜¯ç¡¬æ€§è§„å®šçš„ï¼Œå› ä¸ºå¦‚æœå…¶ä¸­ä¸€ä¸ªç”¨æˆ·è¦æ±‚æ›´å°‘ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šå°†æ›´å¤šç”¨æˆ·æ”¾å…¥é˜Ÿåˆ—ã€‚</p><p>â€‹ç”¨æˆ·é™åˆ¶å› å­æ˜¯ä¸€ç§æ§åˆ¶å•ä¸ªç”¨æˆ·å¯ä»¥ä½¿ç”¨çš„æœ€å¤§èµ„æºé‡çš„æ–¹æ³•ã€‚ ç”¨æˆ·é™åˆ¶å› å­è®¾ç½®ä¸ºé˜Ÿåˆ—æœ€å°å®¹é‡çš„å€æ•°ã€‚å¦‚æœç”¨æˆ·é™åˆ¶å› å­ä¸º1è¡¨ç¤ºç”¨æˆ·å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—çš„æ•´ä¸ªæœ€å°å®¹é‡ï¼Œ å¦‚æœç”¨æˆ·é™åˆ¶å› å­å¤§äº1ï¼Œåˆ™ç”¨æˆ·å¯èƒ½ä¼šå¢é•¿åˆ°æœ€å¤§å®¹é‡ï¼Œå¦‚æœè¯¥å€¼è®¾ç½®ä¸ºå°äº1ï¼Œä¾‹å¦‚0.5ï¼Œåˆ™ç”¨æˆ·åªèƒ½è·å¾—é˜Ÿåˆ—æœ€å°å®¹é‡çš„ä¸€åŠã€‚ å¦‚æœæ‚¨å¸Œæœ›ç”¨æˆ·èƒ½å¤Ÿå¢é•¿åˆ°é˜Ÿåˆ—è®¾ç½®çš„æœ€å¤§å®¹é‡ï¼Œåˆ™å¤§äº1çš„å€¼å°†å…è®¸ç”¨æˆ·å¤šæ¬¡è¶…è¿‡æœ€å°å®¹é‡ã€‚<br><img src="/blogimgs/capacity/user.png" alt="é™åˆ¶å› å­" title="é™åˆ¶å› å­"></p><p>â€‹æœ€åˆå¯èƒ½ä¸ç›´è§‚çš„å¸¸è§è®¾è®¡ç‚¹æ˜¯æŒ‰å·¥ä½œè´Ÿè½½è€Œä¸æ˜¯åº”ç”¨ç¨‹åºåˆ›å»ºé˜Ÿåˆ—ï¼Œç„¶åä½¿ç”¨ç”¨æˆ·é™åˆ¶å› å­æ¥é˜²æ­¢å•ä¸ªç”¨æˆ·<strong>é€šè¿‡ä½¿ç”¨å°äº1.0çš„å€¼å•ç‹¬æ¥ç®¡é˜Ÿåˆ—</strong>ã€‚ æ­¤æ¨¡å‹æ”¯æŒæ›´ç®€å•çš„æ“ä½œï¼Œä¸å…è®¸é€šè¿‡ä¸ºæ¯ä¸ªLoBåˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—æ¥åˆ›å»ºé˜Ÿåˆ—ï¼Œè€Œæ˜¯é€šè¿‡æŒ‰å·¥ä½œè´Ÿè½½åˆ›å»ºé˜Ÿåˆ—æ¥åˆ›å»ºå¯é¢„æµ‹çš„é˜Ÿåˆ—è¡Œä¸ºã€‚ ä¸€æ—¦ç¾¤é›†å®Œå…¨ä½¿ç”¨å¹¶ä¸”åº”ç”¨ç¨‹åºæ’é˜Ÿç­‰å¾…è¿è¡Œæ—¶ï¼Œè¾ƒä½çš„ç”¨æˆ·é™åˆ¶å› ç´ å°†æ˜¯æ§åˆ¶ç§Ÿæˆ·ä¹‹é—´èµ„æºå…±äº«çš„å…³é”®ã€‚</p><p>â€‹æœ€åˆï¼Œç”±äºä½¿ç”¨è¾ƒå°çš„ç”¨æˆ·é™åˆ¶æ¥é™åˆ¶ç”¨æˆ·èµ„æºï¼Œè¿™å¯èƒ½æ— æ³•åœ¨å…¶Hadoopå¹³å°æ—…ç¨‹å¼€å§‹æ—¶æä¾›ç¾¤é›†åˆ©ç”¨ç‡ï¼Œæœ‰è®¸å¤šæ–¹æ³•ï¼Œä½†éœ€è¦è€ƒè™‘çš„æ˜¯ï¼Œæœ€åˆå…è®¸å•ä¸ªç§Ÿæˆ·æ¥ç®¡ä¸€ä¸ªå°é›†ç¾¤ï¼ˆæ¯”å¦‚10ä¸ªèŠ‚ç‚¹ï¼‰ï¼Œè¿™å¯èƒ½æ˜¯åˆç†çš„ï¼Œä½†æ˜¯å½“æ‰©å±•å¹³å°å ç”¨ç©ºé—´æ—¶ï¼Œé™ä½ç”¨æˆ·é™åˆ¶å› å­ï¼Œä»¥ä¾¿æ¯ä¸ªç§Ÿæˆ·ä¿ç•™ä¸æ·»åŠ æ–°èŠ‚ç‚¹ä¹‹å‰ç›¸åŒæ•°é‡çš„å¯åˆ†é…èµ„æºã€‚ è¿™å¯ä»¥è®©ç”¨æˆ·ä¿æŒæœ€åˆçš„ä½“éªŒï¼Œä½†æ˜¯æ— æ³•æ¥ç®¡æ•´ä¸ªé›†ç¾¤ï¼Œå› ä¸ºéšç€æ•´ä¸ªç¾¤é›†çš„å¢é•¿ï¼Œæ–°ç”¨æˆ·å¯ä»¥è½»æ¾è·å¾—åˆ†é…çš„å®¹é‡ï¼ŒåŒæ—¶ä¸ä¼šé™ä½åŸå§‹ç”¨æˆ·çš„ä½“éªŒã€‚</p><h2 id="é˜Ÿåˆ—è®¾è®¡"><a href="#é˜Ÿåˆ—è®¾è®¡" class="headerlink" title="é˜Ÿåˆ—è®¾è®¡"></a>é˜Ÿåˆ—è®¾è®¡</h2><p>â€‹é˜Ÿåˆ—è®¾è®¡æ—¶éœ€è¦è€ƒè™‘å¦‚ä¸‹ç›¸å…³åœºæ™¯ï¼š</p><ul><li><strong>å³æ—¶æŸ¥è¯¢</strong><br>ä¸»è¦æ˜¯äº›ä¸´æ—¶ç»Ÿè®¡éœ€æ±‚ï¼Œä»»åŠ¡çš„å‡ºç°æ²¡æœ‰è§„å¾‹ï¼Œä¸»è¦é›†ä¸­åœ¨å·¥ä½œæ—¶é—´ï¼Œç”±ç”¨æˆ·ä¸»åŠ¨è§¦å‘</li><li><strong>ç´§æ€¥éœ€æ±‚</strong><br>ä¸»è¦ç”¨äºå¤„ç†ä¸€äº›ç´§æ€¥éœ€æ±‚ï¼Œæ¯”å¦‚ç´§æ€¥è¡¥æ•°</li><li><strong>æœºå™¨å­¦ä¹ </strong><br>è¿™éƒ¨åˆ†éœ€æ±‚æ˜¯éœ€è¦å¤§é‡çš„èµ„æºå¹¶ä¸”å¯èƒ½ä¼šé•¿æ—¶é—´å ç”¨èµ„æºï¼Œä½†æ˜¯ç´§æ€¥åº¦å’Œè¿è¡Œæ—¶é•¿è¦æ±‚ä¸æ˜¯å¾ˆé«˜</li><li><strong>å®æ—¶è®¡ç®—</strong><br>è¿™éƒ¨åˆ†éœ€æ±‚æ˜¯é•¿æ—¶é—´è¿è¡Œå¹¶ä¸”æ²¡æœ‰æ˜ç¡®çš„ç»“æŸæ ‡è¯†ï¼Œå¯¹å®æ—¶è¦æ±‚è¾ƒé«˜ï¼Œä¸èƒ½å®¹å¿å»¶è¿Ÿï¼Œéœ€è¦ä¸¥æ ¼ä¿è¯èµ„æºä¸è¢«å…¶å®ƒéœ€æ±‚æŠ¢å </li><li><strong>æ‰¹å¤„ç†</strong><br>æ˜¯æŒ‡ä¸€äº›å¸¸è§„æ•°æ®ETLï¼Œä¸»è¦å…³æ³¨ä»»åŠ¡çš„ååé‡è€Œä¸æ˜¯å½“ä¸ªä»»åŠ¡æ˜¯å¦å»¶è¿Ÿ</li></ul><p>â€‹é˜Ÿåˆ—ä¸­èµ„æºä½¿ç”¨æ¨¡å‹å¯ä»¥è®¤ä¸ºæ˜¯ä¸€äº›containersåƒå¸¸é‡é‚£æ ·ä¸€ç›´å­˜åœ¨å’Œæ–°å¯åŠ¨çš„ã€‚ è¿™ç§ä½¿ç”¨æ¨¡å‹å¯¹äºå…·æœ‰è‰¯å¥½è¡Œä¸ºçš„é›†ç¾¤éå¸¸é‡è¦ï¼Œå› ä¸ºé˜Ÿåˆ—å¯ä»¥å¿«é€Ÿé‡æ–°å¹³è¡¡åˆ°å…¶æœ€å°å®¹é‡ï¼Œå¹¶å…¬å¹³åœ°å¹³è¡¡å…¶ç”¨æˆ·ä¹‹é—´çš„é˜Ÿåˆ—å®¹é‡ã€‚ ä¸å¥½çš„ä½¿ç”¨æ¨¡å¼æ˜¯é•¿æœŸå­˜åœ¨çš„å®¹å™¨ï¼Œèµ„æºä¸€ç›´åœ¨è¢«è‡ªå·±ä½¿ç”¨å¹¶ä¸”æ°¸è¿œä¸ä¼šé‡Šæ”¾ï¼Œè¿™æ ·å®ƒå¯ä»¥é˜»æ­¢èµ„æºçš„é€‚å½“é‡æ–°å¹³è¡¡ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å®ƒå¯ä»¥å®Œå…¨é˜»æ­¢å…¶ä»–åº”ç”¨ç¨‹åºå¯åŠ¨æˆ–å…¶ä»–é˜Ÿåˆ—æ¢å¤å…¶æœ€å°å®¹é‡ã€‚ å½“ä¸ä½¿ç”¨æŠ¢å æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—æ‰©å®¹å¼¹æ€§ç©ºé—´ä½†ä»ä¸é‡Šæ”¾å…¶å®¹å™¨ï¼Œåˆ™å¼¹æ€§ç©ºé—´æ°¸è¿œä¸ä¼šè¢«è¿”å›ç»™å…¶ä»–é˜Ÿåˆ—æ¥ä¿è¯ä»–ä»¬çš„æœ€å°å®¹é‡ã€‚ å¦‚æœåœ¨é˜Ÿåˆ—ä¸­è¿è¡Œçš„åº”ç”¨ç¨‹åºå…·æœ‰é•¿æœŸå­˜åœ¨å®¹å™¨ï¼Œè¯·ç‰¹åˆ«æ³¨æ„å¹¶è€ƒè™‘ä½¿ç”¨è¯¸å¦‚ç”¨æˆ·é™åˆ¶å› å­ï¼ŒæŠ¢å æˆ–ç”šè‡³æ²¡æœ‰å¼¹æ€§å®¹é‡çš„ä¸“ç”¨é˜Ÿåˆ—ç­‰åŠŸèƒ½æ¥å‡è½»å…¶å¯¹å…¶ä»–ç”¨æˆ·çš„å½±å“çš„æ–¹æ³•ã€‚</p><h2 id="CAPACITYè°ƒåº¦ç‰¹æ€§"><a href="#CAPACITYè°ƒåº¦ç‰¹æ€§" class="headerlink" title="CAPACITYè°ƒåº¦ç‰¹æ€§"></a>CAPACITYè°ƒåº¦ç‰¹æ€§</h2><h3 id="CPUè°ƒåº¦"><a href="#CPUè°ƒåº¦" class="headerlink" title="CPUè°ƒåº¦"></a>CPUè°ƒåº¦</h3><p>â€‹é»˜è®¤æƒ…å†µä¸‹Capacityè°ƒåº¦ä¸æ”¯æŒCPUè°ƒåº¦ã€‚å¦‚æœå¼€å¯CPUè°ƒåº¦çš„è¯ï¼Œå¯èƒ½ä¼šé™ä½æ‰¹å¤„ç†ä»»åŠ¡çš„ååé‡ã€‚æ”¯æŒCPUè°ƒåº¦çš„ç®—æ³•æ˜¯Dominant Resource Fairness (DRF)ã€‚</p><p>â€‹CPUè°ƒåº¦ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†ï¼š</p><ol><li>åˆ†é…å’Œæ”¾ç½®</li><li>å¼ºåˆ¶é™åˆ¶</li></ol><p>â€‹åªè¦å¼€å¯CPUè°ƒåº¦å³å¯è§£å†³åˆ†é…å’Œæ”¾ç½®é—®é¢˜ï¼Œè°ƒåº¦å™¨ä¼šä½¿ç”¨DRFç®—æ³•å’ŒVCores Node Managerçš„æ±‡æŠ¥ç»“æœã€‚ è¿™è§£å†³äº†ä¸€äº›æ–°é—®é¢˜ï¼Œä¾‹å¦‚ç”¨æˆ·ä½¿ç”¨1ä¸ªæˆ–2ä¸ªexecutorsæ¥è°ƒåº¦ä»–çš„Sparkåº”ç”¨ç¨‹åºï¼Œä½†æ˜¯æ¯ä¸ªexecutoråˆ†é…8ä¸ªcoreï¼Œç„¶åç”±äºå¯ç”¨å†…å­˜è¿‡å¤šè€Œç»§ç»­å‘è¿™ä¸ªèŠ‚ç‚¹åˆ†é…ä»»åŠ¡ï¼Œç”±äºcoreçš„é™åˆ¶å½±å“è¿™äº›ä»»åŠ¡çš„è¿è¡Œã€‚ é€šè¿‡å¯ç”¨ç®€å•çš„CPUè°ƒåº¦ï¼Œå¦‚æœæ­£åœ¨ä½¿ç”¨æ‰€æœ‰coreï¼Œåˆ™ä¸å†å°†å…¶ä»–ä»»åŠ¡åˆ†é…åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼Œå¹¶æ‰¾åˆ°ç¾¤é›†ä¸­å…¶å®ƒèŠ‚ç‚¹æ¥æ”¾ç½®ä»»åŠ¡ã€‚</p><p>â€‹è‡³äºå¼ºåˆ¶é™åˆ¶å¯ä»¥é€šè¿‡Cgroupæ¥è§£å†³ã€‚Cgroupå¯ä»¥è®©YARNç¡®ä¿åˆ†é…ç»™æŸä¸ªcontainerçš„vcoreä¸ªæ•°ä¸ä¼šè¶…è¿‡è¯·æ±‚çš„æ•°é‡ã€‚å¯ä»¥å¯ç”¨æœªä½¿ç”¨æ—¶å…±äº«vcoresï¼Œä¹Ÿå¯ä»¥ä»…ä¸¥æ ¼æ‰§è¡Œå·²å®‰æ’çš„å†…å®¹ã€‚ èŠ‚ç‚¹ç®¡ç†å™¨è¿˜å¯ä»¥é…ç½®ä¸ºæœåŠ¡å™¨ä¸Šå…è®¸æ‰€æœ‰ä»»åŠ¡æ€»å’Œçš„æœ€å¤§CPUä½¿ç”¨é‡ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ“ä½œç³»ç»Ÿçš„åŠŸèƒ½æ­£å¸¸ä½¿ç”¨coreã€‚</p><h3 id="æŠ¢å "><a href="#æŠ¢å " class="headerlink" title="æŠ¢å "></a>æŠ¢å </h3><p>â€‹å½“åº”ç”¨ç¨‹åºåœ¨é˜Ÿåˆ—Aä¸­ä½¿ç”¨äº†å¼¹æ€§å®¹é‡ï¼Œæ­¤æ—¶å¦ä¸€ä¸ªé˜Ÿåˆ—Bæäº¤äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œé˜Ÿåˆ—Bçš„èµ„æºè¢«é˜Ÿåˆ—Açš„ä»»åŠ¡æŠ¢å…ˆä½¿ç”¨ä¸­ï¼Œæ­¤æ—¶æ­£å¸¸æƒ…å†µä¸‹é˜Ÿåˆ—Bä¸­çš„åº”ç”¨ç¨‹åºå¿…é¡»ç­‰å¾…é˜Ÿåˆ—Aä¸­çš„ä»»åŠ¡é‡Šæ”¾è‡ªç”±ä¹‹åæ‰èƒ½è¿è¡Œã€‚å¦‚æœå¼€å¯æŠ¢å åŠŸèƒ½ï¼Œå°±å¯ä»¥ç«‹é©¬å›æ”¶å…¶ä»–é˜Ÿåˆ—ä¸­çš„èµ„æºï¼Œä»¥ä¾¿æ»¡è¶³é˜Ÿåˆ—çš„æœ€å°å®¹é‡éœ€æ±‚ã€‚æŠ¢å åŠŸèƒ½å¹¶ä¸ä¼šå½»åº•æ€æ­»ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œä¼˜å…ˆæŠ¢å mapä»»åŠ¡çš„èµ„æºï¼Œæœ€åæ‰æ˜¯reduceçš„èµ„æºï¼Œå› ä¸ºè¢«killæ‰çš„ä»»åŠ¡å¿…é¡»é‡æ–°è¿è¡Œï¼Œreduceæ¯”mapè¦é‡å¤æ›´å¤šçš„å·¥ä½œã€‚ ä»æ’åºçš„è§’åº¦æ¥çœ‹ï¼ŒæŠ¢å æ—¶ä¼˜å…ˆè€ƒè™‘æœ€æ–°çš„åº”ç”¨ç¨‹åºå’Œå¤§å¤šæ•°è¶…é¢è®¢é˜…çš„åº”ç”¨ç¨‹åºã€‚</p><p>â€‹æŠ¢å æœ‰äº›åŠŸèƒ½å¹¶ä¸èƒ½åƒç”¨æˆ·é¢„æœŸçš„é‚£æ ·å‘æŒ¥ä½œç”¨ã€‚<strong>æœ€å¸¸è§çš„è¡Œä¸ºæ˜¯è®¤ä¸ºé˜Ÿåˆ—å¯ä»¥åœ¨å…¶è‡ªèº«å†…éƒ¨æŠ¢å ä»¥å¹³è¡¡æ‰€æœ‰ç”¨æˆ·çš„èµ„æºã€‚ è¿™ç§å‡è®¾æ˜¯é”™è¯¯çš„ï¼Œå› ä¸ºæŠ¢å åªèƒ½åœ¨é˜Ÿåˆ—ä¹‹é—´</strong>ï¼Œåœ¨é˜Ÿåˆ—ä¸­ç”¨æˆ·ä¹‹é—´çš„èµ„æºå¹³è¡¡éœ€è¦æŸ¥çœ‹å…¶ä»–æ§åˆ¶æ–¹å¼ï¼Œä¾‹å¦‚ç”¨æˆ·é™åˆ¶å› å­å’Œé˜Ÿåˆ—FIFO / FAIRç­–ç•¥ã€‚</p><!--å¦ä¸€ä¸ªè¡Œä¸ºæ˜¯ï¼Œå¦‚æœèµ„æºä¸èƒ½æä¾›è¶³å¤Ÿçš„èµ„æºæ¥æ»¡è¶³å¦ä¸€ä¸ªèµ„æºåˆ†é…è¯·æ±‚ï¼Œåˆ™Preemptionä¸ä¼šæŠ¢å èµ„æºã€‚ è™½ç„¶å¯¹äºå…·æœ‰è¾ƒå¤§æœ€å¤§å®¹å™¨å¤§å°çš„å°å‹é›†ç¾¤è€Œè¨€ï¼Œå¤§å‹é›†ç¾¤é€šå¸¸ä¸ä¼šå‡ºç°é—®é¢˜ä½†æ˜¯Preemptionæœªé…ç½®ä¸ºå›æ”¶æœ€å¤§å¯èƒ½å®¹é‡çš„å®¹å™¨ï¼Œå› æ­¤æ ¹æœ¬ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ ç”¨äºæ§åˆ¶æ­¤è¡Œä¸ºçš„ä¸»è¦å±æ€§æ˜¯æ¯è½®æ€»æŠ¢å ç‡å’Œè‡ªç„¶ç»ˆæ­¢å› å­ã€‚ æ¯è½®æ€»æŠ¢å ç‡æ˜¯ç¾¤é›†ä¸­å¯ä»¥ç«‹å³è¢«æŠ¢å çš„èµ„æºçš„ç™¾åˆ†æ¯”ï¼Œè‡ªç„¶ç»ˆæ­¢å› å­æ˜¯æ‰€è¯·æ±‚çš„æ€»ç¾¤é›†ï¼ˆ100ï¼…ï¼‰ä¸­èµ„æºçš„ç™¾åˆ†æ¯”å°†è¢«æŠ¢å åˆ°æ¯è½®æ€»æŠ¢å æ•°ã€‚--><h3 id="é˜Ÿåˆ—çš„æ’åºç­–ç•¥"><a href="#é˜Ÿåˆ—çš„æ’åºç­–ç•¥" class="headerlink" title="é˜Ÿåˆ—çš„æ’åºç­–ç•¥"></a>é˜Ÿåˆ—çš„æ’åºç­–ç•¥</h3><p>â€‹Capacityè°ƒåº¦ç›®å‰æ”¯æŒä¸¤ç§æ’åºç­–ç•¥ï¼šFIFOå’ŒFAIRã€‚é˜Ÿåˆ—é»˜è®¤ä½¿ç”¨çš„æ˜¯FIFOï¼Œä½†æ˜¯è¿™ä¸æ˜¯ç”¨æˆ·æ‰€å¸Œæœ›çš„æ’åºç­–ç•¥ã€‚åœ¨å¶å­é˜Ÿåˆ—ä¸­é…ç½®FIFOæˆ–è€…FAIRï¼Œå¯ä»¥åœ¨åº”ç”¨ç¨‹åºçš„ååé‡å’Œå…±äº«å…¬å¹³ä¹‹é—´åˆç†é€‰æ‹©ã€‚å…³äºæ’åºç­–ç•¥çš„ä¸€ä¸ªé‡è¦äº‹æƒ…æ˜¯ï¼Œæ’åºæ˜¯é’ˆå¯¹é˜Ÿåˆ—ä¸­çš„åº”ç”¨ç¨‹åºçº§åˆ«ï¼Œè€Œä¸å…³å¿ƒå“ªä¸ªç”¨æˆ·æ‹¥æœ‰åº”ç”¨ç¨‹åºã€‚</p><p>â€‹FIFOç­–ç•¥æ˜¯æŒ‰ç…§åº”ç”¨ç¨‹åºæäº¤çš„é¡ºåºæ¥æ’åºçš„ã€‚å¦‚æœåº”ç”¨ç¨‹åºæœ‰æœªå®Œæˆçš„èµ„æºè¯·æ±‚ï¼Œåˆ™ä¼šæ ¹æ®å…ˆåˆ°å…ˆå¾—çš„åŸåˆ™åˆ†é…ã€‚ è¿™æ ·åšçš„ç»“æœæ˜¯ï¼Œå¦‚æœåº”ç”¨ç¨‹åºæœ‰è¶³å¤Ÿçš„æœªå®Œæˆè¯·æ±‚ï¼Œå®ƒä»¬å°†åœ¨å®Œæˆä¹‹å‰å¤šæ¬¡è¯·æ±‚ï¼Œå¯èƒ½ä¼šä½¿ç”¨æ•´ä¸ªé˜Ÿåˆ—ï¼Œå®ƒä»¬å°†é˜»æ­¢å…¶ä»–åº”ç”¨ç¨‹åºå¯åŠ¨ã€‚ ç”¨æˆ·ç”šè‡³å¯ä»¥ä½¿ç”¨è‡ªå·±çš„åº”ç”¨ç¨‹åºå æ»¡æ•´ä¸ªé›†ç¾¤èµ„æºè€Œé˜»æ­¢å…¶å®ƒåº”ç”¨ç¨‹åºæäº¤ï¼Œæ­£æ˜¯è¿™ç§è¡Œä¸ºå¯¹ç”¨æˆ·æ¥è¯´æ˜¯æœ€ä¸å¯æ¥å—çš„ã€‚</p><p>â€‹ä½¿ç”¨FAIRç­–ç•¥èƒ½å¾ˆå®¹æ˜“çš„è§£å†³ä¸Šé¢çš„é—®é¢˜ã€‚åœ¨å­é˜Ÿåˆ—ä¸Šä½¿ç”¨FAIRç­–ç•¥æ—¶ï¼Œåº”é¦–å…ˆå¯¹åº”ç”¨ç¨‹åºå·²å ç”¨çš„èµ„æºé‡è¿›è¡Œè¯„ä¼°ï¼Œèµ„æºä½¿ç”¨æœ€å°‘çš„åº”ç”¨ç¨‹åºä¼šä¼˜å…ˆåˆ†é…è¯·æ±‚ã€‚ è¿™æ ·ï¼Œè¿›å…¥é˜Ÿåˆ—çš„æ²¡æœ‰è¿›è¡Œèµ„æºåˆ†é…çš„æ–°åº”ç”¨ç¨‹åºå°†é¦–å…ˆè¿›è¡Œèµ„æºåˆ†é…ã€‚ ä¸€æ—¦é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½å¾—åˆ°èµ„æºï¼Œè¿™æ ·å°±åœ¨ç”¨æˆ·ä¹‹é—´å¾—åˆ°å¹³è¡¡ã€‚</p><p>â€‹æœ€é‡è¦çš„æ˜¯ï¼Œåªæœ‰åœ¨é˜Ÿåˆ—ä¸­æœ‰è‰¯å¥½çš„èµ„æºäº¤äº’æ—¶æ‰ä¼šå‡ºç°æ­¤è¡Œä¸ºã€‚ç”±äºé˜Ÿåˆ—å†…éƒ¨ä¸å­˜åœ¨æŠ¢å èµ„æºï¼Œå› æ­¤æ— æ³•åœ¨é˜Ÿåˆ—ä¸­å¼ºåˆ¶é‡æ–°åˆ†é…èµ„æºï¼Œè€Œä¸”FAIRæ’åºç­–ç•¥ä»…æ¶‰åŠæ–°èµ„æºåˆ†é…è€Œéå½“å‰å·²ä½¿ç”¨èµ„æºçš„å†åˆ†é…ï¼›è¿™æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ å¦‚æœé˜Ÿåˆ—ä¸­èµ„æºè¢«å½“å‰ä»»åŠ¡ä½¿ç”¨ä¸”ä»»åŠ¡æ°¸è¿œä¸ä¼šå®Œæˆæˆ–é•¿æ—¶é—´è¿è¡Œè€Œä¸å…è®¸åœ¨é˜Ÿåˆ—ä¸­å‘ç”Ÿå®¹å™¨ç»“æŸï¼Œé‚£ä¹ˆå°†ä¿ç•™èµ„æºå¹¶ä»ç„¶é˜»æ­¢åº”ç”¨ç¨‹åºæ‰§è¡Œã€‚</p><h3 id="é»˜è®¤é˜Ÿåˆ—æ˜ å°„"><a href="#é»˜è®¤é˜Ÿåˆ—æ˜ å°„" class="headerlink" title="é»˜è®¤é˜Ÿåˆ—æ˜ å°„"></a>é»˜è®¤é˜Ÿåˆ—æ˜ å°„</h3><p>â€‹é€šå¸¸æ˜¯åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šç”¨æˆ·æäº¤çš„é˜Ÿåˆ—ï¼ŒCapacityè°ƒåº¦å¯ä»¥ä½¿ç”¨<strong>é»˜è®¤é˜Ÿåˆ—æ˜ å°„</strong>é€šè¿‡ç”¨æˆ·åæˆ–è€…ç”¨æˆ·ç»„å°†ç”¨æˆ·è·¯ç”±åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯é»˜è®¤é˜Ÿåˆ—çš„è·¯ç”±è§„åˆ™æ˜¯å“ªä¸ªè§„åˆ™å…ˆæ»¡è¶³å°±ä½¿ç”¨é‚£ä¸ªè§„åˆ™è¿›è¡Œè·¯ç”±ã€‚ä¹Ÿå°±æ˜¯è¯´å¦‚æœç»„ç”¨æˆ·æ˜ å°„è§„åˆ™åœ¨ç”¨æˆ·æ˜ å°„è§„åˆ™å‰é¢ï¼Œåˆ™å…ˆä½¿ç”¨ç»„ç”¨æˆ·æ˜ å°„è§„åˆ™å¯¹ç”¨æˆ·è¿›è¡Œè·¯ç”±ã€‚</p><h3 id="ä¼˜å…ˆçº§"><a href="#ä¼˜å…ˆçº§" class="headerlink" title="ä¼˜å…ˆçº§"></a>ä¼˜å…ˆçº§</h3><p>â€‹å½“èµ„æºåœ¨é˜Ÿåˆ—ä¹‹é—´åˆ†é…æ—¶ï¼Œ<strong>å…·æœ‰æœ€ä½ç›¸å¯¹å®¹é‡çš„é˜Ÿåˆ—é¦–å…ˆè·å¾—èµ„æº</strong>ã€‚å¦‚æœä½ æƒ³è®©æŸä¸ªé˜Ÿåˆ—æ€»æ˜¯æ¯”å…¶å®ƒé˜Ÿåˆ—ä¼˜å…ˆè·å¾—èµ„æºï¼Œé‚£ä¹ˆæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æé«˜è¿™ä¸ªé˜Ÿåˆ—çš„ä¼˜å…ˆçº§ã€‚</p><p>â€‹åœ¨è¿™ä¸¤ä¸ªé˜Ÿåˆ—ä¹‹ä¸Šæä¾›äº†å¦‚ä½•ä½¿ç”¨æœªç»é˜Ÿåˆ—ä¼˜å…ˆçº§ä¿®æ”¹çš„ç›¸å¯¹å®¹é‡çš„ç¤ºä¾‹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå³ä½¿é˜Ÿåˆ—Aå°äºé˜Ÿåˆ—Bå¹¶ä¸”é˜Ÿåˆ—Bä½¿ç”¨æ›´å¤šç»å¯¹èµ„æºï¼Œä¹Ÿä¼šé€‰æ‹©ç»§ç»­æ¥æ”¶å®ƒä»¬ï¼Œå› ä¸ºå®ƒçš„ç›¸å¯¹å®¹é‡ä½äºé˜Ÿåˆ—Açš„ç›¸å¯¹å®¹é‡ã€‚å¦‚æœæ‰€éœ€è¡Œä¸ºéœ€è¦é˜Ÿåˆ—Aå§‹ç»ˆæ¥æ”¶èµ„æºåˆ†é…é¦–å…ˆï¼Œé˜Ÿåˆ—ä¼˜å…ˆçº§åº”è¯¥å¢åŠ åˆ°é«˜äºé˜Ÿåˆ—Bçš„ä¼˜å…ˆçº§ã€‚å½“åˆ†é…ä¼˜å…ˆçº§æ—¶ï¼Œæ›´é«˜çš„å€¼è¡¨ç¤ºæ›´é«˜çš„ä¼˜å…ˆçº§ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™æ˜¯ä¸€ç¯‡è¯‘æ–‡ï¼Œ&lt;a href=&quot;https://hortonworks.com/blog/yarn-capacity-scheduler/&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;ä¸»è¦ä»‹ç»äº†Capacity Schedulerç›¸å…³çš„å†…å®¹ã€‚&lt;/p&gt;
&lt;p&gt;Capacity Scheduleråœ¨èµ„æºåˆ†é…æ—¶ä¸»è¦è€ƒè™‘ä¸¤ä¸ªä¸»è¦å±æ€§ï¼š&lt;em&gt;ç”¨æˆ·åå’Œåº”ç”¨ç¨‹åºID&lt;/em&gt;ã€‚åœ¨æŒ‡å®šæœ€å°ç”¨æˆ·ç™¾åˆ†æ¯”å’Œç”¨æˆ·é™åˆ¶å› ç´ çš„é˜Ÿåˆ—ä¸­ï¼Œç”¨æˆ·ä¹‹é—´å…±äº«èµ„æºæ—¶ï¼Œå…³æ³¨çš„æ˜¯ç”¨æˆ·åæœ¬èº«ã€‚åœ¨é˜Ÿåˆ—ä¸­ï¼Œåº”ç”¨ç¨‹åºè·å–èµ„æºåˆ†é…ç”±å¶å­é˜Ÿåˆ—æ’åºç­–ç•¥é©±åŠ¨ï¼šFIFOæˆ–FAIRï¼Œå®ƒåªå…³å¿ƒåº”ç”¨ç¨‹åºè€Œä¸å…³å¿ƒå“ªä¸ªç”¨æˆ·æ­£åœ¨è¿è¡Œå®ƒã€‚åœ¨FIFOä¸­ï¼Œèµ„æºé¦–å…ˆè¢«åˆ†é…ç»™é˜Ÿåˆ—ä¸­æœ€å…ˆæäº¤çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”åªæœ‰å½“å®ƒä¸å†éœ€è¦ä»»ä½•è¯·æ±‚æ—¶ï¼Œä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰ä¼šè·å¾—åˆ†é…ã€‚å¯¹äºä½¿ç”¨æœ€å°‘èµ„æºçš„FAIRåº”ç”¨ç¨‹åºï¼Œé¦–å…ˆè¯¢é—®æ˜¯å¦å­˜åœ¨å¾…å¤„ç†çš„åˆ†é…ï¼Œå¦‚æœå­˜åœ¨åˆ™åˆ†é…ï¼Œåˆ™å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ£€æŸ¥å…·æœ‰æœ€å°‘èµ„æºçš„ä¸‹ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼›è¿™æœ‰åŠ©äºä¸é€šå¸¸ä½¿ç”¨å®ƒä»¬çš„åº”ç”¨ç¨‹åºå¹³å‡å…±äº«é˜Ÿåˆ—ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/categories/Hadoop/"/>
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/tags/Hadoop/"/>
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="YARN" scheme="http://yuanba.tech/tags/YARN/"/>
    
    <category term="Capacity" scheme="http://yuanba.tech/tags/Capacity/"/>
    
  </entry>
  
  <entry>
    <title>Resource Localization in YARN</title>
    <link href="http://yuanba.tech/YARN-Resource-Localization.html"/>
    <id>http://yuanba.tech/YARN-Resource-Localization.html</id>
    <published>2019-05-20T14:10:01.000Z</published>
    <updated>2019-05-20T17:10:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸€ä¸ªApplciationè¿è¡Œåœ¨YARNä¸Šçš„æµç¨‹ä¸ºï¼Œä»YARN Clientå‘ResourceManageræäº¤ä»»åŠ¡ï¼Œå°†Applciationæ‰€éœ€èµ„æºæäº¤åˆ°HDFSä¸­ï¼Œç„¶åResourceManagerå¯åŠ¨APPMasterï¼ŒAPPMasteré€šçŸ¥å„ä¸ªNodeManagerå¯åŠ¨containeræ‰§è¡Œå…·ä½“åˆ°è®¡ç®—ä»»åŠ¡ã€‚åœ¨å¯åŠ¨containerä¹‹å‰éœ€è¦ä»HDFSä¸Šä¸‹è½½è¯¥containeræ‰§è¡Œæ‰€ä¾èµ–çš„èµ„æºï¼Œè¿™äº›èµ„æºåŒ…æ‹¬jarã€ä¾èµ–çš„jaræˆ–è€…å…¶å®ƒæ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸º<strong>èµ„æºæœ¬åœ°åŒ–</strong>(Resource Localization)ã€‚</p><p>æœ¬ç¯‡ä¸»è¦ä»‹ç»ä¸‹èµ„æºæœ¬åœ°åŒ–ç›¸å…³çš„å†…å®¹ã€‚</p><span id="more"></span><h2 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h2><p><strong>æœ¬åœ°åŒ–(Localization)</strong><br>æœ¬åœ°åŒ–æ˜¯æŒ‡å°†HDFSä¸Šçš„èµ„æºä¸‹è½½åˆ°æœ¬åœ°çš„<strong>è¿‡ç¨‹</strong>ã€‚å°†èµ„æºæœ¬åœ°åŒ–ï¼Œä½¿containerä¸ç”¨æ€»æ˜¯è®¿é—®HDFSä¸Šçš„æ•°æ®ï¼Œè€Œæ˜¯ç›´æ¥è®¿é—®æœ¬åœ°æ•°æ®ï¼Œæé«˜æ•ˆç‡ã€‚</p><p><strong>æœ¬åœ°èµ„æº(LocalResource)</strong><br>æœ¬åœ°èµ„æºæ˜¯æŒ‡containerè¿è¡Œæ—¶æ‰€éœ€è¦çš„èµ„æºï¼Œå¯ä»¥æ˜¯æŸä¸ªæ–‡ä»¶æˆ–è€…ä¾èµ–çš„libraryï¼Œè¿™äº›èµ„æºå­˜åœ¨HDFSä¸­ã€‚NodeManageråœ¨containerå¯åŠ¨ä¹‹å‰è´Ÿè´£å°†è¿™äº›èµ„æºè¿›è¡Œæœ¬åœ°åŒ–ã€‚å¯¹äºApplicationæ¥è¯´ï¼Œæœ¬åœ°èµ„æºæŒ‡ï¼š</p><ul><li>URL: éœ€è¦ä»HDFSä¸Šä¸‹è½½çš„æœ¬åœ°èµ„æºåœ°å€</li><li>Size: æœ¬åœ°èµ„æºçš„å¤§å°</li><li>timestamp: æœ¬åœ°èµ„æºåœ¨HDFSä¸Šåˆ›å»ºæ—¶çš„æ—¶é—´æˆ³</li><li>LocalResourceType: NodeManageræœ¬åœ°åŒ–èµ„æºæ—¶æŒ‡å®šçš„èµ„æºç±»å‹ï¼Œæœ‰FILEã€ARCHIVEå’ŒPATTERN</li><li>Pattern: ä»archiveä¸­è§£å‹å…·ä½“å†…å®¹æ—¶ä½¿ç”¨çš„è§„åˆ™åŒ¹é…æ–¹å¼(åªæœ‰LocalResourceTypeæ˜¯PATTERNæ—¶æ‰ç”Ÿæ•ˆ)ã€‚</li><li>LocalResourceVisibility: NodeManagerå°†èµ„æºæœ¬åœ°åŒ–ä¹‹åé’ˆå¯¹è¯¥Nodemanagerä¸Šå…¶å®ƒç”¨æˆ·å’ŒApplicationçš„å¯è§æ€§ã€‚å¯è§èŒƒå›´ä¸ºPUBLICã€PRIVATEå’ŒAPPLICATIONã€‚</li></ul><blockquote><p>NOTE: æœ¬åœ°èµ„æºå¹¶ä¸æ˜¯æŒ‡åœ¨æœ¬åœ°ç£ç›˜çš„èµ„æºï¼Œè€Œæ˜¯éœ€è¦ä»HDFSä¸‹è½½åˆ°æœ¬åœ°çš„èµ„æºã€‚</p></blockquote><p>é‚£ä¹ˆcontainerä¼šè¯·æ±‚ä»€ä¹ˆæ ·çš„èµ„æºè¿›è¡Œæœ¬åœ°åŒ–å‘¢ï¼Ÿå¯ä»¥æ˜¯ä»»æ„çš„æ–‡ä»¶ï¼Œä½†æ˜¯è¿™äº›æ–‡ä»¶å¯¹contianerå¿…é¡»æ˜¯åªè¯»çš„ã€‚<br>ä¸‹é¢ä¸¾å‡ ä¸ªæ¯”è¾ƒé€‚åˆåšæœ¬åœ°èµ„æºçš„å…¸å‹ä¾‹å­ï¼š</p><ol><li>containerå¯åŠ¨çš„æ—¶å€™éœ€è¦çš„ä»£ç åº“ï¼Œå¦‚jaræ–‡ä»¶</li><li>containerå¯åŠ¨æ—¶æ‰€éœ€è¦çš„configureæ–‡ä»¶</li><li>é™æ€çš„æ–‡ä»¶ç›®å½•</li></ol><p>ä¸€äº›åŠ¨æ€èµ„æºä¸é€‚åˆä½œä¸ºæœ¬åœ°èµ„æºï¼Œä¾‹å¦‚ï¼šcontaineréœ€è¦çš„èµ„æºæœ‰å¯èƒ½è¢«å…¶å®ƒç»„ä»¶è¿›è¡Œæ›´æ–°ï¼Œapplicationè‡ªå·±ä¼šç›´æ¥æ›´æ–°çš„æ–‡ä»¶æˆ–è€…applicationæƒ³è·Ÿå…¶å®ƒæœåŠ¡å…±äº«æ–‡ä»¶çš„å˜åŒ–æƒ…å†µçš„ã€‚</p><p><strong>ResourceLocalizationService</strong><br>ResourceLocalizationServiceæ˜¯NodeManagerå†…éƒ¨çš„ä¸€ä¸ªæœåŠ¡ï¼Œä¸»è¦è´Ÿè´£ä¸‹è½½å’Œç®¡ç†containeræ‰€éœ€çš„å„ç§èµ„æºã€‚ä¸‹è½½æ—¶ä¼šå¯¹æ‰€æœ‰å¯ç”¨çš„ç£ç›˜è¿›è¡Œè´Ÿè½½å‡è¡¡ï¼Œå¯¹ä¸‹è½½çš„èµ„æºä¼šä¸¥æ ¼æ§åˆ¶ä»–ä»¬çš„è®¿é—®æƒé™ã€‚</p><p><strong>DeletionService</strong><br>DeletionServiceä¹Ÿæ˜¯NodeManagerå†…éƒ¨çš„ä¸€ä¸ªæœåŠ¡ï¼Œä¸»è¦è´Ÿè´£åœ¨æ”¶åˆ°æŒ‡ä»¤ä¹‹ååˆ é™¤æœ¬åœ°ç›®å½•</p><p><strong>Localizer</strong><br>Localizerå®é™…ä¸Šæ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œç”¨äºèµ„æºæœ¬åœ°åŒ–ã€‚Localizeræœ‰ä¸¤ç§ç±»å‹ï¼Œä¸€ç§æ˜¯æŒ‡ç”¨ä¸ä¸‹è½½PUBLICè®¿é—®ç±»å‹èµ„æºçš„<em>PublicLocalizer</em>ï¼Œå¦ä¸€ç§æ˜¯ä¸‹è½½PRIVATEå’ŒAPPLICATIONè®¿é—®ç±»å‹çš„<em>ContainerLocalizers</em>ã€‚</p><p><strong>LocalCache</strong><br>LocalCacheæ˜¯NodeManagerç»´æŠ¤æ‰€æœ‰ä¸‹è½½åˆ°æœ¬åœ°çš„æ–‡ä»¶çš„local-cacheã€‚è¿™äº›èµ„æºé€šè¿‡ä¸‹è½½æ—¶æŒ‡å®šçš„HDFSåœ°å€æ¥å”¯ä¸€æ ‡è¯†ã€‚</p><h2 id="æ¦‚å¿µè¡¥å……"><a href="#æ¦‚å¿µè¡¥å……" class="headerlink" title="æ¦‚å¿µè¡¥å……"></a>æ¦‚å¿µè¡¥å……</h2><h3 id="LOCALRESOURCE-TIMESTAMPS"><a href="#LOCALRESOURCE-TIMESTAMPS" class="headerlink" title="LOCALRESOURCE TIMESTAMPS"></a>LOCALRESOURCE TIMESTAMPS</h3><p>timestampååº”äº†æœ¬åœ°èµ„æºçš„ä¸€ä¸ªç‰ˆæœ¬ï¼ŒNodeManageråœ¨ä¸‹è½½æœ¬åœ°èµ„æºæ—¶ä¼šæ£€æŸ¥timestampï¼Œè¿™æ ·Applicationåœ¨è¿è¡Œæ—¶çœ‹åˆ°çš„æ–‡ä»¶å†…å®¹éƒ½ä¸€æ ·ã€‚<br>åˆ©ç”¨timestampï¼ŒYARNèƒ½å‘ç°èµ„æºæ˜¯å¦å‘ç”Ÿè¿‡å˜åŒ–ï¼Œå¦‚æœå‘ç”Ÿå˜åŒ–å°†ä½¿containerå¤±è´¥é¿å…ä¸ä¸€è‡´å‘ç”Ÿã€‚å› ä¸ºåœ¨HDFSä¸Šçš„èµ„æºä¸€æ—¦è¢«NodeManageræœ¬åœ°åŒ–åˆ°æœ¬åœ°ç£ç›˜ï¼Œè¿™ä¸ªæ–‡ä»¶å°±ä¸å†ä¸æºæ–‡ä»¶æœ‰ä»»ä½•è”ç³»ï¼Œåªä¼šè®°å½•ä¸‹åŸæ¥çš„URLç”¨æ¥åœ¨æœ¬åœ°è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚æ­¤æ—¶å³ä½¿æºæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼ŒNodeManagerä¹Ÿä¸ä¼šè·Ÿè¸ªæ­¤å˜åŒ–å†æ¬¡ä¸‹è½½æ–‡ä»¶ã€‚</p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯<em>å½“containerå¯åŠ¨æ—¶ï¼ŒApplicationMasterä¼šå‘è¿è¡Œcontainerçš„NodeManageræŒ‡å®šèµ„æºçš„timestampï¼ŒåŒæ ·å½“è¿è¡ŒApplicationMasterçš„containerå¯åŠ¨æ—¶ï¼Œä¹Ÿéœ€è¦èµ„æºçš„timestampï¼Œæ­¤æ—¶è¿™ä¸ªtimestampå°±éœ€è¦ç”±clientæŒ‡å®š</em>ã€‚ä»¥MapReduce on YARNä¸ºä¾‹ï¼ŒMapReduceçš„JobClientå†³å®šApplicationMasteréœ€è¦çš„èµ„æºçš„timestampï¼Œç„¶åç”±ApplicationMasterè‡ªå·±å†³å®šmapå’Œreduceæ‰€éœ€èµ„æºçš„timestampã€‚</p></blockquote><h3 id="LOCALRESOURCE-TYPES"><a href="#LOCALRESOURCE-TYPES" class="headerlink" title="LOCALRESOURCE TYPES"></a>LOCALRESOURCE TYPES</h3><p>ä¸Šä¸€èŠ‚ä¸­æåˆ°LocalResourceTypeä¸ºFILEã€ARCHIVEå’ŒPATTERNï¼Œä¸‹é¢ä»‹ç»ä¸‹ä¸‰ç§typeçš„å…·ä½“å«ä¹‰ã€‚<br>FILEç±»å‹æ˜¯æŒ‡æ™®é€šçš„æ–‡ä»¶ï¼Œæ–‡æœ¬ç±»å‹æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶<br>ARCHIVEç±»å‹æ˜¯æŒ‡ä¸€äº›å¯ä»¥è¢«NodeManagerè‡ªåŠ¨è¯†åˆ«è§£å‹çš„å½’æ¡£æ–‡ä»¶ï¼Œæ¯”å¦‚jarsã€tarsã€tar.gzå’Œzip<br>PATTERNæ˜¯ARCHIVEå’ŒFILEçš„ä¸€ç§æ··åˆä½“ã€‚è¿™ç§ç±»å‹ä¸‹è½½åˆ°æœ¬åœ°çš„æºæ–‡ä»¶ä¼šä¿ç•™ï¼Œå¹¶ä¸”åœ¨æœ¬åœ°åŒ–æ—¶åªæœ‰è§£å‹çš„æ–‡ä»¶ä¼šç•™å­˜åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚æºæ–‡ä»¶å’Œè§£å‹çš„æ–‡ä»¶åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ã€‚å“ªäº›æ–‡ä»¶éœ€è¦ä»ARCHIVEä¸­æŠ½å–å‡ºæ¥ï¼Œå“ªäº›ä¸éœ€è¦è¿™äº›éƒ½æ˜¯ç”±patternå†³å®šçš„ã€‚ç›®å‰åªæœ‰jaræ”¯æŒPATTERNï¼Œå…¶å®ƒéƒ½è¢«è®¤ä¸ºæ­£å¸¸çš„ARCHIVEã€‚</p><h3 id="LOCALRESOURCE-VISIBILITES"><a href="#LOCALRESOURCE-VISIBILITES" class="headerlink" title="LOCALRESOURCE VISIBILITES"></a>LOCALRESOURCE VISIBILITES</h3><p>ä¸Šä¸€èŠ‚LocalResourceVisibilityä¸­æåˆ°æœ¬åœ°èµ„æºæœ‰ä¸‰ç§å¯è§æ€§ï¼Œåˆ†åˆ«ä¸ºPUBLICã€PRIVATEå’ŒAPPLICATIONã€‚å…¶ä¸­</p><p>PUBLICçš„è®¿é—®æƒé™æ˜¯æŒ‡<strong>ä»»ä½•ç”¨æˆ·çš„ä»»æ„Applicationçš„containeréƒ½å¯ä»¥è®¿é—®</strong>ã€‚å…¸å‹çš„PUBLICèµ„æºæ˜¯é‚£äº›åœ¨HDFSä¸Šå¯ä»¥è¢«ä»»ä½•äººè®¿é—®çš„æ–‡ä»¶ï¼Œå½“è¿™äº›èµ„æºè¢«æœ¬åœ°åŒ–ä¹‹åä¼šä¿ç•™ç›¸åŒçš„è®¿é—®æƒé™ã€‚<em>å¦‚æœä¸€ä¸ªèµ„æºæ˜¯PUBLICï¼Œå½“æœ‰container(containerå¯ä»¥æ˜¯å½“å‰Attemptï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒç”¨æˆ·çš„ä»»æ„Applicationä¸­çš„container)è¯·æ±‚ç›¸åŒçš„æœ¬åœ°èµ„æºæ—¶ï¼Œåªè¦æ­¤èµ„æºæ²¡æœ‰è¢«LocalCacheåˆ é™¤ï¼Œéƒ½å¯ä»¥ç›´æ¥ä»LocalCacheé‡Œç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸éœ€è¦å†æ¬¡ä¸‹è½½</em>ã€‚</p><p>PUBLICèµ„æºå­˜å‚¨åœ¨NodeManageræœ¬åœ°ç£ç›˜çš„<code>&lt;local-dir&gt;/filecache</code>ç›®å½•ä¸‹ï¼Œæ­¤ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶çš„owneræ˜¯NodeManagerè¿›ç¨‹å¯åŠ¨æ—¶çš„ç”¨æˆ·ï¼Œå¹¶ä¸”æ‰€æœ‰ç”¨æˆ·éƒ½æœ‰è¯»æƒé™ï¼Œå› æ­¤è¿™äº›èµ„æºå¯ä»¥åœ¨æ­¤NodeManagerä¸Šè¿è¡Œçš„æ‰€æœ‰ç”¨æˆ·çš„containerå…±äº«ã€‚</p><p>PRIVATEæƒé™æœ¬åœ°èµ„æºåªèƒ½åœ¨<strong>å½“å‰èŠ‚ç‚¹ä¸Šç›¸åŒç”¨æˆ·çš„applicationä¹‹é—´å…±äº«</strong>ï¼Œè¿™äº›èµ„æºå­˜å‚¨åœ¨NodeManageræœ¬åœ°ç£ç›˜çš„<code>&lt;local-dir&gt;/usercache/$username/filecache</code>ç›®å½•ä¸‹ï¼Œè¿™äº›æ–‡ä»¶çš„owneræ˜¯å¯åŠ¨Applicationçš„userï¼Œå¹¶ä¸”å…¶å®ƒç”¨æˆ·æ²¡æœ‰è®¿é—®æƒé™ã€‚ç±»ä¼¼PUBLICï¼Œä¸€æ—¦èµ„æºæœ¬åœ°åŒ–ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½æ²¡æœ‰å†™æƒé™ï¼Œå³ä½¿æ˜¯æäº¤ä»»åŠ¡çš„userã€‚è¿™æ ·æ˜¯ä¸ºäº†é¿å…æ¶æ„çš„containerå»ä¿®æ”¹æ–‡ä»¶ã€‚</p><p>APPLICATIONåªåœ¨<strong>å½“å‰èŠ‚ç‚¹ä¸ŠåŒä¸€ä¸ªapplicationçš„containerä¹‹é—´å…±äº«</strong>ã€‚è¿™äº›èµ„æºå­˜å‚¨åœ¨NodeManageræœ¬åœ°ç£ç›˜çš„<code>&lt;local-dir&gt;/usercache/$username/appcache/&lt;app-id&gt;/</code>ç›®å½•ä¸‹ï¼Œæ–‡ä»¶çš„owneræ˜¯Applicationçš„æäº¤è€…ï¼Œå¹¶ä¸”åªæœ‰è¯»æƒé™ã€‚</p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯LOCALRESOURCE VISIBILITIESä¸LOCALRESOURCE TIMESTAMPSç±»ä¼¼ï¼Œéƒ½æ˜¯ç”±ApplicationMasteræŒ‡å®šæœ¬åœ°èµ„æºçš„å¯è§æ€§ï¼ŒNodeManagerå¹¶ä¸ä¼šå¯¹èµ„æºçš„å¯è§æ€§åšä»»ä½•å†³å®šã€‚åŒæ ·å½“è¿è¡ŒApplicationMasterçš„containerå¯åŠ¨æ—¶ï¼Œä¹Ÿéœ€è¦èµ„æºçš„å¯è§æ€§ï¼Œæ­¤æ—¶è¿™ä¸ªå¯è§æ€§å°±éœ€è¦ç”±clientæŒ‡å®šã€‚ä»¥MapReduce on YARNä¸ºä¾‹ï¼ŒMapReduceçš„JobClientå†³å®šApplicationMasteréœ€è¦çš„èµ„æºçš„å¯è§æ€§ï¼Œç„¶åç”±ApplicationMasterè‡ªå·±å†³å®šmapå’Œreduceæ‰€éœ€èµ„æºçš„å¯è§æ€§ã€‚</p></blockquote><h4 id="æœ¬åœ°åŒ–æµç¨‹"><a href="#æœ¬åœ°åŒ–æµç¨‹" class="headerlink" title="æœ¬åœ°åŒ–æµç¨‹"></a>æœ¬åœ°åŒ–æµç¨‹</h4><p>PUBLICèµ„æºæœ¬åœ°åŒ–æ˜¯ç”±<code>PublicLocalizer</code>å®ç°çš„ï¼Œåœ¨NodeManagerè¿›ç¨‹ä¸­ä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹æ± PublicLocalizersï¼Œå…¶ä¸ªæ•°æ˜¯ç”±<code>yarn.nodemanager.localizer.fetch.thread-count</code>å†³å®šï¼Œçº¿ç¨‹æ± çš„å¤§å°å†³å®šå¹¶è¡Œä¸‹è½½PUBLICèµ„æºçš„çº¿ç¨‹æœ€å¤§ä¸ªæ•°ã€‚å½“PublicLocalizeræœ¬åœ°åŒ–PUBLICèµ„æºæ—¶ï¼Œä¼šé€šè¿‡æ£€æŸ¥è¿™äº›èµ„æºåœ¨HDFSä¸Šçš„æƒé™æ¥ç¡®å®šæ‰€ç”³è¯·çš„èµ„æºç¡®å®ä¸ºPUBLICã€‚åªè¦æœ‰èµ„æºä¸ç¬¦åˆå°±æ‹’ç»æœ¬åœ°åŒ–ã€‚PublicLocalizerèƒ½å®‰å…¨çš„ä»HDFSä¸Šä¸‹è½½èµ„æºæ˜¯å‘ContainerLaunchContextä¼ é€’äº†è¯ä¹¦ã€‚ </p><p>PRIVATE/APPLICATONèµ„æºçš„æœ¬åœ°åŒ–æ˜¯ç”±<code>ContainerLocalizer</code>å®ç°çš„ï¼Œä¸åŒä¸PUBLICçš„<code>PublicLocalizer</code>å®ç°ã€‚<em>PublicLocalizeræ˜¯ç›´æ¥åœ¨NodeManagerä¸­å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ± è¿›è¡Œæœ¬åœ°åŒ–ï¼Œè€ŒContainerLocalizerå‡ºäºå®‰å…¨é—®é¢˜ï¼Œå¹¶æ²¡æœ‰åœ¨NodeManagerè¿›ç¨‹ä¸­ç›´æ¥å®ç°ï¼Œè€Œæ˜¯åœ¨continerä¸­å®ç°çš„</em>ã€‚</p><p>PRIVATE/APPLICATONèµ„æºçš„æœ¬åœ°åŒ–æ˜¯ç”±<code>ContainerLocalizer</code>å®ç°ï¼Œè¿™æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ç”±<code>LocalizerRunner</code>çº¿ç¨‹ç®¡ç†ï¼Œ<em>LocalizerRunneræ˜¯NodeManagerä¸­çš„ä¸€ä¸ªçº¿ç¨‹</em>ï¼Œåªè¦æŸä¸ªcontaineræœ‰èµ„æºè¿˜æ²¡æœ‰ä¸‹è½½ï¼Œ<em>é‚£ä¹ˆæ­¤containerå°±ä¼šè§¦å‘ä¸€ä¸ªLocalizerRunner</em>ã€‚ä¸‹é¢çœ‹ä¸‹å…·ä½“çš„ç»†èŠ‚ï¼š</p><!--LocalResourcesTracker is a per-user or per-application object that tracks all the LocalResources for a given user or an application.--><p>å½“æŸä¸ªcontainerç¬¬ä¸€æ¬¡è¯·æ±‚PRIVATE/APPLICATIONç±»å‹çš„æœ¬åœ°èµ„æºæ—¶ï¼Œå¦‚æœæ²¡æœ‰åœ¨LocalResourcesTrackerä¸­æ‰¾åˆ°ï¼Œåˆ™åŠ å…¥pending-resourcesåˆ—è¡¨ã€‚éšåæ˜¯å¦éœ€è¦åˆ›å»ºLocalizerRunnerçº¿ç¨‹å–å†³äºæ˜¯å¦æœ‰å¿…è¦ä¸‹è½½èµ„æºï¼Œå¦‚æœéœ€è¦å°±å°†æœ¬åœ°èµ„æºåŠ å…¥<strong>LocalizerRunner</strong>ç»´æŠ¤çš„pending-resourcesåˆ—è¡¨ã€‚</p><p>NodeManageråœ¨å®‰å…¨æ¨¡å¼æ—¶ï¼Œæœ¬åœ°èµ„æºæœ¬åœ°åŒ–æ—¶éœ€è¦æ‰€ç”¨çš„useræ˜¯applicationçš„æäº¤ç”¨æˆ·è€Œä¸æ˜¯NodeManagerçš„å¯åŠ¨ç”¨æˆ·ã€‚å› æ­¤<strong>LocalizerRunnerä¼šä»¥applicationæäº¤è€…çš„èº«ä»½å¯åŠ¨LinuxContainerExecutor(LCE)è¿›ç¨‹ï¼Œç„¶åLCEä¼šæ‰§è¡ŒContainerLocalizerä¸‹è½½èµ„æº</strong>ã€‚<em>ContainerLocalizerå¯åŠ¨ä¹‹åä¼šä¸NodeManagerç»´æŒä¸€ä¸ªå¿ƒè·³</em>ï¼Œé€šè¿‡å¿ƒè·³ï¼ŒLocalizerRunnerç»™ContainerLocalizeråˆ†é…éœ€è¦ä¸‹è½½çš„èµ„æºæˆ–è€…åœæ­¢ContainerLocalizerè¿›ç¨‹ï¼Œè€ŒContainerLocalizerä¼šé€šçŸ¥LocalizerRunnerè‡ªå·±çš„ä¸‹è½½è¿›åº¦ã€‚å¦‚æœèµ„æºä¸‹è½½å¤±è´¥ï¼Œè¿™ä¸ªèµ„æºå°†ä¼šä»LocalResourcesTrackerä¸­ç§»é™¤ï¼Œå¹¶ä¸”containeræœ€ç»ˆä¹Ÿä¼šå¤±è´¥ã€‚å¦‚æœä¸‹è½½æˆåŠŸï¼ŒLocalizerRunnerä¼šé€šè¿‡å¿ƒè·³ç»™ContainerLocalizerå¦ä¸€ä¸ªèµ„æºè¿›è¡Œä¸‹è½½ï¼Œç›´åˆ°æ‰€æœ‰çš„èµ„æºéƒ½ä¸‹è½½å®Œã€‚</p><!--At present, each ContainerLocalizer doesnâ€™t support parallel download of mutliple PRIVATE/APPLICATION resources which we are trying to fix via YARN-574.Note that because of the above, the maximum parallelism that we can get at present is the number of containers requested for same user on same node manager at THAT point of time. This in the worst case is one when an ApplicationMaster itself is starting. So if AM needs any resources to be localized then today they will be downloaded serially before its container starts.--><h4 id="æœ¬åœ°èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ"><a href="#æœ¬åœ°èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="æœ¬åœ°èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ"></a>æœ¬åœ°èµ„æºçš„ç”Ÿå‘½å‘¨æœŸ</h4><p>ç”±äºæœ¬åœ°èµ„æºçš„è®¿é—®æƒé™ä¸ä¸€æ ·ï¼Œåˆ™ä¸åŒçš„LocalResourceTypeåœ¨æœ¬åœ°ä¿ç•™çš„æ—¶é—´ä¹Ÿä¼šä¸ä¸€æ ·ã€‚</p><ul><li>PUBLICç”±äºæ˜¯åœ¨ä»»ä½•ç”¨æˆ·çš„ä»»æ„Applicationä¹‹é—´å…±äº«ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šåœ¨æŸä¸ªcontaineræˆ–è€…applicationç»“æŸä¹‹åè¢«åˆ é™¤ï¼Œåªæœ‰åœ¨æœ¬åœ°ç›®å½•<local-dir>è¾¾åˆ°å­˜å‚¨é˜ˆå€¼æ—¶æ‰ä¼šè¢«åˆ é™¤ï¼Œè¿™ä¸ªé˜ˆå€¼ç”±<code>yarn.nodemanager.localizer.cache.target-size-mb</code>æ§åˆ¶ã€‚</li><li>PRIVATEå’ŒPUBLICçš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·ã€‚</li><li>APPLICATIONä¼šåœ¨applicationç»“æŸä¹‹åç«‹å³åˆ é™¤ã€‚</li></ul><!--One thing of note is that for any given application, we may have multiple ApplicationAttempts and each attempt may start zero or more containers on a given node manager. When the first container belonging to an ApplicationAttempt starts, ResourceLocalizationService localizes files for that application as requested in the containerâ€™s launch context. If future containers request more such resources then they all will be localized. If one ApplicationAttempt finishes/fails and another is started, ResourceLocalizationService doesnâ€™t do anything w.r.t the previously localized resources. However when eventually the application finishes, ResourceManager communicates that information to NodeManagers which in turn clear the application LocalCache. In summary, APPLICATION LocalResources are truly application scoped and not ApplicationAttempt scoped.--><h4 id="æœ¬åœ°åŒ–ç›¸å…³çš„é…ç½®"><a href="#æœ¬åœ°åŒ–ç›¸å…³çš„é…ç½®" class="headerlink" title="æœ¬åœ°åŒ–ç›¸å…³çš„é…ç½®"></a>æœ¬åœ°åŒ–ç›¸å…³çš„é…ç½®</h4><p>åœ¨<code>yarn-site.xml</code>ä¸­æœ‰ä¸€äº›èµ„æºæœ¬åœ°åŒ–ç›¸å…³çš„é…ç½®ã€‚</p><ul><li><code>yarn.nodemanager.local-dirs</code>: èµ„æºæœ¬åœ°åŒ–æ—¶æ‰€åœ¨çš„æœ¬åœ°ç›®å½•ï¼Œå¯ä»¥æ˜¯ä»¥é€—å·åˆ†éš”çš„å¤šä¸ªç£ç›˜ç›®å½•ã€‚</li><li><code>yarn.nodemanager.local-cache.max-files-per-directory</code>: æ¯ä¸ªç›®å½•ä¸­æœ€å¤šæœ¬åœ°åŒ–æ–‡ä»¶çš„ä¸ªæ•°ï¼ŒPUBLIC / PRIVATE / APPLICATIONåˆ†åˆ«ç»Ÿè®¡ã€‚</li><li><code>yarn.nodemanager.localizer.address</code>: ResourceLocalizationServiceæœåŠ¡ç›‘å¬çš„RPCåœ°å€ï¼Œç”¨æ¥æ¥æ”¶ä¸åŒlocalizers</li><li><code>yarn.nodemanager.localizer.client.thread-count</code>: ResourceLocalizationServiceä¸­ç”¨æ¥å¤„ç†æ¥è‡ªlocalizersè¯·æ±‚çš„çº¿ç¨‹æ•°ã€‚é»˜è®¤æ˜¯5</li><li><code>yarn.nodemanager.localizer.fetch.thread-count</code>: æœ¬åœ°åŒ–PUBLICèµ„æºæ—¶PublicLocalizerçš„çº¿ç¨‹æ•°ã€‚é»˜è®¤æ˜¯4</li><li><code>yarn.nodemanager.delete.thread-count</code>: DeletionServiceä¸­åˆ é™¤æ–‡ä»¶çš„çº¿ç¨‹æ•°ï¼Œé»˜è®¤æ˜¯4ã€‚</li><li><code>yarn.nodemanager.localizer.cache.target-size-mb</code>: æœ¬åœ°åŒ–èµ„æºæ‰€å çš„æœ€å¤§ç£ç›˜ç©ºé—´ï¼Œå•ä½æ˜¯MBï¼Œæ¯”åŒ…æ‹¬APPLICATIONèµ„æºã€‚</li><li><code>yarn.nodemanager.localizer.cache.cleanup.interval-ms</code>: æ¯éš”å›ºå®šæ—¶é—´ï¼Œå»æ£€æŸ¥ä¸‹ç£ç›˜çš„ä½¿ç”¨é‡ã€‚åœ¨æ­¤é—´éš”ä¹‹åï¼Œå¦‚æœå­˜å‚¨çš„ç£ç›˜ç©ºé—´è¶…è¿‡äº†é…ç½®çš„é˜ˆå€¼ï¼Œä¼šåˆ é™¤æœªç”¨çš„èµ„æºã€‚</li></ul><blockquote><p>æœªä½¿ç”¨çš„èµ„æºæ˜¯æŒ‡æ²¡æœ‰è¢«æ­£åœ¨è¿è¡Œçš„containerå¼•ç”¨çš„èµ„æºã€‚æ¯æ¬¡containerè¯·æ±‚èµ„æºæ—¶ï¼Œcontainerä¼šè¢«åŠ å…¥åˆ°ä¸€ä¸ªèµ„æºå¼•ç”¨åˆ—è¡¨ä¸­ï¼Œç›´åˆ°containerç»“æŸä¹‹åæ‰ä¼šè¢«ç§»é™¤ã€‚æ‰€ä»¥å½“å¼•ç”¨æ•°ä¸º0æ—¶ï¼Œå¯ä»¥è¢«åˆ é™¤ã€‚</p></blockquote><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zh.hortonworks.com/blog/management-of-application-dependencies-in-yarn/">Management of Application Dependencies in YARN</a><br><a href="https://zh.hortonworks.com/blog/resource-localization-in-yarn-deep-dive/">Resource Localization in YARN: Deep Dive</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸€ä¸ªApplciationè¿è¡Œåœ¨YARNä¸Šçš„æµç¨‹ä¸ºï¼Œä»YARN Clientå‘ResourceManageræäº¤ä»»åŠ¡ï¼Œå°†Applciationæ‰€éœ€èµ„æºæäº¤åˆ°HDFSä¸­ï¼Œç„¶åResourceManagerå¯åŠ¨APPMasterï¼ŒAPPMasteré€šçŸ¥å„ä¸ªNodeManagerå¯åŠ¨containeræ‰§è¡Œå…·ä½“åˆ°è®¡ç®—ä»»åŠ¡ã€‚åœ¨å¯åŠ¨containerä¹‹å‰éœ€è¦ä»HDFSä¸Šä¸‹è½½è¯¥containeræ‰§è¡Œæ‰€ä¾èµ–çš„èµ„æºï¼Œè¿™äº›èµ„æºåŒ…æ‹¬jarã€ä¾èµ–çš„jaræˆ–è€…å…¶å®ƒæ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸º&lt;strong&gt;èµ„æºæœ¬åœ°åŒ–&lt;/strong&gt;(Resource Localization)ã€‚&lt;/p&gt;
&lt;p&gt;æœ¬ç¯‡ä¸»è¦ä»‹ç»ä¸‹èµ„æºæœ¬åœ°åŒ–ç›¸å…³çš„å†…å®¹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/categories/Hadoop/"/>
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/tags/Hadoop/"/>
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="YARN" scheme="http://yuanba.tech/tags/YARN/"/>
    
    <category term="Localization" scheme="http://yuanba.tech/tags/Localization/"/>
    
  </entry>
  
  <entry>
    <title>Use protobuf to FSImage</title>
    <link href="http://yuanba.tech/[%E8%AF%91]FSImage-protocol.html"/>
    <id>http://yuanba.tech/[%E8%AF%91]FSImage-protocol.html</id>
    <published>2019-05-10T15:12:31.000Z</published>
    <updated>2019-05-10T17:10:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡æ˜¯ä¸€ç¯‡è¯‘æ–‡ï¼Œä¸»è¦ä»‹ç»ä¸‹FSImageæ”¹è¿›ä¸ºprotobufçš„è®¾è®¡åŸç†ï¼Œ<a href="https://issues.apache.org/jira/secure/attachment/12626179/HDFS-5698-design.pdf">åŸæ–‡åœ°å€</a>ã€‚</p><span id="more"></span><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸ºäº†èƒ½ä»æ•…éšœä¸­å¿«é€Ÿæ¢å¤ï¼ŒHDFSä¼šå‘¨æœŸæ€§çš„å°†å†…å­˜ä¸­çš„namespaceåœ¨ç£ç›˜ä¸Šçš„æ–‡ä»¶ç³»ç»Ÿä¸­è¿›è¡ŒæŒä¹…åŒ–ã€‚FSImageçš„æ€§èƒ½å’Œæ‰©å±•æ€§åœ¨ä¿è¯æ•°æ®çš„è€ç”¨æ€§å’Œå¯ç”¨æ€§ä¸Šè‡³å…³é‡è¦ã€‚éšç€è¶Šæ¥è¶Šå¤šçš„é«˜çº§åŠŸèƒ½è¢«å¼•å…¥HDFSä¸­ï¼ŒFSImageå·²ç»ä»ä¸€ä¸ªç®€å•çš„blobæ¼”å˜ä¸ºäº†ä¸€ä¸ªéœ€è¦å­˜å‚¨åœ¨ç£ç›˜çš„å¤æ‚çš„æ•°æ®ç»“æ„ã€‚FSImageæœ‰3ä¸ªæ–¹é¢éœ€è¦æ”¹è¿›ï¼š</p><ul><li>æ•ˆç‡<br>åœ¨ç”Ÿæˆç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬è§‚å¯Ÿåˆ°æŒä¹…åŒ–åˆ°ç£ç›˜çš„FSImageå¤§å°èƒ½è¾¾åˆ°äºŒä¸‰åGBã€‚å› ä¸ºåŠ è½½å’Œåœæœºæ—¶ä¿å­˜FSImageæ˜¯NameNodeçš„å…³é”®ç¯èŠ‚ï¼Œå…¶æ•ˆç‡å¯¹ç¡®ä¿NameNodeæ“ä½œçš„å¯ç”¨æ€§éå¸¸é‡è¦ã€‚</li><li>å…¼å®¹æ€§<br>FSImageå°†éšç€HDFSçš„å„ç§åŠŸèƒ½çš„ä¸æ–­å‘å±•å’Œæ¼”å˜ã€‚FSImageçš„å®ç°å°†èƒ½å¤Ÿè¢«å„ç§ä¸åŒçš„ç‰ˆæœ¬æ‰€ä½¿ç”¨ï¼Œè¿™åœ¨æŸäº›åŠŸèƒ½ä¸‹éå¸¸é‡è¦ï¼Œæ¯”å¦‚æ»šåŠ¨å‡çº§ã€‚</li><li>äº’é€šæ€§<br>FSImageèƒ½è¢«ç¬¬ä¸‰æ–¹å·¥å…·è®¿é—®çš„éœ€æ±‚è¶Šæ¥è¶Šå¼ºçƒˆäº†ã€‚ä¾‹å¦‚æŸä¸ªå·¥å…·å¯ä»¥é€šè¿‡æ‰«æFSImageæ”¶é›†ä¸€äº›ç»Ÿè®¡ä¿¡æ¯ã€‚å› æ­¤FSImageåº”è¯¥æä¾›ä¸€ä¸ªä½¿ç¬¬ä¸‰æ–¹å·¥å…·èƒ½ä¸å…¶è¿›è¡Œäº¤äº’çš„æ¸…æ™°è§„èŒƒã€‚</li></ul><p>å½“å‰FSImageæ¨¡å—æœ‰å¤§çº¦2500è¡Œä»£ç ï¼Œä½†æ˜¯ç°åœ¨çš„è®¾è®¡ä¸å®ç°å¹¶ä¸èƒ½è§£å†³ä¸Šé¢çš„éœ€æ±‚ã€‚é¦–å…ˆï¼Œå¯¹äºå…¼å®¹æ€§è€Œè¨€ï¼Œå½“å‰ä»£ç ä¸­çš„ä¸€äº›å®ç°å¹¶ä¸ç†æƒ³ã€‚ä¾‹å¦‚æœ‰äº›å±æ€§æ¯”å¦‚inode IDså’Œblock IDsè¢«ç¼–ç ä¸ºäº†å›ºå®šé•¿åº¦çš„æ•´æ•°è€Œä¸æ˜¯å˜é•¿æ•´æ•°ã€‚</p><p>å…¶æ¬¡ï¼Œä»£ç ä¾èµ–ä¸åˆ†æ”¯ä¸Šçš„ä¸åŒå¸ƒå±€ç‰ˆæœ¬ä»¥ä¿æŒå‘åå…¼å®¹ã€‚åœ¨ä»£ç æ›´æ–°æ—¶åœ¨ä¿®æ”¹å’Œæµ‹è¯•ä¸Šéœ€è¦è€—è´¹å¾ˆå¤§çš„ç²¾åŠ›ã€‚ç„¶è€Œï¼Œè¿˜ä¸æ”¯æŒå‘å‰å…¼å®¹ï¼Œè¿™ä½¿NameNodeé™çº§å˜çš„å¾ˆå›°éš¾</p><p>å†æ¬¡ï¼ŒFSImageçš„æ ¼å¼ä»…ç”±ä»£ç çš„å…·ä½“å®ç°è€Œå†³å®šã€‚å¦‚æœæ²¡æœ‰æ­£å¼çš„FSImageè§„èŒƒï¼Œå¼€å‘äººå‘˜æ„å»ºç¬¬ä¸‰æ–¹å·¥å…·æ—¶ï¼Œåªèƒ½é€šè¿‡offline image vieweræ¥æ„å»ºï¼Œè¿™ç§æ–¹å¼æ—¶ä½æ•ˆçš„è€Œä¸”è¿˜å®¹æ˜“å‡ºé”™ã€‚</p><p>ä¸ºäº†è§£å†³ä¸Šé¢çš„æŒ‘æˆ˜ï¼Œæˆ‘ä»¬æè®®ä½¿ç”¨Googleçš„Protocol Buffersåè®®æ¥å®šä¹‰ä¸€ç§æ–°çš„FSImageæ ¼å¼ã€‚Protocol Buffersæ˜¯å¯æ‰©å±•çš„ï¼Œä¸è¯­è¨€æ— å…³çš„ï¼Œç”¨äºåºåˆ—åŒ–ç»“æ„æ•°æ®ã€‚Protobufèƒ½è§£å†³ä¸Šé¢çš„æŒ‘æˆ˜ã€‚é¦–å…ˆï¼ŒProtocolä½¿ç”¨ä¸€ä¸ªç¼–è¯‘å™¨ä¸ºåºåˆ—åŒ–å’Œååºåˆ—åŒ–ç”Ÿæˆé«˜æ•ˆçš„ä»£ç ã€‚å…¶æ¬¡ï¼Œå®ƒè¿˜æ”¯æŒå‘å‰å’Œå‘åå…¼å®¹ã€‚åºåˆ—åŒ–åçš„æ¯ä¸ªå±æ€§éƒ½åŒ…å«ä¸€ä¸ªå”¯ä¸€çš„æ ‡ç­¾ï¼Œå› æ­¤ååºåˆ—åŒ–çš„ä»£ç å¯ä»¥åŒæ—¶å¤„ç†æ–°åŠ çš„å­—æ®µå’Œç¼ºå¤±çš„å­—æ®µã€‚æœ€åï¼ŒProtocol Buffersçš„æºç ç›´æ¥å®šä¹‰äº†FSImageçš„æ ¼å¼ã€‚ç¬¬ä¸‰æ–¹å·¥å…·ä»…æ ¹æ®protocolæ–‡ä»¶å°±èƒ½çŸ¥é“FSImageçš„æ ¼å¼ã€‚</p><p><a href="https://issues.apache.org/jira/browse/HDFS-5698">HDFS-5698</a>æ˜¯å…³äºFSImageæ–°æ ¼å¼çš„issuesã€‚ä¸‹é¢çš„å†…å®¹ä»‹ç»äº†è®¾è®¡çš„ç»†èŠ‚ï¼Œæ–°æ ¼å¼çš„ä¸€äº›å®éªŒå‚æ•°ï¼Œæœªæ¥çš„æ–¹å‘å’Œç»“è®ºã€‚</p><h2 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h2><p>ä¸‹å›¾æ˜¯æ–°FSImageæ ¼å¼çš„EBNFè¯­æ³•æè¿°ã€‚æ•´ä¸ªFSImageåŒ…æ‹¬4éƒ¨åˆ†ï¼Œåˆ†åˆ«ä¸ºMAGICã€SECTIONã€FileSummaryå’ŒFileSummaryLengthï¼Œå…¶ä¸­SECTIONåŒ…å«Nä¸ªã€‚<br><img src="/blogimgs/fsimage-proto/EBNF.png" alt="FSImageæ ¼å¼" title="FSImageæ ¼å¼"></p><p>FSImageå°†æ•°æ®åˆ†æˆä¸åŒçš„éƒ¨åˆ†ã€‚æ¯éƒ¨åˆ†åœ¨æ•°æ®ä¸­éƒ½æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚å¼€å‘äººå‘˜å¯ä»¥æ·»åŠ æ–°çš„éƒ¨åˆ†æ¥æ‰©å±•FSImageã€‚</p><p>FileSummaryæ¨¡å—åŒ…å«4ä¸ªå±æ€§ï¼Œåˆ†åˆ«ä¸ºondiskVersionã€layoutVersionã€codecå’Œsectionsï¼Œå…¶ä¸­sectionsä¸­è®°å½•äº†æ¯ä¸ªsectionçš„åå­—ã€é•¿åº¦å’Œåç§»é‡ã€‚æ‰€æœ‰çš„sectionå¯ä»¥ä½¿ç”¨æŒ‡å®šçš„codecå¯¹å…¶è¿›è¡Œå‹ç¼©ã€‚æ¯ä¸ªsectionéƒ½æ˜¯å•ç‹¬å‹ç¼©çš„ï¼Œè€Œä¸”sectionä¸­è®°å½•çš„é•¿åº¦å’Œåç§»é‡éƒ½æ˜¯å‹ç¼©ä¹‹åçš„ï¼Œå› æ­¤å½“è¯»å–çš„æ—¶å€™å¯ä»¥ç›´æ¥é€šè¿‡å“åº”çš„åç§»é‡è€Œç›´æ¥å®šä½åˆ°æŸä¸ªsectionã€‚</p><p>å½“è§£æFSImageæ—¶ï¼Œå…ˆä»æ–‡ä»¶çš„æœ«å°¾è¯»å–4bytesï¼Œè¯»å–çš„4bytesæ•°æ®è®°å½•äº†FileSummaryæ¨¡å—çš„é•¿åº¦ï¼Œé€šè¿‡è§£æFileSummaryæ¨¡å—èƒ½å¾—åˆ°æ‰€æœ‰sectionçš„ä½ç½®ä¿¡æ¯ï¼Œè¿™æ ·è®¾è®¡å…è®¸å†™å…¥æ—¶æŒ‰é¡ºåºä¿ç•™FSImageã€‚</p><h3 id="åºåˆ—åŒ–inode"><a href="#åºåˆ—åŒ–inode" class="headerlink" title="åºåˆ—åŒ–inode"></a>åºåˆ—åŒ–inode</h3><p>FSImageå°†inodeåºåˆ—åŒ–ä¸ºä¸¤ç§sectionã€‚<code>INodeSection</code>è®°å½•äº†æ¯ä¸ªinode(<strong>åŒ…æ‹¬INodeFileå’ŒINodeDirectory</strong>)çš„ä¿¡æ¯ï¼Œ<code>INodeDirectorySection</code>è®°å½•äº†æ¯ä¸ªç›®å½•çš„å­inodesã€‚è¿™ç§å°†inodeså½“ä½œå›¾è€Œä¸æ˜¯æ ‘çš„è®¾è®¡æ¨¡å¼æœ‰ä¸¤ä¸ªä¼˜ç‚¹ï¼Œç¬¬ä¸€ä¸å®é™…çš„å›¾æ›´åŠ åŒ¹é…ï¼Œå› æ­¤å½“å¿«ç…§å­˜åœ¨æ—¶ï¼Œinodeä¸ç”¨å†å½¢æˆæ ‘ã€‚ä¸åŒçš„ç›®å½•èƒ½é€šè¿‡<code>INodeReference</code>å¯¹è±¡æŒ‡å‘åŒä¸€ä¸ªinodeã€‚ç¬¬äºŒå®ƒå°†ç»“æ„æ‰å¹³åŒ–ï¼Œä»è€Œä¸ºå¹¶è¡Œæ€§æä¾›äº†æœºä¼šã€‚æ¯ä¸ªinodeéƒ½ç‹¬ç«‹çš„å­˜å‚¨åœ¨FSImageä¸­ï¼Œå› æ­¤å¯ä»¥å¹¶è¡Œçš„è§£æå’Œæ„å»ºä¸åŒçš„inodesã€‚</p><p>åœ¨protobufçš„è§„èŒƒä¸­ï¼Œ<code>INodeSection</code>å¹¶ä¸åŒ…å«inodeåˆ—è¡¨ï¼Œè€Œæ˜¯åœ¨INodeSectionéšåçš„protobufæ¶ˆæ¯ä¸­éšå¼çš„æŒ‡å®šäº†inodeåˆ—è¡¨ã€‚è¿™æ ·åšçš„åŸå› æ—¶Protocol Buffersåœ¨ç”Ÿæˆä»£ç çš„æ—¶å€™éœ€è¦å°†æ‰€æœ‰çš„å±æ€§åŠ è½½åˆ°å†…å­˜ï¼Œç„¶è€Œinodesåˆ—è¡¨å¯èƒ½å¤ªå¤§è€Œä¸èƒ½åŠ è½½åˆ°å†…å­˜ã€‚æ–‡ä¸­çš„è¿™ç§è®¾è®¡å…è®¸FSImageä»¥é€’å¢çš„æ–¹å¼è§£æã€‚</p><p>ä»¤äººæƒŠè®¶çš„æ˜¯ï¼Œæˆ‘ä»¬çš„åˆå§‹åˆ†æç»“æœè¡¨æ˜åºåˆ—åŒ–æƒé™æ˜¯ä»£ç ä¸­çš„ç“¶é¢ˆã€‚æƒé™æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«ç”¨æˆ·åï¼Œç»„åå’Œè¡¨ç¤ºæƒé™ä½çš„16ä½æ•´æ•°ã€‚ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯ç›´æ¥åºåˆ—åŒ–ä¸¤ä¸ªåç§°å’Œ16ä½æ•´æ•°ã€‚ ä½†æ˜¯ï¼Œæˆ‘ä»¬å‘ç°FSImageä¸­çš„åç§°æ˜¯é«˜åº¦å†—ä½™çš„ï¼Œååºåˆ—åŒ–ä¸ºJavaçš„Stringå¯¹è±¡éœ€è¦å¤§é‡çš„CPUæ—¶é—´ã€‚ä¸ºäº†ä¼˜åŒ–æ­¤ç”¨ä¾‹ï¼ŒFSImageå°†åç§°æ˜ å°„ä¸º24ä½IDï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨64ä½æ•´æ•°è¡¨ç¤ºæƒé™ã€‚</p><h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><p>ä¸ºäº†è¯„ä¼°æ–°FSImageçš„æ€§èƒ½ï¼Œæˆ‘ä»¬æ¯”è¾ƒäº†æ–°æ—§æ ¼å¼çš„FSImageæ–‡ä»¶çš„å¤§å°ï¼Œå’ŒæŒä¹…åŒ–å’ŒåŠ è½½FSImageæ‰€éœ€è¦çš„æ—¶é—´ã€‚æˆ‘ä»¬å°†ç”Ÿäº§ä¸­ä½¿ç”¨çš„FSImageç¼©æ”¾åˆ°äº”ç§ä¸åŒçš„å°ºå¯¸ï¼Œä»¥è¯„ä¼°å…·æœ‰å„ç§å°ºåº¦é›†ç¾¤çš„æ€§èƒ½ã€‚æ‰€æœ‰çš„æµ‹è¯•éƒ½è¿è¡Œåœ¨ç›¸åŒçš„æœºå™¨ä¸Šã€‚</p><p>å›¾2æ¯”è¾ƒäº†æ–°æ—§FSImageçš„å¤§å°ã€‚FSImageéƒ½æ˜¯æœªå‹ç¼©çš„ã€‚ç”±å›¾ä¸­æ‰€çŸ¥æ–°æ ¼å¼çš„FSImageèƒ½å¤ŸèŠ‚çœ6-13%çš„ç£ç›˜ç©ºé—´ã€‚<br><img src="/blogimgs/fsimage-proto/fig2.png" alt="å›¾2" title="å›¾2"></p><p>å›¾3å±•ç¤ºäº†æ–°æ—§FSImageåŠ è½½å’ŒæŒä¹…åŒ–çš„å¤„ç†æ—¶é—´ï¼Œä¹Ÿéƒ½æ˜¯æœªå‹ç¼©çš„ã€‚æ–°FSImageæœ‰ç€è¾ƒå¥½çš„å†™æ€§èƒ½ã€‚<br><img src="/blogimgs/fsimage-proto/fig3.png" alt="å›¾3" title="å›¾3"></p><p>æ–°FSImageè¯»æ¯”æ—§FSImageæ‰€è€—çš„æ—¶é—´é•¿ï¼Œå¤§çº¦ä¸º1.5x-2.3xã€‚åˆ†æç»“æœè¡¨æ˜ï¼Œè§£æå­—èŠ‚å’Œæ„é€ ä¸ºprotocol buffersç”Ÿæˆçš„å¯¹è±¡å ç”¨å¤§éƒ¨åˆ†æ—¶é—´ã€‚ æ—§æ ¼å¼çš„ä»£ç è¯»å–æ•°æ®å¹¶ç›´æ¥æ„é€ HDFSä¸­ä½¿ç”¨çš„å¯¹è±¡ï¼Œè¿™ä¸ä¼šå—åˆ°è¿™ç§ç±»å‹çš„å¼€é”€çš„å½±å“ã€‚</p><h2 id="æœªæ¥å·¥ä½œ"><a href="#æœªæ¥å·¥ä½œ" class="headerlink" title="æœªæ¥å·¥ä½œ"></a>æœªæ¥å·¥ä½œ</h2><h3 id="å¹¶è¡ŒåŒ–"><a href="#å¹¶è¡ŒåŒ–" class="headerlink" title="å¹¶è¡ŒåŒ–"></a>å¹¶è¡ŒåŒ–</h3><p>æ–°FSImageçš„è®¾è®¡æ ¼å¼ä¸ºå¹¶è¡ŒåŠ è½½æä¾›äº†æœºä¼šã€‚æ–°çš„FSImageå•ç‹¬å­˜å‚¨æ¯ä¸ªinodeï¼Œå› æ­¤å¯ä»¥å¹¶è¡Œçš„è§£ææ•°æ®å’Œé‡æ„inodeã€‚åŒæ ·ï¼Œæ–°FSImageä¹Ÿå¯ä»¥å¹¶è¡Œçš„å¡«å……ä¸åŒç›®å½•çš„å­èŠ‚ç‚¹ã€‚</p><p>é‡å»ºBlockMapå ç”¨CPUæ—¶é—´çš„å¤§çº¦ä¸º20ï¼…ã€‚åœ¨æ–°çš„FSImageæ ¼å¼ä¸‹ï¼Œå¯ä»¥å°†BlockMapçš„å·¥ä½œè´Ÿè½½è½¬ç§»åˆ°å•ç‹¬çš„çº¿ç¨‹ä¸­ï¼Œä»è€Œéšè—å»¶è¿Ÿã€‚</p><h3 id="ç›´æ¥æ„å»ºå¯¹è±¡"><a href="#ç›´æ¥æ„å»ºå¯¹è±¡" class="headerlink" title="ç›´æ¥æ„å»ºå¯¹è±¡"></a>ç›´æ¥æ„å»ºå¯¹è±¡</h3><p>æ–°çš„FSImageéœ€è¦é¦–å…ˆé€šè¿‡Protocol Buffersç”Ÿæˆçš„å¯¹è±¡ï¼Œç„¶åæ ¹æ®ç”Ÿæˆçš„å¯¹è±¡æ„é€ HDFSä¸­ä½¿ç”¨çš„å¯¹è±¡ã€‚å®éªŒç»“æœæ˜¾ç¤ºæ„é€ ç”Ÿæˆçš„å¯¹è±¡éœ€è¦å¤§é‡æ—¶é—´ã€‚ å¯ä»¥æ‰‹åŠ¨è§£æProtocol Bufferså¹¶ç›´æ¥æ„é€ å¯¹è±¡ï¼Œä»è€Œæ¶ˆé™¤äº†å¼€é”€ã€‚</p><h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2><p>FSImageçš„æ€§èƒ½å’Œå¯é æ€§å¯¹äºæä¾›HDFSçš„è€ç”¨æ€§å’Œå¯ç”¨æ€§éå¸¸é‡è¦ã€‚æœ¬æ–‡æè¿°äº†ä¸€ç§åŸºäºProtocol Buffersçš„æ–°FSImageæ ¼å¼ã€‚æ–°æ ¼å¼æ»¡è¶³äº†FSImageçš„æ•ˆç‡ï¼Œå…¼å®¹æ€§å’Œäº’æ“ä½œæ€§è¦æ±‚ã€‚ æˆ‘ä»¬å¸Œæœ›æ–°æ ¼å¼å¯ä»¥ä¿ƒè¿›HDFSçš„åˆ›æ–°ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æœ¬ç¯‡æ˜¯ä¸€ç¯‡è¯‘æ–‡ï¼Œä¸»è¦ä»‹ç»ä¸‹FSImageæ”¹è¿›ä¸ºprotobufçš„è®¾è®¡åŸç†ï¼Œ&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12626179/HDFS-5698-design.pdf&quot;&gt;åŸæ–‡åœ°å€&lt;/a&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/categories/Hadoop/"/>
    
    
    <category term="Hadoop" scheme="http://yuanba.tech/tags/Hadoop/"/>
    
    <category term="BigData" scheme="http://yuanba.tech/tags/BigData/"/>
    
    <category term="FSImage" scheme="http://yuanba.tech/tags/FSImage/"/>
    
    <category term="protobuf" scheme="http://yuanba.tech/tags/protobuf/"/>
    
  </entry>
  
  <entry>
    <title>åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®</title>
    <link href="http://yuanba.tech/Consistency-in-Distributed.html"/>
    <id>http://yuanba.tech/Consistency-in-Distributed.html</id>
    <published>2019-04-06T16:10:34.000Z</published>
    <updated>2022-01-17T08:58:24.245Z</updated>
    
    <content type="html"><![CDATA[<p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ä¸ªè‘—åçš„åŸåˆ™CAPåŸåˆ™ï¼ŒCä¸ºConsistency(ä¸€è‡´æ€§)ã€Aä¸ºAvailability(å¯ç”¨æ€§)ã€Pä¸ºPartition tolerance(åˆ†åŒºå®¹é”™æ€§)ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸‹åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚æœè¾¾åˆ°ä¸€è‡´æ€§ã€‚</p><p>è¯´åˆ°ä¸€è‡´æ€§ä¸å¾—ä¸è¯´ä¸‹ç»å…¸çš„æ‹œå åº­é—®é¢˜ã€‚</p><span id="more"></span><!--åˆ†å¸ƒå¼å…±è¯†ç®—æ³•æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ ¸å¿ƒï¼Œå¸¸è§çš„æœ‰Paxosã€pbftã€bftã€raftã€powç­‰ã€‚åŒºå—é“¾ä¸­å¸¸è§çš„æ˜¯POWã€POSã€DPOSã€pbftç­‰ã€‚ å…¶ä¸­ï¼šPOWã€POSã€DPOSæ˜¯å¼€æ”¾å¼çš„å…±è¯†åè®®PBFTä¸ºåŠå¼€æ”¾å¼çš„å…±è¯†åè®®Paxosã€raftç­‰æ˜¯å°é—­å¼å…±è¯†åè®®åŒºåˆ«ï¼šå¼€æ”¾å¼ï¼Œæ— æ³•ç¡®åˆ‡çš„çŸ¥é“èŠ‚ç‚¹çš„å¤šå°‘åŠè¿æ¥çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½æ˜¯æ¶æ„çš„ï¼Œä½†æ˜¯å¤§å¤šæ•°æ˜¯éæ¶æ„çš„åŠå¼€æ”¾å¼ï¼Œå¯ä»¥ç¡®å®šèŠ‚ç‚¹çš„å¤šå°‘åŠè¿æ¥çŠ¶æ€ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯èƒ½æ˜¯æ¶æ„çš„ï¼Œä½†æ˜¯æœ‰æ»¡è¶³ä¸€å®šæ¡ä»¶çš„éæ¶æ„èŠ‚ç‚¹å°é—­å¼ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯éæ¶æ„çš„ï¼Œåªä¸è¿‡å¯èƒ½æ–­å¼€è¿æ¥æˆ–crashã€‚--><h2 id="æ‹œå åº­é—®é¢˜"><a href="#æ‹œå åº­é—®é¢˜" class="headerlink" title="æ‹œå åº­é—®é¢˜"></a>æ‹œå åº­é—®é¢˜</h2><p>è¯è¯´ä¸€ç»„æ‹œå åº­å°†å†›åˆ†åˆ«å„ç‡é¢†ä¸€æ”¯å†›é˜Ÿå…±åŒå›´å›°ä¸€åº§åŸå¸‚ã€‚ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œå°†å„æ”¯å†›é˜Ÿçš„è¡ŒåŠ¨ç­–ç•¥é™å®šä¸ºè¿›æ”»æˆ–æ’¤ç¦»ä¸¤ç§ã€‚å› ä¸ºéƒ¨åˆ†å†›é˜Ÿè¿›æ”»éƒ¨åˆ†å†›é˜Ÿæ’¤ç¦»å¯èƒ½ä¼šé€ æˆç¾éš¾æ€§åæœï¼Œå› æ­¤å„ä½<em>å°†å†›å¿…é¡»é€šè¿‡æŠ•ç¥¨æ¥è¾¾æˆä¸€è‡´ç­–ç•¥ï¼Œå³æ‰€æœ‰å†›é˜Ÿä¸€èµ·è¿›æ”»æˆ–æ‰€æœ‰å†›é˜Ÿä¸€èµ·æ’¤ç¦»</em>ã€‚å› ä¸ºå„ä½å°†å†›åˆ†å¤„åŸå¸‚ä¸åŒæ–¹å‘ï¼Œä»–ä»¬<em>åªèƒ½é€šè¿‡ä¿¡ä½¿äº’ç›¸è”ç³»</em>ã€‚åœ¨æŠ•ç¥¨è¿‡ç¨‹ä¸­æ¯ä½å°†å†›éƒ½å°†è‡ªå·±æŠ•ç¥¨ç»™è¿›æ”»è¿˜æ˜¯æ’¤é€€çš„ä¿¡æ¯é€šè¿‡ä¿¡ä½¿åˆ†åˆ«é€šçŸ¥å…¶ä»–æ‰€æœ‰å°†å†›ï¼Œè¿™æ ·ä¸€æ¥æ¯ä½å°†å†›æ ¹æ®è‡ªå·±çš„æŠ•ç¥¨å’Œå…¶ä»–æ‰€æœ‰å°†å†›é€æ¥çš„ä¿¡æ¯å°±å¯ä»¥çŸ¥é“å…±åŒçš„æŠ•ç¥¨ç»“æœè€Œå†³å®šè¡ŒåŠ¨ç­–ç•¥ã€‚</p><p>ç³»ç»Ÿçš„é—®é¢˜åœ¨äºï¼Œ<strong>å°†å†›ä¸­å¯èƒ½å‡ºç°å›å¾’ï¼Œä»–ä»¬ä¸ä»…å¯èƒ½å‘è¾ƒä¸ºç³Ÿç³•çš„ç­–ç•¥æŠ•ç¥¨ï¼Œè¿˜å¯èƒ½é€‰æ‹©æ€§åœ°å‘é€æŠ•ç¥¨ä¿¡æ¯ã€‚å‡è®¾æœ‰9ä½å°†å†›æŠ•ç¥¨ï¼Œå…¶ä¸­1åå›å¾’ã€‚8åå¿ è¯šçš„å°†å†›ä¸­å‡ºç°äº†4äººæŠ•è¿›æ”»ï¼Œ4äººæŠ•æ’¤ç¦»çš„æƒ…å†µã€‚è¿™æ—¶å€™å›å¾’å¯èƒ½æ•…æ„ç»™4åæŠ•è¿›æ”»çš„å°†é¢†é€ä¿¡è¡¨ç¤ºæŠ•ç¥¨è¿›æ”»ï¼Œè€Œç»™4åæŠ•æ’¤ç¦»çš„å°†é¢†é€ä¿¡è¡¨ç¤ºæŠ•æ’¤ç¦»ã€‚è¿™æ ·ä¸€æ¥åœ¨4åæŠ•è¿›æ”»çš„å°†é¢†çœ‹æ¥ï¼ŒæŠ•ç¥¨ç»“æœæ˜¯5äººæŠ•è¿›æ”»ï¼Œä»è€Œå‘èµ·è¿›æ”»ï¼›è€Œåœ¨4åæŠ•æ’¤ç¦»çš„å°†å†›çœ‹æ¥åˆ™æ˜¯5äººæŠ•æ’¤ç¦»ã€‚è¿™æ ·å„æ”¯å†›é˜Ÿçš„ä¸€è‡´ååŒå°±é­åˆ°äº†ç ´å</strong>ã€‚</p><p>æ‹œå åº­é—®é¢˜å…¶å®æ˜¯æŒ‡åœ¨ä¸€ä¸ªå¯å¦¥åçš„é€šä¿¡ç½‘ç»œä¸­å®ç°åˆ†å¸ƒå¼åè®®çš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯<em>åœ¨ä¸å¯é çš„ç¯å¢ƒä¸­å»ºç«‹ä¸€ä¸ªå¯é çš„ç³»ç»Ÿçš„é—®é¢˜</em>ã€‚</p><p>å‡å§‹é‚£äº›å¿ è¯šï¼ˆæˆ–æ˜¯æ²¡æœ‰å‡ºé”™ï¼‰çš„å°†å†›ä»ç„¶èƒ½é€šè¿‡å¤šæ•°å†³ç­–æ¥å†³å®šä»–ä»¬çš„æˆ˜ç•¥ï¼Œä¾¿ç§°è¾¾åˆ°äº†<strong>æ‹œå åº­å®¹é”™</strong>ã€‚</p><!--åœ¨ç‚¹å¯¹ç‚¹å¼æ•°å­—è´§å¸ç³»ç»Ÿæ¯”ç‰¹å¸é‡Œï¼Œæ¯”ç‰¹å¸ç½‘ç»œçš„è¿ä½œæ˜¯å¹³è¡Œçš„ï¼ˆparallelï¼‰ã€‚å„ç»“ç‚¹ä¸ç»ˆç«¯éƒ½è¿ç®—è‘—åŒºå—é“¾æ¥è¾¾æˆå·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰ã€‚å·¥ä½œé‡è¯æ˜çš„é“¾æ¡æ˜¯è§£å†³æ¯”ç‰¹å¸ç³»ç»Ÿä¸­æ‹œå åº­é—®é¢˜çš„å…³é”®ï¼Œé¿å…æœ‰é—®é¢˜çš„ç»“ç‚¹ï¼ˆå³å‰æ–‡æåˆ°çš„â€œåå›çš„å°†å†›â€ï¼‰ç ´åæ•°å­—è´§å¸ç³»ç»Ÿé‡Œäº¤æ˜“å¸çš„æ­£ç¡®æ€§ï¼Œæ˜¯å¯¹æ•´ä¸ªç³»ç»Ÿçš„è¿è¡ŒçŠ¶æ€æœ‰ç€é‡è¦çš„æ„ä¹‰ã€‚æ¯”ç‰¹å¸ä½¿ç”¨ç»è¿‡å·¥ä½œé‡è¯æ˜åŒºå—é“¾æŠ€æœ¯è§£å†³äº†æ‹œå åº­å®¹é”™é—®é¢˜ã€‚ POWå¢åŠ äº†æå‡ºææ¡ˆçš„æˆæœ¬ï¼Œä¸æ˜¯ä»»æ„èŠ‚ç‚¹å¯ä»¥éšæ„æå‡ºææ¡ˆï¼Œåœ¨æºå¤´å‡å°‘äº†å¹²æ‰°ä¿¡æ¯--><h2 id="PBFT"><a href="#PBFT" class="headerlink" title="PBFT"></a>PBFT</h2><p>PBFTæ˜¯Practical Byzantine Fault Toleranceçš„ç¼©å†™ï¼Œæ„ä¸º<em>å®ç”¨æ‹œå åº­å®¹é”™ç®—æ³•</em>ï¼Œå¤æ‚åº¦è¿‡é«˜<code>O(N^2)</code>ã€‚PBFTæ˜¯ä¸€ç§<em>çŠ¶æ€æœºå‰¯æœ¬å¤åˆ¶ç®—æ³•</em>ï¼Œå³æœåŠ¡ä½œä¸ºçŠ¶æ€æœºè¿›è¡Œå»ºæ¨¡ï¼ŒçŠ¶æ€æœºåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹è¿›è¡Œå‰¯æœ¬å¤åˆ¶ã€‚æ¯ä¸ªçŠ¶æ€æœºçš„å‰¯æœ¬éƒ½ä¿å­˜äº†æœåŠ¡çš„çŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿå®ç°äº†æœåŠ¡çš„æ“ä½œã€‚</p><p>PBFTæ˜¯ä¸€ä¸ª<strong>ä¸‰é˜¶æ®µç®—æ³•</strong>ï¼Œåˆ†ä¸º<code>Pre-Prepare</code>ã€<code>Prepare</code>å’Œ<code>Commit</code>ã€‚<br>PBFTä¸­æœ‰å‡ ä¸ªæ¦‚å¿µéœ€è¦äº†è§£ä¸‹ï¼Œæ‰€æœ‰çš„èŠ‚ç‚¹ç§°ä¸º<code>å‰¯æœ¬</code>ï¼Œè¿™äº›å‰¯æœ¬æœ‰ä¸¤ä¸ªè§’è‰²ï¼Œåˆ†åˆ«ä¸ºä¸»èŠ‚ç‚¹(primary)å’Œå¤‡ä»½èŠ‚ç‚¹(backups)ï¼Œæ‰€æœ‰çš„å‰¯æœ¬åœ¨ä¸€ä¸ªè¢«ç§°ä¸º<code>è§†å›¾</code>(View)çš„è½®æ¢è¿‡ç¨‹ä¸­è¿ä½œã€‚<em>ä¸»èŠ‚ç‚¹å’Œå¤‡ä»½èŠ‚ç‚¹æ˜¯é’ˆå¯¹è§†å›¾è€Œè¨€ï¼Œè§†å›¾æ˜¯è¿ç»­ç¼–å·çš„æ•´æ•°</em>ã€‚åœ¨æŸä¸ªè§†å›¾ä¸­ï¼Œä»å‰¯æœ¬ä¸­é€‰å‡ºä¸€ä¸ªå‰¯æœ¬ä¸ºä¸»èŠ‚ç‚¹ï¼Œé€‰æ‹©ç®—æ³•ä¸º<code>p = v mod |R|</code>ï¼Œå…¶ä¸­væ˜¯è§†å›¾ç¼–å·ï¼Œ|R|ä¸ºå‰¯æœ¬ä¸ªæ•°ï¼Œpä¸ºå‰¯æœ¬ç¼–å·ï¼Œé™¤ä¸»èŠ‚ç‚¹ä¹‹å¤–æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¸ºå¤‡ä»½èŠ‚ç‚¹ã€‚å½“<strong>ä¸»èŠ‚ç‚¹å¤±æ•ˆ</strong>çš„æ—¶å€™å°±éœ€è¦å¯åŠ¨è§†å›¾æ›´æ¢è¿‡ç¨‹ã€‚</p><p>çŸ¥é“ä¸Šè¿°æ¦‚å¿µä¹‹åï¼Œæ¥çœ‹ä¸‹ç®—æ³•çš„å…·ä½“æµç¨‹ï¼š<br><img src="/blogimgs/PBFT-Paxos-Raft/pbft.png" alt="PBFT" title="PBFT"><br>å…¶ä¸­0ä¸ºä¸»èŠ‚ç‚¹ï¼Œ123ä¸ºå¤‡ä»½èŠ‚ç‚¹ï¼Œ3å®•æœºæ— æ³•å“åº”è¯·æ±‚</p><ol><li>ä¸»èŠ‚ç‚¹0æ¥æ”¶åˆ°å®¢æˆ·ç«¯Cå‘æ¥çš„è¯·æ±‚requestï¼Œç»™è¯·æ±‚åˆ†é…ä¸€ä¸ªåºåˆ—å·nï¼Œç„¶åå‘æ‰€æœ‰<strong>å¤‡ä»½èŠ‚ç‚¹</strong>ç¾¤å‘é¢„å‡†å¤‡æ¶ˆæ¯ï¼Œé¢„å‡†å¤‡æ¶ˆæ¯çš„æ ¼å¼ä¸º&lt;&lt;PRE-PREPARE,v,n,d&gt;,m&gt;ï¼Œè¿™é‡Œvæ˜¯è§†å›¾ç¼–å·ï¼Œmæ˜¯å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚æ¶ˆæ¯ï¼Œdæ˜¯è¯·æ±‚æ¶ˆæ¯mçš„æ‘˜è¦ã€‚</li><li>å¤‡ä»½èŠ‚ç‚¹æ”¶åˆ°ä¸»èŠ‚ç‚¹å¹¿æ’­çš„æ¶ˆæ¯ä¹‹åï¼Œcheckä¸‹è‡ªå·±æ˜¯å¦æ¥å—ï¼Œæ¥å—ä¹‹åå‘<strong>å…¶å®ƒå‰¯æœ¬</strong>è¿›è¡Œprepareå¹¿æ’­</li><li>æŸä¸ªå‰¯æœ¬åœ¨æ¥æ”¶åˆ°<code>2f</code>ä¸ªprepareä¿¡æ¯ä¹‹åï¼Œå‘<strong>å…¶å®ƒå‰¯æœ¬</strong>å¹¿æ’­commit<!--(*å¤‡ä»½èŠ‚ç‚¹çš„2fä¸­æœ‰ä¸€ä¸ªæ˜¯æœªå¹¿æ’­ç»™è‡ªå·±çš„prepareä¿¡æ¯*)--></li><li>æŸä¸ªå‰¯æœ¬åœ¨æ¥æ”¶åˆ°<code>2f+1</code>ä¸ªcommitä¿¡æ¯ä¹‹åï¼Œå‘å®¢æˆ·ç«¯Cå‘é€reply<!--ä¹‹æ‰€ä»¥è¿™é‡Œæ˜¯2f+1ï¼Œæ˜¯å› ä¸ºä¸»èŠ‚ç‚¹åŠ å…¥äº†å¹¿æ’­åºåˆ—--></li><li>å®¢æˆ·ç«¯Cåœ¨æ¥æ”¶åˆ°<code>f+1</code>ä¸ªç›¸åŒçš„replyä¹‹ååˆ™è¾¾æˆå…±è¯†<!--éœ€è¦æ³¨æ„çš„æ˜¯ä¸»èŠ‚ç‚¹æ²¡æœ‰æ”¶åˆ°pre-prepareå¹¿æ’­ï¼Œæ²¡æœ‰è‡ªå·±çš„prepareä¿¡æ¯ï¼Œä½†æ˜¯å¯ä»¥æ”¶åˆ°å¤‡ä»½èŠ‚ç‚¹çš„prepareä¿¡æ¯ï¼Œæ”¶åˆ°2fä¸ªä¹‹åå°±å¯ä»¥è¿›è¡Œå¹¿æ’­commitä¿¡æ¯--></li></ol><!--åŒæ‰€æœ‰çš„çŠ¶æ€æœºå‰¯æœ¬å¤åˆ¶æŠ€æœ¯ä¸€æ ·ï¼ŒPBFTå¯¹æ¯ä¸ªå‰¯æœ¬èŠ‚ç‚¹æå‡ºäº†ä¸¤ä¸ªé™å®šæ¡ä»¶ï¼šï¼ˆ1ï¼‰æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»æ˜¯ç¡®å®šæ€§çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ç»™å®šçŠ¶æ€å’Œå‚æ•°ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ‰§è¡Œçš„ç»“æœå¿…é¡»ç›¸åŒï¼›ï¼ˆ2ï¼‰æ‰€æœ‰èŠ‚ç‚¹å¿…é¡»ä»ç›¸åŒçš„çŠ¶æ€å¼€å§‹æ‰§è¡Œã€‚åœ¨è¿™ä¸¤ä¸ªé™å®šæ¡ä»¶ä¸‹ï¼Œå³ä½¿å¤±æ•ˆçš„å‰¯æœ¬èŠ‚ç‚¹å­˜åœ¨ï¼ŒPBFTç®—æ³•å¯¹æ‰€æœ‰éå¤±æ•ˆå‰¯æœ¬èŠ‚ç‚¹çš„è¯·æ±‚æ‰§è¡Œæ€»é¡ºåºè¾¾æˆä¸€è‡´ï¼Œä»è€Œä¿è¯å®‰å…¨æ€§ã€‚--><p>æ‹œå åº­é—®é¢˜æ˜¯ä¸€ä¸ªç†è®ºæ€§çš„æ¨¡å‹ï¼Œè§£å†³èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œå·¥ç¨‹å®è·µä¸Šå¯ä»¥å°†å…¶æ¨¡å‹çš„æŸäº›æ¡ä»¶è¿›è¡Œå‡è®¾ï¼Œè¿™æ ·å¯ä»¥è§£å†³ä¸€äº›ç‰¹å®šçš„é—®é¢˜ã€‚<br>å°†é›†ç¾¤ä¸­æ˜¯å¦å­˜åœ¨èƒŒå›è€…ä½œä¸ºä¸€ä¸ªå·²çŸ¥æ¡ä»¶æ¥å°†æ‹œå åº­é—®é¢˜ç»†åˆ†ä¸‹ï¼š</p><ol><li>å‡å¦‚é›†ç¾¤ä¸­å­˜åœ¨èƒŒå›è€…ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€äº›ä¼ªé€ ä¿¡æ¯ï¼Œè¿™ç§æƒ…å†µç§°ä¸º<em>æ‹œå åº­é”™è¯¯</em>ï¼Œä¼ªé€ ä¿¡æ¯çš„èŠ‚ç‚¹ç§°ä¸ºæ‹œå åº­èŠ‚ç‚¹ã€‚å…¶ä¸€è‡´æ€§ç®—æ³•ä¸ºBFTï¼ˆByzantine Fault Toleranceï¼‰ï¼Œä¸Šæ–‡ä»‹ç»çš„PBFTå°±æ˜¯ä¸€ä¸ªæ‹œå åº­å®¹é”™ç®—æ³•ã€‚</li><li>å¦‚æœé›†ç¾¤ä¸­ä¸å­˜åœ¨èƒŒå›è€…ï¼Œéƒ½æ˜¯å¿ è¯šè€…ï¼Œåªæ˜¯è¿™äº›å¿ è¯šè€…ç”±äºæŸç§åŸå› æ— æ³•æ­£å¸¸å·¥ä½œï¼Œè¿™ç§æƒ…å†µç§°ä¸º<em>éæ‹œå åº­é”™è¯¯</em>ã€‚å…¶ä¸€è‡´æ€§ç®—æ³•ä¸ºCFTï¼ˆCrash Fault Toleranceï¼‰ã€‚</li></ol><p>ä¸‹é¢æˆ‘ä»¬å°±ä»‹ç»ä¸¤ä¸ªéæ‹œå åº­ä¸€è‡´æ€§ç®—æ³•<em>Paxos</em>å’Œ<em>Raft</em>ã€‚</p><h2 id="Paxos"><a href="#Paxos" class="headerlink" title="Paxos"></a>Paxos</h2><p>Paxosç®—æ³•ä¸ºéæ‹œå åº­ä¸€è‡´æ€§ç®—æ³•ï¼Œ<em>è¿è¡Œåœ¨å…è®¸å®•æœºæ•…éšœçš„å¼‚æ­¥ç³»ç»Ÿä¸­ï¼Œä¸è¦æ±‚å¯é çš„æ¶ˆæ¯ä¼ é€’ï¼Œå¯å®¹å¿æ¶ˆæ¯ä¸¢å¤±ã€å»¶è¿Ÿã€ä¹±åºä»¥åŠé‡å¤</em>ã€‚<strong>å®ƒåˆ©ç”¨å¤§å¤šæ•°æœºåˆ¶ä¿è¯äº†2F+1çš„å®¹é”™èƒ½åŠ›ï¼Œå³2F+1ä¸ªèŠ‚ç‚¹çš„ç³»ç»Ÿæœ€å¤šå…è®¸Fä¸ªèŠ‚ç‚¹åŒæ—¶å‡ºç°æ•…éšœ</strong>ã€‚</p><p>Paxosç®—æ³•ä¸­çš„è§’è‰²åˆ†ä¸ºProposerå’ŒAcceptorï¼ŒProposeræ˜¯ææ¡ˆè€…ï¼Œç”¨æ¥å‘èµ·ææ¡ˆï¼ˆProposalï¼‰ï¼ŒAcceptoræ˜¯å†³ç­–è€…ï¼Œç”¨æ¥æ¥æ”¶å’Œå“åº”Proposeræå‡ºçš„ææ¡ˆã€‚è¿™ä¸ªç®—æ³•çš„åœºæ™¯æ˜¯<strong>ä¸€ä¸ªæˆ–å¤šä¸ªæè®®è¿›ç¨‹ï¼ˆProposerï¼‰å¯ä»¥å‘èµ·ææ¡ˆï¼ˆProposalï¼‰ï¼Œéœ€è¦åœ¨æ‰€æœ‰ææ¡ˆä¸­é€‰å–æŸä¸€ä¸ªææ¡ˆï¼Œä½¿å…¶åœ¨æ‰€æœ‰è¿›ç¨‹ä¸­è¾¾æˆä¸€è‡´ã€‚ç³»ç»Ÿä¸­çš„å¤šæ•°æ´¾åŒæ—¶è®¤å¯è¯¥ææ¡ˆï¼Œå³è¾¾æˆäº†ä¸€è‡´ã€‚æœ€å¤šåªé’ˆå¯¹ä¸€ä¸ªç¡®å®šçš„ææ¡ˆè¾¾æˆä¸€è‡´ã€‚</strong></p><p>Paxosç®—æ³•æµç¨‹åˆ†ä¸ºä¸¤é˜¶æ®µï¼Œç¬¬ä¸€é˜¶æ®µä¸ºPrepareé˜¶æ®µï¼Œç¬¬äºŒé˜¶æ®µä¸ºCommité˜¶æ®µã€‚ä¸¤é˜¶æ®µæäº¤ç®—æ³•çš„æ€è·¯å¤§è‡´å¯ä»¥æ¦‚æ‹¬ä¸º<strong>å†³ç­–è€…å°†ææ¡ˆçš„ç»“æœé€šçŸ¥ææ¡ˆè€…ï¼Œå†ç”±ææ¡ˆè€…æ ¹æ®æ‰€æœ‰å†³ç­–è€…åé¦ˆçš„ç»“æœå†³å®šæ˜¯æäº¤æ“ä½œè¿˜æ˜¯ç»ˆæ­¢æ“ä½œ</strong>ã€‚</p><p>Paxosç®—æ³•å¤§è‡´æµç¨‹ä¸ºProposerè¯¢é—®Acceptors<strong>æ˜¯å¦å¯ä»¥å‘èµ·ææ¡ˆ</strong>ï¼ŒAcceptorså°†ç»“æœè¿”å›ç»™Proposer(ç¬¬ä¸€é˜¶æ®µ)ï¼Œå†ç”±Proposeræ ¹æ®Acceptorsåé¦ˆçš„<em>ç»“æœå†³å®šææ¡ˆå†…å®¹ä»¥åŠææ¡ˆæ˜¯æäº¤è¿˜æ˜¯ç»ˆæ­¢</em>(ç¬¬äºŒé˜¶æ®µ)ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹ï¼š<br>ç¬¬ä¸€é˜¶æ®µPrepareé˜¶æ®µï¼š</p><ol><li>Proposeræå‡ºä¸€ä¸ªææ¡ˆæ—¶ï¼Œæ¯æ¬¡ææ¡ˆæ—¶éƒ½ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€ä¸”é€’å¢çš„IDï¼Œå‘Acceptorså‘é€<em>PrepareRequest</em>è¯·æ±‚ï¼ŒPrepareRequestè¯·æ±‚<em>åªæºå¸¦ææ¡ˆID</em>ï¼Œè€Œ<em>æ— éœ€æºå¸¦ææ¡ˆå†…å®¹</em>ã€‚</li><li>Acceptorsæ”¶åˆ°Proposerçš„è¯·æ±‚åï¼Œåˆ¤æ–­<code>PrepareRequest</code>ä¸­çš„<strong>IDæ˜¯å¦å¤§äºAcceptorsè®°å½•çš„å€¼</strong>ï¼Œå¦‚æœå¤§äºåˆ™æ£€æŸ¥ä¸‹æ˜¯å¦æœ‰å·²ç»Acceptè¿‡çš„ææ¡ˆï¼Œ<em>æœ‰åˆ™è¿”å›ææ¡ˆä¸­IDæœ€å¤§çš„é‚£ä¸ªææ¡ˆçš„valueå’ŒIDï¼Œæ²¡æœ‰åˆ™è¿”å›ç©ºå€¼</em>ï¼Œå¦‚æœ<strong>å°äºAcceptorsè®°å½•çš„å€¼åˆ™ä¸å“åº”</strong>ã€‚<br>ç¬¬ä¸€é˜¶æ®µç»“æŸï¼Œå¼€å§‹ç¬¬äºŒé˜¶æ®µCommité˜¶æ®µï¼š</li><li>Proposeræ¥æ”¶åˆ°å¤šæ•°Acceptorsçš„<code>PrepareResponse</code>åº”ç­”ä¹‹åï¼Œ<strong>ä»åº”ç­”ä¸­é€‰æ‹©ææ¡ˆIDæœ€å¤§å¯¹åº”çš„valueä½œä¸ºæœ¬æ¬¡è¦å‘èµ·çš„ææ¡ˆ</strong>ã€‚ <em>å¦‚æœæ‰€æœ‰åº”ç­”çš„ææ¡ˆvalueå‡ä¸ºç©ºå€¼ï¼Œåˆ™å¯ä»¥è‡ªå·±éšæ„å†³å®šææ¡ˆvalue</em>ã€‚ç„¶åæºå¸¦å½“å‰IDï¼Œå‘æ‰€æœ‰Acceptorså‘é€<code>AccpetRequest</code>è¯·æ±‚ã€‚</li><li>Accpetorsæ”¶åˆ°<code>AccpetRequest</code>åï¼Œåˆ¤æ–­<code>AccpetRequest</code>ä¸­çš„<strong>IDæ˜¯å¦å¤§äºç­‰äºAcceptorsè®°å½•çš„å€¼</strong>ï¼Œæ˜¯åˆ™æŒä¹…åŒ–å½“å‰IDå’Œææ¡ˆå†…å®¹ï¼Œç„¶åè¿”å›ç»™Proposerå“åº”<code>AcceptResponse</code></li><li>Proposeræ”¶åˆ°å¤šæ•°Acceptorsçš„<code>AcceptResponse</code>åï¼Œå†³è®®å½¢æˆã€‚</li></ol><blockquote><p>æ•´ä¸ªæµç¨‹ä¸­Acceptorsçš„è¡Œä¸ºå¯ä»¥æ¦‚æ‹¬ä¸º<strong>ä¸¤ä¸ªæ‰¿è¯ºï¼Œä¸€ä¸ªåº”ç­”</strong>ã€‚<br>ä¸¤ä¸ªæ‰¿è¯ºï¼š</p></blockquote><ol><li>ä¸å†åº”ç­”PrepareRequestä¸­IDå°äºç­‰äºå½“å‰è¯·æ±‚PrepareRequestä¸­IDçš„è¯·æ±‚(æ˜¯å› ä¸ºå½“å‰PrepareRequestä¸­IDå·²ç»èµ‹å€¼ç»™minProposal)</li><li>ä¸å†åº”ç­”AcceptRequestä¸­IDå°äºå½“å‰è¯·æ±‚AcceptRequestä¸­IDçš„è¯·æ±‚(å› ä¸ºå½“å‰AcceptRequestä¸­IDæ˜¯ä¸Šæ¬¡PrepareRequestè¯·æ±‚ä¸­IDï¼Œæ‰€ä»¥ä¸å†åº”ç­”å°äºçš„ID)<br>ä¸€ä¸ªåº”ç­”ï¼š<br>ä¸è¿èƒŒä¹‹å‰ä½œå‡ºçš„æ‰¿è¯ºä¸‹ï¼Œè¿”å›è‡ªå·±å·²ç»Acceptè¿‡çš„ææ¡ˆä¸­IDæœ€å¤§çš„é‚£ä¸ªææ¡ˆçš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›ç©ºå€¼</li></ol><p>ç»“åˆä¸‹é¢çš„ä¼ªä»£ç èƒ½å¤Ÿæ›´åŠ æ·±åˆ»ç†è§£è¿™ä¸¤ä¸ªæ‰¿è¯ºä¸€ä¸ªåº”ç­”çš„å«ä¹‰<br><img src="/blogimgs/PBFT-Paxos-Raft/basic-paxos.jpg" alt="basic paxos" title="basic paxos"><br>ç®—æ³•é€»è¾‘ä¸ºï¼š</p><ol><li>è·å–ä¸€ä¸ªProposalID nï¼Œä¸ºäº†ä¿è¯ProposalIDå”¯ä¸€ï¼Œå¯é‡‡ç”¨æ—¶é—´æˆ³+ServerIDç”Ÿæˆï¼›</li><li>Proposerå‘æ‰€æœ‰Acceptorså¹¿æ’­Prepare(n)è¯·æ±‚ï¼›</li><li>Acceptoræ¯”è¾ƒnå’Œ<code>minProposal</code>ï¼Œå¦‚æœ<code>n&gt;minProposal</code>ï¼Œåˆ™<code>minProposal=n</code>ï¼Œå¹¶ä¸”å°†<code>acceptedProposal</code>å’Œ<code>acceptedValue</code>è¿”å›ï¼›</li><li>Proposeræ¥æ”¶åˆ°è¿‡åŠæ•°å›å¤åï¼Œå¦‚æœå‘ç°æœ‰<code>acceptedValue</code>è¿”å›ï¼Œå°†æ‰€æœ‰å›å¤ä¸­<em>acceptedProposalæœ€å¤§çš„acceptedValueä½œä¸ºæœ¬æ¬¡ææ¡ˆçš„value</em>ï¼Œå¦åˆ™å¯ä»¥ä»»æ„å†³å®šæœ¬æ¬¡ææ¡ˆçš„valueï¼›</li><li>åˆ°è¿™é‡Œå¯ä»¥è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼Œå¹¿æ’­<code>Accept(n,value)</code> åˆ°æ‰€æœ‰èŠ‚ç‚¹ï¼›</li><li>Acceptoræ¯”è¾ƒnå’ŒminProposalï¼Œå¦‚æœ<code>n&gt;=minProposal</code>ï¼Œåˆ™<em>acceptedProposal=minProposal=nï¼ŒacceptedValue=valueï¼Œæœ¬åœ°æŒä¹…åŒ–å</em>ï¼Œè¿”å›ï¼›<em>å¦åˆ™ï¼Œè¿”å›minProposal</em>ã€‚</li><li>æè®®è€…æ¥æ”¶åˆ°è¿‡åŠæ•°è¯·æ±‚åï¼Œ<strong>å¦‚æœå‘ç°æœ‰è¿”å›å€¼result&gt;n</strong>ï¼Œè¡¨ç¤ºæœ‰æ›´æ–°çš„æè®®ï¼Œè·³è½¬åˆ°1ï¼›å¦åˆ™valueè¾¾æˆä¸€è‡´ã€‚</li></ol><!--ç¬¬ä¸€é˜¶æ®µï¼šè·å–epochè½®æ¬¡çš„è®¿é—®æƒå’Œå½“å‰varçš„å–å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•è·å–å½“å‰æ—¶é—´æˆ³ä¸ºepochï¼šé€šè¿‡Acceptor.prepare(epoch)ï¼Œè·å–epochè½®æ¬¡çš„è®¿é—®æƒå’Œå½“å‰varçš„å–å€¼ï¼›å¦‚æœä¸èƒ½è·å–ï¼Œè¿”å›<error>ã€‚ç¬¬äºŒé˜¶æ®µï¼šé‡‡ç”¨â€œåè€…è®¤åŒå‰è€…â€çš„åŸåˆ™æ‰§è¡Œã€‚å¦‚æœvarå–å€¼ä¸ºnullï¼Œåˆ™è‚¯å®šæ—§epochæ— æ³•ç”Ÿæˆç¡®å®šæ€§å–å€¼ï¼Œåˆ™é€šè¿‡Acceptor.accept(var, prepared_epoch, V)æäº¤æ•°æ®Vã€‚æˆåŠŸåè¿”å›<ok, V>ï¼›è‹¥acceptå¤±è´¥ï¼Œåˆ™è¯´æ˜è¢«æ›´æ–°çš„epochæŠ¢å æˆ–Acceptoræ•…éšœï¼Œè¿”å›<error>ã€‚å¦‚æœvarå–å€¼å­˜åœ¨ï¼Œåˆ™æ­¤å–å€¼è‚¯å®šæ˜¯ç¡®å®šæ€§å–å€¼ï¼Œæ­¤æ—¶è®¤åŒå®ƒä¸å†æ›´æ”¹ï¼Œç›´æ¥è¿”å›<ok, accepted_value>ã€‚--><!--ææ¡ˆç¼–å·æ€ä¹ˆå–å€¼ï¼Œé˜²æ­¢æ¶æ„å–å€¼JNæ˜¯å¦‚ä½•å†™ï¼Œå¦‚ä½•åŒæ­¥æ•°æ®çš„â€œæ´»é”â€çš„æ ¹æœ¬åŸå› åœ¨äºä¸¤ä¸ªproposeräº¤æ›¿ææ¡ˆï¼Œé¿å…â€œæ´»é”â€çš„æ–¹å¼ä¸ºï¼Œå¦‚æœä¸€ä¸ªproposeré€šè¿‡accpterè¿”å›çš„æ¶ˆæ¯çŸ¥é“æ­¤æ—¶æœ‰æ›´é«˜ç¼–å·çš„ææ¡ˆè¢«æå‡ºæ—¶ï¼Œè¯¥proposeré™é»˜ä¸€æ®µæ—¶é—´ï¼Œè€Œä¸æ˜¯é©¬ä¸Šæå‡ºæ›´é«˜çš„æ–¹æ¡ˆï¼Œé™é»˜æœŸé•¿çŸ­ä¸ºä¸€ä¸ªææ¡ˆä»æå‡ºåˆ°è¢«æ¥å—çš„å¤§æ¦‚æ—¶é—´é•¿åº¦å³å¯ï¼Œé™é»˜æœŸè¿‡åï¼Œproposeré‡æ–°ææ¡ˆã€‚ç³»ç»Ÿä¸­ä¹‹æ‰€ä»¥è¦æœ‰ä¸»proposerçš„åŸå› åœ¨äºï¼Œå¦‚æœæ¯æ¬¡æ•°æ®æ›´æ”¹éƒ½ç”¨paxosï¼Œé‚£å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œè¿˜æ˜¯é€šè¿‡ä¸»èŠ‚ç‚¹ä¸‹å‘è¯·æ±‚è¿™æ ·æ¥çš„å¿«ï¼Œå› ä¸ºçœå»äº†ä¸å¿…è¦çš„paxosæ—¶é—´ã€‚æ‰€ä»¥é€‰æ‹©ä¸»proposerç”¨paxosç®—æ³•ï¼Œå› ä¸ºé€‰ä¸»çš„é¢‘ç‡è¦æ¯”æ›´æ”¹æ•°æ®é¢‘ç‡ä½å¤ªå¤šã€‚ä½†æ˜¯ä¸»proposeræŒ‚äº†å’‹æ•´ï¼Œæ•´ä¸ªé›†ç¾¤å°±ä¸€ç›´å¤„äºä¸å¯ç”¨çŠ¶æ€ï¼Œæ‰€ä»¥ä¸€èˆ¬éƒ½ç”¨ç§Ÿçº¦çš„æ–¹å¼ï¼Œå¦‚æœproposeræŒ‚äº†ï¼Œåˆ™ç§Ÿçº¦ä¼šè¿‡æœŸï¼Œå…¶å®ƒproposerå°±å¯ä»¥å†é‡æ–°é€‰ä¸»ï¼Œå¦‚æœä¸æŒ‚ï¼Œåˆ™ä¸»proposerè‡ªå·±ç»­ç§Ÿã€‚--><p>åŸå§‹çš„Paxosç®—æ³•(Basic Paxos)<em>åªèƒ½å¯¹ä¸€ä¸ªå€¼å½¢æˆå†³è®®</em>ï¼Œå†³è®®çš„å½¢æˆè‡³å°‘éœ€è¦ä¸¤æ¬¡ç½‘ç»œæ¥å›ï¼Œ*åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹å¯èƒ½éœ€è¦æ›´å¤šçš„ç½‘ç»œæ¥å›ï¼Œæç«¯æƒ…å†µä¸‹ç”šè‡³å¯èƒ½å½¢æˆæ´»é”(æ´»é”â€“å¤šä¸ªProposeräº¤æ›¿å‘Acceptorsæäº¤PrepareRequestè¯·æ±‚ï¼Œåœ¨å‘é€AccpetRequestè¯·æ±‚æ—¶ï¼Œéƒ½å› ä¸ºIDå‘ç”Ÿæ›´æ–°ï¼ŒAcceptorsæ— æ³•æ¥å—AccpetRequestè¯·æ±‚ï¼Œè¿”å›IDï¼Œæ˜¯Proposerå†æ¬¡å‘Acceptorså‘é€PrepareRequestè¯·æ±‚ï¼Œå¦‚æ­¤åå¤ï¼Œæ— æ³•å½¢æˆå…±è¯†ã€‚)*ã€‚æ›´é‡è¦çš„æ˜¯å¦‚æœæƒ³è¿ç»­ç¡®å®šå¤šä¸ªå€¼<!--è¿™é‡Œä¸æ˜¯å¤ªæ‡‚ï¼Œæ ‡è®°ä¸‹ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ-->ï¼ŒBasic Paxosæ— æ³•ç¡®å®šäº†ã€‚å› æ­¤Basic Paxoså‡ ä¹åªæ˜¯ç”¨æ¥åšç†è®ºç ”ç©¶ï¼Œå¹¶ä¸ç›´æ¥åº”ç”¨åœ¨å®é™…å·¥ç¨‹ä¸­ã€‚</p><p>å®é™…åº”ç”¨ä¸­å‡ ä¹éƒ½éœ€è¦è¿ç»­ç¡®å®šå¤šä¸ªå€¼ï¼Œè€Œä¸”å¸Œæœ›èƒ½æœ‰æ›´é«˜çš„æ•ˆç‡ã€‚<code>Multi-Paxos</code>æ­£æ˜¯ä¸ºè§£å†³æ­¤é—®é¢˜è€Œæå‡ºã€‚Multi-PaxosåŸºäºBasic Paxosåšäº†ä¸¤ç‚¹æ”¹è¿›ï¼š</p><ol><li>é’ˆå¯¹æ¯ä¸€ä¸ªè¦ç¡®å®šçš„å€¼ï¼Œè¿è¡Œä¸€æ¬¡Paxosç®—æ³•å®ä¾‹ï¼ˆInstanceï¼‰ï¼Œå½¢æˆå†³è®®ã€‚æ¯ä¸€ä¸ªPaxoså®ä¾‹ä½¿ç”¨å”¯ä¸€çš„Instance IDæ ‡è¯†ã€‚</li><li>åœ¨æ‰€æœ‰Proposersä¸­é€‰ä¸¾ä¸€ä¸ªLeaderï¼Œç”±Leaderå”¯ä¸€çš„æäº¤ææ¡ˆç»™Acceptorsè¿›è¡Œè¡¨å†³ã€‚<em>ä»…æœ‰ä¸€ä¸ªLeaderè¿›è¡Œvalueæäº¤çš„æƒ…å†µä¸‹ï¼ŒPrepareé˜¶æ®µå°±å¯ä»¥è·³è¿‡ï¼Œä»è€Œå°†ä¸¤é˜¶æ®µå˜ä¸ºä¸€é˜¶æ®µï¼Œæé«˜æ•ˆç‡ã€‚</em>åŒæ—¶è¿™æ ·æ²¡æœ‰Proposerç«äº‰ï¼Œ<em>ä¹Ÿè§£å†³äº†æ´»é”é—®é¢˜</em>ã€‚</li></ol><!--Multi-Paxosé¦–å…ˆéœ€è¦é€‰ä¸¾Leaderï¼ŒLeaderçš„ç¡®å®šä¹Ÿæ˜¯ä¸€æ¬¡å†³è®®çš„å½¢æˆï¼Œæ‰€ä»¥å¯æ‰§è¡Œä¸€æ¬¡Basic Paxoså®ä¾‹æ¥é€‰ä¸¾å‡ºä¸€ä¸ªLeaderã€‚é€‰å‡ºLeaderä¹‹ååªèƒ½ç”±Leaderæäº¤Proposalï¼Œåœ¨Leaderå®•æœºä¹‹åæœåŠ¡ä¸´æ—¶ä¸å¯ç”¨ï¼Œéœ€è¦é‡æ–°é€‰ä¸¾Leaderç»§ç»­æœåŠ¡ã€‚åœ¨ç³»ç»Ÿä¸­ä»…æœ‰ä¸€ä¸ªLeaderè¿›è¡ŒProposalæäº¤çš„æƒ…å†µä¸‹ï¼ŒPrepareé˜¶æ®µå¯ä»¥è·³è¿‡ã€‚Multi-Paxosé€šè¿‡æ”¹å˜Prepareé˜¶æ®µçš„ä½œç”¨èŒƒå›´è‡³åé¢Leaderæäº¤çš„æ‰€æœ‰å®ä¾‹ï¼Œä»è€Œä½¿å¾—Leaderçš„è¿ç»­æäº¤åªéœ€è¦æ‰§è¡Œä¸€æ¬¡Prepareé˜¶æ®µï¼Œåç»­åªéœ€è¦æ‰§è¡ŒAccepté˜¶æ®µï¼Œå°†ä¸¤é˜¶æ®µå˜ä¸ºä¸€é˜¶æ®µï¼Œæé«˜äº†æ•ˆç‡ã€‚ä¸ºäº†åŒºåˆ†è¿ç»­æäº¤çš„å¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä½¿ç”¨ä¸€ä¸ªInstance IDæ ‡è¯†ï¼ŒInstance IDç”±Leaderæœ¬åœ°é€’å¢ç”Ÿæˆå³å¯ã€‚Multi-Paxoså…è®¸æœ‰å¤šä¸ªè‡ªè®¤ä¸ºæ˜¯Leaderçš„èŠ‚ç‚¹å¹¶å‘æäº¤Proposalè€Œä¸å½±å“å…¶å®‰å…¨æ€§ï¼Œè¿™æ ·çš„åœºæ™¯å³é€€åŒ–ä¸ºBasic Paxosã€‚--><p>Paxosç¡®å®å¾ˆå¼ºå¤§ï¼Œè€Œä¸”ä¹Ÿå¯ä»¥åº”ç”¨äºå®é™…å·¥ç¨‹ä¸­ï¼Œä½†æ˜¯å…¶ç†è®ºçœŸçš„å¾ˆéš¾ç†è§£ï¼Œäºæ˜¯<em>Raftç®—æ³•</em>å‡ºç°äº†ï¼Œä»¥ç®€å•è‘—ç§°ï¼Œå¹¶åœ¨å·¥ä¸šä¸Šä¹Ÿå¾—åˆ°äº†å¹¿æ³›çš„ä½¿ç”¨ã€‚</p><h2 id="Raft"><a href="#Raft" class="headerlink" title="Raft"></a>Raft</h2><p>Raftä¹Ÿæ˜¯ä¸¤é˜¶æ®µæäº¤ç®—æ³•ï¼Œç±»ä¼¼äºMulti-Paxosã€‚ç®—æ³•ä¸­çš„è§’è‰²åˆ†ä¸ºLeaderã€Followerå’ŒCandidateï¼Œä½†æ˜¯<em>è¿™ä¸‰ç§è§’è‰²å¹¶ä¸æ˜¯åŒæ—¶å‡ºç°çš„ï¼Œæ­£å¸¸è¿è¡Œæ—¶åªæœ‰Leaderå’ŒFollower</em>ï¼Œcandidateåªä½œä¸ºé€‰ä¸¾leaderæ—¶çš„ä¸€ä¸ªä¸´æ—¶è§’è‰²å‡ºç°ã€‚</p><ul><li>Leader: æ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å‘FolloweråŒæ­¥è¯·æ±‚æ—¥å¿—ï¼Œå½“æ—¥å¿—åŒæ­¥åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šåå‘Šè¯‰Followeræäº¤æ—¥å¿—ã€‚</li><li>Follower: æ¥å—å¹¶æŒä¹…åŒ–LeaderåŒæ­¥çš„æ—¥å¿—ï¼Œåœ¨Leaderå‘Šä¹‹æ—¥å¿—å¯ä»¥æäº¤ä¹‹åï¼Œæäº¤æ—¥å¿—ã€‚</li><li>Candidate: Leaderé€‰ä¸¾è¿‡ç¨‹ä¸­çš„ä¸´æ—¶è§’è‰²ã€‚</li></ul><blockquote><p>ç³»ç»Ÿåœ¨åˆå§‹åŒ–æ—¶ï¼ŒåŒä¸ºFollowerï¼Œåœ¨election timeoutä¹‹å(å„èŠ‚ç‚¹åœ¨150-300msä¹‹é—´éšæœº)ï¼Œç”±Followerè½¬åŒ–ä¸ºCandidateè¿›è¡Œé€‰ä¸¾Leader</p></blockquote><!-- heartbeat timeout ä¹‹åFolloweræ„ŸçŸ¥åˆ°Leaderæ¶ˆå¤±ï¼Œè¿›è¡Œæ–°Leaderé€‰ä¸¾--><p>Raftç®—æ³•ä¸»è¦ç”¨äºç®¡ç†å¤šå‰¯æœ¬çŠ¶æ€æœºçš„æ—¥å¿—å¤åˆ¶ï¼Œå¹¶ä¸”å…¶<em>å°†ä¸€è‡´æ€§åˆ†è§£ä¸ºå¤šä¸ªå­é—®é¢˜</em>ï¼šLeaderé€‰ä¸¾(Leader election)ã€æ—¥å¿—åŒæ­¥(Log replication)ã€å®‰å…¨æ€§(Safety)ã€æ—¥å¿—å‹ç¼©(Log compaction)ã€æˆå‘˜å˜æ›´(Membership change)ç­‰ã€‚åŒæ—¶ï¼Œ<em>Raftç®—æ³•ä½¿ç”¨äº†æ›´å¼ºçš„å‡è®¾æ¥å‡å°‘äº†éœ€è¦è€ƒè™‘çš„çŠ¶æ€ï¼Œä½¿ä¹‹å˜çš„æ˜“äºç†è§£å’Œå®ç°</em>ã€‚Raftç®—æ³•æ”¯æŒæœ€å¤§çš„å®¹é”™æ•…éšœèŠ‚ç‚¹æ˜¯Fï¼Œé›†ç¾¤æ€»æ•°ä¸º2F+1ã€‚</p><p>ä¸ªäººæ„Ÿè§‰Raftç®—æ³•å­¦ä¹ çš„æœ€å¥½æ•™ç¨‹æ˜¯<a href="http://thesecretlivesofdata.com/raft/#home">http://thesecretlivesofdata.com/raft/#home</a>ï¼Œä¿—è¯è¯´ä¸€å›¾èƒœåƒè¨€ï¼Œæ›´ä½•å†µæ˜¯è¿˜æ˜¯ä¸ªåŠ¨å›¾ï¼Œè€ç‰›é€¼äº†ï¼Œä¿ç®¡ä½ çœ‹ä¸€éå°±æ‡‚äº†ã€‚ã€‚ã€‚è¿™é‡Œå°±ä¸å†è¿›è¡Œè¿‡å¤šçš„ä»‹ç»äº†ã€‚</p><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://zhuanlan.zhihu.com/p/31780743">https://zhuanlan.zhihu.com/p/31780743</a><br><a href="https://my.oschina.net/ittrueman/blog/1612492">https://my.oschina.net/ittrueman/blog/1612492</a><br><a href="http://thesecretlivesofdata.com/raft/#home">http://thesecretlivesofdata.com/raft/#home</a><br><a href="https://zhuanlan.zhihu.com/p/32052223">https://zhuanlan.zhihu.com/p/32052223</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ä¸ªè‘—åçš„åŸåˆ™CAPåŸåˆ™ï¼ŒCä¸ºConsistency(ä¸€è‡´æ€§)ã€Aä¸ºAvailability(å¯ç”¨æ€§)ã€Pä¸ºPartition tolerance(åˆ†åŒºå®¹é”™æ€§)ã€‚è¿™é‡Œä¸»è¦ä»‹ç»ä¸‹åˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¦‚æœè¾¾åˆ°ä¸€è‡´æ€§ã€‚&lt;/p&gt;
&lt;p&gt;è¯´åˆ°ä¸€è‡´æ€§ä¸å¾—ä¸è¯´ä¸‹ç»å…¸çš„æ‹œå åº­é—®é¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="BlockChain" scheme="http://yuanba.tech/categories/BlockChain/"/>
    
    
    <category term="BlockChain" scheme="http://yuanba.tech/tags/BlockChain/"/>
    
    <category term="Kafka" scheme="http://yuanba.tech/tags/Kafka/"/>
    
    <category term="Zookeeper" scheme="http://yuanba.tech/tags/Zookeeper/"/>
    
    <category term="Paxos" scheme="http://yuanba.tech/tags/Paxos/"/>
    
    <category term="Raft" scheme="http://yuanba.tech/tags/Raft/"/>
    
    <category term="BFT" scheme="http://yuanba.tech/tags/BFT/"/>
    
  </entry>
  
  <entry>
    <title>cryptozombiesæºç è§£æäºŒ</title>
    <link href="http://yuanba.tech/cryptozombies-src-parse-2.html"/>
    <id>http://yuanba.tech/cryptozombies-src-parse-2.html</id>
    <published>2019-03-04T14:30:04.000Z</published>
    <updated>2019-03-05T16:30:34.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="http://bigdatadecode.top/cryptozombies-src-parse.html">cryptozombiesæºç è§£æä¸€</a>ä¸­å¯¹ä»¥å¤ªåŠå¼€å‘ä¸­çš„<em>äº‹ä»¶</em>ä¸<em>åˆçº¦äº¤äº’</em>è¿›è¡Œäº†ä»‹ç»ï¼Œçœ‹è¿‡è¿™ç¯‡æ–‡ç« çš„åŒå­¦æˆ‘ç›¸ä¿¡å¯¹Dappå¼€å‘ä¹Ÿæœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸€äº›æ™ºèƒ½åˆçº¦å¼€å‘ä¸­ç‰¹æ€§ã€‚</p><span id="more"></span><h2 id="å¦‚ä½•å‡å°‘gas"><a href="#å¦‚ä½•å‡å°‘gas" class="headerlink" title="å¦‚ä½•å‡å°‘gas"></a>å¦‚ä½•å‡å°‘gas</h2><p>gasæ˜¯EVMä¸­ä»£ç æ‰§è¡Œæ‰€æ¶ˆè€—èµ„æºçš„è®¡é‡å•ä½ï¼Œgasæ˜¯éœ€è¦ç”¨ä»¥å¤ªå¸è´­ä¹°çš„ï¼Œç°åœ¨ä½ æ˜¯ä¸æ˜¯å·²ç»getåˆ°äº†ä¸ºä»€ä¹ˆè¦å‡å°‘gasäº†ï¼Œå˜¿å˜¿ã€‚ã€‚ã€‚</p><h3 id="ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„"><a href="#ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„" class="headerlink" title="ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„"></a>ä½¿ç”¨åˆé€‚çš„æ•°æ®ç»“æ„</h3><p>è¿™é‡Œä»¥uintä¸ºä¾‹ï¼Œåœ¨Solidityä¸­é™¤äº†æœ‰åŸºæœ¬ç‰ˆçš„uintå¤–ï¼Œè¿˜æœ‰å…¶ä»–å˜ç§uintï¼šuint8ï¼Œuint16ï¼Œuint32ç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šè€ƒè™‘ä½¿ç”¨uintå˜ç§ï¼Œ<em>å› ä¸ºæ— è®ºå¦‚ä½•å®šä¹‰ uintçš„å¤§å°ï¼ŒSolidityä¸ºå®ƒä¿ç•™256ä½çš„å­˜å‚¨ç©ºé—´</em>ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨uint8è€Œä¸ä½¿ç”¨uint(uint256)ï¼Œå¹¶ä¸ä¼šä¸ºä½ èŠ‚çœä»»ä½•gasï¼Œå› ä¸ºSolidityå§‹ç»ˆä¿ç•™äº†256çš„ç©ºé—´ã€‚</p><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦æœ‰å…¶ä»–uintçš„å˜ç§å‘¢ï¼Ÿ<strong>æ˜¯å› ä¸ºåœ¨structé‡Œï¼Œå¯ä»¥é€šè¿‡å£°æ˜å…·ä½“çš„uintå˜ç§æ¥èŠ‚çœå­˜å‚¨ç©ºé—´</strong>ã€‚<br>åœ¨structé‡Œï¼Œç›¸åŒç±»å‹çš„uintè¦ç´§é‚»ï¼Œä¾‹å¦‚uint8çš„å˜é‡è¦æ”¾åœ¨ä¸€èµ·ï¼Œuint16çš„è¦æ”¾åœ¨ä¸€èµ·ï¼Œè¿™æ ·å¯ä»¥å°†è¿™äº›uintæ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»è€Œå ç”¨è¾ƒå°‘çš„å­˜å‚¨ç©ºé—´ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct Zombie &#123;</span><br><span class="line">  string name;</span><br><span class="line">  uint dna;</span><br><span class="line">  uint32 level;</span><br><span class="line">  uint32 readyTime;</span><br><span class="line">  uint16 winCount;</span><br><span class="line">  uint16 lossCount;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„viewå’Œpureçš„ä½¿ç”¨åœºæ™¯"><a href="#æ³¨æ„viewå’Œpureçš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="æ³¨æ„viewå’Œpureçš„ä½¿ç”¨åœºæ™¯"></a>æ³¨æ„viewå’Œpureçš„ä½¿ç”¨åœºæ™¯</h3><p>ä¹‹æ‰€ä»¥è¦æ³¨æ„viewå’Œpureçš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯<strong>å› ä¸ºä»åˆçº¦å¤–éƒ¨è°ƒç”¨è¿™ä¸¤ä¸ªä¿®é¥°ç¬¦ä¿®é¥°çš„å‡½æ•°çš„æ—¶å€™ä¸èŠ±è´¹ä»»ä½•gas</strong>ï¼Œæ³¨æ„è¿™é‡Œè¯´çš„æ˜¯åœ¨åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼Œ<strong>å®ƒä»¬åœ¨è¢«å†…éƒ¨å…¶ä»–å‡½æ•°è°ƒç”¨çš„æ—¶å€™å°†ä¼šè€—è´¹gas</strong><!--ï¼Œå› ä¸ºä¸€ä¸ªviewå‡½æ•°åœ¨å¦ä¸€ä¸ªå‡½æ•°çš„å†…éƒ¨è¢«è°ƒç”¨ï¼Œè€Œè°ƒç”¨å‡½æ•°ä¸viewå‡½æ•°çš„ä¸å±äºåŒä¸€ä¸ªåˆçº¦ï¼Œä¹Ÿä¼šäº§ç”Ÿè°ƒç”¨æˆæœ¬ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœä¸»è°ƒå‡½æ•°åœ¨ä»¥å¤ªåŠåˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒä»ç„¶éœ€è¦é€ä¸ªèŠ‚ç‚¹å»éªŒè¯ã€‚æ‰€ä»¥æ ‡è®°ä¸ºviewçš„å‡½æ•°åªæœ‰åœ¨å¤–éƒ¨è°ƒç”¨æ—¶æ‰æ˜¯å…è´¹çš„-->ã€‚</p><p>ä¸‹é¢è§£é‡Šä¸‹ä¸ºä»€ä¹ˆviewå’Œpureä»åˆçº¦å¤–éƒ¨è°ƒç”¨ä¸éœ€è¦èŠ±è´¹gasã€‚<br>æ˜¯å› ä¸º<em>viewä¿®é¥°ç¬¦çš„æ„æ€æ˜¯ä¸ä¼šæ”¹å˜åŒºå—é“¾ä¸Šçš„ä»»ä½•æ•°æ®ï¼Œåªæ˜¯ä»åŒºå—é“¾ä¸Šè¯»å–æ•°æ®</em>ã€‚æ ‡è®°ä¸ºviewçš„å‡½æ•°ï¼Œæ„å‘³ç€å‘Šè¯‰web3.jsï¼Œè¿è¡Œè¿™ä¸ªå‡½æ•°åªéœ€è¦æŸ¥è¯¢ä½ çš„æœ¬åœ°ä»¥å¤ªåŠèŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡(äº‹åŠ¡éœ€è¦è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå› æ­¤èŠ±è´¹gas)ã€‚<br>æ‰€ä»¥åœ¨æ‰€æœ‰èƒ½åªè¯»çš„å‡½æ•°ä¸Šæ ‡è®°ä¸Šè¡¨ç¤º<code>åªè¯»</code>çš„<code>external view</code>å£°æ˜ï¼Œå°±èƒ½ä¸ºä½ çš„ç©å®¶å‡å°‘åœ¨DAppä¸­gasç”¨é‡ã€‚</p><p>pureä¸viewç±»ä¼¼ï¼Œ<em>pureä¿®é¥°ç¬¦çš„æ„æ€æ˜¯ä¸ä½†ä¸ä¼šå¾€åŒºå—é“¾å†™æ•°æ®ï¼Œå®ƒç”šè‡³ä¸ä»åŒºå—é“¾è¯»å–æ•°æ®</em>ï¼Œæ‰€ä»¥pureä¹Ÿä¸ä¼šæ¶ˆè€—gasã€‚</p><h3 id="å°½å¯èƒ½çš„è§„é¿æ˜‚è´µçš„æ“ä½œ"><a href="#å°½å¯èƒ½çš„è§„é¿æ˜‚è´µçš„æ“ä½œ" class="headerlink" title="å°½å¯èƒ½çš„è§„é¿æ˜‚è´µçš„æ“ä½œ"></a>å°½å¯èƒ½çš„è§„é¿æ˜‚è´µçš„æ“ä½œ</h3><p><strong>Solidityä¸­ä½¿ç”¨storage(å­˜å‚¨)æ˜¯ç›¸å½“æ˜‚è´µçš„ï¼Œâ€å†™å…¥â€æ“ä½œå°¤å…¶è´µ</strong>ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ— è®ºæ˜¯å†™å…¥è¿˜æ˜¯æ›´æ”¹ä¸€æ®µæ•°æ®ï¼Œè¿™éƒ½å°†æ°¸ä¹…æ€§åœ°å†™å…¥åŒºå—é“¾ã€‚â€æ°¸ä¹…æ€§â€å•Šï¼éœ€è¦åœ¨å…¨çƒæ•°åƒä¸ªèŠ‚ç‚¹çš„ç¡¬ç›˜ä¸Šå­˜å…¥è¿™äº›æ•°æ®ï¼Œéšç€åŒºå—é“¾çš„å¢é•¿ï¼Œæ‹·è´ä»½æ•°æ›´å¤šï¼Œå­˜å‚¨é‡ä¹Ÿå°±è¶Šå¤§ã€‚è¿™æ˜¯éœ€è¦æˆæœ¬çš„ï¼</p><p>æ‰€ä»¥åœ¨å¼€å‘ä¸­ï¼Œä¸ºäº†é™ä½æˆæœ¬ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œé¿å…å°†æ•°æ®å†™å…¥å­˜å‚¨ã€‚è™½ç„¶è¿™æ ·åšä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹ï¼Œä½†æ˜¯åœ¨æœ‰äº›åœºæ™¯ä¸‹è¿˜æ˜¯å¯å–çš„ã€‚</p><p>ä»£ç ä¸­æœ‰ä¸€ä¸ª<code>getZombiesByOwner</code>çš„å‡½æ•°ï¼ŒåŠŸèƒ½æ˜¯å¾—åˆ°æŸä¸ªç”¨æˆ·çš„åƒµå°¸å†›å›¢ï¼Œå¸¸è§„é€»è¾‘æ˜¯åœ¨<code>ZombieFactory</code>ä¸­å­˜å…¥<em>owner</em>ä¸<em>zombies</em>çš„æ˜ å°„<code>mapping (address =&gt; uint[]) public ownerToZombies</code>ï¼Œç„¶åæˆ‘ä»¬æ¯æ¬¡åˆ›å»ºæ–°åƒµå°¸æ—¶ï¼Œæ‰§è¡Œ<code>ownerToZombies[owner].push(zombieId)</code>å°†å…¶æ·»åŠ åˆ°ä¸»äººçš„åƒµå°¸æ•°ç»„ä¸­ã€‚è€Œ <code>getZombiesByOwner</code>å‡½æ•°ä¹Ÿéå¸¸ç®€å•ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getZombiesByOwner</span>(<span class="params">address _owner</span>) <span class="title">external</span> <span class="title">view</span> <span class="title">returns</span> (<span class="params">uint[]</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> ownerToZombies[_owner];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥æŠŠä¸€å¤´åƒµå°¸è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸»äººåä¸‹ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ<br>è¿™ä¸ªâ€æ¢ä¸»â€å‡½æ•°è¦åšåˆ°ï¼š</p><ol><li>å°†åƒµå°¸pushåˆ°æ–°ä¸»äººçš„<code>ownerToZombies</code>æ˜ å°„ä¸­çš„æ•°ç»„ï¼Œ </li><li>ä»æ—§ä¸»çš„<code>ownerToZombies</code>æ•°ç»„ä¸­ç§»é™¤åƒµå°¸ï¼Œ </li><li>å°†æ—§ä¸»åƒµå°¸æ•°ç»„ä¸­â€æ¢ä¸»åƒµå°¸â€ä¹‹åçš„çš„æ¯å¤´åƒµå°¸éƒ½å¾€å‰æŒªä¸€ä½ï¼ŒæŠŠæŒªèµ°â€æ¢ä¸»åƒµå°¸â€åç•™ä¸‹çš„â€ç©ºæ§½â€å¡«ä¸Šï¼Œ </li><li>å°†æ•°ç»„é•¿åº¦å‡1ã€‚<br>ä½†æ˜¯<em>ç¬¬ä¸‰æ­¥å®åœ¨æ˜¯å¤ªè´µäº†</em>ï¼<em>å› ä¸ºæ¯æŒªåŠ¨ä¸€å¤´åƒµå°¸ï¼Œæˆ‘ä»¬éƒ½è¦æ‰§è¡Œä¸€æ¬¡å†™æ“ä½œ</em>ã€‚å¦‚æœä¸€ä¸ªä¸»äººæœ‰20å¤´åƒµå°¸ï¼Œè€Œç¬¬ä¸€å¤´è¢«æŒªèµ°äº†ï¼Œé‚£ä¸ºäº†ä¿æŒæ•°ç»„çš„é¡ºåºï¼Œæˆ‘ä»¬å¾—åš19ä¸ªå†™æ“ä½œã€‚<br>ç”±äº<em>å†™å…¥å­˜å‚¨æ˜¯Solidityä¸­æœ€è´¹gasçš„æ“ä½œä¹‹ä¸€</em>ï¼Œä½¿å¾—æ¢ä¸»å‡½æ•°çš„æ¯æ¬¡è°ƒç”¨éƒ½éå¸¸æ˜‚è´µã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™èŠ±è´¹çš„gaséƒ½ä¸åŒï¼å…·ä½“è¿˜å–å†³äºç”¨æˆ·åœ¨åŸä¸»å†›å›¢ä¸­çš„åƒµå°¸å¤´æ•°ï¼Œä»¥åŠç§»èµ°çš„åƒµå°¸æ‰€åœ¨çš„ä½ç½®ã€‚ä»¥è‡³äºç”¨æˆ·éƒ½ä¸çŸ¥é“åº”è¯¥æ”¯ä»˜å¤šå°‘gasã€‚</li></ol><blockquote><p>æ³¨æ„ï¼šå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ•°ç»„ä¸­æœ€åä¸€ä¸ªåƒµå°¸å¾€å‰æŒªæ¥å¡«è¡¥ç©ºæ§½ï¼Œå¹¶å°†æ•°ç»„é•¿åº¦å‡å°‘ä¸€ã€‚ä½†è¿™æ ·æ¯åšä¸€ç¬”äº¤æ˜“ï¼Œéƒ½ä¼šæ”¹å˜åƒµå°¸å†›å›¢çš„ç§©åºã€‚</p></blockquote><p>æ­¤æ—¶æˆ‘ä»¬å°±åº”è¯¥é¿å…è¿™ç§é«˜æ˜‚çš„æ“ä½œï¼Œä½¿ç”¨å¦ä¸€ç§æ–¹æ¡ˆæ¥è§£å†³ã€‚ä¸Šé¢æåˆ°viewä¿®é¥°çš„å‡½æ•°ä»å¤–éƒ¨è°ƒç”¨æ˜¯å…è´¹çš„ï¼Œè€Œä¸”æˆ‘ä»¬ä¹Ÿåªæ˜¯ä»åŒºå—é“¾ä¸­è¯»å–æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨<code>getZombiesByOwner</code>å‡½æ•°ä¸­ä¸€ä¸ªforå¾ªç¯éå†æ•´ä¸ªåƒµå°¸æ•°ç»„<code>zombies</code>ï¼ŒæŠŠå±äºæŸä¸ªä¸»äººçš„åƒµå°¸æŒ‘å‡ºæ¥æ„å»ºå‡ºåƒµå°¸æ•°ç»„ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„transferå‡½æ•°å°†ä¼šä¾¿å®œå¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æŒªåŠ¨å­˜å‚¨é‡Œçš„åƒµå°¸æ•°ç»„é‡æ–°æ’åºï¼Œæ€»ä½“ä¸Šè¿™ä¸ªæ–¹æ³•ä¼šæ›´ä¾¿å®œï¼Œå°±æ˜¯æœ‰ç‚¹åå¸¸ã€‚</p><blockquote><p>åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œéå†å¤§æ•°æ®é›†åˆéƒ½æ˜¯æ˜‚è´µçš„ã€‚ä½†æ˜¯åœ¨Solidityä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªæ ‡è®°äº†<code>external view</code>çš„å‡½æ•°ï¼Œéå†æ¯”storageè¦ä¾¿å®œå¤ªå¤šï¼Œå› ä¸ºviewå‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•èŠ±é”€ã€‚ ï¼ˆgaså¯æ˜¯çœŸé‡‘ç™½é“¶å•Šï¼ï¼‰ã€‚</p></blockquote><p>æœ€å<code>getZombiesByOwner</code>çš„å®ç°ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns(uint[]) &#123;</span><br><span class="line">  uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">  uint counter = 0;</span><br><span class="line">  for (uint i = 0; i &lt; zombies.length; i++) &#123;</span><br><span class="line">    if (zombieToOwner[i] == _owner) &#123;</span><br><span class="line">      result[counter] = i;</span><br><span class="line">      counter++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éšæœºæ•°"><a href="#éšæœºæ•°" class="headerlink" title="éšæœºæ•°"></a>éšæœºæ•°</h2><p>ç›¸ä¿¡å¤§å®¶åœ¨æ—¥å¸¸å¼€å‘ä¸­å…ä¸äº†ç”¨éšæœºæ•°ï¼Œä½†æ˜¯åœ¨åŒºå—é“¾ä¸­å¦‚ä½•ä½¿ç”¨éšæœºæ•°å‘¢ï¼ŸåŒºå—é“¾ä¸­çš„éšæœºæ•°ä¸ä¼ ç»Ÿç¨‹åºä¸­çš„éšæœºæ•°ä¸ä¸€æ ·æ˜¯å› ä¸ºï¼ŒåŒºå—é“¾æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œç¯å¢ƒï¼Œå¹¶ä¸”ä¸ºäº†ä¸å¯ç¯¡æ”¹æ€§ï¼Œéœ€è¦nå°æœºå™¨åœ¨åŒä¸€æ—¶åˆ»çš„æ‰§è¡Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨åŒä¸€æ—¶åˆ»éšæœºæ•°æ˜¯ä¸€æ ·çš„ã€‚</p><p>Solidityä¸­æœ€å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨æ˜¯<code>keccak256</code>å“ˆå¸Œå‡½æ•°ã€‚<br>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç”Ÿæˆä¸€äº›éšæœºæ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”Ÿæˆä¸€ä¸ª0åˆ°100çš„éšæœºæ•°:</span></span><br><span class="line">uint randNonce = <span class="number">0</span>;</span><br><span class="line">uint random = uint(keccak256(now, msg.sender, randNonce)) % <span class="number">100</span>;</span><br><span class="line">randNonce++;</span><br><span class="line">uint random2 = uint(keccak256(now, msg.sender, randNonce)) % <span class="number">100</span>;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•é¦–å…ˆæ‹¿åˆ°nowçš„æ—¶é—´æˆ³ã€msg.senderã€ä»¥åŠä¸€ä¸ªè‡ªå¢æ•°nonce(ä¸€ä¸ªä»…ä¼šè¢«ä½¿ç”¨ä¸€æ¬¡çš„æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå¯¹ç›¸åŒçš„è¾“å…¥å€¼è°ƒç”¨ä¸€æ¬¡ä»¥ä¸Šå“ˆå¸Œå‡½æ•°äº†)ã€‚<br>ç„¶ååˆ©ç”¨<code>keccak</code>æŠŠè¾“å…¥çš„å€¼è½¬å˜ä¸ºä¸€ä¸ªå“ˆå¸Œå€¼, å†å°†å“ˆå¸Œå€¼è½¬æ¢ä¸ºuint, ç„¶ååˆ©ç”¨<code>%100</code>æ¥å–æœ€åä¸¤ä½, å°±ç”Ÿæˆäº†ä¸€ä¸ª0åˆ°100ä¹‹é—´éšæœºæ•°äº†ã€‚</p><blockquote><p>è¿™ä¸ªæ–¹æ³•å¾ˆå®¹æ˜“è¢«ä¸è¯šå®çš„èŠ‚ç‚¹æ”»å‡»</p></blockquote><p>ä¸è¯šå®èŠ‚ç‚¹æ˜¯åˆ©ç”¨éšæœºå‡½æ•°è¿›è¡Œæ”»å‡»çš„ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¡¬å¸ç¿»è½¬åˆçº¦â€“æ­£é¢ä½ èµ¢åŒå€é’±ï¼Œåé¢ä½ è¾“æ‰æ‰€æœ‰çš„é’±ã€‚å‡å¦‚å®ƒä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥å†³å®šæ˜¯æ­£é¢è¿˜æ˜¯åé¢(random&gt;=50ç®—æ­£é¢, random&lt;50ç®—åé¢)ã€‚<br>æ­¤æ—¶å¦‚æœæˆ‘æ­£è¿è¡Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å¯ä»¥åªå¯¹æˆ‘è‡ªå·±çš„èŠ‚ç‚¹å‘å¸ƒä¸€ä¸ªäº‹åŠ¡ï¼Œ<em>ä¸”ä¸åˆ†äº«å®ƒ</em>ã€‚æˆ‘å¯ä»¥è¿è¡Œç¡¬å¸ç¿»è½¬æ–¹æ³•æ¥å·çª¥æˆ‘çš„è¾“èµ¢ã€‚<br>å¦‚æœæˆ‘è¾“äº†ï¼Œæˆ‘å°±ä¸æŠŠè¿™ä¸ªäº‹åŠ¡åŒ…å«è¿›æˆ‘è¦è§£å†³çš„ä¸‹ä¸€ä¸ªåŒºå—ä¸­å»ã€‚æˆ‘å¯ä»¥ä¸€ç›´è¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œç›´åˆ°æˆ‘èµ¢å¾—äº†ç¡¬å¸ç¿»è½¬å¹¶è§£å†³äº†ä¸‹ä¸€ä¸ªåŒºå—ï¼Œç„¶åè·åˆ©ã€‚</p><p>å½“ç„¶ï¼Œå› ä¸ºç½‘ç»œä¸Šæˆåƒä¸Šä¸‡çš„ä»¥å¤ªåŠèŠ‚ç‚¹éƒ½åœ¨ç«äº‰è§£å†³ä¸‹ä¸€ä¸ªåŒºå—ï¼Œæˆ‘èƒ½æˆåŠŸè§£å†³ä¸‹ä¸€ä¸ªåŒºå—çš„å‡ ç‡éå¸¸ä¹‹ä½ã€‚è¿™å°†èŠ±è´¹æˆ‘ä»¬å·¨å¤§çš„è®¡ç®—èµ„æºæ¥å¼€å‘è¿™ä¸ªè·åˆ©æ–¹æ³•ï¼Œä½†æ˜¯å¦‚æœå¥–åŠ±å¼‚å¸¸åœ°é«˜(æ¯”å¦‚æˆ‘å¯ä»¥åœ¨ç¡¬å¸ç¿»è½¬å‡½æ•°ä¸­èµ¢å¾—1ä¸ªäº¿)ï¼Œé‚£å°±å¾ˆå€¼å¾—å»æ”»å‡»äº†ã€‚</p><p>æ‰€ä»¥å°½ç®¡è¿™ä¸ªæ–¹æ³•åœ¨ä»¥å¤ªåŠä¸Šä¸å®‰å…¨ï¼Œåœ¨å®é™…ä¸­ï¼Œé™¤éæˆ‘ä»¬çš„éšæœºå‡½æ•°æœ‰ä¸€å¤§ç¬”é’±åœ¨ä¸Šé¢ï¼Œä½ æ¸¸æˆçš„ç”¨æˆ·ä¸€èˆ¬æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºå»æ”»å‡»çš„ã€‚</p><p>å› æ­¤æˆ‘ä»¬å†³å®šæ¥å—è¿™ä¸ªä¸è¶³ä¹‹å¤„ï¼Œä½¿ç”¨è¿™ä¸ªç®€å•çš„éšæœºæ•°ç”Ÿæˆå‡½æ•°ã€‚ä½†æ˜¯è¦è°¨è®°å®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚</p><!--åœ¨ä»¥å¤ªåŠä¸Šï¼Œå½“ä½ åœ¨ä¸€ä¸ªåˆçº¦ä¸Šè°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œä½ ä¼šæŠŠå®ƒå¹¿æ’­ç»™ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…åœ¨ç½‘ç»œä¸Šçš„transactionèŠ‚ç‚¹ä»¬ã€‚ç½‘ç»œä¸Šçš„èŠ‚ç‚¹å°†æ”¶é›†å¾ˆå¤šäº‹åŠ¡ï¼Œè¯•ç€æˆä¸ºç¬¬ä¸€ä¸ªè§£å†³è®¡ç®—å¯†é›†å‹æ•°å­¦é—®é¢˜çš„äººï¼Œä½œä¸º"å·¥ä½œè¯æ˜"ï¼Œç„¶åå°†"å·¥ä½œè¯æ˜"(Proof of Work, PoW)å’Œäº‹åŠ¡ä¸€èµ·ä½œä¸ºä¸€ä¸ªblockå‘å¸ƒåœ¨ç½‘ç»œä¸Šã€‚ä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹è§£å†³äº†ä¸€ä¸ªPoW, å…¶ä»–èŠ‚ç‚¹å°±ä¼šåœæ­¢å°è¯•è§£å†³è¿™ä¸ªPoWï¼Œå¹¶éªŒè¯å…¶ä»–èŠ‚ç‚¹çš„äº‹åŠ¡åˆ—è¡¨æ˜¯æœ‰æ•ˆçš„ï¼Œç„¶åæ¥å—è¿™ä¸ªèŠ‚ç‚¹è½¬è€Œå°è¯•è§£å†³ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚--><p>æ¸¸æˆä¸­çš„éšæœºå‡½æ•°åº”ç”¨åœ¨ä¸å…¶å®ƒåƒµå°¸æ‰“æ¶çš„åœºæ™¯ä¸Šï¼Œç”¨æ¥å†³å®šæ˜¯å¦å–èƒœï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^<span class="number">0.4</span><span class="number">.19</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;./zombiehelper.sol&quot;</span>;</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper &#123;</span><br><span class="line">  uint randNonce = <span class="number">0</span>;</span><br><span class="line">  uint attackVictoryProbability = <span class="number">70</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">randMod</span>(<span class="params">uint _modulus</span>) <span class="title">internal</span> <span class="title">returns</span>(<span class="params">uint</span>) </span>&#123;</span><br><span class="line">    randNonce++;</span><br><span class="line">    <span class="keyword">return</span> uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">attack</span>(<span class="params">uint _zombieId, uint _targetId</span>) <span class="title">external</span> <span class="title">ownerOf</span>(<span class="params">_zombieId</span>) </span>&#123;</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(<span class="number">100</span>);</span><br><span class="line">    <span class="keyword">if</span> (rand &lt;= attackVictoryProbability) &#123;</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, <span class="string">&quot;zombie&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      myZombie.lossCount++;</span><br><span class="line">      enemyZombie.winCount++;</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="è®¢é˜…äº‹ä»¶"><a href="#è®¢é˜…äº‹ä»¶" class="headerlink" title="è®¢é˜…äº‹ä»¶"></a>è®¢é˜…äº‹ä»¶</h2><p>ä¸€ä¸ªå®Œæ•´å¯ç”¨çš„DAppé™¤äº†æ™ºèƒ½åˆçº¦å¿…ç„¶ä¹Ÿä¼šåŒ…æ‹¬å‰ç«¯åº”ç”¨ï¼Œè¿™æ ·æ‰èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„è®©ç”¨æˆ·ä½¿ç”¨ï¼Œé‚£ä¹ˆå‰ç«¯åº”ç”¨å¦‚ä½•åŠæ—¶çš„æ„ŸçŸ¥åˆçº¦ä¸Šçš„å˜åŒ–å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡<em>è®¢é˜…äº‹ä»¶</em>ã€‚</p><p><a href="http://bigdatadecode.top/cryptozombies-src-parse.html">cryptozombiesæºç è§£æä¸€</a>ä¸­zombiefactory.solæœ‰ä¸ªäº‹ä»¶<code>NewZombie</code>ï¼Œæ¯æ¬¡æ–°å»ºä¸€ä¸ªåƒµå°¸ä¹‹åï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªæ—¶é—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯ä¸­é€šè¿‡Web3.jsè®¢é˜…ä¸€ä¸ªäº‹ä»¶ï¼Œè¿™æ ·Web3æä¾›è€…å°±å¯ä»¥åœ¨æ¯æ¬¡äº‹ä»¶å‘ç”Ÿåè§¦å‘ä¸€äº›ä»£ç é€»è¾‘ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.events.NewZombie()</span><br><span class="line">.on(<span class="string">&quot;data&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> zombie = event.returnValues;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;ä¸€ä¸ªæ–°åƒµå°¸è¯ç”Ÿäº†ï¼&quot;</span>, zombie.zombieId, zombie.name, zombie.dna);</span><br><span class="line">&#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="built_in">console</span>.error);</span><br></pre></td></tr></table></figure><p><code>NewZombie</code>äº‹ä»¶åœ¨æ¯ä¸ªæ–°å»ºåƒµå°¸çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ï¼Œè€Œä¸Šè¿°ä»£ç æ˜¯ç›‘å¬<code>NewZombie</code>çš„æ¯æ¬¡è§¦å‘ï¼Œæ‰€ä»¥æ— è®ºè°çš„åƒµå°¸æ–°å»ºæˆ‘éƒ½ä¼šæ”¶åˆ°ä¸€æ¬¡å¼¹çª—ä¿¡æ¯ï¼Œè¿™å¯¹æˆ‘å¯å¾ˆä¸å‹å¥½ï¼Œæˆ‘åªå…³å¿ƒæˆ‘å½“è‡ªå·±çš„åƒµå°¸å†›å›¢å¢åŠ æˆå‘˜æ—¶æé†’æˆ‘ï¼Œè¿™ä¸ªæ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><blockquote><p>indexedå…³é”®å­—å¯ç”¨äºè¿‡æ»¤event </p></blockquote><p>ä¸ºäº†ç­›é€‰ä»…å’Œå½“å‰ç”¨æˆ·ç›¸å…³çš„äº‹ä»¶ï¼ŒSolidityåˆçº¦å¿…é¡»ä½¿ç”¨<code>indexed</code>å…³é”®å­—ï¼Œå°±åƒæˆ‘ä»¬åœ¨ERC721å®ç°ä¸­çš„<code>Transfer</code>äº‹ä»¶ä¸­é‚£æ ·ï¼š<br><code>event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</code><br>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå› ä¸º_fromå’Œ_toéƒ½æ˜¯indexedï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨å‰ç«¯äº‹ä»¶ç›‘å¬ä¸­è¿‡æ»¤äº‹ä»¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.events.Transfer(&#123; <span class="attr">filter</span>: &#123; <span class="attr">_to</span>: userAccount &#125; &#125;)</span><br><span class="line">.on(<span class="string">&quot;data&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = event.returnValues;</span><br><span class="line">  <span class="comment">// å½“å‰ç”¨æˆ·æ›´æ–°äº†ä¸€ä¸ªåƒµå°¸ï¼æ›´æ–°ç•Œé¢æ¥æ˜¾ç¤º</span></span><br><span class="line">&#125;).on(<span class="string">&#x27;error&#x27;</span>, <span class="built_in">console</span>.error);</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°äº†å§ï¼Œä½¿ç”¨<code>event</code>å’Œ<code>indexed</code>å­—æ®µå¯¹äºç›‘å¬åˆçº¦ä¸­çš„æ›´æ”¹å¹¶å°†å…¶<em>åæ˜ åˆ°DAppçš„å‰ç«¯ç•Œé¢ä¸­æ˜¯éå¸¸æœ‰ç”¨çš„åšæ³•</em>ã€‚</p><p>ä¹Ÿå¯ä»¥æŸ¥è¯¢è¿‡å»çš„äº‹ä»¶ï¼ŒæŸ¥è¯¢è¿‡å»äº‹ä»¶ä½¿ç”¨<code>getPastEvents</code>æ–¹æ³•ï¼Œä½¿ç”¨è¿‡æ»¤å™¨<code>fromBlock</code>å’Œ<code>toBlock</code>ç»™Solidityä¸€ä¸ªäº‹ä»¶æ—¥å¿—çš„æ—¶é—´èŒƒå›´(â€œblockâ€ åœ¨è¿™é‡Œä»£è¡¨ä»¥å¤ªåŠåŒºå—ç¼–å·)ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cryptoZombies.getPastEvents(<span class="string">&quot;NewZombie&quot;</span>, &#123; <span class="attr">fromBlock</span>: <span class="number">0</span>, <span class="attr">toBlock</span>: <span class="string">&#x27;latest&#x27;</span> &#125;)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">events</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// events æ˜¯å¯ä»¥ç”¨æ¥éå†çš„ `event` å¯¹è±¡ </span></span><br><span class="line">  <span class="comment">// è¿™æ®µä»£ç å°†è¿”å›ç»™æˆ‘ä»¬ä»å¼€å§‹ä»¥æ¥åˆ›å»ºçš„åƒµå°¸åˆ—è¡¨</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æœ‰äº›ç‰›é€¼çš„åŒå­¦çœ‹åˆ°è¿™é‡Œå¯èƒ½å°±æƒ³åˆ°äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç”¨ä¾‹ï¼š<em>ç”¨äº‹ä»¶æ¥ä½œä¸ºä¸€ç§æ›´ä¾¿å®œçš„å­˜å‚¨</em>ã€‚ä½†æ˜¯è¿™é‡Œçš„çŸ­æ¿æ˜¯ï¼Œ<strong>äº‹ä»¶ä¸èƒ½ä»æ™ºèƒ½åˆçº¦æœ¬èº«è¯»å–</strong>ã€‚ä½†æ˜¯ï¼Œ<strong>å¦‚æœä½ æœ‰ä¸€äº›æ•°æ®éœ€è¦æ°¸ä¹…æ€§åœ°è®°å½•åœ¨åŒºå—é“¾ä¸­ä»¥ä¾¿å¯ä»¥åœ¨åº”ç”¨çš„å‰ç«¯ä¸­è¯»å–ï¼Œè¿™å°†æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç”¨ä¾‹</strong>ã€‚è¿™äº›æ•°æ®ä¸ä¼šå½±å“æ™ºèƒ½åˆçº¦å‘å‰çš„çŠ¶æ€ã€‚</p><p>åƒµå°¸æ¸¸æˆä¸­å°±æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œ<em>ç”¨äº‹ä»¶æ¥ä½œä¸ºåƒµå°¸æˆ˜æ–—çš„å†å²çºªå½•</em>â€“æˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡åƒµå°¸æ”»å‡»åˆ«äººä»¥åŠæœ‰ä¸€æ–¹èƒœå‡ºçš„æ—¶å€™äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ã€‚æ™ºèƒ½åˆçº¦ä¸éœ€è¦è¿™äº›æ•°æ®æ¥è®¡ç®—ä»»ä½•æ¥ä¸‹æ¥çš„äº‹æƒ…ï¼Œä½†æ˜¯è¿™å¯¹æˆ‘ä»¬åœ¨å‰ç«¯å‘ç”¨æˆ·å±•ç¤ºæ¥è¯´æ˜¯éå¸¸æœ‰ç”¨çš„ä¸œè¥¿ã€‚</p><p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ˜¯é’ˆå¯¹Web3.jsæœ€æ–°ç‰ˆ1.0çš„ï¼Œæ­¤ç‰ˆæœ¬ä½¿ç”¨äº†WebSocketsæ¥è®¢é˜…äº‹ä»¶ã€‚ä½†æ˜¯ï¼ŒMetaMaskå°šä¸”ä¸æ”¯æŒæœ€æ–°çš„äº‹ä»¶APIã€‚<br>æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¿…é¡»ä½¿ç”¨ä¸€ä¸ªå•ç‹¬Web3æä¾›è€…ï¼Œå®ƒé’ˆå¯¹äº‹ä»¶æä¾›äº†WebSocketsæ”¯æŒã€‚ æˆ‘ä»¬å¯ä»¥ç”¨Infuraæ¥åƒå®ä¾‹åŒ–ç¬¬äºŒä»½æ‹·è´ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> web3Infura = <span class="keyword">new</span> Web3(<span class="keyword">new</span> Web3.providers.WebsocketProvider(<span class="string">&quot;wss://mainnet.infura.io/ws&quot;</span>));</span><br><span class="line"><span class="keyword">var</span> czEvents = <span class="keyword">new</span> web3Infura.eth.Contract(cryptoZombiesABI, cryptoZombiesAddress);</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å°†ä½¿ç”¨<code>czEvents.events.Transfer</code>æ¥ç›‘å¬äº‹ä»¶ï¼Œè€Œä¸å†ä½¿ç”¨<code>cryptoZombies.events.Transfer</code>ã€‚</p><p>è¿™æ˜¯æˆ‘è·Ÿå®Œè¿™ä¸ªæ•™ç¨‹ä¹‹åçš„ä¸€äº›æ€»ç»“å§ï¼Œè¿˜æœ‰ä¸€äº›å†…å®¹æ²¡æœ‰æ€»ç»“ï¼Œéšåæœ‰æ—¶é—´å†æ€»ç»“ä¸‹ï¼Œé¡¹ç›®çš„æºä»£ç å¯ä»<a href="https://github.com/hunshenshi/cryptozombies">github</a>ä¸Šæµè§ˆã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;http://bigdatadecode.top/cryptozombies-src-parse.html&quot;&gt;cryptozombiesæºç è§£æä¸€&lt;/a&gt;ä¸­å¯¹ä»¥å¤ªåŠå¼€å‘ä¸­çš„&lt;em&gt;äº‹ä»¶&lt;/em&gt;ä¸&lt;em&gt;åˆçº¦äº¤äº’&lt;/em&gt;è¿›è¡Œäº†ä»‹ç»ï¼Œçœ‹è¿‡è¿™ç¯‡æ–‡ç« çš„åŒå­¦æˆ‘ç›¸ä¿¡å¯¹Dappå¼€å‘ä¹Ÿæœ‰äº†ä¸€ä¸ªåˆæ­¥çš„äº†è§£ï¼Œä¸‹é¢æˆ‘ä»¬ç»§ç»­å­¦ä¹ ä¸€äº›æ™ºèƒ½åˆçº¦å¼€å‘ä¸­ç‰¹æ€§ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="BlockChain" scheme="http://yuanba.tech/categories/BlockChain/"/>
    
    
    <category term="BlockChain" scheme="http://yuanba.tech/tags/BlockChain/"/>
    
    <category term="Ethereum" scheme="http://yuanba.tech/tags/Ethereum/"/>
    
    <category term="crypto" scheme="http://yuanba.tech/tags/crypto/"/>
    
    <category term="cryptozombies" scheme="http://yuanba.tech/tags/cryptozombies/"/>
    
  </entry>
  
</feed>
